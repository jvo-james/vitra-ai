<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Dashboard</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <style>
    /*──────────────────────────────────────────────────────────────────────────────
      VARIABLES & THEME
    ──────────────────────────────────────────────────────────────────────────────*/
    :root {
      --primary: #4A78C4;
      --accent: #FFA500;
      --bg: #F0F4FF;
      --surface: #FFFFFF;
      --text: #1A1A1A;
      --muted: #555555;
      --shadow-light: rgba(0,0,0,0.1);
      --shadow-dark: rgba(0,0,0,0.4);
      --radius: 1rem;
      --padding: 1.5rem;
      --gap: 1rem;
      --max-width: 1200px;
    }
    html.dark {
      --bg: #1F2233;
      --surface: #2B2E44;
      --text: #E0E0E0;
      --muted: #888888;
      --shadow-light: rgba(0,0,0,0.4);
      --shadow-dark: rgba(0,0,0,0.7);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      RESET & BASE
    ──────────────────────────────────────────────────────────────────────────────*/
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: background-color .3s ease, color .3s ease, box-shadow .3s ease;
    }
    html, body {
      height: 100%;
      width: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: 'Montserrat', sans-serif;
    }
    a { text-decoration: none; color: inherit; }
    button { font: inherit; cursor: pointer; background: none; border: none; }

    /*──────────────────────────────────────────────────────────────────────────────
      LAYOUT CONTAINER
    ──────────────────────────────────────────────────────────────────────────────*/
    body {
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /*──────────────────────────────────────────────────────────────────────────────
      SIDEBAR
    ──────────────────────────────────────────────────────────────────────────────*/
    .sidebar {
      width: 240px;
      background: var(--surface);
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: 2px 0 8px var(--shadow-light);
      z-index: 10;
    }
    html.dark .sidebar {
      box-shadow: 2px 0 8px var(--shadow-dark);
    }
    .sidebar .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }
    .sidebar .logo svg {
      width: 2rem;
      height: 2rem;
      fill: var(--primary);
    }
    .sidebar nav {
      margin-top: 2rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .sidebar nav a {
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text);
      font-weight: 500;
      transition: background-color .2s, color .2s;
    }
    .sidebar nav a i {
      font-size: 1.25rem;
      color: var(--primary);
      transition: color .2s;
    }
    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: var(--primary);
      color: var(--surface);
    }
    .sidebar nav a:hover i,
    .sidebar nav a.active i {
      color: var(--surface);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      MAIN AREA
    ──────────────────────────────────────────────────────────────────────────────*/
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      TOPBAR
    ──────────────────────────────────────────────────────────────────────────────*/
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: var(--surface);
      box-shadow: 0 2px 8px var(--shadow-light);
      z-index: 5;
    }
    html.dark .topbar {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .topbar .welcome {
      font-size: 1.25rem;
      font-weight: 500;
    }
    .topbar .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .topbar button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      background: var(--primary);
      color: var(--surface);
      font-weight: 500;
      box-shadow: 0 2px 8px var(--shadow-light);
    }
    html.dark .topbar button {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .topbar i {
      font-size: 1.5rem;
      color: var(--text);
      cursor: pointer;
    }
    .topbar i:hover {
      color: var(--primary);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      CONTENT GRID
    ──────────────────────────────────────────────────────────────────────────────*/
    .content {
      padding: 2rem;
      max-width: var(--max-width);
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--gap);
    }
    @media(max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
        padding: 1rem;
      }
    }

    /*──────────────────────────────────────────────────────────────────────────────
      CARD
    ──────────────────────────────────────────────────────────────────────────────*/
    .card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow-light);
      padding: var(--padding);
      display: flex;
      flex-direction: column;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    html.dark .card {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px var(--shadow-light);
    }
    html.dark .card:hover {
      box-shadow: 0 4px 16px var(--shadow-dark);
    }
    .card h4 {
      margin-bottom: 1rem;
      font-size: 1.25rem;
      color: var(--text);
    }
    .card p {
      margin-bottom: 1rem;
      color: var(--muted);
      flex: 1;
    }
    .card .stat {
      font-size: 2rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    .card a {
      margin-top: auto;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--primary);
      color: var(--surface);
      border-radius: var(--radius);
      font-weight: 500;
      transition: background-color .2s, transform .2s;
    }
    .card a:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      CHART CARD
    ──────────────────────────────────────────────────────────────────────────────*/
    .chart-card {
      grid-column: 1 / -1;
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow-light);
      padding: var(--padding);
      transition: transform .2s, box-shadow .2s;
    }
    html.dark .chart-card {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .chart-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px var(--shadow-light);
    }
    html.dark .chart-card:hover {
      box-shadow: 0 4px 16px var(--shadow-dark);
    }
    .chart-card h4 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--text);
    }
    .chart-container {
      width: 100%;
      height: 300px;
    }

    /*──────────────────────────────────────────────────────────────────────────────
      DATE FILTER
    ──────────────────────────────────────────────────────────────────────────────*/
    .filter-bar {
      grid-column: 1 / -1;
      display: flex;
      gap: 1rem;
      align-items: center;
      background: var(--surface);
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow-light);
      margin-bottom: var(--gap);
    }
    html.dark .filter-bar {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .filter-bar label {
      font-weight: 500;
      color: var(--text);
    }
    .filter-bar input {
      padding: 0.5rem;
      border: 1px solid var(--muted);
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
      transition: border-color .2s, box-shadow .2s;
    }
    .filter-bar input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74,120,196,0.3);
      outline: none;
    }
    html.dark .filter-bar input {
      background: var(--surface);
      border-color: var(--muted);
      color: var(--text);
    }
    .filter-bar button {
      padding: 0.6rem 1.2rem;
      background: var(--primary);
      color: var(--surface);
      border-radius: var(--radius);
      font-weight: 500;
      box-shadow: 0 2px 8px var(--shadow-light);
      transition: background-color .2s, transform .2s;
    }
    .filter-bar button:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
    html.dark .filter-bar button {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }

    /*──────────────────────────────────────────────────────────────────────────────
      TOAST
    ──────────────────────────────────────────────────────────────────────────────*/
    .toast {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      background: var(--primary);
      color: var(--surface);
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow-light);
      opacity: 0;
      transition: transform .3s ease, opacity .3s ease;
      z-index: 200;
      font-weight: 500;
    }
    html.dark .toast {
      box-shadow: 0 2px 8px var(--shadow-dark);
    }
    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>

<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span>Vitra AI</span>
    </div>
    <nav>
      <a href="#" class="active"><i class="fas fa-chart-pie"></i> Dashboard</a>
      <a href="herbal.html"><i class="fas fa-leaf"></i> Herbal Medicine</a>
      <a href="psychology.html"><i class="fas fa-brain"></i> Psychology & MH</a>
      <a href="dietetics.html"><i class="fas fa-apple-alt"></i> Dietetics</a>
      <a href="epharmacy.html"><i class="fas fa-pills"></i> E-Pharmacy</a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i> Consultation</a>
      <a href="profile.html"><i class="fas fa-user-circle"></i> Profile</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="welcome">Hello, <strong id="userName">User</strong>!</div>
      <div class="controls">
        <i id="themeToggle" class="fas fa-moon"></i>
        <button id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
      </div>
    </header>

    <!-- CONTENT GRID -->
    <section class="content">
      <!-- Date Filter Bar -->
      <div class="filter-bar">
        <label for="startDate">From:</label>
        <input type="date" id="startDate" value="">
        <label for="endDate">To:</label>
        <input type="date" id="endDate" value="">
        <button id="filterBtn"><i class="fas fa-filter"></i> Apply Filter</button>
      </div>

      <!-- Card: Herbal Medicine Stats -->
      <div class="card">
        <h4>Herbal Medicine AI</h4>
        <div class="stat" id="herbalQueries">0</div>
        <p>Total AI queries processed in Herbal Medicine</p>
        <a href="herbal.html"><i class="fas fa-seedling"></i> Go to Herbal</a>
      </div>

      <!-- Card: Psychology & MH Stats -->
      <div class="card">
        <h4>Psychology & MH AI</h4>
        <div class="stat" id="psychQueries">0</div>
        <p>Total AI queries processed in Psychology & Mental Health</p>
        <a href="psychology.html"><i class="fas fa-brain"></i> Go to Psychology</a>
      </div>

      <!-- Card: Dietetics Stats -->
      <div class="card">
        <h4>Dietetics AI</h4>
        <div class="stat" id="dietQueries">0</div>
        <p>Total AI queries processed in Dietetics</p>
        <a href="dietetics.html"><i class="fas fa-utensils"></i> Go to Dietetics</a>
      </div>

      <!-- Card: E-Pharmacy Stats -->
      <div class="card">
        <h4>E-Pharmacy AI</h4>
        <div class="stat" id="pharmacyQueries">0</div>
        <p>Total AI queries processed in E-Pharmacy</p>
        <a href="epharmacy.html"><i class="fas fa-pills"></i> Go to E-Pharmacy</a>
      </div>

      <!-- Card: Consultation Booking Stats -->
      <div class="card">
        <h4>Consult Booking AI</h4>
        <div class="stat" id="consultQueries">0</div>
        <p>Total AI matches performed in Consult Booking</p>
        <a href="consult.html"><i class="fas fa-calendar-check"></i> Go to Consultation</a>
      </div>

      <!-- Chart: Queries Distribution by Sector -->
      <div class="chart-card">
        <h4>Queries Distribution by Sector</h4>
        <div class="chart-container">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>

      <!-- Chart: Daily Queries Over Time -->
      <div class="chart-card">
        <h4>Daily AI Queries (Last 7 Days)</h4>
        <div class="chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>
    </section>
  </div>

  <!-- TOAST NOTIFICATION -->
  <div id="toast" class="toast"></div>

  <!-- SCRIPTS -->
  <script>
    // ──────────────────────────────────────────────────────────────────────────────
    // FIREBASE INITIALIZATION
    // ──────────────────────────────────────────────────────────────────────────────
    const firebaseConfig = {
      apiKey: "AIzaSyBhaYOcLMXuobCT-vaXr-zXTZnBfaheAIY",
      authDomain: "vitra-ai-712ea.firebaseapp.com",
      projectId: "vitra-ai-712ea",
      storageBucket: "vitra-ai-712ea.appspot.com",
      messagingSenderId: "306868103753",
      appId: "1:306868103753:web:e2d7700f8ad34c1e17ed98"
    };
    firebase.initializeApp(firebaseConfig);

    document.addEventListener('DOMContentLoaded', () => {
      // ELEMENT REFERENCES
      const themeToggle = document.getElementById('themeToggle');
      const signOutBtn = document.getElementById('signOutBtn');
      const userNameEl = document.getElementById('userName');
      const toastEl = document.getElementById('toast');
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');
      const filterBtn = document.getElementById('filterBtn');

      // STATS ELEMENTS
      const herbalQueriesEl = document.getElementById('herbalQueries');
      const psychQueriesEl = document.getElementById('psychQueries');
      const dietQueriesEl = document.getElementById('dietQueries');
      const pharmacyQueriesEl = document.getElementById('pharmacyQueries');
      const consultQueriesEl = document.getElementById('consultQueries');

      // AUTH STATE
      firebase.auth().onAuthStateChanged(user => {
        if (!user) return window.location.href = 'index.html';
        userNameEl.textContent = user.displayName || "User";
      });

      // THEME TOGGLE
      themeToggle.onclick = () => {
        document.documentElement.classList.toggle('dark');
        themeToggle.classList.toggle('fa-moon');
        themeToggle.classList.toggle('fa-sun');
      };

      // SIGN OUT
      signOutBtn.onclick = () => {
        firebase.auth().signOut().then(() => {
          window.location.href = 'index.html';
        });
      };

      // TOAST FUNCTION
      function showToast(message) {
        toastEl.textContent = message;
        toastEl.classList.add('visible');
        setTimeout(() => toastEl.classList.remove('visible'), 3000);
      }

      // HELPER: GET CSS VARIABLE COLOR
      function varColor(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      }

      // ────────────────────────────────────────────────────────────────────────────
      // INITIAL DUMMY DATA (CAN REPLACE WITH REAL FIREBASE FETCH)
      // ────────────────────────────────────────────────────────────────────────────
      let statsData = {
        herbal: 124,
        psych: 98,
        diet: 76,
        pharmacy: 153,
        consult: 85,
        daily: [20, 22, 18, 25, 30, 28, 32], // last 7 days total
        labels: [] // will be set dynamically as dates
      };

      // FUNCTION TO GENERATE LAST 7 DAYS LABELS
      function generateLast7Days() {
        const labels = [];
        for (let i = 6; i >= 0; i--) {
          const d = new Date();
          d.setDate(d.getDate() - i);
          labels.push(d.toLocaleDateString('default', { month: 'short', day: 'numeric' }));
        }
        return labels;
      }
      statsData.labels = generateLast7Days();

      // DISPLAY STATS
      function displayStats() {
        herbalQueriesEl.textContent = statsData.herbal;
        psychQueriesEl.textContent = statsData.psych;
        dietQueriesEl.textContent = statsData.diet;
        pharmacyQueriesEl.textContent = statsData.pharmacy;
        consultQueriesEl.textContent = statsData.consult;
      }
      displayStats();

      // ────────────────────────────────────────────────────────────────────────────
      // CHARTS INITIALIZATION
      // ────────────────────────────────────────────────────────────────────────────
      // Distribution Doughnut Chart
      const distCtx = document.getElementById('distributionChart').getContext('2d');
      const distributionChart = new Chart(distCtx, {
        type: 'doughnut',
        data: {
          labels: ['Herbal', 'Psychology', 'Dietetics', 'E-Pharmacy', 'Consult'],
          datasets: [{
            data: [
              statsData.herbal,
              statsData.psych,
              statsData.diet,
              statsData.pharmacy,
              statsData.consult
            ],
            backgroundColor: [
              varColor('--primary'),
              varColor('--accent'),
              '#8BC34A',
              '#FF5722',
              '#3F51B5'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: varColor('--text') }
            }
          }
        }
      });

      // Daily Line Chart
      const dailyCtx = document.getElementById('dailyChart').getContext('2d');
      const dailyChart = new Chart(dailyCtx, {
        type: 'line',
        data: {
          labels: statsData.labels,
          datasets: [{
            label: 'Total Queries',
            data: statsData.daily,
            borderColor: varColor('--primary'),
            backgroundColor: 'rgba(74,120,196,0.1)',
            tension: 0.3,
            pointBackgroundColor: varColor('--primary'),
            fill: true
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: varColor('--text') },
              grid: { color: varColor('--muted') }
            },
            x: {
              ticks: { color: varColor('--text') },
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });

      // ────────────────────────────────────────────────────────────────────────────
      // FILTER FUNCTIONALITY (DATES)
      // ────────────────────────────────────────────────────────────────────────────
      filterBtn.onclick = () => {
        const start = startDateInput.value;
        const end = endDateInput.value;
        if (!start || !end) {
          showToast('Please pick both dates');
          return;
        }
        const startDate = new Date(start);
        const endDate = new Date(end);
        if (startDate > endDate) {
          showToast('Start date cannot be after end date');
          return;
        }
        // Dummy filter logic: randomize stats for demonstration
        statsData.herbal = Math.floor(Math.random() * 200);
        statsData.psych = Math.floor(Math.random() * 200);
        statsData.diet = Math.floor(Math.random() * 200);
        statsData.pharmacy = Math.floor(Math.random() * 200);
        statsData.consult = Math.floor(Math.random() * 200);
        statsData.daily = Array.from({ length: 7 }, () => Math.floor(Math.random() * 50 + 10));
        statsData.labels = generateLast7Days();

        // Update displays & charts
        displayStats();
        distributionChart.data.datasets[0].data = [
          statsData.herbal,
          statsData.psych,
          statsData.diet,
          statsData.pharmacy,
          statsData.consult
        ];
        distributionChart.update();
        dailyChart.data.labels = statsData.labels;
        dailyChart.data.datasets[0].data = statsData.daily;
        dailyChart.update();

        showToast('Statistics updated for selected range');
      };

      // SET DEFAULT DATES TO PAST WEEK
      const today = new Date().toISOString().split('T')[0];
      const prevWeek = new Date();
      prevWeek.setDate(prevWeek.getDate() - 7);
      startDateInput.value = prevWeek.toISOString().split('T')[0];
      endDateInput.value = today;
    });
  </script>
</body>
</html>
