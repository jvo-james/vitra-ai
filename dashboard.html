<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Dashboard</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>


<style>
  :root {
    --primary: #4A78C4;
    --secondary: #FFFFFF;
    --accent: #FF5722;
    --bg: #F7FAFE;
    --surface: #FFFFFF;
    --text: #1A1A1A;
    --muted: #555555;
    --radius: 0.75rem;
    --padding: 1.5rem;
    --gap: 1rem;
    --max-width: 1200px;
    --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-dark: 0 2px 8px rgba(0, 0, 0, 0.4);
    --transition: 0.3s ease;
  }

  html.dark {
    --bg: #1F2233;
    --surface: #2B2E44;
    --text: #E0E0E0;
    --muted: #888888;
    --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.4);
    --shadow-dark: 0 2px 8px rgba(255, 255, 255, 0.1);
  }

  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    transition: var(--transition);
  }

  html, body {
    width: 100%;
    height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: var(--bg);
    color: var(--text);
    scroll-behavior: smooth;
    line-height: 1.6;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  a:hover {
    color: var(--primary);
  }

  img {
    max-width: 100%;
    display: block;
  }

  ul {
    list-style: none;
  }

  button {
    font: inherit;
    cursor: pointer;
    border: none;
    background: none;
  }

  input, select, textarea {
    font: inherit;
  }

  h1, h2, h3, h4, h5, h6 {
    color: var(--primary);
  }

  p {
    color: var(--text);
    margin-bottom: var(--gap);
  }

    .navbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem var(--padding);
    box-shadow: var(--shadow);
    z-index: 1000;
  }

  .navbar .logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .navbar .logo svg {
    width: 2.3rem;
    height: 2.3rem;
    fill: var(--primary);
  }

  .navbar .logo .logo-text {
    font-size: 1.15rem;
    font-weight: 600;
    color: var(--primary);
  }

  .navbar ul {
    display: flex;
    gap: var(--gap);
  }

  .navbar ul li a {
    padding: 0.5rem;
    font-weight: 500;
    color: var(--text);
    transition: color 0.2s;
  }

  .navbar ul li a:hover {
    color: var(--primary);
  }

  .navbar .auth {
    display: flex;
    gap: 0.75rem;
  }

  .navbar .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    font-weight: 500;
    transition: background 0.2s, transform 0.2s;
  }

  .btn-primary {
    background: var(--primary);
    color: #fff;
  }

  .btn-primary:hover {
    background: #3A62A8;
    transform: translateY(-2px);
  }

  .btn-secondary {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
  }

  .btn-secondary:hover {
    background: var(--primary);
    color: var(--secondary);
    transform: translateY(-2px);
  }

  #themeToggle {
    font-size: 1.2rem;
    color: var(--muted);
    cursor: pointer;
    margin-left: var(--gap);
    transition: color 0.2s;
  }

  #themeToggle:hover {
    color: var(--primary);
  }

  .hamburger {
    display: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text);
  }

  @media (max-width: 768px) {
    .navbar ul,
    .navbar .auth {
      display: none;
    }
    .hamburger {
      display: block;
    }
  }

    .sidebar-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 900;
    display: none;
    opacity: 0;
    transition: opacity var(--transition);
  }

  .sidebar-overlay.show {
    display: block;
    opacity: 1;
  }

  .sidebar {
    position: fixed;
    top: 0; left: -260px;
    width: 260px; height: 100%;
    background: var(--surface);
    color: var(--text);
    padding: 2rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-shadow: var(--shadow-light);
    transition: left var(--transition);
    z-index: 1000;
  }

  html.dark .sidebar {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }

  .sidebar.show {
    left: 0;
  }

  .sidebar-nav a {
    display: block;
    padding: 0.75rem 0.5rem;
    font-size: 1.2rem;
    color: var(--text);
    border-radius: var(--radius);
    transition: background 0.2s, color 0.2s;
  }

  .sidebar-nav a:hover {
    background: rgba(74, 120, 196, 0.1);
    color: var(--primary);
  }

  .sidebar-auth {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .sidebar-auth button {
    width: 100%;
    padding: 0.75rem;
    justify-content: center;
    box-shadow: var(--shadow-light);
  }

  html.dark .sidebar-auth button {
    box-shadow: var(--shadow-dark);
  }

  .sidebar-theme {
    margin-top: 1rem;
    text-align: center;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--muted);
  }

  .sidebar-theme:hover {
    color: var(--primary);
  }

  main {
    margin: 0 auto;
    padding: calc(var(--padding) + 4rem) var(--padding) var(--padding);
    max-width: var(--max-width);
  }

  section {
    margin-bottom: 3rem;
  }

  h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--primary);
  }

  #greetingSection {
    text-align: center;
    margin-bottom: 2rem;
  }

  #greetingSection h2 {
    font-size: 2.25rem;
    margin-bottom: 0.5rem;
  }

  #greetingSection p {
    font-size: 1rem;
    color: var(--muted);
  }

  #quickAccess {
    background: var(--surface);
    padding: 3rem 0;
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
  }

  html.dark #quickAccess {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }

  #quickAccess .quick-access-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    text-align: center;
    padding: 0 var(--padding);
  }

  #quickAccess h2 {
    font-size: 2rem;
    margin-bottom: 1.5rem;
    color: var(--text);
  }

  #quickAccess .quick-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
  }

  #quickAccess .quick-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 1rem;
    color: var(--secondary);
    background: var(--primary);
    transition: background 0.2s, transform 0.2s;
    box-shadow: var(--shadow-light);
  }

  html.dark #quickAccess .quick-btn {
    box-shadow: var(--shadow-dark);
  }

  #quickAccess .quick-btn.btn-secondary {
    background: var(--secondary);
    color: var(--primary);
    border: 2px solid var(--primary);
  }

  #quickAccess .quick-btn i {
    font-size: 1.25rem;
  }

  #quickAccess .quick-btn:hover {
    background: #3A62A8;
    transform: translateY(-2px);
  }

  @media (max-width: 600px) {
    #quickAccess .quick-buttons {
      flex-direction: column;
      gap: 0.75rem;
    }
    #quickAccess .quick-btn {
      width: 100%;
      justify-content: center;
    }
  }

  .dashboard-section {
    background: var(--surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: var(--shadow-light);
    margin-bottom: 2rem;
  }

  html.dark .dashboard-section {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }

  .dashboard-section h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--primary);
  }

  .dashboard-section .card {
    display: flex;
    align-items: center;
    gap: var(--gap);
    background: var(--bg);
    border-radius: var(--radius);
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-light);
    position: relative;
  }

  html.dark .dashboard-section .card {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }

  .dashboard-section .card:last-child {
    margin-bottom: 0;
  }

  .dashboard-section .card i {
    font-size: 1.75rem;
    color: var(--primary);
  }

  .dashboard-section .card .details {
    flex: 1;
  }

  .dashboard-section .card .details h4 {
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 0.25rem;
    font-weight: 600;
  }

  .dashboard-section .card .details p {
    font-size: 0.95rem;
    color: var(--muted);
  }

  .dashboard-section .card .actions {
    display: flex;
    gap: 0.5rem;
  }

  .dashboard-section .card .btn-reschedule,
  .dashboard-section .card .btn-cancel {
    background: var(--primary);
    color: #fff;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background var(--transition), transform var(--transition);
    box-shadow: var(--shadow-light);
  }

  html.dark .dashboard-section .card .btn-reschedule,
  html.dark .dashboard-section .card .btn-cancel {
    box-shadow: var(--shadow-dark);
  }

  .dashboard-section .card .btn-reschedule i,
  .dashboard-section .card .btn-cancel i {
    font-size: 1rem;
  }

  .dashboard-section .card .btn-reschedule:hover {
    background: #3A62A8;
    transform: translateY(-2px);
  }

  .dashboard-section .card .btn-cancel:hover {
    background: #D4724F;
    transform: translateY(-2px);
  }

  #appointmentsContainer {
    margin-top: 1rem;
  }
  #appointmentsContainer p {
    text-align: center;
    color: var(--muted);
    font-size: 1rem;
    margin-top: 1rem;
  }

  #prescriptionsContainer {
    margin-top: 1rem;
  }
  #prescriptionsContainer .card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg);
    padding: 1rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    margin-bottom: 1rem;
  }
  html.dark #prescriptionsContainer .card {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  #prescriptionsContainer .card .details h4 {
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 0.25rem;
    font-weight: 600;
  }
  #prescriptionsContainer .card .details p {
    font-size: 0.95rem;
    color: var(--muted);
  }
  #prescriptionsContainer .card .actions button {
    background: var(--primary);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: background 0.2s, transform 0.2s;
    box-shadow: var(--shadow-light);
  }
  html.dark #prescriptionsContainer .card .actions button {
    box-shadow: var(--shadow-dark);
  }
  #prescriptionsContainer .card .actions button:hover {
    background: #3A62A8;
    transform: translateY(-2px);
  }
  #prescriptionsContainer p {
    text-align: center;
    color: var(--muted);
    margin-top: 1rem;
  }

  #nutritionContainer {
    margin-top: 1rem;
    text-align: center;
    font-size: 1rem;
    background: var(--surface);
    padding: var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
  }
  html.dark #nutritionContainer {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  #nutritionContainer p {
    margin-bottom: 0.75rem;
    color: var(--text);
    font-weight: 500;
  }
  #nutritionContainer a.btn-primary {
    margin-top: 0.75rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  #insightsContainer {
    margin-top: 1rem;
  }
  #insightsContainer .card {
    flex-direction: column;
    align-items: flex-start;
    background: var(--surface);
    padding: var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    margin-bottom: 1rem;
  }
  html.dark #insightsContainer .card {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  #insightsContainer .card .details h4 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: var(--text);
    font-weight: 600;
  }
  #insightsContainer .card .details p {
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
    color: var(--muted);
  }
  #insightsContainer .card a.btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    margin-top: 0.5rem;
  }

  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    background: var(--surface);
    padding: 1rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    margin-bottom: var(--gap);
  }
  html.dark .filter-bar {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  .filter-bar label {
    font-weight: 500;
    color: var(--text);
  }
  .filter-bar input {
    padding: 0.5rem;
    border: 1px solid var(--muted);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
    min-width: 120px;
  }
  .filter-bar input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(74, 120, 196, 0.3);
    outline: none;
  }
  html.dark .filter-bar input {
    background: var(--surface);
    border-color: var(--muted);
    color: var(--text);
  }
  .filter-bar button {
    padding: 0.6rem 1.2rem;
    background: var(--primary);
    color: var(--secondary);
    border-radius: var(--radius);
    font-weight: 500;
    box-shadow: var(--shadow-light);
    transition: background-color 0.2s, transform 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  html.dark .filter-bar button {
    box-shadow: var(--shadow-dark);
  }
  .filter-bar button:hover {
    background: var(--accent);
    transform: translateY(-2px);
  }

  .content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--gap);
    margin-top: var(--gap);
  }
  .content .card {
    background: var(--surface);
    padding: var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transition: transform var(--transition), box-shadow var(--transition);
  }
  html.dark .content .card {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  .content .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  .content .card h4 {
    font-size: 1.25rem;
    color: var(--text);
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  .content .card .stat {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
  }
  .content .card p {
    color: var(--muted);
    font-size: 0.95rem;
  }
  .content .card a {
    margin-top: auto;
    align-self: flex-start;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary);
    font-weight: 500;
    transition: color 0.2s;
  }
  .content .card a i {
    font-size: 1rem;
  }
  .content .card a:hover {
    color: var(--accent);
  }

  .charts-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap);
    padding: var(--padding);
  }
  .charts-row .chart-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    padding: var(--padding);
    flex: 1 1 300px;
    display: flex;
    flex-direction: column;
    gap: var(--gap);
  }
  html.dark .charts-row .chart-card {
    background: var(--surface);
    box-shadow: var(--shadow-dark);
  }
  .chart-card h4 {
    font-size: 1.25rem;
    color: var(--text);
    margin-bottom: 0.75rem;
    font-weight: 600;
  }
  .chart-container {
    position: relative;
    width: 100%;
    height: 250px;
  }
  @media (max-width: 768px) {
    .charts-row {
      flex-direction: column;
      padding: var(--padding) 0;
    }
    .charts-row .chart-card {
      width: 100%;
    }
  }

  .toast {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    background: var(--primary);
    color: var(--secondary);
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
    opacity: 0;
    pointer-events: none;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 200;
    font-weight: 500;
  }
  html.dark .toast {
    box-shadow: var(--shadow-dark);
  }
  .toast.visible {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  #profileModal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #profileModal:not([hidden]) {
    display: flex;
    opacity: 1;
  }
  #profileModal .modal-content {
    background: var(--surface);
    border-radius: var(--radius);
    padding: calc(var(--padding) * 1.2);
    max-width: 400px;
    width: 90%;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    position: relative;
    transform: translateY(-20px);
    animation: slideDown 0.3s forwards;
  }
  @keyframes slideDown {
    to { transform: translateY(0); }
  }
  #profileModal h3 {
    margin-bottom: 1rem;
    font-size: 1.5rem;
    color: var(--primary);
    text-align: center;
  }
  #profileModal label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text);
  }
  #profileModal input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--muted);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 1rem;
    margin-bottom: 1rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  #profileModal input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(74, 120, 196, 0.15);
  }
  html.dark #profileModal input {
    background: var(--surface);
    color: var(--text);
    border-color: var(--muted);
  }
  #profileModal button#saveProfileBtn {
    width: 100%;
    padding: 0.75rem;
    background: var(--primary);
    color: var(--secondary);
    font-size: 1rem;
    font-weight: 600;
    border-radius: var(--radius);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: background 0.2s ease, transform 0.2s ease;
  }
  #profileModal button#saveProfileBtn:hover {
    background: #3A62A8;
    transform: translateY(-2px);
  }
  html.dark #profileModal button#saveProfileBtn {
    background: var(--primary);
    color: #fff;
  }
  #profileModal .btn-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: transparent;
    color: var(--muted);
    font-size: 1.25rem;
    border: none;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.2s ease;
  }
  #profileModal .btn-close:hover {
    color: var(--primary);
    transform: scale(1.1);
  }
  html.dark #profileModal .btn-close {
    color: var(--muted);
  }

  #backToTop {
    position: fixed;
    bottom: 2rem; right: 2rem;
    display: none;
    background: var(--primary);
    color: var(--secondary);
    padding: 0.75rem;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: var(--shadow-light);
    z-index: 1000;
    transition: transform 0.2s;
  }
  html.dark #backToTop {
    box-shadow: var(--shadow-dark);
  }
  #backToTop:hover {
    transform: scale(1.1);
  }

  footer {
    background: var(--surface);
    padding: var(--padding);
    text-align: center;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
    margin-top: 3rem;
  }
  html.dark footer {
    background: var(--surface);
    box-shadow: 0 -2px 8px rgba(255, 255, 255, 0.05);
  }
  footer p {
    font-size: 0.9rem;
    color: var(--muted);
  }
  footer .socials {
    margin-top: 0.5rem;
  }
  footer .socials a {
    margin: 0 0.5rem;
    font-size: 1.2rem;
    color: var(--muted);
    transition: color 0.2s;
  }
  footer .socials a:hover {
    color: var(--primary);
  }

   @media (max-width: 400px) {
    html, body {
      font-size: 14px;
    }
    .navbar .logo .logo-text {
      font-size: 1.25rem;
    }
    .navbar .btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }
    #themeToggle {
      font-size: 1rem;
    }
    .quick-buttons {
      flex-direction: column;
    }
    .charts-row {
      flex-direction: column;
      padding: var(--padding) 0;
    }
    .charts-row .chart-card {
      width: 100%;
      padding: 1rem;
    }
    .chart-container {
      height: 200px;
    }
  }


#upcomingAppointments h3 {
  font-size: 1.75rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--primary);
}
#upcomingAppointments .appointments-list {
  display: flex;
  flex-direction: column;
  gap: var(--gap);
}
#upcomingAppointments .appointments-list .empty-message {
  text-align: center;
  color: var(--muted);
  font-size: 1rem;
  margin-top: var(--gap);
}
#upcomingAppointments .appt-card {
  display: flex;
  align-items: baseline;
  background: var(--surface);
  padding: var(--gap);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  transition: transform var(--transition), box-shadow var(--transition);
}
html.dark #upcomingAppointments .appt-card {
  background: var(--surface);
  box-shadow: var(--shadow-dark);
}
#upcomingAppointments .appt-icon {
  color: var(--primary);
  min-width: 2.5rem;
  margin-top: 0.15rem;
}
#upcomingAppointments .appt-card .details {
  flex: 1;
  margin-left: 1rem;
}
#upcomingAppointments .appt-card .details h4 {
  font-size: 1.1rem;
  color: var(--text);
  margin-bottom: 0.25rem;
  font-weight: 600;
}
#upcomingAppointments .appt-card .details p {
  color: var(--muted);
  font-size: 0.95rem;
  margin-top: 0.15rem;
}
#upcomingAppointments .appt-card .actions {
  display: flex;
  gap: 0.5rem;
}
#upcomingAppointments .appt-card .btn-reschedule,
#upcomingAppointments .appt-card .btn-cancel {
  background: var(--primary);
  color: #fff;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background var(--transition), transform var(--transition);
  box-shadow: var(--shadow-light);
}
html.dark #upcomingAppointments .appt-card .btn-reschedule,
html.dark #upcomingAppointments .appt-card .btn-cancel {
  box-shadow: var(--shadow-dark);
}
#upcomingAppointments .appt-card .btn-reschedule:hover {
  background: #3A62A8;
  transform: translateY(-2px);
}
  #upcomingAppointments .appt-card .btn-reschedule i,
#upcomingAppointments .appt-card .btn-cancel i {
  color: #fff;       
  font-size: 1rem;
}
  html.dark #upcomingAppointments .appt-card .btn-reschedule,
html.dark #upcomingAppointments .appt-card .btn-cancel {
  background: var(--primary);
  color: #fff;
}
#upcomingAppointments .appt-card .btn-cancel:hover {
  background: #D4724F;
  transform: translateY(-2px);
}
@media (max-width: 480px) {
  #upcomingAppointments .appt-card {
    flex-direction: column;
    align-items: flex-start;
  }
  #upcomingAppointments .appt-card .actions {
    margin-top: 0.5rem;
  }
}

  .spinner {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    margin-left: 0.5rem;
    border: 2px solid rgba(255, 255, 255, 0.6);
    border-top-color: var(--secondary);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    vertical-align: middle;
  }

  .hidden {
    display: none !important;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

#filterSection .filter-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  background: var(--surface);
  padding: 1rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
}

html.dark #filterSection .filter-bar {
  box-shadow: var(--shadow-dark);
}

#filterSection .filter-bar .date-inputs {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

#filterSection .filter-bar label {
  font-weight: 500;
  color: var(--text);
}

#filterSection .filter-bar input {
  padding: 0.5rem;
  border: 1px solid var(--muted);
  border-radius: var(--radius);
  background: var(--bg);
  color: var(--text);
  font-size: 1rem;
  transition: border-color 0.2s, box-shadow 0.2s;
}

#filterSection .filter-bar input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(74, 120, 196, 0.3);
}

html.dark #filterSection .filter-bar input {
  background: var(--surface);
  border-color: var(--muted);
  color: var(--text);
}

#filterSection .filter-bar button {
  padding: 0.6rem 1.2rem;
  background: var(--primary);
  color: var(--secondary);
  border-radius: var(--radius);
  font-weight: 500;
  box-shadow: var(--shadow-light);
  transition: background 0.2s, transform 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

html.dark #filterSection .filter-bar button {
  box-shadow: var(--shadow-dark);
}

#filterSection .filter-bar button:hover {
  background: var(--accent);
  transform: translateY(-2px);
}

@media (max-width: 600px) {
  #filterSection .filter-bar {
    flex-wrap: wrap;
  }
  #filterSection .filter-bar .date-inputs {
    width: 100%;
    justify-content: space-between;
  }
  #filterSection .filter-bar button {
    width: 100%;
    justify-content: center;
    margin-top: 0.75rem;
  }
}


  #insightsContainer .card a.btn-secondary {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.95rem;
  font-weight: 500;
  color: var(--primary);
  border: 2px solid var(--primary);
  border-radius: var(--radius);
  transition: background 0.2s, color 0.2s, transform 0.2s;
  box-shadow: var(--shadow-light);
}
html.dark #insightsContainer .card a.btn-secondary {
  background: transparent;
  color: var(--primary);
  box-shadow: var(--shadow-dark);
}
#insightsContainer .card a.btn-secondary:hover {
  background: var(--primary);
  color: var(--secondary);
  transform: translateY(-2px);
}

#purchasedContainer .purchased-item {
  background: var(--surface);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  padding: 1rem;
  margin-bottom: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  transition: transform var(--transition), box-shadow var(--transition);
}
#purchasedContainer .purchased-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
#purchasedContainer .purchased-item h4 {
  font-size: 1.1rem;
  font-weight:600;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
#purchasedContainer .purchased-item .price {
  font-weight: 700;
  color: var(--accent);
  margin-top: 0.25rem;
}
#purchasedContainer .purchased-item p:last‐of‐type {
  color: var(--muted);
  font-size: 0.9rem;
}
.purchased-card {
  display: flex; flex-direction: column; gap:0.5rem;
  border-radius: var(--radius); overflow:hidden;
  box-shadow: var(--shadow-light); position:relative;
  transition: transform 0.2s, box-shadow 0.2s;
}
.purchased-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}
.purchased-card img {
  width:100%; height:150px; object-fit:cover;
}
.purchased-card .drug-name.clickable {
  cursor:pointer; color: var(--primary);
}
.price-row {
  display:flex; justify-content:space-between; align-items:center;
}
.discount-badge {
  background: #e53e3e; color:#fff; border-radius:4px; padding:0.1em 0.5em; font-size:0.85rem;
}
.actions {
  margin-top:auto; display:flex; gap:0.5rem;
}

  #purchasedContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px,1fr));
  gap: 1rem;
}
.purchased-card {
  display: flex;
  flex-direction: column;
  background: var(--surface);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-light);
  transition: transform var(--transition), box-shadow var(--transition);
}
.purchased-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
}
.purchased-card img {
  width: 100%;
  aspect-ratio: 4/3;
  object-fit: cover;
}
.purchased-card .dosage,
.purchased-card .purchase-date {
  font-size: 0.9rem;
  color: var(--muted);
  margin: 0.25rem 1rem;
}
.purchased-card .price-row {
  margin: 0.25rem 1rem;
}
.purchased-card .actions {
  margin: 0.5rem 1rem 1rem;
  display: flex;
  gap: 0.5rem;
}
.purchased-card .btn-details {
  flex: 1;
  background: var(--secondary);
  color: var(--primary);
  border: 2px solid var(--primary);
  padding: 0.5rem;
  border-radius: var(--radius);
  transition: background var(--transition), color var(--transition);
}
.purchased-card .btn-details:hover {
  background: var(--primary);
  color: var(--secondary);
}
.purchased-card .btn-reorder {
  flex: 1;
  background: var(--primary);
  color: var(--secondary);
  padding: 0.5rem;
  border-radius: var(--radius);
  transition: background var(--transition);
}
.purchased-card .btn-reorder:hover {
  background: #3A62A8;
}
.purchased-card .btn-reorder i {
  color: var(--secondary);
}
  @media (max-width: 400px) {
  #purchasedContainer {
    grid-template-columns: 1fr !important;
  }
}
</style>

  
</head>

  <body>

    <nav class="navbar">
  <a style="text-decoration: none;" href="index.html">  <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--primary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span class="logo-text">Vitra AI</span>
    </div></a>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="herbal.html">Herbal</a></li>
      <li><a href="psychology.html">Mental Health</a></li>
      <li><a href="dietetics.html">Diet</a></li>
      <li><a href="epharmacy.html">E-Pharm</a></li>
      <li><a href="consult.html">Appointments</a></li>
      
    </ul>
    <div class="auth">
      <button class="btn btn-secondary" id="userProfile">
        <i class="fas fa-user-circle"></i> John Doe
      </button>
      <button class="btn btn-primary" id="signOut">
        <i class="fas fa-sign-out-alt"></i> Sign Out
      </button>
    </div>
    <i id="themeToggle" class="fas fa-moon"></i>
    <i class="fas fa-bars hamburger" id="hamburger"></i>
  </nav>

  <!-- sidebar (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <aside class="sidebar" id="sidebar">
    <ul class="sidebar-nav">
      <li><a href="index.html">Home</a></li>
      <li><a href="herbal.html">Herbal Medicine</a></li>
      <li><a href="psychology.html">Mental Health</a></li>
      <li><a href="dietetics.html">Dietetics</a></li>
      <li><a href="epharmacy.html">E-Pharmacy</a></li>
      <li><a href="consult.html">Consult Booking</a></li>
    </ul>
    <div class="sidebar-auth">
      <button class="btn btn-secondary" id="profileLink">
        <i class="fas fa-user-circle"></i> Edit Profile
      </button>
      <button class="btn btn-primary" id="sidebarSignOut">
        <i class="fas fa-sign-out-alt"></i> Sign Out
      </button>
    </div>
    <div class="sidebar-theme">
      <i id="sidebarThemeToggle" class="fas fa-moon"></i>
    </div>
  </aside>

  <main>
    <section class="module" style="text-align:center; margin-bottom:2rem;">
      <h2>Welcome back, John Doe!</h2>
      <p style="color: var(--muted);">Here’s a quick overview of your AI-powered health dashboard.</p>
    </section>

    <section id="quickAccess" class="module">
      <div class="quick-access-inner">
        <h2>Quick Access</h2>
        <div class="quick-buttons">
          <a href="consult.html" class="quick-btn btn-primary">
            <i class="fas fa-calendar-check"></i> My Appointments
          </a>
          <a href="epharmacy.html" class="quick-btn btn-secondary">
            <i class="fas fa-prescription-bottle-alt"></i> My Prescriptions
          </a>
          <a href="dietetics.html" class="quick-btn btn-primary">
            <i class="fas fa-apple-alt"></i> Meal Plans
          </a>
          <a href="psychology.html#therapybot" class="quick-btn btn-secondary">
            <i class="fas fa-brain"></i> Chat with AI Therapist
          </a>
          <a href="herbal.html" class="quick-btn btn-primary">
            <i class="fas fa-leaf"></i> Herbal Recommendations
          </a>
        </div>
      </div>
    </section>

   <section id="upcomingAppointments" class="dashboard-section">
  <h3><i class="fas fa-calendar-alt"></i> Upcoming Appointments</h3>
  <div id="appointmentsContainer" class="appointments-list">
    <p class="empty-message">You have no upcoming appointments.</p>
      </div>
    </section>

 <section id="purchasedDrugs" class="dashboard-section">
      <h3><i class="fas fa-shopping-bag"></i> Purchased Drugs</h3>
   <p style="margin-bottom:0.75rem; font-style:italic; color:var(--muted);">
    <a href="epharmacy.html#buyDrugs" style="color: var(--primary); font-weight:500;">
      Click here to purchase drugs from our pharmacy…
    </a>
  </p>
  <div id="purchasedContainer" class="content">
  </div>

    </section>

    <section id="nutritionSummary" class="module">
      <h2><i class="fas fa-apple-alt"></i> Nutrition Summary</h2>
      <div id="nutritionContainer" style="margin-top:1rem;">
       
        <p style="color: var(--muted);">No nutrition data available.</p>
      </div>
    </section>

    <section id="aiInsights" class="module">
      <h2><i class="fas fa-robot"></i> AI Insights</h2>
      <div id="insightsContainer" style="margin-top:1rem;">
       
        <p style="color: var(--muted);">No AI insights available at this time.</p>
      </div>
    </section>

<section id="filterSection" class="dashboard-section">
    <h3><i class="fas fa-filter"></i> Filter AI Usage</h3>
  <p style="color: var(--muted); margin-bottom: var(--gap);">
    Select a date range below to update all AI‐query statistics (Herbal, Psychology, Dietetics, E-Pharmacy, Consultation).
  </p>
  <div class="filter-bar">
    <div class="date-inputs">
      <label for="startDate">From:</label>
      <input type="date" id="startDate" value="">
      <label for="endDate">To:</label>
      <input type="date" id="endDate" value="">
    </div>
    <button id="filterBtn" class="btn btn-secondary">
      <i class="fas fa-filter"></i> Apply Filter
    </button>
  </div>
</section>

      <section class="content">
           <div class="card">
        <h4>Herbal Medicine AI</h4>
        <div class="stat" id="herbalQueries">0</div>
        <p>Total AI queries processed in Herbal Medicine</p>
        <a href="herbal.html"><i class="fas fa-seedling"></i> Go to Herbal</a>
      </div>

      <div class="card">
        <h4>Psychology & MH AI</h4>
        <div class="stat" id="psychQueries">0</div>
        <p>Total AI queries processed in Psychology & Mental Health</p>
        <a href="psychology.html"><i class="fas fa-brain"></i> Go to Psychology</a>
      </div>

      <div class="card">
        <h4>Dietetics AI</h4>
        <div class="stat" id="dietQueries">0</div>
        <p>Total AI queries processed in Dietetics</p>
        <a href="dietetics.html"><i class="fas fa-utensils"></i> Go to Dietetics</a>
      </div>

      <div class="card">
        <h4>E-Pharmacy AI</h4>
        <div class="stat" id="pharmacyQueries">0</div>
        <p>Total AI queries processed in E-Pharmacy</p>
        <a href="epharmacy.html"><i class="fas fa-pills"></i> Go to E-Pharmacy</a>
      </div>

      <div class="card">
        <h4>Consult Booking AI</h4>
        <div class="stat" id="consultQueries">0</div>
        <p>Total AI matches performed in Consult Booking</p>
        <a href="consult.html"><i class="fas fa-calendar-check"></i> Go to Consultation</a>
      </div>
     </section>
     
     <section class="charts-row" style="display: flex; gap: var(--gap); padding: var(--padding);">
     <div class="chart-card" style="flex: 1;">
        <h4>Queries Distribution by Sector</h4>
        <div class="chart-container">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>
      <div class="chart-card" style="flex: 1;">
        <h4>Daily AI Queries (Last 7 Days)</h4>
        <div class="chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>
    </section>

  <div id="profileModal" class="modal" hidden>
    <div class="modal-content">
      <button class="btn-close" id="closeProfileModal"><i class="fas fa-times"></i></button>
      <h3>Update Profile</h3>
      <label for="profileName"><i class="fas fa-user"></i> Name:</label>
     <input type="text" id="profileName" placeholder="Enter your name" required/>
      <button id="saveProfileBtn" class="btn">
        <i class="fas fa-save"></i> Save
        <span id="saveSpinner" class="spinner hidden"></span>
      </button>
    </div>
  </div>
  <div id="toast" class="toast"></div>
    
  </main>

  <footer>
    <p>&copy; 2025 Vitra AI. All rights reserved.</p>
    <div class="socials">
      <a href="#"><i class="fab fa-facebook-f"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-linkedin-in"></i></a>
    </div>
  </footer>

  <!-- back2top  -->
  <div id="backToTop"><i class="fas fa-arrow-up"></i></div>

<script src="storage.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBhaYOcLMXuobCT-vaXr-zXTZnBfaheAIY",
    authDomain: "vitra-ai-712ea.firebaseapp.com",
    projectId: "vitra-ai-712ea",
    storageBucket: "vitra-ai-712ea.appspot.com",
    messagingSenderId: "306868103753",
    appId: "1:306868103753:web:e2d7700f8ad34c1e17ed98"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  

  document.addEventListener("DOMContentLoaded", () => {

    const sidebar             = document.getElementById("sidebar");
    const overlay             = document.getElementById("sidebarOverlay");
    const hamburger           = document.getElementById("hamburger");
    const sidebarThemeToggle  = document.getElementById("sidebarThemeToggle");
    const themeToggle         = document.getElementById("themeToggle");
    const signOutBtn          = document.getElementById("signOut");
    const sidebarSignOut      = document.getElementById("sidebarSignOut");
    const appointmentsContainer  = document.getElementById("appointmentsContainer");
    const purchasedContainer     = document.getElementById("purchasedContainer");
    const nutritionContainer     = document.getElementById("nutritionContainer");
    const insightsContainer      = document.getElementById("insightsContainer");
    const backToTopBtn           = document.getElementById("backToTop");
    const quickAccessSection     = document.getElementById("quickAccess");
    const greetingSection        = quickAccessSection.previousElementSibling;
    const userProfileBtn         = document.getElementById("userProfile");
    const profileLinkBtn         = document.getElementById("profileLink");
    const profileModal           = document.getElementById("profileModal");
    const closeProfileModalBtn   = document.getElementById("closeProfileModal");
    const profileNameInput       = document.getElementById("profileName");
    const saveProfileBtn         = document.getElementById("saveProfileBtn");
    const toastEl                = document.getElementById("toast");
    const startDateInput         = document.getElementById("startDate");
    const endDateInput           = document.getElementById("endDate");
    const filterBtn              = document.getElementById("filterBtn");
    const herbalQueriesEl        = document.getElementById("herbalQueries");
    const psychQueriesEl         = document.getElementById("psychQueries");
    const dietQueriesEl          = document.getElementById("dietQueries");
    const pharmacyQueriesEl      = document.getElementById("pharmacyQueries");
    const consultQueriesEl       = document.getElementById("consultQueries");
    const distributionCtx        = document.getElementById("distributionChart").getContext("2d");
    const dailyCtx               = document.getElementById("dailyChart").getContext("2d");

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "index.html?modal=signin";
        return;
      }
      const displayName = user.displayName || user.email.split("@")[0];
      const firstName = displayName.split(" ")[0];
      userProfileBtn.innerHTML = `<i class="fas fa-user-circle"></i> ${firstName}`;
      greetingSection.innerHTML = `
        <h2>Hello ${displayName}!</h2>
        <p style="color: var(--muted);">Here’s a quick overview of your AI-powered health dashboard.</p>
      `;

      loadAppointments();
      loadPurchasedDrugs();
      loadNutritionSummary();
      loadAIInsights();
      displayStats();
      initializeCharts();
      populateDailyCounts();
    });

    function handleSignOut() {
      auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    }
    signOutBtn.addEventListener("click", handleSignOut);
    sidebarSignOut.addEventListener("click", handleSignOut);

    function openSidebar() {
      sidebar.classList.add("show");
      overlay.classList.add("show");
    }
    function closeSidebar() {
      sidebar.classList.remove("show");
      overlay.classList.remove("show");
    }
    hamburger.addEventListener("click", openSidebar);
    overlay.addEventListener("click", closeSidebar);

    themeToggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      themeToggle.classList.toggle("fa-moon");
      themeToggle.classList.toggle("fa-sun");
    });
    sidebarThemeToggle.addEventListener("click", () => themeToggle.click());

    window.addEventListener("scroll", () => {
      backToTopBtn.style.display = window.scrollY > 400 ? "block" : "none";
    });
    backToTopBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    function loadAppointments() {
      appointmentsContainer.innerHTML = "";
      const allAppointments = JSON.parse(localStorage.getItem("appointments") || "[]");
      const today = new Date().setHours(0, 0, 0, 0);
      const upcoming = allAppointments.filter(a => {
        const apptDate = new Date(a.date).setHours(0, 0, 0, 0);
        return apptDate >= today;
      });
      if (upcoming.length === 0) {
        appointmentsContainer.innerHTML = `<p style="color: var(--muted);">You have no upcoming appointments.</p>`;
        return;
      }
      upcoming.forEach(appt => {
        const card = document.createElement("div");
        card.className = "card appt-card";
        card.dataset.id = appt.id;
        card.innerHTML = `
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details" style="margin-left:1rem;">
            <h4><strong>${appt.name}</strong></h4>
            <p>${appt.date} • ${formatTime(appt.time)}</p>
          </div>
          <div class="actions" style="margin-left:auto; display:flex; gap:0.5rem;">
            <button class="btn-reschedule">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button class="btn-cancel">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
        card.querySelector(".btn-cancel").addEventListener("click", () => {
          if (confirm("Are you sure you want to cancel this appointment?")) {
            removeAppointment(appt.id);
            card.remove();
            if (appointmentsContainer.children.length === 0) {
              appointmentsContainer.innerHTML = `<p style="color: var(--muted);">You have no upcoming appointments.</p>`;
            }
          }
        });
        card.querySelector(".btn-reschedule").addEventListener("click", () => {
          window.location.href = `consult.html?rescheduleId=${encodeURIComponent(appt.id)}`;
        });
        appointmentsContainer.append(card);
      });
    }

    function removeAppointment(id) {
      const list = JSON.parse(localStorage.getItem("appointments") || "[]");
      const updated = list.filter(a => a.id !== id);
      localStorage.setItem("appointments", JSON.stringify(updated));
    }
    function formatTime(t) {
      if (t.includes("AM") || t.includes("PM")) return t;
      let [hh, mm] = t.split(":").map(Number);
      const suffix = hh >= 12 ? "PM" : "AM";
      hh = hh % 12 || 12;
      return `${String(hh).padStart(2, "0")}:${String(mm).padStart(2, "0")} ${suffix}`;
    }

  function loadPurchasedDrugs() {
  purchasedContainer.innerHTML = "";
 const purchased = JSON.parse(localStorage.getItem("purchasedDrugs") || "[]");
 if (!purchased.length) {
   purchasedContainer.innerHTML = `<p class="empty-message" style="color: var(--muted);">You haven’t purchased any drugs yet.</p>`;
   return;
 }
 purchased.forEach(item => {
    const card = document.createElement("div");
   card.className = "card purchased-card";
   card.dataset.name = item.name;
   card.innerHTML = `
    <img 
      src="${item.thumb || item.imageUrl || 'placeholder.jpg'}"
      alt="${item.name}" 
      onerror="this.src='placeholder.jpg'" 
    >
     <h4 class="drug-name clickable">${item.name}</h4>
     <p class="dosage">
       Dosage: <strong>${item.dosage ?? '—'}</strong>
    </p>
     <p class="purchase-date">
       Purchased:
      ${new Date(item.date).toLocaleDateString([], {
         month: "short", day: "numeric", year: "numeric"
       })}
      at
      ${new Date(item.date).toLocaleTimeString([], {
         hour: "2-digit", minute: "2-digit"
       })}
     </p>
     <div class="price-row">
       <span class="price">₵${item.price.toFixed(2)}</span>
       ${item.discount ? `<span class="discount-badge">–${item.discount*100}%</span>` : ''}
      </div>
      <div class="actions">
        <button class="btn btn-secondary btn-details"><i class="fas fa-info-circle"></i> Details</button>
        <button class="btn btn-primary btn-reorder"><i class="fas fa-cart-plus"></i> Reorder</button>
     </div>
    `;
    purchasedContainer.append(card);
  });

  purchasedContainer.addEventListener("click", e => {
    const card       = e.target.closest(".purchased-card");
  const detailBtn  = e.target.closest(".btn-details");
  const reorderBtn = e.target.closest(".btn-reorder");
  if (!card) return;
 const name = card.dataset.name;
  if (detailBtn || e.target.closest(".drug-name")) {
    openDrugModalByName(name);
  }
  if (reorderBtn) {
    window.location.href = `epharmacy.html?reorder=${encodeURIComponent(name)}`;
  }

  });
}

    function loadNutritionSummary() {
      nutritionContainer.innerHTML = "";
      const data = JSON.parse(localStorage.getItem("nutritionSummary") || "{}");
      if (!data || !data.calories) {
        nutritionContainer.innerHTML = `<p style="color: var(--muted);">No nutrition data available.</p>`;
        return;
      }
      const summaryHTML = `
        <p><strong>Today's Calories:</strong> ${data.calories} kcal</p>
        <p>
          <strong>Protein:</strong> ${data.protein} g · 
          <strong>Carbs:</strong> ${data.carbs} g · 
          <strong>Fats:</strong> ${data.fats} g
        </p>
        <a href="dietetics.html" class="btn btn-primary" style="margin-top:0.5rem; display:inline-flex; align-items:center; gap:0.5rem;">
          <i class="fas fa-arrow-right"></i> View Full Meal Plan
        </a>
      `;
      nutritionContainer.innerHTML = summaryHTML;
    }

    function recordPharmacyTimestamp() {
      const key = "timestampsPharmacy";
      const arr = JSON.parse(localStorage.getItem(key) || "[]");
      arr.push(new Date().toISOString());
      localStorage.setItem(key, JSON.stringify(arr));
    }
    recordPharmacyTimestamp();

    function loadAIInsights() {
      insightsContainer.innerHTML = "";
      const examples = [
  {
    title: "Herbal Tip of the Day",
    text: "Based on your recent concerns, we recommend adding turmeric to your regimen for its anti-inflammatory properties.",
    link: "herbal.html"
  },
  {
    title: "Mental Health Check-In",
    text: "Our AI noticed elevated stress keywords in your last chat. Consider a 5-minute guided breathing exercise today.",
    link: "psychology.html#therapybot"
  },
  {
    title: "Nutrition Insight",
    text: "Your protein intake is slightly below target. Try adding a protein-rich snack like Greek yogurt this afternoon.",
    link: "dietetics.html"
  },
  {
    title: "E-Pharmacy Spotlight",
    text: "Your recent purchase history suggests you might consider stocking echinacea supplements for immune support.",
    link: "epharmacy.html#buyDrugs"
  },
  {
    title: "Consultation Reminder",
    text: "You haven’t scheduled a follow-up appointment in a while—book a quick check-in to review your progress.",
    link: "consult.html"
  },
  {
    title: "Sleep Aid Suggestion",
    text: "Melatonin levels dip late; consider drinking chamomile tea 30 minutes before bed for better sleep.",
    link: "dietetics.html"
  },
  {
    title: "Stress Management Tip",
    text: "Lavender aromatherapy can ease stress—add a few drops to a diffuser this evening.",
    link: "psychology.html#therapybot"
  },
  {
    title: "Herbal Safety Alert",
    text: "Avoid combining St. John’s Wort with certain antidepressants—consult your provider for personalized advice.",
    link: "herbal.html"
  },
  {
    title: "Immune Booster Tip",
    text: "Elderberry syrup has been shown to reduce cold severity; consider adding it during flu season.",
    link: "epharmacy.html#buyDrugs"
  },
  {
    title: "Digestion Booster",
    text: "Ginger tea can soothe nausea and improve digestion—try sipping after meals for relief.",
    link: "dietetics.html"
  },
  {
    title: "Mood Lifter Insight",
    text: "A small daily dose of saffron extract may help stabilize mood—research suggests benefits for mild depression.",
    link: "herbal.html"
  },
  {
    title: "Joint Health Hint",
    text: "Turmeric’s curcumin compound has anti-inflammatory effects—pair with black pepper to boost absorption.",
    link: "dietetics.html"
  },
  {
    title: "Heart Health Check",
    text: "Hawthorn extract supports cardiovascular function—consider adding if you have mild high blood pressure.",
    link: "herbal.html"
  }
];

      const insight = examples[Math.floor(Math.random() * examples.length)];
      const card = document.createElement("div");
      card.className = "card";
      card.style.padding = "1rem";
      card.style.marginBottom = "1rem";
      card.innerHTML = `
        <div class="details">
          <h4><strong>${insight.title}</strong></h4>
          <p>${insight.text}</p>
        </div>
        <a href="${insight.link}" class="btn btn-secondary" style="margin-top:0.5rem; display:inline-flex; align-items:center; gap:0.5rem;">
          Learn More
        </a>
      `;
      insightsContainer.append(card);
    }

    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add("visible");
      setTimeout(() => toastEl.classList.remove("visible"), 3000);
    }

    let statsData = {
      herbal: 0,
      psych: 0,
      diet: 0,
      pharmacy: 0,
      consult: 0,
      daily: [0, 0, 0, 0, 0, 0, 0],
      labels: []
    };

    function generateLast7DaysLabels() {
      const labels = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        labels.push(d.toLocaleDateString("default", { month: "short", day: "numeric" }));
      }
      return labels;
    }

     function displayStats() {
      statsData.herbal   = Storage.getCount("Herbal");
      statsData.psych    = Storage.getCount("Psych");
      statsData.diet     = Storage.getCount("Diet");
      statsData.pharmacy = Storage.getCount("Pharmacy");
      statsData.consult  = Storage.getCount("Consult");

      herbalQueriesEl.textContent   = statsData.herbal;
      psychQueriesEl.textContent    = statsData.psych;
      dietQueriesEl.textContent     = statsData.diet;
      pharmacyQueriesEl.textContent = statsData.pharmacy;
      consultQueriesEl.textContent  = statsData.consult;

      statsData.labels = generateLast7DaysLabels();
    }

    let distributionChart, dailyChart;
    function initializeCharts() {

      distributionChart = new Chart(distributionCtx, {
        type: "doughnut",
        data: {
          labels: ["Herbal", "Psych", "Diet", "Pharmacy", "Consult"],
          datasets: [{
            data: [
              statsData.herbal,
              statsData.psych,
              statsData.diet,
              statsData.pharmacy,
              statsData.consult
            ],
            backgroundColor: [
               "#228B22",   
                "#FF0000",  
                "#F7DC6F",  
                "#005f73",   
                "#4B0082"   
            ],
            borderColor: "rgba(255,255,255,0.9)",
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          cutout: "50%",
          plugins: {
            legend: {
              position: "bottom",
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
                padding: 20,
                boxWidth: 12
              }
            },
            tooltip: {
              backgroundColor: getComputedStyle(document.documentElement).getPropertyValue("--surface").trim(),
              titleColor: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
              bodyColor: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
              borderColor: getComputedStyle(document.documentElement).getPropertyValue("--muted").trim(),
              borderWidth: 1
            }
          }
        }
      });

      dailyChart = new Chart(dailyCtx, {
        type: "line",
        data: {
          labels: statsData.labels,
          datasets: [{
            label: "Daily Queries",
            data: statsData.daily,
            borderColor: "rgba(74,120,196,1)",
            backgroundColor: "rgba(74,120,196,0.2)",
            pointBackgroundColor: "rgba(74,120,196,1)",
            pointBorderColor: getComputedStyle(document.documentElement).getPropertyValue("--surface").trim(),
            pointBorderWidth: 2,
            tension: 0.3,
            fill: true,
            borderWidth: 3,
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
                maxRotation: 0,
                minRotation: 0
              },
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue("--muted").trim(),
                drawBorder: false
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue("--text").trim()
              },
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue("--muted").trim(),
                borderDash: [5, 5]
              }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: getComputedStyle(document.documentElement).getPropertyValue("--surface").trim(),
              titleColor: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
              bodyColor: getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),
              borderColor: getComputedStyle(document.documentElement).getPropertyValue("--muted").trim(),
              borderWidth: 1,
              cornerRadius: 4
            }
          }
        }
      });
    }

    function populateDailyCounts() {
      const dailyCounts = [];
      for (let i = 6; i >= 0; i--) {
        const dayStart = new Date();
        dayStart.setHours(0, 0, 0, 0);
        dayStart.setDate(dayStart.getDate() - i);
        const dayEnd = new Date(dayStart);
        dayEnd.setHours(23, 59, 59, 999);

        function countDay(key) {
          const raw = localStorage.getItem(key) || "[]";
          const arr = JSON.parse(raw);
          return arr.filter(ts => {
            const d = new Date(ts);
            return d >= dayStart && d <= dayEnd;
          }).length;
        }

        const sumForDay =
          countDay("timestampsHerbal") +
          countDay("timestampsPsych") +
          countDay("timestampsDiet") +
          countDay("timestampsPharmacy") +
          countDay("timestampsConsult");

        dailyCounts.push(sumForDay);
      }
      statsData.daily = dailyCounts;
      if (dailyChart) {
        dailyChart.data.datasets[0].data = dailyCounts;
        dailyChart.update();
      }
    }

    filterBtn.addEventListener("click", () => {
      const start = startDateInput.value;
      const end   = endDateInput.value;
      if (!start || !end) {
        showToast("Please pick both dates");
        return;
      }
      const startDate = new Date(start);
      const endDate   = new Date(end);
      endDate.setHours(23, 59, 59, 999);
      if (startDate > endDate) {
        showToast("Start date cannot be after end date");
        return;
      }

      function countInRange(key) {
        const raw = localStorage.getItem(key) || "[]";
        const arr = JSON.parse(raw);
        return arr.filter(ts => {
          const d = new Date(ts);
          return d >= startDate && d <= endDate;
        }).length;
      }

      statsData.herbal   = countInRange("timestampsHerbal");
      statsData.psych    = countInRange("timestampsPsych");
      statsData.diet     = countInRange("timestampsDiet");
      statsData.pharmacy = countInRange("timestampsPharmacy");
      statsData.consult  = countInRange("timestampsConsult");

      const last7Counts = [];
      const labels      = [];
      for (let i = 6; i >= 0; i--) {
        const dayStart = new Date();
        dayStart.setHours(0, 0, 0, 0);
        dayStart.setDate(dayStart.getDate() - i);
        const dayEnd = new Date(dayStart);
        dayEnd.setHours(23, 59, 59, 999);

        function countForDay(key) {
          const raw = localStorage.getItem(key) || "[]";
          const arr = JSON.parse(raw);
          return arr.filter(ts => {
            const d = new Date(ts);
            return d >= dayStart && d <= dayEnd;
          }).length;
        }

        const countHerbal   = countForDay("timestampsHerbal");
        const countPsych    = countForDay("timestampsPsych");
        const countDiet     = countForDay("timestampsDiet");
        const countPharma   = countForDay("timestampsPharmacy");
        const countConsult  = countForDay("timestampsConsult");

        last7Counts.push(countHerbal + countPsych + countDiet + countPharma + countConsult);
        labels.push(dayStart.toLocaleDateString("default", { month: "short", day: "numeric" }));
      }
      statsData.daily  = last7Counts;
      statsData.labels = labels;

      herbalQueriesEl.textContent   = statsData.herbal;
      psychQueriesEl.textContent    = statsData.psych;
      dietQueriesEl.textContent     = statsData.diet;
      pharmacyQueriesEl.textContent = statsData.pharmacy;
      consultQueriesEl.textContent  = statsData.consult;

      distributionChart.data.datasets[0].data = [
        statsData.herbal,
        statsData.psych,
        statsData.diet,
        statsData.pharmacy,
        statsData.consult
      ];
      distributionChart.update();

      dailyChart.data.labels           = statsData.labels;
      dailyChart.data.datasets[0].data = statsData.daily;
      dailyChart.update();

      showToast("Statistics updated for selected range");
    });

    userProfileBtn.addEventListener("click", () => {
      const currentName =
        firebase.auth().currentUser.displayName
        || firebase.auth().currentUser.email.split("@")[0];
      profileNameInput.value = currentName;
      profileModal.hidden = false;
      profileNameInput.focus();
    });
    profileLinkBtn.addEventListener("click", () => {
      const currentName =
        firebase.auth().currentUser.displayName
        || firebase.auth().currentUser.email.split("@")[0];
      profileNameInput.value = currentName;
      profileModal.hidden = false;
      profileNameInput.focus();
    });
    closeProfileModalBtn.addEventListener("click", () => {
      profileModal.hidden = true;
    });

    saveProfileBtn.addEventListener("click", async () => {
      const newName = profileNameInput.value.trim();
      if (!newName) {
        showToast("Name cannot be empty");
        return;
      }
      const user = firebase.auth().currentUser;
      if (user) {
        saveProfileBtn.disabled = true;
        document.getElementById("saveSpinner").classList.remove("hidden");
        try {
          await user.updateProfile({ displayName: newName });
          localStorage.setItem("displayName", newName);
          window.location.reload();
        } catch (err) {
          console.error(err);
          showToast("Could not update profile");
          saveProfileBtn.disabled = false;
          document.getElementById("saveSpinner").classList.add("hidden");
        }
      }
    });

    const storedName = localStorage.getItem("displayName");
    if (storedName) {
      userProfileBtn.innerHTML = `<i class="fas fa-user-circle"></i> ${storedName}`;
    }
  });
</script>


</body>


</html>
