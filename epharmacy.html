<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>E-Pharmacy AI Portal</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<style>

    :root {
    --pharm-primary: #005f73;
    --pharm-primary-alt: #0a9396;
    --pharm-secondary: #94d2bd;
    --pharm-accent: #e9d8a6;
    --pharm-bg: #f0efeb;
    --pharm-surface: #ffffff;
    --pharm-text: #001219;
    --pharm-muted: #555555;
    --radius: 0.75rem;
    --padding: 1rem;
    --transition: 0.3s ease;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  html.dark {
    --pharm-bg: #001219;
    --pharm-surface: #002e2e;
    --pharm-text: #e0fbfc;
    --pharm-muted: #889999;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  html {
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    scroll-behavior: smooth;
    background: var(--pharm-bg);
    color: var(--pharm-text);
    transition: background var(--transition), color var(--transition);
  }
  body {
    display: flex;
    min-height: 100vh;
    background: var(--pharm-bg);
    color: var(--pharm-text);
    overflow-x: hidden;
  }
  a {
    color: inherit;
    text-decoration: none;
    transition: color var(--transition);
  }
  a:hover {
    color: var(--pharm-primary-alt);
  }
  img {
    max-width: 100%;
    display: block;
  }
  button, input, textarea, select {
    font-family: inherit;
    transition: var(--transition);
  }
  button {
    cursor: pointer;
    border: none;
    background: none;
  }
  ul, ol {
    list-style: none;
  }
  h1, h2, h3, h4 {
    color: var(--pharm-primary);
    margin-bottom: 0.5rem;
  }
  p.desc {
    color: var(--pharm-muted);
    margin-bottom: 0.75rem;
  }
  small {
    color: var(--pharm-muted);
    font-size: 0.85rem;
  }

  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: var(--pharm-surface);
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--pharm-primary-alt);
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--pharm-primary);
  }

  aside#sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100vh;
    background: var(--pharm-surface);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    transition: width var(--transition), transform var(--transition);
    z-index: 1000;
    overflow: hidden;
  }
  aside#sidebar.collapsed {
    width: 60px;
  }
  aside#sidebar .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: var(--padding);
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--pharm-primary);
  }
  aside#sidebar .logo svg {
    width: 1.8rem;
    height: 1.8rem;
    fill: var(--pharm-text);  
    transition: transform var(--transition);
  }
  aside#sidebar .logo:hover svg {
    transform: scale(1.1);
  }
  aside#sidebar .logo .logo-text {
    font-size: 1.4rem;
  }
 aside#sidebar.collapsed .logo .logo-text {
   display: none;
 }
  aside#sidebar nav {
    flex: 1;
    overflow-y: auto;
  }
  aside#sidebar nav ul {
    padding: 0 var(--padding);
  }
  aside#sidebar nav li {
    margin-bottom: 0.25rem;
  }
  aside#sidebar nav li a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: var(--radius);
    color: var(--pharm-text);
    font-weight: 500;
    transition: background var(--transition), color var(--transition);
  }
  aside#sidebar nav li.active a,
  aside#sidebar nav li a:hover {
    background: var(--pharm-primary-alt);
    color: #fff;
  }
  aside#sidebar nav li a i {
    font-size: 1.2rem;
    width: 1.2rem;
    text-align: center;
    color: var(--pharm-primary-alt);
  }
  aside#sidebar.collapsed nav li a span {
    display: none;
  }
  aside#sidebar.collapsed nav li a {
    justify-content: center;
  }
  #shrinkSidebar {
    margin: 0.5rem auto;
    background: var(--pharm-secondary);
    color: var(--pharm-surface);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow);
    transition: background var(--transition), transform var(--transition);
  }
  #shrinkSidebar:hover {
    background: var(--pharm-primary);
    transform: scale(1.1);
  }
html.dark #shrinkSidebar {
   background: var(--pharm-secondary);
   color: var(--pharm-text);   
 }

    header {
    position: fixed;
    top: 0;
    left: 280px;
    right: 0;
    height: 64px;
    background: var(--pharm-surface);
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--padding);
    z-index: 999;
    transition: left var(--transition);
  }
  aside#sidebar.collapsed ~ header {
    left: 60px;
  }
  header i#hamburger,
  header i#themeToggle {
    font-size: 1.5rem;
    color: var(--pharm-primary-alt);
    cursor: pointer;
    transition: transform var(--transition), color var(--transition);
  }
  header i#hamburger:hover,
  header i#themeToggle:hover {
    color: var(--pharm-primary);
    transform: scale(1.1);
  }
  header h1 {
    font-size: 1.6rem;
    font-weight: 600;
    color: var(--pharm-text);
  }
html.dark aside#sidebar nav li a i {
   color: var(--pharm-text);
 }
 html.dark aside#sidebar nav li.active a i,
 html.dark aside#sidebar nav li a:hover i {
   color: #fff;
 }
aside#sidebar nav li a i {
   color: var(--pharm-text);
 }
aside#sidebar nav li.active a i,
aside#sidebar nav li a:hover i {
   color: #fff;
 }
   main {
    flex: 1;
    margin-top: 80px;
    margin-left: 300px;
    padding: var(--padding);
    background: var(--pharm-bg);
    transition: margin-left var(--transition);
  }
  aside#sidebar.collapsed ~ main {
    margin-left: 80px;
  }
  @media (max-width: 768px) {
    header {
      left: 0 !important;
    }
    aside#sidebar {
      transform: translateX(-100%);
      width: 220px;
    }
    body.sidebar-open aside#sidebar {
      transform: translateX(0);
    }
    main {
      margin-left: 0 !important;
    }
  }

  section.module {
    background: var(--pharm-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow);
    transition: transform var(--transition), box-shadow var(--transition);
  }
  section.module:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
  }
  section.module h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    font-size: 1.5rem;
    color: var(--pharm-primary-alt);
  }
  section.module p.desc {
    font-size: 0.95rem;
    color: var(--pharm-muted);
    margin-bottom: 1rem;
  }
  section.module label {
    display: block;
    margin-bottom: 1rem;
    color: var(--pharm-text);
    font-weight: 500;
  }
  section.module label input,
  section.module label select,
  section.module label textarea {
    width: 100%;
    padding: 0.75rem;
    margin-top: 0.5rem;
    border: 2px solid var(--pharm-primary-alt);
    border-radius: var(--radius);
    background: var(--pharm-bg);
    color: var(--pharm-text);
    font-size: 1rem;
    transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
  }
  section.module label input:focus,
  section.module label select:focus,
  section.module label textarea:focus {
    outline: none;
    border-color: var(--pharm-secondary);
    box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.3);
    background: var(--pharm-accent);
  }
  html.dark section.module label input,
  html.dark section.module label select,
  html.dark section.module label textarea {
    background: var(--pharm-surface);
    color: var(--pharm-text);
    border-color: var(--pharm-secondary);
  }
  section.module button.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--pharm-primary);
    color: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  section.module button.btn:hover {
    background: var(--pharm-primary-alt);
    transform: translateY(-2px);
  }

   .response {
    background: var(--pharm-surface);
    border-left: 4px solid var(--pharm-secondary);
    padding: var(--padding);
    border-radius: var(--radius);
    margin-top: 1rem;
    position: relative;
    box-shadow: var(--shadow);
    transition: background var(--transition);
    word-wrap: break-word;
    white-space: pre-wrap;
  }
  .response .close-btn {
    position: absolute;
    top: var(--padding);
    right: var(--padding);
    background: none;
    color: var(--pharm-secondary);
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
    display: none;
  }
  .response .close-btn:hover {
    color: var(--pharm-primary-alt);
    transform: scale(1.1);
  }
  .response .result-content {
    margin-top: 1.5rem;
    line-height: 1.5;
    color: var(--pharm-text);
  }
  .response.loading .close-btn {
    display: none;
  }
   .response.loading {
    max-height: 120px;
 }
  .response.loading .result-content {
   max-height: 80px;
    overflow-y: auto;
  }
.response.error {
    border-color: #e53e3e;
  }

  html.dark .response {
    background: var(--pharm-surface);
  }
  html.dark .response .result-content {
    color: var(--pharm-text);
  }
  .tool-row {
    margin-top: 0.5rem;
    display: flex;
    gap: 0.5rem;
  }
  .tool-row button {
    background: var(--pharm-surface);
    border: 1px solid var(--pharm-muted);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--pharm-primary-alt);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  .tool-row button:hover {
    background: var(--pharm-primary-alt);
    color: #fff;
    transform: scale(1.1);
  }

  #hero {
    background: var(--pharm-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--padding);
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    overflow: hidden;
    position: relative;
    padding: var(--padding);
  }
  #hero .hero-text {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 1rem;
  }
  #hero h2 {
    font-size: 2rem;
    color: var(--pharm-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  #hero p.desc {
    font-size: 1rem;
    color: var(--pharm-muted);
  }
  #hero .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }
  #hero .hero-actions a.btn {
    background: var(--pharm-primary-alt);
    color: #fff;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
  }
  #hero .hero-actions a.btn:hover {
    background: var(--pharm-primary);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  }
  #hero .hero-image {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #hero .hero-image img {
    width: 100%;
    border-radius: var(--radius);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }
  .sticker {
    position: absolute;
    font-size: 3rem;
    opacity: 0.15;
    color: var(--pharm-primary-alt);
    transition: transform var(--transition), opacity var(--transition);
  }
  .sticker:hover {
    opacity: 0.25;
    transform: scale(1.1);
  }


  html.dark .bot-msg {
    background: var(--pharm-surface);
    color: var(--pharm-text);
  }
  .timestamp,
  .msg-ts {
    font-size: 0.75rem;
    color: var(--pharm-muted);
    position: absolute;
    bottom: -1.2rem;
    right: 0.8rem;
  }
  .chat-date {
    text-align: center;
    margin: 1rem 0;
    font-size: 0.85rem;
    color: var(--pharm-muted);
  }
section.module label textarea {
    background: var(--pharm-bg);
    color: var(--pharm-text);
  }
  html.dark section.module label textarea {
   background: var(--pharm-surface);
    color: var(--pharm-text);
  }
html.dark .chat-input textarea {
    background: var(--pharm-surface);
  border-color: var(--pharm-secondary);
   color: var(--pharm-text);
  }
.response .close-btn {
    position: absolute;
    top: var(--padding);
    right: var(--padding);
    background: none;
    color: var(--pharm-secondary);
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
    display: block;      
    opacity: 0.6;        
  }
 
.chat-box {
  background: var(--bg);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: var(--radius);
  padding: var(--padding);
  min-height: 200px;
  max-height: 300px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  margin-bottom: 1rem;
  transition: background var(--transition), border-color var(--transition);
}

.user-msg,
.bot-msg {
  max-width: 80%;
  margin: 0.5rem 0;
  padding: 0.8rem 1rem;
  border-radius: 1.2rem;
  position: relative;
  transition: background var(--transition), color var(--transition);
}
.user-msg {
  background: var(--primary);
  color: #fff;
  align-self: flex-end;
  border-bottom-right-radius: 0.2rem;
}
.bot-msg {
  background: #e8f5f1;
  color: var(--text);
  align-self: flex-start;
  border-bottom-left-radius: 0.2rem;
}
html.dark .bot-msg {
  background: var(--surface-dark);
  color: var(--text-dark);
}

.timestamp {
  font-size: 0.7rem;
  position: absolute;
  bottom: -1.2rem;
  right: 0.8rem;
  color: var(--muted);
}

.chat-date-separator {
  text-align: center;
  margin: 0.75rem 0;
  font-weight: bold;
  color: var(--muted);
  user-select: none;
}

.chat-input-row {
  display: flex;
  gap: 0.5rem;
}
.chat-input-row input {
  flex: 1 1 100%;
  padding: 0.8rem 1rem;
  border: 1px solid var(--muted);
  border-radius: var(--radius);
  background: var(--bg);
  color: var(--text);
  font-size: 0.95rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.chat-input-row input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 8px var(--primary);
}
.chat-input-row button {
  background: var(--primary);
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 1rem;
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
.chat-input-row button:hover {
  transform: scale(1.1);
  background: var(--secondary);
}
.btn-secondary {
   display: inline-flex;
   align-items: center;
   gap: 0.5rem;
   background: var(--pharm-primary-alt);
   color: #fff;
   padding: 0.5rem 1rem;
   border-radius: var(--radius);
   font-weight: 500;
   border: none;
   transition: background var(--transition), transform var(--transition);
 }
 .btn-secondary:hover {
   background: var(--pharm-primary);
   transform: translateY(-1px);
 }
#chatHint {
  font-size: 0.9rem;
  color: var(--muted);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
html.dark .user-msg {
   border-color: var(--pharm-text);
 }
  html.dark .chat-input-row input {
   background: var(--pharm-surface);
   border-color: var(--pharm-secondary);
   color: var(--pharm-text);
 }
 html.dark .chat-input-row button {
   background: var(--pharm-primary-alt);
   color: #fff;
 }

  .spinner {
  display: inline-block;
  width: 1em;
  height: 1em;
  border: 2px solid var(--primary);
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  vertical-align: middle;
  margin-left: 0.25em;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
 
    .chat-box {
    background: var(--pharm-bg);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: var(--radius);
    padding: var(--padding);
    min-height: 300px;  
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .user-msg,
  .bot-msg {
    max-width: 75%;
    padding: 0.75rem 1rem;
    border-radius: 1.2rem;
    position: relative;
    word-wrap: break-word;
    transition: background var(--transition), color var(--transition);
  }
  .user-msg {
    background: var(--pharm-primary-alt);
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 0.2rem;
    border-bottom-left-radius: 1.2rem;
    border-top-right-radius: 1.2rem;
    border-top-left-radius: 1.2rem;
  }
  .bot-msg {
    background: var(--pharm-surface);
    color: var(--pharm-text);
    align-self: flex-start;
    border-bottom-left-radius: 0.2rem;
    border-bottom-right-radius: 1.2rem;
    border-top-left-radius: 1.2rem;
    border-top-right-radius: 1.2rem;
    box-shadow: var(--shadow);
  }

    .timestamp, .msg-ts {
    font-size: 0.65rem;
    color: var(--pharm-muted);
    position: absolute;
    bottom: -1.2rem;
    right: 0.6rem;
  }
  .spinner {
    display: inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid var(--pharm-primary);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    vertical-align: middle;
    margin-left: 0.25em;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

.history-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
}
.history-content {
  background: var(--surface);
  padding: 2rem;
  border-radius: var(--radius);
  width: 90%;
  max-width: 600px;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  position: relative;
}
.history-content h3 {
  margin-bottom: 1rem;
  color: var(--primary);
  font-size: 1.5rem;
  border-bottom: 2px solid var(--accent);
  padding-bottom: 0.5rem;
}
.history-content ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
.history-content li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid #eee;
}
.history-content li:last-child {
  border-bottom: none;
}
.history-content .del-msg {
  background: none;
  border: none;
  color: var(--secondary);
  font-size: 1.1rem;
  cursor: pointer;
  transition: color var(--transition);
}
.history-content .del-msg:hover {
  color: var(--primary);
}
.history-content .close-history {
  display: block;
  margin: 1.5rem auto 0;
  background: var(--primary);
  color: #fff;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 1rem;
  transition: background var(--transition), transform var(--transition);
}
.history-content .close-history:hover {
  background: var(--secondary);
  transform: translateY(-2px);
}
 #historyModal .close-modal {
      position: absolute;
      top: 0.75rem;
      right: 1rem;
     background: var(--pharm-primary-alt) !important;
     color: #fff;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
    }

    #historyModal .close-modal:hover {
      background: var(--pharm-primary);
      transform: translateY(-2px);
    }

    html.dark #historyModal .close-modal {
      background: var(--pharm-secondary);
      color: var(--pharm-text);
    }
    html.dark #historyModal .close-modal:hover {
      background: var(--pharm-primary-alt);
    }
.history-table-wrapper {
  overflow-x: auto;
  margin-bottom: var(--padding);
}
.history-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;
}
.history-table th,
.history-table td {
  padding: 0.6rem 0.8rem;
  text-align: left;
  border: none;
}
.history-table tbody tr:nth-child(odd) {
  background: rgba(0,0,0,0.03);
}
.history-actions {
  position: sticky;
  bottom: 0;
  background: var(--surface);
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  padding-top: var(--padding);
  border-top: 1px solid rgba(0,0,0,0.1);
}
.history-actions button {
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: var(--radius);
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
.history-actions button:hover {
  background: var(--secondary);
  transform: translateY(-1px);
}
.history-content {
   background: var(--pharm-surface);
   border-radius: var(--radius);
   padding: var(--padding);
   width: 90%;
   max-width: 600px;
   max-height: 80%;
   overflow-y: auto;
   box-shadow: var(--shadow);
   position: relative;
   border: 1px solid var(--pharm-secondary);
   display: flex;
   flex-direction: column;
 }
 .history-content h3 {
   color: var(--pharm-primary-alt);
   font-size: 1.5rem;
   font-weight: 600;
   margin-bottom: 1rem;
   padding-bottom: 0.5rem;
   border-bottom: 2px solid var(--pharm-secondary);
   text-align: center;
 }
 .history-table-wrapper {
   background: var(--pharm-bg);
   border-radius: var(--radius);
   flex: 1;
   overflow-y: auto;
   padding: var(--padding);
 }
 .history-table {
   width: 100%;
   border-collapse: collapse;
 }
 .history-table th, .history-table td {
   padding: 0.75rem;
   text-align: left;
   border-bottom: 1px solid rgba(0,0,0,0.05);
 }
 .history-table thead tr:first-child th {
   background: var(--pharm-secondary);
  color: #fff;
  font-weight: 600;
   font-size: 1rem;
 }
 .history-table tbody tr:nth-child(odd) {
   background: rgba(0,0,0,0.03);
 }
 .history-actions {
   display: flex;
   justify-content: space-between;
   padding-top: var(--padding);
   border-top: 1px solid rgba(0,0,0,0.1);
 }
 .history-actions button {
   background: var(--pharm-primary-alt);
   color: #fff;
   border: none;
   border-radius: var(--radius);
   padding: 0.6rem 1.2rem;
   font-size: 0.95rem;
   cursor: pointer;
   transition: background var(--transition), transform var(--transition);
 }
 .history-actions button:hover {
   background: var(--pharm-primary);
   transform: translateY(-1px);
 }
 .history-table td .del-msg i {
   color: var(--pharm-secondary);
   transition: color var(--transition);
 }
 .history-table td .del-msg:hover i {
   color: var(--pharm-primary-alt);
 }

  .copy-toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--primary);
  color: #fff;
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-size: 0.95rem;
  animation: fade-in-out 2s ease forwards;
  z-index: 2000;
}
@keyframes fade-in-out {
  0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
  10% { opacity: 1; transform: translateX(-50%) translateY(0); }
  90% { opacity: 1; }
  100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
}

html.dark .chat-box {
  background: var(--bg);
  border-color: var(--muted);
}
html.dark .user-msg {
  background: var(--secondary);
  color: #fff;
}
html.dark .bot-msg {
  background: var(--surface-dark);
  color: var(--text-dark);
}

@media (max-width: 480px) {
  .chat-box {
    max-height: 220px;
  }
}
.feature-card i { color: #fff; }
   .chart-wrapper {
    background: var(--pharm-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: var(--shadow);
  }
  .chart-wrapper h3 {
    margin-bottom: 0.75rem;
    color: var(--pharm-primary-alt);
    font-size: 1.25rem;
  }
  #chart1,
  #chart2 {
    width: 100% !important;
    height: 250px !important;
  }
  button#exportChartsData {
    margin-top: 1rem;
    background: var(--pharm-primary-alt);
    color: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    font-weight: 600;
    box-shadow: var(--shadow);
    transition: background var(--transition), transform var(--transition);
  }
  button#exportChartsData:hover {
    background: var(--pharm-primary);
    transform: translateY(-2px);
  }

   #pharmacyExpert .expert-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
  }
  #pharmacyExpert .feature-card {
    background: var(--pharm-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: var(--padding);
    text-align: center;
    transition: transform var(--transition), box-shadow var(--transition);
  }
  #pharmacyExpert .feature-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
  }
  #pharmacyExpert .feature-card i {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
    color: var(--pharm-primary-alt);
  }
  #pharmacyExpert .feature-card h3 {
    margin-bottom: 0.5rem;
    color: var(--pharm-secondary);
    font-size: 1.25rem;
  }
  #pharmacyExpert .feature-card p {
    color: var(--pharm-text);
    margin-bottom: 1rem;
    font-size: 0.95rem;
  }
  #pharmacyExpert .feature-card .btn {
    background: var(--pharm-primary-alt);
    color: #fff;
    padding: 0.6rem 1.2rem;
    border-radius: var(--radius);
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #pharmacyExpert .feature-card .btn:hover {
    background: var(--pharm-primary);
    transform: translateY(-2px);
  }

   footer {
    margin-top: 2rem;
    text-align: center;
    color: var(--pharm-muted);
    font-size: 0.9rem;
  }

   @media (max-width: 1024px) {
    #hero {
      grid-template-columns: 1fr;
    }
    .hero-image {
      margin-top: 1rem;
    }
    #pharmacyExpert .expert-features {
      grid-template-columns: 1fr;
    }
    section.module {
      padding: 0.75rem;
    }
  }
  @media (max-width: 768px) {
    header {
      left: 0 !important;
    }
    aside#sidebar {
      transform: translateX(-100%);
      transition: transform var(--transition);
    }
    body.sidebar-open aside#sidebar {
      transform: translateX(0);
    }
    main {
      margin-left: 0 !important;
      padding: 0.75rem;
    }
    #shrinkSidebar {
      display: none;
    }
    #hero h2 {
      font-size: 1.8rem;
    }
    .hero-actions a.btn {
      flex: 1 1 100%;
      justify-content: center;
    }
    #pharmacyExpert .feature-card {
      padding: 0.75rem;
    }
  }
  @media (max-width: 480px) {
    html {
      font-size: 14px;
    }
    header h1 {
      font-size: 1rem;
    }
    #hero h2 {
      font-size: 1.5rem;
    }
    .hero-actions a.btn {
      font-size: 0.9rem;
      padding: 0.6rem 1rem;
    }
    #hero p.desc,
    section.module p.desc {
      font-size: 0.9rem;
    }
    section.module h2 {
      font-size: 1.25rem;
    }
    .chat-controls button,
    .chat-input button {
      width: 100%;
      margin-top: 0.5rem;
      border-radius: var(--radius);
    }
    #pharmacyExpert .expert-features {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  #buyDrugs {
  background: var(--pharm-surface);
  border-radius: var(--radius);
  padding: var(--padding);
  margin-bottom: 2rem;
  box-shadow: var(--shadow);
  transition: background var(--transition), box-shadow var(--transition);
}

#buyDrugs:hover {
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
}

#buyDrugs h2 {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.75rem;
  color: var(--pharm-primary-alt);
  margin-bottom: 1rem;
}

#buyDrugs p.desc {
  font-size: 0.95rem;
  color: var(--pharm-muted);
  margin-bottom: 1.5rem;
}

#buyDrugs label[for="symptomInputBuy"] {
  display: block;
  font-weight: 500;
  margin-bottom: 0.5rem;
  color: var(--pharm-text);
}
#buyDrugs #symptomInputBuy {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid var(--pharm-primary-alt);
  border-radius: var(--radius);
  background: var(--pharm-bg);
  color: var(--pharm-text);
  font-size: 1rem;
  resize: vertical;
  transition: border-color var(--transition), box-shadow var(--transition);
}
#buyDrugs #symptomInputBuy:focus {
  outline: none;
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.3);
  background: var(--pharm-accent);
}

#buyDrugs #suggestDrug {
  margin-top: 0.75rem;
  background: var(--pharm-primary);
  color: #fff;
  padding: 0.6rem 1rem;
  border-radius: var(--radius);
  font-size: 0.95rem;
  font-weight: 600;
  box-shadow: var(--shadow);
  transition: background var(--transition), transform var(--transition);
}
#buyDrugs #suggestDrug:hover {
  background: var(--pharm-primary-alt);
  transform: translateY(-2px);
}

#buyDrugs #suggestionMsg {
  font-size: 0.95rem;
  margin-top: 0.5rem;
  min-height: 1.25rem;
  color: var(--pharm-secondary);
}

#buyDrugs label[for="drugSelect"] {
  display: block;
  font-weight: 500;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  color: var(--pharm-text);
}
#buyDrugs #drugSelect {
  width: 100%;
  padding: 0.65rem;
  border: 2px solid var(--pharm-primary-alt);
  border-radius: var(--radius);
  background: var(--pharm-bg);
  color: var(--pharm-text);
  font-size: 1rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
#buyDrugs #drugSelect:focus {
  outline: none;
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.3);
  background: var(--pharm-accent);
}

#buyDrugs #priceDisplay {
  font-size: 1rem;
  font-weight: 600;
  color: var(--pharm-primary);
  margin-top: 0.5rem;
}

#buyDrugs #orderDetails {
  margin-top: 1.5rem;
  background: var(--pharm-bg);
  border: 1px solid var(--pharm-secondary);
  border-radius: var(--radius);
  padding: var(--padding);
  box-shadow: var(--shadow);
  transition: background var(--transition), box-shadow var(--transition);
}

#buyDrugs #orderDetails h3 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.25rem;
  color: var(--pharm-primary-alt);
  margin-bottom: 1rem;
}

#buyDrugs #orderDetails label {
  display: block;
  margin-bottom: 1rem;
  color: var(--pharm-text);
  font-weight: 500;
}
#buyDrugs #orderDetails input,
#buyDrugs #orderDetails textarea {
  width: 100%;
  padding: 0.65rem;
  margin-top: 0.5rem;
  border: 2px solid var(--pharm-primary-alt);
  border-radius: var(--radius);
  background: var(--pharm-bg);
  color: var(--pharm-text);
  font-size: 1rem;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
}
#buyDrugs #orderDetails input:focus,
#buyDrugs #orderDetails textarea:focus {
  outline: none;
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.3);
  background: var(--pharm-accent);
}

#buyDrugs #payWithPaystack {
  margin-top: 1.25rem;
  background: var(--pharm-primary-alt);
  color: #fff;
  padding: 0.7rem 1.2rem;
  border-radius: var(--radius);
  font-size: 1rem;
  font-weight: 600;
  box-shadow: var(--shadow);
  transition: background var(--transition), transform var(--transition);
}
#buyDrugs #payWithPaystack:hover {
  background: var(--pharm-primary);
  transform: translateY(-2px);
}

#paymentModal {
  display: none; 
}
#paymentModal:not([hidden]) {
    display: flex;
    align-items: center;
   justify-content: center;
  }

  #paymentModal .history-content {
  background: var(--pharm-surface);
  padding: 1.5rem;
  border-radius: var(--radius);
  width: 90%;
  max-width: 500px;
  max-height: 70%;
  overflow-y: auto;
  box-shadow: var(--shadow);
  position: relative;
}

#paymentModal .history-content h3 {
  font-size: 1.5rem;
  color: var(--pharm-primary-alt);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

#paymentModal .history-content p {
  font-size: 1rem;
  line-height: 1.5;
  color: var(--pharm-text);
  margin-bottom: 1.5rem;
}

#paymentModal .history-content .close-history {
  display: block;
  margin: 0 auto;
  background: var(--pharm-primary-alt);
  color: #fff;
  padding: 0.6rem 1.2rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 1rem;
  transition: background var(--transition), transform var(--transition);
}
#paymentModal .history-content .close-history:hover {
  background: var(--pharm-primary);
  transform: translateY(-2px);
}

@media (max-width: 768px) {
  #buyDrugs {
    padding: 0.75rem;
  }
  #buyDrugs h2 {
    font-size: 1.5rem;
  }
  #buyDrugs p.desc {
    font-size: 0.9rem;
  }
  #buyDrugs #symptomInputBuy,
  #buyDrugs #drugSelect,
  #buyDrugs #orderDetails input,
  #buyDrugs #orderDetails textarea {
    font-size: 0.95rem;
  }
  #buyDrugs #suggestDrug,
  #buyDrugs #payWithPaystack {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 480px) {
  #buyDrugs h2 {
    font-size: 1.3rem;
  }
  #buyDrugs p.desc {
    font-size: 0.85rem;
  }
  #buyDrugs #symptomInputBuy,
  #buyDrugs #drugSelect,
  #buyDrugs #orderDetails input,
  #buyDrugs #orderDetails textarea {
    font-size: 0.9rem;
  }
  #buyDrugs #suggestDrug,
  #buyDrugs #payWithPaystack {
    font-size: 0.9rem;
    padding: 0.6rem 1rem;
  }
  #buyDrugs #orderDetails h3 {
    font-size: 1.2rem;
  }
}
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 3000;
}
  .modal:not([hidden]) {
    display: flex; }
.modal .modal-content {
  background: var(--pharm-surface);
  border-radius: var(--radius);
  padding: var(--padding);
  width: 90%;
  max-width: 600px;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: var(--shadow);
  position: relative;
}
html.dark #buyDrugs #symptomInputBuy,
html.dark #buyDrugs #drugSelect,
html.dark #buyDrugs #orderDetails input,
html.dark #buyDrugs #orderDetails textarea {
  background: var(--pharm-surface);
  color: var(--pharm-text);
  border-color: var(--pharm-secondary);
}
html.dark #buyDrugs #symptomInputBuy:focus,
html.dark #buyDrugs #drugSelect:focus,
html.dark #buyDrugs #orderDetails input:focus,
html.dark #buyDrugs #orderDetails textarea:focus {
  background: var(--pharm-surface);
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.3);
}

#symptomInput,
#compoundList {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid var(--pharm-primary-alt);
  border-radius: var(--radius);
  background: var(--pharm-bg);
  color: var(--pharm-text);
  font-size: 1rem;
  resize: vertical;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition), color var(--transition);
 }
#symptomInput:focus,
#compoundList:focus {
  outline: none;
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148,210,189,0.3);
  background: var(--pharm-accent);
}
html.dark #symptomInput,
html.dark #compoundList {
 background: var(--pharm-surface);
  color: var(--pharm-text);
  border-color: var(--pharm-secondary);
}
html.dark #symptomInput:focus,
html.dark #compoundList:focus {
  background: var(--pharm-surface);
  border-color: var(--pharm-secondary);
  box-shadow: 0 0 0 3px rgba(148,210,189,0.3);
}

@media (max-width: 600px) {
  #symptomInput,
  #compoundList {
    font-size: 0.9rem;
    padding: 0.5rem;
  }
}
#pharmacyExpert .feature-card a.btn i {
  color: #fff;
  font-size: 1rem;
  transition: color var(--transition);
}

#pharmacyExpert .feature-card a.btn:hover i {
  color: #fff;
}
  
</style>


</head>

<body>
  <aside id="sidebar">
   <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--primary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span class="logo-text">Vitra AI</span>
    </div>

    <nav>
      <ul>
        <li><a href="herbal.html"><i class="fas fa-seedling"></i> <span>Herbal Medicine</span></a></li>
        <li><a href="psychology.html"><i class="fas fa-brain"></i> <span>Psychology & Mental Health</span></a></li>
        <li><a href="dietetics.html"><i class="fas fa-utensils"></i> <span>Dietetics</span></a></li>
        <li class="active"><a href="#"><i class="fas fa-prescription-bottle-alt"></i> <span>E-Pharmacy</span></a></li>
        <li><a href="consult.html"><i class="fas fa-calendar-check"></i> <span>Consult Booking</span></a></li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar" style="margin:0.5rem; cursor:pointer;">
      <i class="fas fa-chevron-left"></i>
    </button>
  </aside>

  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>E-Pharmacy AI Suite</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>


  <main>

  <section id="hero" class="module">
    <div class="hero-text">
      <h2><i class="fas fa-prescription"></i> Empower Your E-Pharmacy Experience</h2>
      <p class="desc">AI-powered tools for prescription scanning, drug lookup, interaction checking, dosage planning & more.</p>
      <div class="hero-actions">
        <a href="#buyDrugs" class="btn"><i class="fas fa-shopping-cart"></i> Purhcase Drugs</a>
        <a href="#drugInfo" class="btn"><i class="fas fa-search"></i> Lookup Drug</a>
        <a href="#interactionChecker" class="btn"><i class="fas fa-shield-alt"></i> Check Interactions</a>
        <a href="#dosageCalculator" class="btn"><i class="fas fa-calculator"></i> Plan Dosage</a>
      </div>
    </div>
    <div class="hero-image">
      <img src="pills.jpg" alt="E-Pharmacy Illustration">
    </div>

    <i class="fas fa-capsules sticker sticker-1" style="top:10%; left:15%;"></i>
    <i class="fas fa-vial sticker sticker-2" style="top:5%; right:20%;"></i>
    <i class="fas fa-notes-medical sticker sticker-3" style="bottom:10%; left:20%;"></i>
    <i class="fas fa-tag sticker sticker-4" style="bottom:15%; right:10%;"></i>
    <i class="fas fa-flask sticker sticker-5" style="top:50%; left:60%;"></i>
    <i class="fas fa-robot sticker sticker-6" style="top:30%; right:50%;"></i>
  </section>

    <section id="prescriptionScanner" class="module">
      <h2><i class="fas fa-microscope"></i> Smart Prescription Builder</h2>
      <p class="desc">Upload or scan a handwritten prescription; AI will decode and structure it for you.</p>
      <label>Upload Prescription Image:
        <input type="file" id="rxImage" accept="image/*">
      </label>
      <label>Patient Age:
        <input type="number" id="rxAge" placeholder="e.g. 45">
      </label>
      <label>Weight (kg):
        <input type="number" id="rxWeight" placeholder="e.g. 70">
      </label>
      <label>Diagnosis:
        <select id="rxDiagnosis">
          <option>Asthma</option>
          <option>Malaria</option>
          <option>Hypertension</option>
          <option>Diabetes</option>
          <option>Typhoid</option>
          <option>Yellow Fever</option>
          <option>Hepatitis B</option>
          <option>HIV/AIDS</option>
          <option>Tuberculosis</option>
          <option>Cholera</option>
          <option>Sickle Cell</option>
          <option>Pneumonia</option>
          <option>Diarrhea</option>
          <option>Meningitis</option>
          <option>COVID-19</option>
          <option>Measles</option>
          <option>Polio</option>
          <option>Lassa Fever</option>
          <option>Dengue</option>
          <option>Other</option>
        </select>
        <input type="text" id="rxDiagOther" class="other-input" placeholder="Specify diagnosis…" style="display:none; margin-top:0.5rem;" required>
      </label>
      <label>Medication Type:
        <select id="rxMode">
          <option>Tablet</option>
          <option>Syrup</option>
          <option>Injection</option>
          <option>Cream</option>
          <option>Other</option>
        </select>
        <input type="text" id="rxModeOther" class="other-input" placeholder="Specify form…" style="display:none; margin-top:0.5rem;">
      </label>
      <label>Dosage Frequency:
        <select id="rxFreq">
          <option>Once daily</option>
          <option>Twice daily</option>
          <option>Every 8 hours</option>
          <option>As needed</option>
        </select>
      </label>
      <label>Additional Notes:
        <textarea id="rxNotes" rows="2" placeholder="e.g. take with food…"></textarea>
      </label>
      <button id="scanRx" class="btn"><i class="fas fa-cogs"></i> Build Prescription</button>
      <div id="scannerPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="drugInfo" class="module">
      <h2><i class="fas fa-pills"></i> Drug Information Lookup</h2>
      <p class="desc">Search any medication to get monographs, dosage guidelines, side-effects, and safety data.</p>
      <label>Drug Name:
        <input list="drug-list" id="drugInput" placeholder="Type or select a drug…">
        <datalist id="drug-list">
          <option>Metformin</option><option>Lisinopril</option><option>Atorvastatin</option>
          <option>Omeprazole</option><option>Albuterol</option><option>Levothyroxine</option>
          <option>Amlodipine</option><option>Simvastatin</option><option>Gabapentin</option>
          <option>Citalopram</option><option>Losartan</option><option>Sertraline</option>
          <option>Furosemide</option><option>Hydrochlorothiazide</option><option>Prednisone</option>
          <option>Amoxicillin</option><option>Azithromycin</option><option>Clopidogrel</option>
          <option>Warfarin</option><option>Other</option>
        </datalist>
      </label>
      <button id="lookupDrug" class="btn"><i class="fas fa-search"></i> Lookup</button>
      <div id="drugInfoPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="interactionChecker" class="module">
      <h2><i class="fas fa-exchange-alt"></i> Drug–Drug & Drug–Food Interaction Checker</h2>
      <p class="desc">Enter up to two medications and any food or supplement to check for potential interactions.</p>
      <label>Drug 1:
        <input list="drug-list" id="intDrug1" placeholder="e.g. Paracetamol">
      </label>
      <label>Drug 2:
        <input list="drug-list" id="intDrug2" placeholder="e.g. Aspirin">
      </label>
      <label>Food/Supplement:
        <input list="food-list" id="intFood" placeholder="e.g. Grapefruit, Milk…">
        <datalist id="food-list">
          <option>Grapefruit</option><option>Milk</option><option>Alcohol</option>
          <option>Iron supplement</option><option>Other</option>
        </datalist>
      </label>
      <button id="checkInteractions" class="btn"><i class="fas fa-shield-alt"></i> Check Interactions</button>
      <div id="interactionPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="dosageCalculator" class="module">
      <h2><i class="fas fa-calculator"></i> Dosage & Titration Planner</h2>
      <p class="desc">Input patient metrics; AI will compute initial dose, titration schedule, and monitoring intervals.</p>
      <small>⦿ Titration: step-wise adjustments over time<br>⦿ Monitoring: when to check labs/vitals</small>
      <label>Weight (kg):
        <input type="number" id="patientWeight" placeholder="e.g. 70">
      </label>
      <label>Creatinine Clearance (mL/min):
        <input type="number" id="crCl" placeholder="e.g. 85">
      </label>
      <label>Liver Function (ALT U/L):
        <input type="number" id="altValue" placeholder="e.g. 30">
      </label>
      <button id="computeDose" class="btn"><i class="fas fa-cogs"></i> Compute Dose</button>
      <div id="dosagePanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="symptomAdvisor" class="module">
      <h2><i class="fas fa-notes-medical"></i> Symptom-Based Drug Advisor</h2>
      <p class="desc">Describe your symptoms, and the AI suggests appropriate medications with dosages and follow-up advice.</p>
      <textarea id="symptomInput" rows="3" placeholder="e.g. headache, fever, cough…"></textarea>
      <button id="adviseDrug" class="btn"><i class="fas fa-stethoscope"></i> Recommend Medication</button>
      <div id="advisePanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

<section id="buyDrugs" class="module">
  <h2><i class="fas fa-shopping-cart"></i> Buy Drugs from Our Pharmacy</h2>
  <p class="desc">
    Describe what’s wrong and let our AI suggest the best medication, or simply pick a drug below. After selecting, fill in your details and proceed to payment.
  </p>

  <label for="symptomInputBuy">Describe your symptoms:</label>
  <textarea id="symptomInputBuy" rows="2" placeholder="e.g. headache and fever…"></textarea>
  <button id="suggestDrug" class="btn"><i class="fas fa-brain"></i> Suggest a Drug</button>
  <small style="display:block; margin-top:0.5rem; color:var(--pharm-muted);">
    (Our AI will analyze your symptoms and pre-select a suitable medication below.)
  </small>
  <div id="suggestionMsg" style="margin-top:0.75rem; color:var(--pharm-secondary);"></div>

  <label for="drugSelect" style="margin-top:1rem; display:block;">Choose a drug:</label>
 <small class="desc" style="margin-bottom:0.5rem;">Hold Ctrl (⌘ on Mac) to select more than one.</small>
  <select id="drugSelect" multiple size="5">
 </select>
 <div style="margin-top:0.5rem;">
   <button id="addToCart" class="btn" style="background:var(--pharm-primary-alt);">
     <i class="fas fa-cart-plus"></i> Add to Cart
   </button>
 </div>
  <div id="priceDisplay" style="margin-top:0.5rem; font-weight:600;"></div>

 <div id="cartSummary" style="margin-top:1rem; display:none; border:1px solid var(--pharm-secondary); border-radius:var(--radius); padding:var(--padding); background:var(--pharm-bg);">
   <h4 style="margin-bottom:0.75rem; color:var(--pharm-primary-alt);">Selected Items:</h4>
   <ul id="cartList" style="list-style:disc; padding-left:1.5rem; color:var(--pharm-text);"></ul>
   <p style="font-weight:600; margin-top:0.75rem;">Total: ₵<span id="cartTotal">0.00</span></p>
 </div>

  <div id="orderDetails" style="margin-top:1.5rem; display:none;">
    <h3><i class="fas fa-user"></i> Your Details</h3>
  <label>Full Name:
      <input type="text" id="buyerName" placeholder="e.g. John Doe" required>
    </label>
    <label>Phone Number:
      <input 
        type="tel" 
        id="buyerPhone" 
        placeholder="+233501234567" 
        pattern="\+\d{10,15}" 
        required
      >
      <small style="display:block; font-size:0.85rem; color:var(--pharm-muted);">
        Format: <code>+CountryCodeNumber</code> (10–15 digits). e.g. <code>+233501234567</code>
      </small>
    </label>
    <label>Email Address:
      <input 
        type="email" 
        id="buyerEmail" 
        placeholder="example@mail.com" 
        required
      >
    </label>
    <label>Delivery Address:
      <textarea id="buyerAddress" rows="2" placeholder="Street, City, Region…" required></textarea>
    </label>
     <button id="payWithPaystack" class="btn" style="background: var(--pharm-primary-alt);">
      <i class="fas fa-credit-card"></i> Proceed to Payment
    </button>
  </div>
</section>
 <!-- modal -->
     <div id="paymentModal" class="history-modal" hidden>
    <div class="history-content">
      <h3><i class="fas fa-check-circle" style="color:green;"></i> Payment Successful!</h3>
      <p id="confirmText"></p>
      <button class="close-history"><i class="fas fa-times"></i> Close</button>
    </div>
  </div>


    <section id="compoundAdvisor" class="module">
      <h2><i class="fas fa-flask"></i> Compound Formulation Advisor</h2>
      <p class="desc">List active ingredients & desired strength; AI returns a detailed compounding protocol with excipients, mixing order, and storage guidelines.</p>
      <small>⦿ Excipients: fillers, binders<br>⦿ Stability: shelf life, storage conditions</small>
      <textarea id="compoundList" rows="3" placeholder="e.g. Amoxicillin 125mg/mL, Glycerin…"></textarea>
      <label>Desired Strength:
        <input type="text" id="compoundStrength" placeholder="e.g. 20mg/mL">
      </label>
      <button id="adviseCompound" class="btn"><i class="fas fa-tools"></i> Advise Formulation</button>
      <div id="compoundPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="sideEffectPredictor" class="module">
      <h2><i class="fas fa-exclamation-circle"></i> Side-Effect Predictor</h2>
      <p class="desc">Enter patient age, comorbidities, and chosen medications; AI predicts likely side-effects, severity grading, and monitoring advice.</p>
      <label>Age:
        <input type="number" id="patientAge" placeholder="e.g. 65">
      </label>
      <label>Comorbidities:
        <select id="comorbiditySelect">
          <option>Diabetes</option><option>Hypertension</option><option>CKD</option>
          <option>CHF</option><option>COPD</option><option>Other</option>
        </select>
        <input class="other-input" placeholder="Specify…" style="display:none; margin-top:0.5rem;">
      </label>
      <label>Medications:
        <input list="drug-list" id="sideEffectDrugs" placeholder="Select or type meds…">
      </label>
      <button id="predictSideEffects" class="btn"><i class="fas fa-heartbeat"></i> Predict Risks</button>
      <div id="sideEffectPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="drugChatbot" class="module">
      <h2><i class="fas fa-robot"></i> Drug-Education Chatbot</h2>
      <p class="desc">Ask any question about medications—AI provides answers with citations, dosing charts, and follow-ups.</p>
      <div class="chat-controls">
      <button id="clearPharmaChat" class="btn-secondary" type="button"><i class="fas fa-trash"></i> Clear Chat</button>
    <button id="historyBtn" class="btn" type="button" style="margin-left:0.5rem;"><i class="fas fa-history"></i> History</button>
      </div>
      <div id="pharmaChatBox" class="chat-box"></div>
     <form id="pharma-form" class="chat-input-row">
   <input id="pharmaInput" type="text" placeholder="Ask me anything about meds…" />
   <button id="sendPharma" class="btn" type="submit">
     <i class="fas fa-paper-plane"></i>
   </button>
 </form>
    </section>

     <div id="historyModal" class="modal" hidden>
      <div class="modal-content">
        <button class="close-modal btn-secondary" aria-label="Close History">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h3>Chat History</h3>
          <button id="clearHistory" class="btn-secondary" type="button"><i class="fas fa-trash-alt"></i></button>
        </div>
        <div id="historyList" style="max-height:400px; overflow-y:auto;"></div>
      </div>
    </div>

    <section id="refillScheduler" class="module">
      <h2><i class="fas fa-sync-alt"></i> Bulk Refill Scheduler</h2>
      <p class="desc">Upload your medication list or select from options; AI will schedule refills, set reminders, and optimize dates.</p>
      <label>Upload CSV/XLSX:
        <input type="file" id="refillList" accept=".csv,.xlsx">
      </label>
      <label>Or Select Medications:
        <select id="refillSelect" multiple>
          <option>Amoxicillin</option>
          <option>Metformin</option>
          <option>Lisinopril</option>
          <option>Amlodipine</option>
          <option>Omeprazole</option>
          <option>Simvastatin</option>
          <option>Atorvastatin</option>
          <option>Albuterol</option>
          <option>Gabapentin</option>
          <option>Warfarin</option>
          <option>Prednisone</option>
          <option>Azithromycin</option>
          <option>Clopidogrel</option>
          <option>Citalopram</option>
          <option>Sertraline</option>
          <option>Furosemide</option>
          <option>Hydrochlorothiazide</option>
          <option>Levothyroxine</option>
          <option>Other</option>
        </select>
        <input type="text" id="refillOther" class="other-input" placeholder="Specify other medication…" style="display:none; margin-top:0.5rem;">
      </label>
      <button id="scheduleRefill" class="btn"><i class="fas fa-calendar-check"></i> Schedule Refills</button>
      <div id="refillPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
      </div>
    </section>

    <section id="charts" class="module">
      <h2><i class="fas fa-chart-line"></i> Usage Statistics</h2>
      <p class="desc">These charts update in real time—showing this month’s prescription scans and weekly drug lookups.</p>
      <div class="chart-wrapper">
        <h3>Monthly Prescription Scans</h3>
        <canvas id="chart1"></canvas>
          <p class="desc" style="margin-top:0.5rem;">
         This line chart shows how many prescriptions were scanned each month over the past 7 months.
       </p>
      </div>
      <div class="chart-wrapper" style="margin-top:1.5rem;">
        <h3>Weekly Drug Lookups</h3>
        <canvas id="chart2"></canvas>
        <p class="desc" style="margin-top:0.5rem;">
         This bar chart displays the total number of drug lookup requests for each week of the current month.
       </p>
      </div>
      <button id="exportChartsData" class="btn" style="margin-top:1.5rem;"><i class="fas fa-file-export"></i> Export Data (CSV)</button>
    </section>

    <section id="pharmacyExpert" class="module">
      <h2><i class="fas fa-user-md"></i> Talk to a Licensed Pharmacist</h2>
      <p class="desc">Connect with one of our certified pharmacists in real time—get personalized advice, medication counseling, and follow-up recommendations.</p>
      <div class="expert-features">
        <div class="feature-card">
          <i class="fas fa-comments" style="color: #ffffff"></i>
          <h3>Secure Chat Support</h3>
          <p>Chat with a pharmacist to clarify drug interactions, side-effects, or dosage queries.</p>
          <a class="btn" href="chat-consult.html"><i class="fas fa-comment"></i> Open Chat</a>
        </div>
        <div class="feature-card">
          <i class="fas fa-calendar-plus" style="color: #ffffff"></i>
          <h3>Schedule Appointment</h3>
          <p>Book a one-on-one session for comprehensive medication management and therapy reviews.</p>
          <a class="btn" href="consult.html"><i class="fas fa-calendar-check"></i> Book Now</a>
        </div>
      </div>
    </section>

    <footer>
      <p style="text-align:center; margin-top:2rem; color:var(--pharm-muted);">
        &copy; 2025 Vitra AI E-Pharmacy. All Rights Reserved.
      </p>
    </footer>
  </main>
<script src="https://js.paystack.co/v1/inline.js"></script>

<script src="storage.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

    function escapeHtml(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  document.addEventListener("DOMContentLoaded", () => {
   
    const themeToggle = document.getElementById("themeToggle");
    const savedTheme = localStorage.getItem("epharmacy-theme");
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark");
      document.documentElement.setAttribute("aria-theme", "dark");
      themeToggle.classList.remove("fa-moon");
      themeToggle.classList.add("fa-sun");
    }
    themeToggle.addEventListener("click", () => {
      const htmlEl = document.documentElement;
      const isDark = htmlEl.classList.toggle("dark");
      themeToggle.classList.toggle("fa-sun", isDark);
      themeToggle.classList.toggle("fa-moon", !isDark);
      htmlEl.setAttribute("aria-theme", isDark ? "dark" : "light");
      localStorage.setItem("epharmacy-theme", isDark ? "dark" : "light");
   shrinkSidebar.style.color = isDark ? getComputedStyle(document.documentElement).getPropertyValue("--pharm-text") : getComputedStyle(document.documentElement).getPropertyValue("--pharm-surface");
    });

      const sidebar = document.getElementById("sidebar");
    const shrinkSidebar = document.getElementById("shrinkSidebar");
    const hamburger = document.getElementById("hamburger");

        shrinkSidebar.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      const icon = shrinkSidebar.querySelector("i");
      icon.classList.toggle("fa-chevron-left");
      icon.classList.toggle("fa-chevron-right");

      const logoText = sidebar.querySelector(".logo .logo-text");
     if (sidebar.classList.contains("collapsed")) {
       logoText.style.display = "none";
     } else {
       logoText.style.display = "inline"; 
     }
    });

        hamburger.addEventListener("click", () => {
      document.body.classList.toggle("sidebar-open");
    });

        document.addEventListener("click", (e) => {
      if (window.innerWidth <= 768 && sidebar.contains(e.target) === false && hamburger.contains(e.target) === false) {
        document.body.classList.remove("sidebar-open");
      }
    });

      async function callOpenAI(messages) {
      try {
        const response = await fetch("/.netlify/functions/openai-proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages })
        });
        if (!response.ok) throw new Error("OpenAI request failed");
        const data = await response.json();
        return data.choices?.[0]?.message?.content.trim() || "";
      } catch (err) {
        console.error(err);
        throw err;
      }
    }
    async function callVision(file) {
      const fd = new FormData();
      fd.append("file", file);
      const res = await fetch("/.netlify/functions/vision-proxy", {
        method: "POST",
        body: fd
      });
      const rawText = await res.text();
      let payload = null;
      try { payload = JSON.parse(rawText); } catch {}
      if (!res.ok) {
        const errMsg = payload?.error || rawText;
        throw new Error("Vision API error: " + errMsg);
      }
      return payload !== null ? payload : rawText;
    }

   const drugsData = [
    { name: "Paracetamol 500mg", price: 8.00 },
    { name: "Amoxicillin 500mg", price: 48.00 },
    { name: "Ciprofloxacin 500mg", price: 30.00 },
    { name: "Azithromycin 250mg", price: 40.00 },
    { name: "Metformin 500mg", price: 20.00 },
    { name: "Lisinopril 10mg", price: 22.00 },
    { name: "Atorvastatin 20mg", price: 55.00 },
    { name: "Omeprazole 20mg", price: 35.00 },
    { name: "Amoxicillin-Clavulanate 625mg", price: 60.00 },
    { name: "Ceftriaxone 1g Injection", price: 120.00 },
    { name: "Artemether-Lumefantrine (Coartem) 80/480mg", price: 80.00 },
    { name: "Quinine 300mg", price: 15.00 },
    { name: "Albendazole 400mg", price: 12.00 },
    { name: "Ivermectin 6mg", price: 28.00 },
    { name: "Mebendazole 100mg", price: 11.00 },
    { name: "Vitamin C 500mg", price: 9.00 },
    { name: "Vitamin D 1000 IU", price: 15.00 },
    { name: "Iron Sulphate 200mg", price: 18.00 },
    { name: "Enalapril 5mg", price: 21.00 },
    { name: "Metoprolol 50mg", price: 26.00 },
    { name: "Atenolol 50mg", price: 24.00 },
    { name: "Salbutamol Inhaler 100mcg", price: 250.00 },
    { name: "Budesonide Inhaler 200mcg", price: 450.00 },
    { name: "Salmetrol-Fluticasone 50/250mcg", price: 600.00 },
    { name: "Regular Insulin (10mL vial)", price: 700.00 },
    { name: "Insulin Glargine 100IU/mL", price: 1500.00 },
    { name: "Metronidazole 400mg", price: 13.00 },
    { name: "Tinidazole 500mg", price: 32.00 },
    { name: "Zinc Sulphate 20mg", price: 10.00 },
    { name: "Co-trimoxazole (Trimethoprim-Sulfamethoxazole) 480mg", price: 19.00 },
    { name: "Nifedipine 20mg", price: 29.00 },
    { name: "Simvastatin 20mg", price: 48.00 },
    { name: "Hydrochlorothiazide 25mg", price: 19.00 },
    { name: "Prednisone 20mg", price: 38.00 },
    { name: "Naproxen 500mg", price: 22.00 },
    { name: "Ibuprofen 400mg", price: 15.00 },
    { name: "Diclofenac 50mg", price: 18.00 },
    { name: "Erythromycin 500mg", price: 40.00 },
    { name: "Doxycycline 100mg", price: 35.00 },
    { name: "Chloroquine 250mg", price: 12.00 },
    { name: "Artesunate 50mg", price: 65.00 }
  ];

  const symptomInputBuy = document.getElementById("symptomInputBuy");
  const suggestDrugBtn   = document.getElementById("suggestDrug");
  const suggestionMsg    = document.getElementById("suggestionMsg");
  const drugSelect       = document.getElementById("drugSelect");
  const priceDisplay     = document.getElementById("priceDisplay");
  const addToCartBtn     = document.getElementById("addToCart");
  const cartList         = document.getElementById("cartList");
  const cartTotal        = document.getElementById("cartTotal");
  const cartSummary      = document.getElementById("cartSummary");
  const orderDetails     = document.getElementById("orderDetails");
  const payButton        = document.getElementById("payWithPaystack");
  const paymentModal     = document.getElementById("paymentModal");
  const confirmText      = document.getElementById("confirmText");

  drugsData.forEach((drug, idx) => {
    const opt = document.createElement("option");
    opt.value = idx; 
    opt.textContent = `${drug.name} — ₵${drug.price.toFixed(2)}`;
    drugSelect.appendChild(opt);
  });

  function updateSinglePrice() {
    const idx = Number(drugSelect.value);
    if (isNaN(idx) || idx < 0) {
      priceDisplay.textContent = "";
      return;
    }
    priceDisplay.textContent = `Price: ₵${drugsData[idx].price.toFixed(2)}`;
  }
  drugSelect.addEventListener("change", updateSinglePrice);

  suggestDrugBtn.addEventListener("click", async () => {
    const symptoms = symptomInputBuy.value.trim();
    suggestionMsg.textContent = "";
    if (!symptoms) {
      suggestionMsg.textContent = "⚠️ Please describe your symptoms first.";
      return;
    }
    suggestionMsg.innerHTML = `Analyzing symptoms… <span class="spinner"></span>`;
    try {
      const sysPrompt = `
You are a clinical pharmacist. A patient reports these symptoms: "${symptoms}". 
From the list below, suggest up to FIVE drugs (return only the names, comma-separated, matching the list). If only one is appropriate, that’s fine.
${drugsData.map(d => d.name).join(", ")}.
      `.trim();

      const aiReply = await callOpenAI([
        { role: "system", content: sysPrompt },
        { role: "user",   content: `Symptoms: ${symptoms}` }
      ]);

     const rawNames = aiReply
       .split(/[\r\n]+/)[0]          
       .split(",")                
       .map(s => s.trim())
       .filter(s => s.length > 0)
       .slice(0, 5);               

     Array.from(drugSelect.options).forEach(opt => opt.selected = false);
     const matchedNames = [];

     rawNames.forEach(name => {
       const idx = drugsData.findIndex(d => d.name.toLowerCase() === name.toLowerCase());
       if (idx >= 0) {
         drugSelect.options[idx].selected = true;
         matchedNames.push(drugsData[idx].name);
       }
     });

     if (matchedNames.length > 0) {
       updateSinglePrice(); 
       suggestionMsg.textContent = `AI suggests: ${matchedNames.map(n => `"${n}"`).join(", ")}.`;
     } else {
       suggestionMsg.textContent = `AI suggested "${rawNames.join(", ")}", which isn't in our list. Please choose manually.`;
     }
   } catch (err) {
      console.error(err);
      suggestionMsg.textContent = "⚠️ Unable to get suggestion right now. Please try again.";
    }
  });

  let cartItems = [];

  addToCartBtn.addEventListener("click", () => {
    const selectedOptions = Array.from(drugSelect.selectedOptions);
    if (selectedOptions.length === 0) {
      alert("⚠️ Please select at least one drug to add.");
      return;
    }

    cartItems = selectedOptions.map(opt => {
      const idx = Number(opt.value);
      return {
        name:  drugsData[idx].name,
        price: drugsData[idx].price
      };
    });

    cartList.innerHTML = "";
    let total = 0;
    cartItems.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `${item.name} — ₵${item.price.toFixed(2)}`;
      cartList.appendChild(li);
      total += item.price;
    });
    cartTotal.textContent = total.toFixed(2);
    cartSummary.style.display = "block";

    orderDetails.style.display = "block";
    priceDisplay.textContent = "";
  });

  orderDetails.style.display = "none";
  cartSummary.style.display  = "none";

  payButton.addEventListener("click", () => {
  if (cartItems.length === 0) {
      alert("⚠️ Your cart is empty. Please add at least one drug.");
      return;
    }
    const nameEl    = document.getElementById("buyerName");
    const phoneEl   = document.getElementById("buyerPhone");
    const emailEl   = document.getElementById("buyerEmail");
    const addressEl = document.getElementById("buyerAddress");

    const name    = nameEl.value.trim();
    const phone   = phoneEl.value.trim();
    const email   = emailEl.value.trim();
    const address = addressEl.value.trim();
    if (!name || !phone || !email || !address) {
      alert("⚠️ Please fill in all your details before proceeding.");
      return;
    }

    if (!emailEl.checkValidity()) {
      alert("⚠️ Please enter a valid email address (e.g. user@example.com).");
      emailEl.focus();
      return;
    }
    if (!phoneEl.checkValidity()) {
      alert("⚠️ Please enter a valid phone number (must start with + and be 10–15 digits).");
      phoneEl.focus();
      return;
    }


    const totalGHS  = cartItems.reduce((sum, itm) => sum + itm.price, 0);
    const totalKobo = Math.round(totalGHS * 100);

    const handler = PaystackPop.setup({
key: "pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa",
      email: email,
      amount: totalKobo,
      currency: "GHS",
      firstname: name,
      metadata: {
        custom_fields: [
          { display_name: "Phone Number",    variable_name: "phone_number",    value: phone   },
          { display_name: "Delivery Address", variable_name: "delivery_address", value: address }
        ]
      },
      onClose: function() {
        alert("Payment window was closed. If you already paid, please contact support.");
      },
      callback: function(response) {

    const prev = JSON.parse(localStorage.getItem("purchasedDrugs") || "[]");
    cartItems.forEach(itm => {
      prev.push({
        name: itm.name,
        price: itm.price,
        date: new Date().toISOString()
      });
    });
    localStorage.setItem("purchasedDrugs", JSON.stringify(prev));

    const itemLines = cartItems
      .map(itm => `${itm.name} — ₵${itm.price.toFixed(2)}`)
      .join("<br>");
    confirmText.innerHTML = `
      Thank you, <strong>${escapeHtml(name)}</strong>!<br>
      You have successfully purchased:<br>
      ${itemLines}<br><br>
      <strong>Total Paid: ₵${totalGHS.toFixed(2)}</strong><br>
      Transaction Reference: <em>${response.reference}</em><br>
      Delivery Address: <em>${escapeHtml(address)}</em><br>
      Contact: <em>${escapeHtml(phone)}</em><br>
      Check your email (${escapeHtml(email)}) for the receipt.
    `;
    paymentModal.hidden = false;
      }
    });
    handler.openIframe();
  });

  paymentModal.querySelector(".close-history").onclick = () => {
    paymentModal.hidden = true;

    cartItems = [];
    cartList.innerHTML = "";
    cartTotal.textContent = "0.00";
    cartSummary.style.display = "none";
    orderDetails.style.display = "none";
    symptomInputBuy.value = "";
    suggestionMsg.textContent = "";
    priceDisplay.textContent = "";
    drugSelect.value = "";
    document.getElementById("buyerName").value = "";
    document.getElementById("buyerPhone").value = "";
    document.getElementById("buyerEmail").value = "";
    document.getElementById("buyerAddress").value = "";
  };

 
       function formatHTML(text) {
      if (!text) return "";
      return text
        .replace(/^######\s*(.+)$/gm, "<h6>$1</h6>")
        .replace(/^#####\s*(.+)$/gm, "<h5>$1</h5>")
        .replace(/^####\s*(.+)$/gm, "<h4>$1</h4>")
        .replace(/^###\s*(.+)$/gm, "<h3>$1</h3>")
        .replace(/^##\s*(.+)$/gm, "<h2>$1</h2>")
        .replace(/^#\s*(.+)$/gm, "<h1>$1</h1>")
        .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
        .replace(/\*(.+?)\*/g, "<em>$1</em>")
        .replace(/`([^`]+)`/g, "<code>$1</code>")
        .split(/\n{2,}/)
        .map(p => `<p>${p.trim()}</p>`)
        .join("");
    }

       function addClose(panel) {
      if (panel.querySelector(".close-btn")) return;
      const btn = document.createElement("button");
      btn.className = "close-btn";
      btn.setAttribute("aria-label", "Close result");
      btn.innerHTML = '<i class="fas fa-times"></i>';
      btn.onclick = () => (panel.hidden = true);
      panel.prepend(btn);
    }

      function addTools(panel) {
      if (panel.querySelector(".tool-row")) return;
      const tools = document.createElement("div");
      tools.className = "tool-row";
      tools.innerHTML = `
        <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
        <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
      `;
      panel.append(tools);

      const copyBtn = tools.querySelector(".copy-btn");
      const dlBtn = tools.querySelector(".dl-btn");
      const contentDiv = panel.querySelector(".result-content");

      copyBtn.onclick = () => {
        if (!contentDiv) return;
        navigator.clipboard.writeText(contentDiv.innerText || "");
        const toast = document.createElement("div");
        toast.className = "copy-toast";
        toast.textContent = "Copied!";
        document.body.append(toast);
        setTimeout(() => toast.remove(), 1500);
      };

      dlBtn.onclick = () => {
        if (!contentDiv) return;
        const text = contentDiv.innerText || "";
        const blob = new Blob([text], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "response.txt";
        document.body.append(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      };
    }

      function showFriendlyError(panel, message = "😕 Oops! Something went wrong. Please try again.") {
      panel.innerHTML = `<div class="result-content">${escapeHtml(message)}</div>`;
      panel.classList.add("error");
      addClose(panel);
    }

    document.querySelectorAll("select").forEach((sel) => {
      sel.addEventListener("change", (e) => {
        const otherField = document.getElementById(sel.id + "Other");
        if (!otherField) return;
        const pickedOther = Array.from(sel.selectedOptions).some(opt => opt.value === "Other");
        if (pickedOther) {
          otherField.style.display = "block";
          otherField.required = true;
        } else {
          otherField.style.display = "none";
          otherField.required = false;
        }
      });
    });

       const scanRxBtn = document.getElementById("scanRx");
    const scannerPanel = document.getElementById("scannerPanel");
    const rxImageInput = document.getElementById("rxImage");
    function previewRxImage(input) {
    }
    window.previewRxImage = previewRxImage;

    scanRxBtn.addEventListener("click", async () => {
      const panel = scannerPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Processing… <span class="spinner"></span></div>`;
      try {
        const file = rxImageInput.files[0];
        const age = document.getElementById("rxAge").value.trim();
        const weight = document.getElementById("rxWeight").value.trim();
        let diagnosis = document.getElementById("rxDiagnosis").value;
        if (diagnosis === "Other") diagnosis = document.getElementById("rxDiagOther").value.trim();
        let mode = document.getElementById("rxMode").value;
        if (mode === "Other") mode = document.getElementById("rxModeOther").value.trim();
        const freq = document.getElementById("rxFreq").value;
        const notes = document.getElementById("rxNotes").value.trim();

        if (!file && !diagnosis) {
          showFriendlyError(panel, "⚠️ Please upload a prescription image or select a diagnosis.");
          return;
        }

        let combinedHtml = "";
        if (file) {
          const visionData = await callVision(file);
          const recognizedText = visionData.text || JSON.stringify(visionData);
          combinedHtml += `<p><strong>Recognized Prescription Text:</strong> ${escapeHtml(recognizedText)}</p><hr/>`;
        }
        const sysPrompt = `
You are a skilled medical assistant. A user has provided a prescription (OCR text if available), plus:
• Patient Age: ${age} years
• Weight: ${weight} kg
• Diagnosis: ${diagnosis}
• Medication Form: ${mode}
• Frequency: ${freq}
• Additional Notes: ${notes}

Please output a clean, structured prescription summary that includes:
1) Medication names and dosages (based on OCR or user input).  
2) Suggested instructions (e.g., “take with food”).  
3) Any safety warnings (allergies, dose adjustments).  
4) Format as bullet points or short paragraphs for readability.
        `.trim();

        const userContent = file ? `${visionData.text}` : `Diagnosis: ${diagnosis}`;

        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: userContent }
        ]);

        combinedHtml += `<div class="result-content">${formatHTML(aiReply)}</div>`;
        panel.innerHTML = combinedHtml;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(scannerPanel, err.message || "An error occurred while building the prescription.");
      }
    });

    scannerPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => scannerPanel.hidden = true;
    });

    const lookupDrugBtn = document.getElementById("lookupDrug");
    const drugInfoPanel = document.getElementById("drugInfoPanel");

    lookupDrugBtn.addEventListener("click", async () => {
      const panel = drugInfoPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Searching… <span class="spinner"></span></div>`;
      try {
        let drugName = document.getElementById("drugInput").value.trim();
        if (!drugName) {
          showFriendlyError(panel, "⚠️ Please enter a drug name to lookup.");
          return;
        }
        const sysPrompt = `
You are a clinical pharmacologist. Provide a detailed monograph for the drug: "${drugName}". Include:
• Mechanism of action  
• Indications  
• Dosing guidelines  
• Common side effects  
• Contraindications and precautions  
• Monitoring parameters  
Format as clear headings and bullet points.
        `.trim();

        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: `Drug: ${drugName}` }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(drugInfoPanel, err.message || "Failed to retrieve drug information.");
      }
    });
    drugInfoPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => drugInfoPanel.hidden = true;
    });

      const checkInteractionsBtn = document.getElementById("checkInteractions");
    const interactionPanel = document.getElementById("interactionPanel");

    checkInteractionsBtn.addEventListener("click", async () => {
      const panel = interactionPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Analyzing… <span class="spinner"></span></div>`;
      try {
        const drug1 = document.getElementById("intDrug1").value.trim();
        const drug2 = document.getElementById("intDrug2").value.trim();
        const food = document.getElementById("intFood").value.trim();

        if (!drug1 && !drug2 && !food) {
          showFriendlyError(panel, "⚠️ Please enter at least one drug or food to check interactions.");
          return;
        }
        const sysPrompt = `
You are an expert in pharmacology. Evaluate potential interactions between:
• Drug 1: ${drug1 || "N/A"}  
• Drug 2: ${drug2 || "N/A"}  
• Food/Supplement: ${food || "N/A"}  

Provide:
1) Any known drug–drug interactions (mechanism, severity).  
2) Any known drug–food/supplement interactions.  
3) Recommendations to mitigate risks.  
Format as short paragraphs or bullet points.
        `.trim();

        const userContent = `Drug 1: ${drug1}\nDrug 2: ${drug2}\nFood/Supplement: ${food}`;
        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: userContent }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(interactionPanel, err.message || "Interaction check failed.");
      }
    });
    interactionPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => interactionPanel.hidden = true;
    });

     const computeDoseBtn = document.getElementById("computeDose");
    const dosagePanel = document.getElementById("dosagePanel");

    computeDoseBtn.addEventListener("click", async () => {
      const panel = dosagePanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Calculating… <span class="spinner"></span></div>`;
      try {
        const weight = document.getElementById("patientWeight").value.trim();
        const crCl = document.getElementById("crCl").value.trim();
        const alt = document.getElementById("altValue").value.trim();

        if (!weight || !crCl) {
          showFriendlyError(panel, "⚠️ Please enter at least weight and creatinine clearance.");
          return;
        }
        const sysPrompt = `
You are a clinical pharmacokinetics specialist. Given:
• Weight: ${weight} kg  
• Creatinine Clearance: ${crCl} mL/min  
• Liver Function (ALT): ${alt || "N/A"} U/L  

Calculate:
1) Initial drug dosing (e.g., mg/kg).  
2) Titration schedule recommendations (step-wise dose adjustments).  
3) Monitoring intervals (labs, vitals).  
Provide clear instructions and rationale in bullet points.
        `.trim();

        const userContent = `Weight: ${weight} kg\nCrCl: ${crCl} mL/min\nALT: ${alt}`;
        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: userContent }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(dosagePanel, err.message || "Dosage calculation failed.");
      }
    });
    dosagePanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => dosagePanel.hidden = true;
    });
Storage.recordCategory("Pharmacy"); 
  
    const adviseDrugBtn = document.getElementById("adviseDrug");
    const advisePanel = document.getElementById("advisePanel");

    adviseDrugBtn.addEventListener("click", async () => {
      const panel = advisePanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Analyzing… <span class="spinner"></span></div>`;
      try {
        const symptoms = document.getElementById("symptomInput").value.trim();
        if (!symptoms) {
          showFriendlyError(panel, "⚠️ Please describe your symptoms to get recommendations.");
          return;
        }
        const sysPrompt = `
You are a clinical pharmacist assistant. A patient describes symptoms: "${symptoms}".  
Provide:
1) List of appropriate over-the-counter or prescription medications.  
2) Suggested dosages and frequency.  
3) Monitoring/follow-up advice (e.g., when to see a doctor).  
Format as separate paragraphs.
        `.trim();

        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: `Symptoms: ${symptoms}` }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(advisePanel, err.message || "Recommendation failed.");
      }
    });
    advisePanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => advisePanel.hidden = true;
    });

     const adviseCompoundBtn = document.getElementById("adviseCompound");
    const compoundPanel = document.getElementById("compoundPanel");

    adviseCompoundBtn.addEventListener("click", async () => {
      const panel = compoundPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Processing… <span class="spinner"></span></div>`;
      try {
        const ingredients = document.getElementById("compoundList").value.trim();
        const strength = document.getElementById("compoundStrength").value.trim();
        if (!ingredients || !strength) {
          showFriendlyError(panel, "⚠️ Please list ingredients and desired strength.");
          return;
        }
        const sysPrompt = `
You are an experienced compounding pharmacist. A user provides:
• Active ingredients & quantities: ${ingredients}  
• Desired final strength: ${strength}  

Provide a step-by-step compounding protocol that includes:
1) Excipients and amounts.  
2) Mixing order and technique.  
3) Compounding equipment.  
4) Storage conditions and shelf life.  
Format as bullet points.
        `.trim();

        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: `Ingredients: ${ingredients}\nStrength: ${strength}` }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(compoundPanel, err.message || "Formulation advice failed.");
      }
    });
    compoundPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => compoundPanel.hidden = true;
    });

     const predictSideEffectsBtn = document.getElementById("predictSideEffects");
    const sideEffectPanel = document.getElementById("sideEffectPanel");
    const comorbiditySelect = document.getElementById("comorbiditySelect");
    const comorbidityOther = document.querySelector("#predictSideEffects ~ .other-input");

    predictSideEffectsBtn.addEventListener("click", async () => {
      const panel = sideEffectPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Predicting… <span class="spinner"></span></div>`;
      try {
        const age = document.getElementById("patientAge").value.trim();
        let comorbidity = comorbiditySelect.value;
        if (comorbidity === "Other") comorbidity = comorbidityOther.value.trim();
        const meds = document.getElementById("sideEffectDrugs").value.trim();

        if (!age || !meds) {
          showFriendlyError(panel, "⚠️ Please enter patient age and at least one medication.");
          return;
        }
        const sysPrompt = `
You are a clinical pharmacist. Given:
• Patient Age: ${age}  
• Comorbidities: ${comorbidity || "None"}  
• Medications: ${meds}  

Predict:
1) Likely side effects with severity grading.  
2) Recommended monitoring (labs, vitals).  
3) Risk mitigation strategies.  
Format as bullet points or short paragraphs.
        `.trim();

        const aiReply = await callOpenAI([
          { role: "system", content: sysPrompt },
          { role: "user", content: `Age: ${age}\nComorbidities: ${comorbidity}\nMedications: ${meds}` }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(sideEffectPanel, err.message || "Prediction failed.");
      }
    });
    sideEffectPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => sideEffectPanel.hidden = true;
    });

    comorbiditySelect.addEventListener("change", () => {
      if (comorbiditySelect.value === "Other") {
        comorbidityOther.style.display = "block";
        comorbidityOther.required = true;
      } else {
        comorbidityOther.style.display = "none";
        comorbidityOther.required = false;
      }
    });

        const scheduleRefillBtn = document.getElementById("scheduleRefill");
    const refillPanel = document.getElementById("refillPanel");
    const refillSelect = document.getElementById("refillSelect");
    const refillOther = document.getElementById("refillOther");
    const refillListInput = document.getElementById("refillList");

    scheduleRefillBtn.addEventListener("click", async () => {
      const panel = refillPanel;
      panel.hidden = false;
      panel.classList.remove("error");
      panel.innerHTML = `<div class="result-content">Scheduling… <span class="spinner"></span></div>`;
      try {
        const file = refillListInput.files[0];
        let meds = Array.from(refillSelect.selectedOptions).map(o => o.value).filter(v => v);
        if (refillSelect.value === "Other") {
          meds.push(refillOther.value.trim());
        }
        if (!file && meds.length === 0) {
          showFriendlyError(panel, "⚠️ Please upload a list or select medications.");
          return;
        }

        let aiPrompt = `
You are a pharmacy workflow specialist. A user wants to schedule bulk refills. They have:
`;
        if (file) {
          const fileText = await file.text();
          aiPrompt += `• Medication list from file:\n${fileText}\n`;
        }
        if (meds.length > 0) {
          aiPrompt += `• Selected medications: ${meds.join(", ")}\n`;
        }
        aiPrompt += `
Provide:
1) An optimized refill schedule with dates and reminders.  
2) Recommended refill intervals based on typical usage.  
3) Any adherence tips.  
Format as a short report with bullet points.
        `.trim();

        const aiReply = await callOpenAI([
          { role: "system", content: aiPrompt },
          { role: "user", content: "Please schedule refills as described above." }
        ]);

        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        addClose(panel);
        addTools(panel);
      } catch (err) {
        console.error(err);
        showFriendlyError(refillPanel, err.message || "Refill scheduling failed.");
      }
    });
    refillPanel.querySelectorAll(".close-btn").forEach(btn => {
      btn.onclick = () => refillPanel.hidden = true;
    });
    refillSelect.addEventListener("change", () => {
      if (Array.from(refillSelect.selectedOptions).some(opt => opt.value === "Other")) {
        refillOther.style.display = "block";
        refillOther.required = true;
      } else {
        refillOther.style.display = "none";
        refillOther.required = false;
      }
    });

     const pharmaChatBox = document.getElementById("pharmaChatBox");
    const sendPharmaBtn = document.getElementById("sendPharma");
    const pharmaInput = document.getElementById("pharmaInput");
    const clearPharmaBtn = document.getElementById("clearPharmaChat");
    const historyBtn = document.getElementById("historyBtn");
    let pharmaLastDateHeader = null;

    let pharmaHistory = JSON.parse(localStorage.getItem("pharmaHistory") || "[]");
    pharmaHistory = pharmaHistory.map(entry => {
  let dt = new Date(entry.timestamp);
  if (entry.timestamp && !entry.timestamp.includes("T") && dt.getHours() === 0 && dt.getMinutes() === 0) {
    dt.setHours(12, 0, 0, 0);
  }
  return { ...entry, timestamp: dt.toISOString() };
  });
  localStorage.setItem("pharmaHistory", JSON.stringify(pharmaHistory));

    function pharmaFormatDateSeparator(date) {
      const today = new Date();
      const diffDays = Math.floor((today.setHours(0, 0, 0, 0) - date.setHours(0, 0, 0, 0)) / 86400000);
      if (diffDays === 0) return "Today";
      if (diffDays === 1) return "Yesterday";
      return date.toLocaleDateString();
    }
    function pharmaAddMessage(who, text, timestamp = new Date()) {
      const msgDate = timestamp instanceof Date ? timestamp : new Date(timestamp);
      const msgDay = msgDate.toDateString();
      if (msgDay !== pharmaLastDateHeader) {
        const sep = document.createElement("div");
        sep.className = "chat-date-separator";
        sep.textContent = pharmaFormatDateSeparator(msgDate);
        pharmaChatBox.append(sep);
        pharmaLastDateHeader = msgDay;
      }
      const msgDiv = document.createElement("div");
      msgDiv.className = who === "You" ? "user-msg" : "bot-msg";
      msgDiv.innerHTML = `
        ${formatHTML(text)}
        <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true })}</div>
      `;
      pharmaChatBox.append(msgDiv);
      pharmaChatBox.scrollTop = pharmaChatBox.scrollHeight;
    }
    pharmaHistory.forEach(m => pharmaAddMessage(m.who, m.text, new Date(m.timestamp)));

    sendPharmaBtn.addEventListener("click", async (e) => {
      e.preventDefault();
      const userText = pharmaInput.value.trim();
      if (!userText) return;
      const userTime = new Date();
      pharmaAddMessage("You", userText, userTime);
      pharmaHistory.push({ who: "You", text: userText, timestamp: userTime.toISOString() });
      localStorage.setItem("pharmaHistory", JSON.stringify(pharmaHistory));
      pharmaInput.value = "";
      const spinnerDiv = document.createElement("div");
      spinnerDiv.className = "bot-msg";
      spinnerDiv.innerHTML = `<div class="spinner"></div>`;
      pharmaChatBox.append(spinnerDiv);
      pharmaChatBox.scrollTop = pharmaChatBox.scrollHeight;

       const systemPrompt = `
You are a friendly, knowledgeable pharmacist. A user will ask questions about medications—mechanisms, dosing, side effects, interactions, or counseling. Provide concise, evidence-based answers with clear follow-up advice.
      `.trim();

      const allMessages = [{ role: "system", content: systemPrompt }];
      pharmaHistory.forEach(m => {
        allMessages.push({
          role: m.who === "You" ? "user" : "assistant",
          content: m.text
        });
      });
      allMessages.push({ role: "user", content: userText });

      try {
        const aiReply = await callOpenAI(allMessages);
        const msgDate = new Date();
        spinnerDiv.innerHTML = `
          ${formatHTML(aiReply)}
          <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}</div>
        `;
        pharmaHistory.push({ who: "Pharmacist", text: aiReply, timestamp: msgDate.toISOString() });
        localStorage.setItem("pharmaHistory", JSON.stringify(pharmaHistory));
      } catch (err) {
        spinnerDiv.innerHTML = `<div class="result-content">⚠️ Oops! Something went wrong. Please try again.</div>`;
        console.error(err);
      }
      pharmaChatBox.scrollTop = pharmaChatBox.scrollHeight;
    });
     
    clearPharmaBtn.addEventListener("click", () => {
      pharmaChatBox.innerHTML = "";
    pharmaLastDateHeader = null;
     pharmaHistory = [];
     localStorage.removeItem("pharmaHistory");
    });

    historyBtn.addEventListener("click", () => {
      const modal = document.createElement("div");
      modal.className = "history-modal";
      const grouped = {};
      pharmaHistory.forEach((m, i) => {
        const dt = new Date(m.timestamp);
        const label = pharmaFormatDateSeparator(dt);
        if (!grouped[label]) grouped[label] = [];
        grouped[label].push({ who: m.who, text: m.text, idx: i });
      });
      let tableHTML = `<table class="history-table">`;
      Object.keys(grouped).forEach(label => {
        tableHTML += `
          <thead>
            <tr><th colspan="3">${label}</th></tr>
            <tr>
              <th>Sender</th>
              <th>Message</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            ${grouped[label].map(m => `
              <tr data-index="${m.idx}">
                <td>${m.who}</td>
                <td>${formatHTML(m.text)}</td>
                <td><button class="del-msg" data-index="${m.idx}" title="Delete"><i class="fas fa-trash-alt"></i></button></td>
              </tr>
            `).join("")}
          </tbody>`;
      });
      tableHTML += `</table>`;
      modal.innerHTML = `
        <div class="history-content">
          <h3>Chat History</h3>
          <div class="history-table-wrapper">${tableHTML}</div>
          <div class="history-actions">
            <button class="clear-history"><i class="fas fa-trash"></i> Clear History</button>
            <button class="close-history"><i class="fas fa-times"></i> Close</button>
          </div>
        </div>`;
      document.body.append(modal);

      modal.querySelectorAll(".del-msg").forEach(btn => {
        btn.onclick = () => {
          const idx = +btn.dataset.index;
          pharmaHistory.splice(idx, 1);
          localStorage.setItem("pharmaHistory", JSON.stringify(pharmaHistory));
          const row = modal.querySelector(`tr[data-index="${idx}"]`);
          if (row) row.remove();
          modal.querySelectorAll(".history-table tbody tr").forEach((tr, i) => {
            tr.dataset.index = i;
            tr.querySelector(".del-msg").dataset.index = i;
          });
        };
      });
      modal.querySelector(".clear-history").onclick = () => {
        pharmaHistory = [];
        localStorage.removeItem("pharmaHistory");
        modal.remove();
      };
      modal.querySelector(".close-history").onclick = () => modal.remove();
    });

     const staticHistoryModal  = document.getElementById("historyModal");
   const staticCloseBtn      = staticHistoryModal?.querySelector(".close-modal");
   if (staticCloseBtn) {
     staticCloseBtn.addEventListener("click", () => {
       staticHistoryModal.hidden = true;
     });
   }
       function getCSSVar(name) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }
    function initCharts() {
      const colorText = getCSSVar("--pharm-text");
      const colorMuted = getCSSVar("--pharm-muted");
      new Chart("chart1", {
        type: "line",
        data: {
          labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
          datasets: [{
            label: "Prescription Scans",
            data: [50, 75, 100, 125, 150, 175, 200],
            borderColor: getCSSVar("--pharm-primary"),
            backgroundColor: "rgba(10,147,150,0.1)",
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks: { color: colorText }, grid: { display: false } },
            y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true }
          },
          plugins: { legend: { display: false } }
        }
      });
      new Chart("chart2", {
        type: "bar",
        data: {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [{
            label: "Drug Lookups",
            data: [120, 140, 160, 180],
            backgroundColor: [
              "rgba(0,95,115,0.7)",
              "rgba(148,210,189,0.7)",
              "rgba(233,216,166,0.7)",
              "rgba(10,147,150,0.7)"
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks: { color: colorText }, grid: { display: false } },
            y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true }
          },
          plugins: { legend: { display: false } }
        }
      });
    }
    window.addEventListener("load", () => {
      if (typeof Chart !== "undefined" && document.getElementById("chart1")) {
        initCharts();
      }
    });

    const exportChartsDataBtn = document.getElementById("exportChartsData");
    exportChartsDataBtn.addEventListener("click", () => {
      const chartsData = [
        { id: "PrescriptionScans", desc: "Monthly prescription scans", labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul"], values: [50,75,100,125,150,175,200] },
        { id: "DrugLookups", desc: "Weekly drug lookups", labels: ["Week 1","Week 2","Week 3","Week 4"], values: [120,140,160,180] }
      ];
      let csvContent = "Chart,Description,Label,Value\n";
      chartsData.forEach(ch => {
        ch.labels.forEach((lab, idx) => {
          csvContent += `"${ch.id}","${ch.desc}","${lab}",${ch.values[idx]}\n`;
        });
      });
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "usage_statistics.csv";
      document.body.append(a);
      a.click();
      URL.revokeObjectURL(url);
      a.remove();
    });

     const mq = window.matchMedia("(max-width: 768px)");
    function updateHamburgerVisibility() {
      hamburger.style.display = mq.matches ? "block" : "none";
    }
    mq.addListener(updateHamburgerVisibility);
    updateHamburgerVisibility();
  });
</script>

</body>
</html>
