<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Herbal Medicine Hub</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* RESET & THEME */
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Montserrat',sans-serif; }
    :root {
      --accent: #8ECDF1;
      --bg:     #F5F5F5;
      --fg:     #222;
      --muted:  #666;
      --card:   #FFF;
      --radius: 10px;
      --trans:  .3s;
    }
    html,body { height:100%; background:var(--bg); color:var(--fg); transition:background var(--trans),color var(--trans); }
    a { color:inherit; text-decoration:none; }

    /* LAYOUT */
    body { display:flex; }
    aside, main { background:var(--card); border-radius:var(--radius); }
    aside { width:220px; margin:1rem; padding:1rem; flex-shrink:0; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    main { flex:1; margin:1rem; padding:1.5rem; box-shadow:0 2px 8px rgba(0,0,0,0.1); overflow-y:auto; }

    /* SIDEBAR */
    .brand { font-weight:700; font-size:1.3rem; color:var(--accent); display:flex; align-items:center; gap:0.5rem; margin-bottom:2rem; }
    nav a { display:block; padding:0.75rem 1rem; margin-bottom:0.25rem; border-radius:var(--radius); transition:background var(--trans); }
    nav a:hover, nav a.active { background:var(--accent)20; }
    nav i { width:20px; text-align:center; }

    /* HEADER */
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
    header h1 { font-size:1.6rem; font-weight:600; }
    .theme-toggle { cursor:pointer; font-size:1.2rem; }

    /* MODULE STYLES */
    section.module { background:var(--card); border-radius:var(--radius); padding:1.25rem; margin-bottom:1.5rem; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    section.module h2 { display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem; font-size:1.2rem; }
    section.module p.desc { color:var(--muted); margin-bottom:1rem; }
    section.module form { display:flex; flex-wrap:wrap; gap:0.5rem; align-items:flex-end; }
    section.module input, section.module select, section.module textarea {
      flex:1 1 200px; padding:0.6rem; border:1px solid var(--muted); border-radius:var(--radius); transition:border-color var(--trans);
    }
    section.module input::placeholder, section.module textarea::placeholder { color:var(--muted); }
    section.module input:focus, section.module select:focus, section.module textarea:focus {
      border-color:var(--accent); outline:none;
    }
    section.module button {
      background:var(--accent); color:var(--card); padding:0.6rem 1.2rem; border:none; border-radius:var(--radius);
      cursor:pointer; transition:transform var(--trans), box-shadow var(--trans);
    }
    section.module button:hover {
      transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }

    /* PLACEHOLDERS & LOADING */
    .hint { font-size:0.9rem; color:var(--muted); margin-top:0.25rem; }
    .spinner {
      border:4px solid var(--spinner-bg,#f3f3f3);
      border-top:4px solid var(--accent);
      border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite;
      display:inline-block; vertical-align:middle; margin-left:0.5rem;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* CHATBOX */
    #chatBox { height:180px; overflow-y:auto; padding:0.75rem; border:1px solid var(--muted); border-radius:var(--radius); background:#fafafa; }
    #chatBox p { margin-bottom:0.5rem; }
    #chatInput { flex:1; }

    /* CHARTS */
    .charts { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; margin-top:1.5rem; }
    .chart-card { background:var(--card); padding:1rem; border-radius:var(--radius); box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    canvas { max-height:250px !important; }

    /* RESPONSE PANELS */
    .response { background:#f0f8ff; border-left:4px solid var(--accent); padding:1rem; border-radius:var(--radius); margin-top:0.5rem; }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside>
    <div class="brand"><i class="fas fa-leaf"></i>Vitra AI</div>
    <nav>
      <a href="#" class="active"><i class="fas fa-seedling"></i>Herbal Diagnostics</a>
      <a href="#"><i class="fas fa-user-shield"></i>Formulations</a>
      <a href="#"><i class="fas fa-search"></i>Identification</a>
      <a href="#"><i class="fas fa-chart-pie"></i>Efficacy</a>
      <a href="#"><i class="fas fa-graduation-cap"></i>Chatbot</a>
      <a href="#"><i class="fas fa-book-reader"></i>Research</a>
      <a href="#"><i class="fas fa-warehouse"></i>Inventory</a>
      <a href="#"><i class="fas fa-dna"></i>Genetics</a>
      <a href="#"><i class="fas fa-calculator"></i>Dosage</a>
      <a href="#"><i class="fas fa-exchange-alt"></i>Interactions</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main>
    <header>
      <h1>Herbal Medicine Hub</h1>
      <i id="toggleTheme" class="fas fa-moon theme-toggle" title="Toggle Light/Dark"></i>
    </header>

    <!-- 1. Diagnostics -->
    <section class="module">
      <h2><i class="fas fa-stethoscope"></i> AI Diagnostics</h2>
      <p class="desc">Tell us what you’re feeling; our AI will suggest herbs.</p>
      <form id="dx-form">
        <textarea id="dxInput" rows="2" placeholder="e.g. I’ve had tension headaches and insomnia…"></textarea>
        <button type="submit">Analyze</button>
        <div class="hint">Describe symptoms clearly for best results.</div>
      </form>
      <div id="dxResult" class="response" hidden></div>
    </section>

    <!-- 2. Formulations -->
    <section class="module">
      <h2><i class="fas fa-user-shield"></i> Personalized Formulations</h2>
      <p class="desc">Pick herbs, age & weight for a custom blend.</p>
      <form id="pf-form">
        <select id="pfHerbs" multiple size="5">
          <!-- 20+ herbs -->
          <option>Ashwagandha</option><option>Astragalus</option><option>Basil</option><option>Chamomile</option>
          <option>Echinacea</option><option>Ginkgo Biloba</option><option>Ginseng</option><option>Lavender</option>
          <option>Licorice</option><option>Milk Thistle</option><option>Neem</option><option>Oregano</option>
          <option>Peppermint</option><option>Rosemary</option><option>St. John’s Wort</option><option>Turmeric</option>
          <option>Valerian</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Gotu Kola</option><option>Skullcap</option><option>Thyme</option><option>Yarrow</option>
        </select>
        <input id="pfAge" type="number" min="1" max="120" placeholder="Age (years)"/>
        <input id="pfWeight" type="number" min="10" max="300" placeholder="Weight (kg)"/>
        <button type="submit">Generate</button>
        <div class="hint">Hold Ctrl/Cmd to select multiple herbs.</div>
      </form>
      <div id="pfResult" class="response" hidden></div>
    </section>

    <!-- 3. Identification -->
    <section class="module">
      <h2><i class="fas fa-leaf"></i> Herb Identification</h2>
      <p class="desc">Upload a photo; we’ll name your plant.</p>
      <form id="ing-form">
        <input id="ingUpload" type="file" accept="image/*"/>
        <button type="submit">Identify</button>
        <div class="hint">Use a clear, close-up photo of a leaf or flower.</div>
      </form>
      <div id="ingResult" class="response" hidden></div>
    </section>

    <!-- 4. Efficacy Prediction -->
    <section class="module">
      <h2><i class="fas fa-chart-pie"></i> Efficacy Prediction</h2>
      <p class="desc">See how well an herb works for your condition.</p>
      <form id="pred-form">
        <input id="predInput" placeholder="e.g. Turmeric for arthritis"/>
        <button type="submit">Predict</button>
        <div class="hint">Format: “Herb for condition”.</div>
      </form>
      <div id="predResult" class="response" hidden></div>
    </section>

    <!-- 5. Chatbot -->
    <section class="module">
      <h2><i class="fas fa-graduation-cap"></i> Education Chatbot</h2>
      <p class="desc">Ask anything about herbal medicine.</p>
      <div id="chatBox"></div>
      <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
        <input id="chatInput" placeholder="Type your question…"/>
        <button id="sendChat"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div id="chatHint" class="hint" hidden>Our bot is thinking… hang tight!</div>
    </section>

    <!-- 6. Research Summaries -->
    <section class="module">
      <h2><i class="fas fa-book-reader"></i> Research Summaries</h2>
      <p class="desc">Paste study titles or keywords for a summary.</p>
      <form id="research-form">
        <input id="researchQuery" placeholder="e.g. ‘Ashwagandha anxiety RCT’"/>
        <button type="submit">Summarize</button>
        <div class="hint">Be specific: include herb and focus (e.g. stress, sleep)</div>
      </form>
      <div id="researchResults" class="response" hidden></div>
    </section>

    <!-- 7. Inventory Forecast -->
    <section class="module">
      <h2><i class="fas fa-warehouse"></i> Inventory Forecast</h2>
      <p class="desc">Predict your stock needs weeks ahead.</p>
      <form id="inventory-form">
        <select id="forecastHerb">
          <!-- 20+ herbs -->
          <option>Turmeric</option><option>Ginkgo Biloba</option><option>Ashwagandha</option><option>Echinacea</option>
          <option>Valerian</option><option>Chamomile</option><option>Lavender</option><option>Basil</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <input id="forecastPeriod" type="number" min="1" max="52" value="4" placeholder="Weeks ahead"/>
        <button type="submit">Forecast</button>
        <div class="hint">Choose 1–52 weeks into the future.</div>
      </form>
      <div id="inventoryResult" class="response" hidden></div>
    </section>

    <!-- 8. Genetics Match -->
    <section class="module">
      <h2><i class="fas fa-dna"></i> Genetics Match</h2>
      <p class="desc">Upload your genetic report for tailored herbs.</p>
      <form id="genetics-form">
        <input id="geneticUpload" type="file" accept=".csv,.json"/>
        <button type="submit">Analyze</button>
        <div class="hint">CSV or JSON with SNPs is ideal.</div>
      </form>
      <div id="geneticResult" class="response" hidden></div>
    </section>

    <!-- 9. Dosage Calculator -->
    <section class="module">
      <h2><i class="fas fa-calculator"></i> Dosage Calculator</h2>
      <p class="desc">Get daily dosage advice based on weight.</p>
      <form id="dose-form">
        <input id="weight" type="number" min="10" max="300" placeholder="Weight (kg)"/>
        <input id="symptom" placeholder="Symptom (e.g. headache)"/>
        <button type="submit">Calculate</button>
        <div class="hint">Weight 10–300 kg. Describe symptom briefly.</div>
      </form>
      <div id="dosageResult" class="response" hidden></div>
    </section>

    <!-- 10. Interaction Checker -->
    <section class="module">
      <h2><i class="fas fa-exchange-alt"></i> Interaction Checker</h2>
      <p class="desc">Select two herbs to check for interactions.</p>
      <form id="int-form">
        <select id="herbA">
          <!-- 20+ options -->
          <option>Turmeric</option><option>Ashwagandha</option><option>Ginkgo Biloba</option><option>St. John’s Wort</option>
          <option>Echinacea</option><option>Valerian</option><option>Chamomile</option><option>Lavender</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <select id="herbB">
          <!-- same 20+ options -->
          <option>Turmeric</option><option>Ashwagandha</option><option>Ginkgo Biloba</option><option>St. John’s Wort</option>
          <option>Echinacea</option><option>Valerian</option><option>Chamomile</option><option>Lavender</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <button type="submit">Check</button>
        <div class="hint">Pick two distinct herbs.</div>
      </form>
      <div id="interactionResult" class="response" hidden></div>
    </section>

    <!-- CHARTS -->
    <div class="charts">
      <div class="chart-card">
        <h2><i class="fas fa-chart-bar"></i> Top Growing Herbs</h2>
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-card">
        <h2><i class="fas fa-chart-pie"></i> Category Breakdown</h2>
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </main>

 <script>
  const OPENAI_PROXY = '/.netlify/functions/openai-proxy';

  // Show a friendly loading state with spinner
  function setLoading(el) {
    el.innerHTML = 'Brewing your herbal wisdom... <span class="spinner"></span>';
    el.hidden = false;
  }

  // Display the AI's reply
  function showResult(el, text) {
    el.textContent = text;
    el.hidden = false;
  }

  // Generic OpenAI call helper
  async function callOpenAI(messages) {
    const res = await fetch(OPENAI_PROXY, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages })
    });
    if (!res.ok) {
      const errText = await res.text();
      throw new Error(errText || 'Network error');
    }
    const { choices } = await res.json();
    return choices[0].message.content.trim();
  }

  // Wire up a form to OpenAI
  function wireModule(formId, systemPrompt, getUserInput, resultId) {
    const form = document.getElementById(formId);
    const resultEl = document.getElementById(resultId);
    form.addEventListener('submit', async e => {
      e.preventDefault();
      setLoading(resultEl);
      try {
        const reply = await callOpenAI([
          { role: 'system', content: systemPrompt },
          { role: 'user',   content: getUserInput() }
        ]);
        showResult(resultEl, reply);
      } catch (err) {
        showResult(resultEl, '⚠️ Oops, something went wrong.');
        console.error(err);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Theme toggle
    document.getElementById('toggleTheme').onclick = () => {
      document.documentElement.classList.toggle('light');
      document.getElementById('toggleTheme').classList.toggle('fa-sun');
    };

    // Diagnostics
    wireModule(
      'dx-form',
      'You are an expert herbal diagnostic assistant.',
      () => document.getElementById('dxInput').value,
      'dxResult'
    );

    // Personalized Formulations
    wireModule(
      'pf-form',
      'You are an expert at formulating custom herbal mixtures.',
      () => {
        const herbs = Array.from(document.getElementById('pfHerbs').selectedOptions)
                           .map(o => o.value)
                           .join(', ');
        const age = document.getElementById('pfAge').value;
        const weight = document.getElementById('pfWeight').value;
        return `Herbs: ${herbs}; Age: ${age}; Weight: ${weight}kg`;
      },
      'pfResult'
    );

    // Herb Identification
    wireModule(
      'ing-form',
      'You are a plant species identifier.',
      () => document.getElementById('ingUpload').files[0]?.name || '',
      'ingResult'
    );

    // Efficacy Prediction
    wireModule(
      'pred-form',
      'You predict efficacy scores (0–100) for herbs and conditions.',
      () => document.getElementById('predInput').value,
      'predResult'
    );

    // Research Summaries
    wireModule(
      'research-form',
      'You summarize clinical research findings concisely.',
      () => document.getElementById('researchQuery').value,
      'researchResults'
    );

    // Inventory Forecast
    wireModule(
      'inventory-form',
      'You forecast weekly herb demand based on historical and seasonal trends.',
      () => {
        const herb = document.getElementById('forecastHerb').value;
        const weeks = document.getElementById('forecastPeriod').value;
        return `Herb: ${herb}; Weeks ahead: ${weeks}`;
      },
      'inventoryResult'
    );

    // Genetics Match
    wireModule(
      'genetics-form',
      'You interpret genetic reports to recommend suitable herbs.',
      () => document.getElementById('geneticUpload').files[0]?.name || '',
      'geneticResult'
    );

    // Dosage Calculator
    wireModule(
      'dose-form',
      'You calculate daily herbal dosages based on weight and symptom.',
      () => {
        const weight = document.getElementById('weight').value;
        const symptom = document.getElementById('symptom').value;
        return `Weight: ${weight}kg; Symptom: ${symptom}`;
      },
      'dosageResult'
    );

    // Interaction Checker
    wireModule(
      'int-form',
      'You check for interactions between two herbs.',
      () => {
        const a = document.getElementById('herbA').value;
        const b = document.getElementById('herbB').value;
        return `${a} & ${b}`;
      },
      'interactionResult'
    );

    // Chatbot
    const chatBox = document.getElementById('chatBox');
    const chatHint = document.getElementById('chatHint');
    const chatInput = document.getElementById('chatInput');
    const sendChat = document.getElementById('sendChat');
    let history = [{ role: 'system', content: 'You are a friendly herbal medicine tutor.' }];

    sendChat.addEventListener('click', async () => {
      const msg = chatInput.value.trim();
      if (!msg) return;
      chatBox.innerHTML += `<p><strong>You:</strong> ${msg}</p>`;
      chatInput.value = '';
      history.push({ role: 'user', content: msg });
      chatHint.hidden = false;
      try {
        const reply = await callOpenAI(history);
        history.push({ role: 'assistant', content: reply });
        chatBox.innerHTML += `<p><strong>Vitra AI:</strong> ${reply}</p>`;
      } catch {
        chatBox.innerHTML += `<p><strong>Vitra AI:</strong> Sorry, something went wrong.</p>`;
      }
      chatHint.hidden = true;
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    // Charts (ready for real data)
    new Chart(
      document.getElementById('barChart'),
      {
        type: 'bar',
        data: {
          labels: ['Turmeric','Ginkgo','Echinacea','Valerian','Ashwagandha'],
          datasets: [{
            label: 'Usage',
            data: [200,160,140,120,100],
            backgroundColor: '#8ECDF1'
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      }
    );

    new Chart(
      document.getElementById('pieChart'),
      {
        type: 'pie',
        data: {
          labels: ['Roots','Leaves','Flowers','Seeds','Barks'],
          datasets: [{
            data: [30,25,20,15,10],
            backgroundColor: ['#8ECDF1','#A0E0E0','#C0F0F0','#E0FFFF','#F0FFFF']
          }]
        }
      }
    );
  });
</script>

</body>
</html>
