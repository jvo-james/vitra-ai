<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Herbal Medicine Hub</title>
  
<!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  
  <style>
/*────────────────── RESET & BASE ──────────────────*/
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
html {
  font-family: 'Montserrat', sans-serif;
  font-size: 16px;
  scroll-behavior: smooth;
}
body {
  display: flex;
  min-height: 100vh;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

/*────────────────── THEME VARIABLES ──────────────────*/
:root {
  --primary: #2a6f4e;            /* deep green */
  --secondary: #8e6c4b;          /* earthy brown */
  --accent: #d4c5a2;             /* light gold/ivory */
  --bg: #f8f6f0;                 /* ivory */
  --surface: #ffffff;
  --text: #333333;
  --muted: #6b6b6b;
  --bg-dark: #1f1f1f;
  --surface-dark: #2a2a2a;
  --text-dark: #ececec;
  --muted-dark: #888888;
  --radius: 0.75rem;
  --padding: 1rem;
  --transition: 0.3s ease;
  --sidebar-w: 280px;
  --sidebar-collapsed-w: 80px;
  --header-h: 64px;
}
html.dark {
  --bg: var(--bg-dark);
  --surface: var(--surface-dark);
  --text: var(--text-dark);
  --muted: var(--muted-dark);
}

/*────────────────── LAYOUT ──────────────────*/
aside {
  flex: 0 0 var(--sidebar-w);
  position: sticky;
  top: 0;
  height: 100vh;
  background: var(--surface);
  box-shadow: 2px 0 12px rgba(0,0,0,0.05);
  transition: flex var(--transition);
  overflow: hidden;
  z-index: 1000;
}
aside.collapsed {
  flex: 0 0 var(--sidebar-collapsed-w);
}
aside .brand {
  display: flex;
  align-items: center;
  gap: .75rem;
  padding: var(--padding);
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--primary);
}
aside nav {
  margin-top: 2rem;
}
aside nav a {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: .75rem var(--padding);
  border-radius: var(--radius);
  color: var(--text);
  font-weight: 500;
  text-decoration: none;
  transition: background var(--transition), padding-left var(--transition);
}
aside nav a i {
  font-size: 1.2rem;
}
aside nav a:hover,
aside nav a.active {
  background: var(--primary);
  color: #fff;
  padding-left: calc(var(--padding) + 0.5rem);
}
aside.collapsed nav a span {
  display: none;
}
#shrinkBtn {
  position: absolute;
  bottom: var(--padding);
  left: -18px;
  width: 36px;
  height: 36px;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  transition: transform var(--transition);
}
#shrinkBtn:hover {
  transform: scale(1.1);
}

header {
  position: fixed;
  top: 0;
  left: var(--sidebar-w);
  right: 0;
  height: var(--header-h);
  background: var(--surface);
  border-bottom: 1px solid #e1e8ed;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--padding);
  z-index: 999;
  transition: left var(--transition);
}
aside.collapsed ~ header {
  left: var(--sidebar-collapsed-w);
}
header h1 {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text);
}
header .hamburger,
header .theme-toggle {
  font-size: 1.4rem;
  color: var(--primary);
  cursor: pointer;
  transition: transform var(--transition);
}
header .hamburger:hover,
header .theme-toggle:hover {
  transform: scale(1.1);
}

main {
  flex: 1;
  padding: calc(var(--header-h) + var(--padding)) var(--padding) var(--padding);
  background: var(--bg);
}

    /* Force exactly 2 columns, fixed height for each card */
.charts {
  display: grid !important;
  grid-template-columns: repeat(2, 1fr) !important;
  gap: 1rem !important;
}

.chart-card {
  /* total card height including caption */
  height: 250px; 
  display: flex;
  flex-direction: column;
  border: 1px solid var(--muted);
  padding: 0.5rem;
}

.chart-card canvas {
  /* fill the remaining space in the card */
  flex: 1 1 auto !important;
  width: 100% !important;
  height: auto !important;
}

/*────────────────── MODULES ──────────────────*/
.module {
  background: var(--surface);
  border-radius: var(--radius);
  padding: var(--padding);
  box-shadow: 0 2px 8px rgba(0,0,0,0.03);
  margin-bottom: 1.5rem;
  transition: transform var(--transition), box-shadow var(--transition);
}
.module:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.06);
}
.module-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.module h2 {
  display: flex;
  align-items: center;
  gap: .75rem;
  margin-bottom: .75rem;
  font-size: 1.25rem;
  color: var(--primary);
}
.module p.desc {
  font-size: .95rem;
  color: var(--muted);
  margin-bottom: 1rem;
}

/*────────────────── FORMS & BUTTONS ──────────────────*/
form {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: flex-end;
}
input, select, textarea {
  flex: 1 1 200px;
  padding: .75rem;
  border: 1.5px solid #d1dce5;
  background: var(--bg);
  color: var(--text);
  font-size: .95rem;
  border-radius: var(--radius);
  transition: border-color var(--transition), box-shadow var(--transition);
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 8px var(--primary);
}
button {
  background: var(--primary);
  color: #fff;
  padding: .7rem 1.4rem;
  border: none;
  font-size: .95rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: var(--radius);
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  transition: transform var(--transition), box-shadow var(--transition);
}
button:hover:not([disabled]) {
  transform: scale(1.03);
  box-shadow: 0 5px 14px rgba(0,0,0,0.12);
}
button[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
}

.hint {
  width: 100%;
  font-size: .85rem;
  color: var(--muted);
}

/*────────────────── RESPONSES ──────────────────*/
.response {
  background: rgba(142,108,75,0.1);
  border-left: 4px solid var(--secondary);
  padding: var(--padding);
  border-radius: var(--radius);
  margin-top: 1rem;
  position: relative;
}
.response .close-btn {
  background: var(--secondary);
  color: #fff;
  border: none;
  border-radius: 50%;
  font-size: 1.1rem;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.response:hover .close-btn {
  opacity: 1;
  transform: scale(1);
}
.response .close-btn {
  display: block;                /* put on its own line */
  margin: 0 auto 0.5rem;         /* center above content + space */
  width: 2rem; height: 2rem;     /* perfect circle */
  border-radius: 50%;
  position: static;              /* remove absolute overlap */
  font-size:1.2rem;
}
.response .result-content {
  margin-top: 0.5rem;            /* avoid collision */
}
    .tool-row button {
  font-size:0.85rem;
  width:1.6rem; height:1.6rem;
  padding:0.2rem;
 }
/*────────────────── HERO ──────────────────*/
#hero {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 4rem 1rem;
  background: linear-gradient(135deg,#e8f5f1 0%,#f5fafb 100%);
  margin-bottom: 2rem;
  border-radius: var(--radius);
}
#hero h1 {
  font-size: 2.5rem;
  color: var(--primary);
  margin-bottom: 1rem;
}
#hero p {
  font-size: 1.1rem;
  color: var(--text);
  margin-bottom: 1.5rem;
}
#hero .cta {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: center;
}
#hero .cta button {
  min-width: 160px;
}
#hero video {
  margin-top: 2rem;
  max-width: 600px;
  width: 100%;
  border-radius: var(--radius);
}

/*────────────────── SYMPTOM CHECKER ──────────────────*/

#hero-symptom .sym-form {
  display: grid;
  grid-template:
    "labels1 inputs1" auto
    "labels2 inputs2" auto
    "actions actions" auto / 1fr 1fr;
  gap: 0.75rem 1rem;
  gap: 1rem;
}
    #hero-symptom .field:nth-child(1) { grid-area: labels1; }
 #hero-symptom .field:nth-child(2) { grid-area: inputs1; }
 #hero-symptom .range-field       { grid-area: labels2 / inputs2; display:flex; }
 #hero-symptom button.btn-primary { grid-area: actions; justify-self:center; }

#hero-symptom .field {
  margin-bottom: 1rem;
}
#hero-symptom textarea,
#hero-symptom select,
#hero-symptom input[type="number"],
#hero-symptom input[type="range"] {
  max-width: 180px;
  padding: .6rem;
  font-size: .9rem;
}
#hero-symptom button.btn-primary {
  grid-column: span 2;
  justify-self: center;
  background: #2a6f4e !important;
  color: #fff !important;
  padding: .75rem 1.5rem;
}
#hero-symptom .response.sym-response {
  margin-top: 1.5rem;
}

/*────────────────── CULTURAL KNOWLEDGE ──────────────────*/
.culture-input-wrapper {
  display: flex;
  gap: .5rem;
  align-items: flex-end;
}
#hero–cultural .culture-input-wrapper input {
  flex: 1 1 250px;
  padding: .6rem;
  border: 1px solid #d1dce5;
  border-radius: var(--radius);
}
#hero–cultural .btn-culture {
  background: var(--primary);
  color: #fff;
  padding: .7rem 1.2rem;
  border: none;
  border-radius: var(--radius);
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/*────────────────── AI HERBALIST CHAT ──────────────────*/
#hero–chat .chat-controls {
  display: flex;
  justify-content: flex-end;
  gap: .5rem;
  margin-bottom: .5rem;
}
#hero–chat .chat-controls button {
  background: var(--surface);
  border: 1px solid var(--muted);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--secondary);
  transition: background var(--transition), color var(--transition);
}
#hero–chat .chat-controls button:hover {
  background: var(--primary);
  color: #fff;
}
.chat-box {
  background: var(--bg);
  border: 1px solid #d1dce5;
  border-radius: var(--radius);
  padding: var(--padding);
  min-height: 200px;
  max-height: 300px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.user-msg, .bot-msg {
  max-width: 80%;
  margin: .5rem 0;
  padding: .8rem 1rem;
  border-radius: 1.2rem;
  position: relative;
}
.user-msg {
  background: var(--primary);
  color: #fff;
  align-self: flex-end;
  border-bottom-right-radius: .2rem;
}
.bot-msg {
  background: #e8f5f1;
  color: var(--text);
  align-self: flex-start;
  border-bottom-left-radius: .2rem;
}
.timestamp {
  font-size: .7rem;
  position: absolute;
  bottom: -1.2rem;
  right: .8rem;
  color: var(--muted);
}

/*────────────────── PERSONALIZED FORMULATIONS & INVENTORY ──────────────────*/
#formulations select,
#inventory select {
  max-width: 200px;
}
#formulations select option,
#inventory select option {
  padding: .4rem;
}

/*────────────────── INTERACTION CHECKER ──────────────────*/
#interaction select {
  max-width: 180px;
}
#interaction select option {
  padding: .4rem;
}

/*────────────────── ROI CALCULATOR ──────────────────*/
#roi-form .field {
  display: flex;
  flex-direction: column;
  gap: .25rem;
}
#roi-form .field input,
#roi-form .field select {
  max-width: 180px;
  padding: .6rem;
  border: 1px solid #d1dce5;
}
#roi-form button {
  background: var(--secondary);
  color: #fff;
  padding: .7rem 1.3rem;
  border-radius: var(--radius);
  margin-top: .5rem;
}
#roiResult .result-content {
  margin-top: 1rem;
  padding: 1rem;
  background: #fff;
  border-radius: var(--radius);
  box-shadow: 0 1px 6px rgba(0,0,0,0.05);
}
.history-modal {
  display:flex; align-items:flex-start; padding-top:5rem;
 }
/*────────────────── FOOTER ──────────────────*/
footer {
  background: var(--surface);
  padding: var(--padding);
  text-align: center;
  font-size: .85rem;
  color: var(--muted);
  margin-top: 2rem;
  border-top: 1px solid #e1e8ed;
}
footer a {
  color: var(--primary);
  text-decoration: none;
  margin: 0 .5rem;
}

/*────────────────── SPINNER ──────────────────*/
.spinner {
  display: inline-block;
  width: 1em;
  height: 1em;
  border: 2px solid var(--primary);
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin .8s linear infinite;
  vertical-align: middle;
  margin-left: .25em;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/*────────────────── RESPONSIVE ──────────────────*/
@media (max-width: 1024px) {
  aside {
    position: fixed;
    transform: translateX(-100%);
    z-index: 900;
  }
  aside.open {
    transform: translateX(0);
  }
  header {
    left: 0 !important;
  }
}
@media (max-width: 768px) {
  #hero-symptom .sym-form {
    grid-template-columns: 1fr;
  }
}
@media (max-width: 640px) {
  form {
    flex-direction: column;
  }
  input, select, textarea, button {
    width: 100% !important;
  }
  #hero {
    padding: 3rem 1rem;
  }
  #shrinkBtn {
    bottom: .5rem;
  }
  .charts {
    grid-template-columns: 1fr;
  }
  .chart-card canvas {
    height: 180px !important;
  }
}
@media (max-width: 480px) {
  input, select, textarea, button {
    font-size: .9rem;
  }
  #hero h1 {
    font-size: 2rem;
  }
}
    .chart-card canvas {
  max-height: 180px !important;
}
    
.copy-toast {
  position: fixed;
  bottom: 1rem; right: 1rem;
  background: var(--primary);
  color: #fff;
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.history-modal { background: rgba(0,0,0,0.6); }
.history-content { position: relative; padding:1.5rem; }
.history-content h3::before { content:'\f017'; font-family:'FontAwesome'; margin-right:.5rem; }
.history-content .del-msg { background:none; border:none; color:var(--secondary); font-size:1.2rem; }

     .chat-input-row input {
  flex: 1 1 400px;     
  padding: 0.8rem;
  border: 1px solid var(--muted);
  border-radius: var(--radius);
 }

</style>

</head>

<body>

  <!-- ONBOARDING MODAL -->
  <div id="onboardModal" role="dialog" aria-modal="true" aria-labelledby="onboardTitle" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:3000;">
    <div style="background:var(--surface);padding:2rem;border-radius:var(--radius);max-width:400px;text-align:center;">
      <h2 id="onboardTitle" style="color:var(--primary)">Welcome to Vitra AI Herbal Hub</h2>
      <p>Empowering Traditional Healing with Artificial Intelligence.<br/>Explore plant IDs, custom blends, and more.</p>
      <button onclick="onboardClose()">Get Started</button>
    </div>
  </div>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-leaf"></i><span>Vitra AI</span></div>
    <nav role="navigation">
      <a href="#hero" class="active"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="#hero–identifier"><i class="fas fa-camera"></i><span>Herb Identifier</span></a>
      <a href="#hero-symptom"><i class="fas fa-notes-medical"></i><span>Symptom Checker</span></a>
      <a href="#hero–cultural"><i class="fas fa-globe"></i><span>Cultural Knowledge</span></a>
      <a href="#hero–safety"><i class="fas fa-shield-alt"></i><span>Safety Checker</span></a>
      <a href="#hero–chat"><i class="fas fa-comments"></i><span>AI Herbalist Chat</span></a>
      <a href="#formulations"><i class="fas fa-user-shield"></i><span>Personalized Formulations</span></a>
      <a href="#research"><i class="fas fa-book-reader"></i><span>Research Summaries</span></a>
      <a href="#inventory"><i class="fas fa-warehouse"></i><span>Inventory Forecast</span></a>
      <a href="#genetics"><i class="fas fa-dna"></i><span>Genetics Match</span></a>
      <a href="#dosage"><i class="fas fa-calculator"></i><span>Dosage Calculator</span></a>
      <a href="#interaction"><i class="fas fa-exchange-alt"></i><span>Interaction Checker</span></a>
      <a href="#addons"><i class="fas fa-plus-circle"></i><span>Add-Ons</span></a>
      <a href="#analytics"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
      <a href="#roi"><i class="fas fa-dollar-sign"></i><span>ROI Calculator</span></a>
      <a href="#about"><i class="fas fa-cogs"></i><span>About & Tech</span></a>
      <a href="#contact"><i class="fas fa-envelope"></i><span>Contact</span></a>
      <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
    </nav>
  </aside>

  <!-- HEADER -->
  <header>
    <div style="display:flex; align-items:center; gap:1rem;">
      <i id="hamburger" class="fas fa-bars hamburger" aria-label="Toggle navigation"></i>
      <h1>Herbal Medicine Hub</h1>
    </div>
    <div>
      <i id="themeToggle" class="fas fa-moon theme-toggle" aria-label="Toggle theme"></i>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main role="main">
    <!--  Hero -->
    <section id="hero">
      <h1>Empowering Traditional Healing with Artificial Intelligence</h1>
      <p>Discover, personalize, and manage herbal remedies with AI-powered tools—designed for practitioners and enthusiasts alike.</p>
      <div class="cta">
        <button onclick="scrollToSection('hero–identifier')">Try Herb Identifier</button>
        <button onclick="scrollToSection('hero–chat')">Chat with Herbalist</button>
      </div>
      <video src="path/to/intro.mp4" controls aria-label="Intro demonstration video"></video>
    </section>

    <!-- Executive Analytics Dashboard -->
    <section id="analytics" class="module">
      <h2><i class="fas fa-chart-line"></i> Executive Analytics & KPIs</h2>
      <p class="desc">Real‐time metrics to track adoption, efficacy, supply and ROI at a glance.</p>
      <div class="charts">
        <figure class="chart-card"><canvas id="chartAdoption"></canvas><figcaption><strong>Adoption Over Time:</strong> Monthly new users.</figcaption></figure>
        <figure class="chart-card"><canvas id="chartEfficacy"></canvas><figcaption><strong>Efficacy Outcomes:</strong> Positive feedback rates.</figcaption></figure>
        <figure class="chart-card"><canvas id="chartSupply"></canvas><figcaption><strong>Supply Impact:</strong> Inventory usage.</figcaption></figure>
        <figure class="chart-card"><canvas id="chartROI"></canvas><figcaption><strong>Financial ROI:</strong> Quarterly returns.</figcaption></figure>
      </div>
      <button onclick="exportAnalytics()">Export Full CSV</button>
    </section>

    <!-- 1. Herb Identifier -->
    <section id="hero–identifier" class="module">
      <h2><i class="fas fa-camera"></i> AI Plant Scanner</h2>
      <p class="desc">Upload a photo; our AI will identify the plant (e.g. <em>Moringa oleifera</em> placeholder).</p>
      <form id="iden-form">
        <textarea id="idenDesc" rows="2" placeholder="Or describe your plant here…"></textarea>
        <input type="file" accept="image/*" aria-label="Upload plant image" onchange="previewImage(this)"/>
        <button type="submit">Identify</button>
        <div class="hint">Use a clear close-up of a leaf or flower.</div>
      </form>
      <img id="idenPreview" alt="" style="max-width:200px;margin-top:1rem;display:none;"/>
      <div id="idenResult" class="response" role="status" aria-live="polite" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 2. Symptom Checker -->
    <section id="hero-symptom" class="module">
      <h2><i class="fas fa-notes-medical"></i> Symptom Checker</h2>
      <p class="desc">Tell us your symptoms and duration, choose severity, then get AI‐powered herb recommendations.</p>
      <form id="sym-form" class="sym-form">
        <div class="field">
          <label for="symInput">Your Symptoms</label>
          <textarea id="symInput" required placeholder="e.g. headache, nausea…"></textarea>
        </div>
        <div class="field">
          <label for="symCategories">Category</label>
          <select id="symCategories" multiple size="4" required>
            <option disabled selected>Select category…</option>
            <option value="pain">Pain</option>
            <option value="digestive">Digestive</option>
            <option value="respiratory">Respiratory</option>
            <option value="stress">Stress</option>
  <option value="sleep">Sleep</option>
  <option value="energy">Energy</option>
  <option value="immune">Immune</option>
  <option value="skin">Skin</option>
  <option value="mental">Mental</option>
  <option value="cardio">Cardio</option>
  <option value="respiratory">Respiratory</option>
  <option value="digestive">Digestive</option>
          </select>
        </div>
        <div class="field range-field">
          <label for="severity">Severity</label>
          <input type="range" id="severity" min="1" max="10" value="5"/>
          <span id="sevValue">5</span>/10
        </div>
        <div class="field">
          <label for="symDuration">Duration (days)</label>
          <input type="number" id="symDuration" min="0" placeholder="e.g. 3"/>
        </div>
        <button type="submit" class="btn-primary">Get Recommendations</button>
      </form>
      <div id="symResult" class="response sym-response" hidden>
        <button class="close-btn">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 3. Cultural Knowledge -->
    <section id="hero–cultural" class="module">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
        <h2>🌍 Cultural Knowledge</h2>
      </div>
      <p class="desc">Enter a region, tradition or herb name to get practices, rituals & folklore.</p>
      <div class="culture-input-wrapper" style="display:flex; gap:0.5rem; align-items:flex-end; margin-bottom:1rem;">
        <input id="cultureQuery" type="text" placeholder="e.g. West African herbal uses…" />
        <button onclick="getCulture()" class="btn-culture">Get Insights</button>
      </div>
      <div id="cultureResult" class="response" hidden>
        <button class="close-btn">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 4. Safety Checker -->
    <section id="hero–safety" class="module">
      <h2><i class="fas fa-shield-alt"></i> Safety Checker</h2>
      <p class="desc">Enter two items (herbs or medications) to check for dangerous interactions.</p>
      <form id="safety-form">
        <input id="safetyA" placeholder="Item A (e.g. Turmeric)" aria-label="Item A" required/>
        <input id="safetyB" placeholder="Item B (e.g. Warfarin)" aria-label="Item B" required/>
        <button type="submit">Check</button>
        <div class="hint">Pick two distinct items.</div>
      </form>
      <div id="safetyResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 5. AI Herbalist Chat -->
    <section id="hero–chat" class="module">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2><i class="fas fa-comments"></i> AI Herbalist Chat</h2>
        <div class="chat-controls">
          <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
          <button id="clearChat" title="Clear Chat"><i class="fas fa-eraser"></i></button>
        </div>
      </div>
      <p class="desc">Ask about herbal remedies:</p>
      <div id="chatBox" class="chat-box" role="log" aria-live="polite"></div>
      <div class="chat-input-row">
        <input id="chatInput" placeholder="Ask about herbal remedies…" aria-label="Type your question"/>
        <button id="sendChat" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div id="chatHint" class="hint" hidden>Bot is thinking… <span class="spinner"></span></div>
    </section>

    <!-- 6. Personalized Formulations -->
    <section id="formulations" class="module">
      <h2><i class="fas fa-user-shield"></i> Personalized Formulations</h2>
      <p class="desc">Pick one herb, age & weight for a custom blend.</p>
      <form id="pf-form">
        <select id="pfHerbs" aria-label="Select herb" required>
          <option disabled selected>Select herb…</option>
          <option>Ashwagandha</option>
          <option>Astragalus</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
          <!-- 7 Ghanaian local herbs -->
          <option>Roselle</option>
          <option>Soursop</option>
          <option>Baobab</option>
          <option>Moringa</option>
          <option>Ginger</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
        </select>
        <input id="pfAge" type="number" min="1" max="120" placeholder="Age (years)" required/>
        <input id="pfWeight" type="number" min="10" max="300" placeholder="Weight (kg)" required/>
        <button type="submit">Generate</button>
        <div class="hint">Use dropdown to pick a single herb.</div>
      </form>
      <div id="pfResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <p class="hint"><em>Formulation meets dosage safety limits.</em></p>
      </div>
    </section>

    <!-- 7. Research Summaries -->
    <section id="research" class="module">
      <h2><i class="fas fa-book-reader"></i> Research Summaries</h2>
      <p class="desc">Paste study titles or keywords for a concise summary.</p>
      <form id="research-form">
        <input id="researchQuery" placeholder="e.g. ‘Ashwagandha anxiety RCT’" aria-label="Research query" required/>
        <button type="submit">Summarize</button>
        <div class="hint">Include herb and focus area.</div>
      </form>
      <div id="researchResults" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <a href="#" target="_blank">Read Original Study</a>
      </div>
    </section>

    <!-- 8. Inventory Forecast -->
    <section id="inventory" class="module">
      <h2><i class="fas fa-warehouse"></i> Inventory Forecast</h2>
      <p class="desc">Predict stock needs weeks ahead.</p>
      <form id="inventory-form">
        <select id="forecastHerb" aria-label="Select herb for forecast" required>
          <option disabled selected>Select herb…</option>
          <!-- same options as PF -->
          <option>Ashwagandha</option>
          <option>Astragalus</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
          <option>Roselle</option>
          <option>Soursop</option>
          <option>Baobab</option>
          <option>Moringa</option>
          <option>Ginger</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
        </select>
        <input id="forecastPeriod" type="number" min="1" max="52" value="4" placeholder="Weeks ahead" required/>
        <button type="submit">Forecast</button>
        <div class="hint">Choose 1–52 weeks into the future.</div>
      </form>
      <div id="inventoryResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 9. Genetics Match -->
    <section id="genetics" class="module">
      <h2><i class="fas fa-dna"></i> Genetics Match</h2>
      <p class="desc">Upload your genetic report for tailored herb recommendations.</p>
      <form id="genetics-form">
        <input id="geneticUpload" type="file" accept=".csv,.json" aria-label="Upload genetic report"/>
        <button type="submit">Analyze</button>
        <div class="hint">CSV or JSON with SNP data is ideal.</div>
      </form>
      <div id="geneticResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <p class="hint"><em>Tier 1: evidence-based, Tier 2: emerging science.</em></p>
      </div>
    </section>

    <!-- 10. Dosage Calculator -->
    <section id="dosage" class="module">
      <h2><i class="fas fa-calculator"></i> Dosage Calculator</h2>
      <p class="desc">Get daily dosage advice based on weight, symptom, and extract form.</p>
      <form id="dose-form">
        <input id="weight" type="number" min="10" max="300" placeholder="Weight (kg)" required/>
        <input id="symptom" placeholder="Symptom (e.g. headache)" required/>
        <select id="formType" aria-label="Select extract type">
          <option value="powder">Powder</option>
          <option value="tincture">Tincture</option>
          <option value="capsule">Capsule</option>
        </select>
        <button type="submit">Calculate</button>
        <div class="hint">Specify extract form for accuracy.</div>
      </form>
      <div id="dosageResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 11. Interaction Checker -->
    <section id="interaction" class="module">
      <h2><i class="fas fa-exchange-alt"></i> Interaction Checker</h2>
      <p class="desc">Select two herbs to check for interactions.</p>
      <form id="int-form">
        <select id="herbA" aria-label="Herb A" required>
          <option disabled selected>Herb A…</option>
          <option>Ashwagandha</option>
          <option>Baobab</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginger</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Moringa</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
        </select>
        <select id="herbB" aria-label="Herb B" required>
          <option disabled selected>Herb B…</option>
          <option>Ashwagandha</option>
          <option>Baobab</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginger</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Moringa</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
        </select>
        <button type="submit">Check</button>
        <div class="hint">Pick two distinct herbs.</div>
      </form>
      <div id="interactionResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- ADD-ONS -->
    <section id="addons" class="module">
      <h2><i class="fas fa-plus-circle"></i> Additional Features</h2>
      <ul>
        <li><strong>User Login/Signup</strong> to save herb history & personalized plans.</li>
        <li><strong>Weekly AI-Generated Blog</strong> on herbal insights.</li>
        <li><strong>Voice Assistant</strong> for elderly users (click-to-talk).</li>
      </ul>
    </section>

    <!-- 12. ROI Calculator -->
    <section id="roi" class="module">
      <h2><i class="fas fa-dollar-sign"></i> Business Insights & ROI Calculator</h2>
      <p class="desc">
        Estimate your practice’s return on investment from AI-driven herbal prescription automation.
        Select your currency, enter your monthly prescription volume and herb costs, then calculate ROI.
      </p>
      <form id="roi-form">
        <div class="field">
          <label for="currency">Currency</label>
          <select id="currency">
            <option value="GHS" selected>Ghanaian Cedi (GHS)</option>
            <option value="USD">US Dollar (USD)</option>
            <option value="EUR">Euro (EUR)</option>
          </select>
        </div>
        <div class="field">
          <label for="roiRx">Monthly Prescriptions</label>
          <input type="number" id="roiRx" required placeholder="e.g. 100"/>
        </div>
        <div class="field">
          <label for="roiCost">Avg. Herb Cost (<span id="curSym">₵</span>)</label>
          <input type="number" id="roiCost" required placeholder="e.g. 25"/>
        </div>
        <button type="submit">Calculate ROI</button>
      </form>
      <div id="roiResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- ARCHITECTURE & TECH -->
    <section id="about" class="module">
      <h2><i class="fas fa-cogs"></i> Architecture & Data Flow</h2>
      <p class="desc">High-level overview of our AI platform components.</p>
      <img src="flow.jpg" alt="System Architecture Diagram" style="width:100%;border-radius:var(--radius);margin-bottom:1rem;"/>
      <ol>
        <li>Client (Browser/Mobile)</li>
        <li>API Gateway</li>
        <li>AI Microservices (Diagnostics, ID, Chat)</li>
        <li>Data Lake (Herb DB, Clinical Studies, Genetics)</li>
        <li>Analytics Engine</li>
        <li>Admin Dashboard</li>
      </ol>
      <p><a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms of Use</a></p>
    </section>

    <!-- CONTACT & DISCLAIMER -->
    <section id="contact" class="module">
      <h2><i class="fas fa-envelope"></i> Contact & Compliance</h2>
      <p class="desc">For partnerships, audits, or support.</p>
      <form id="contact-form">
        <input type="email" placeholder="Your email" required aria-label="Email"/>
        <textarea placeholder="Message" rows="3" required aria-label="Message"></textarea>
        <button type="submit">Send</button>
      </form>
      <p class="hint" style="margin-top:1rem;">
        <strong>Disclaimer:</strong> For informational purposes only; consult a professional.<br/>
        Genetic data is handled per our <a href="#privacy">Privacy Policy</a>.
      </p>
    </section>

    <!-- FOOTER -->
    <footer>
      <p>&copy; 2025 Vitra AI. <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms & Conditions</a></p>
    </footer>

  </main>




 
  

  <!-- JAVASCRIPT LOGIC -->
<script>
  // define this before the modal’s markup
  function onboardClose() {
    document.getElementById('onboardModal').style.display = 'none';
  }

</script>
<script>
  //──────────────────────────────────────────────────────────────────────────────
  // ONBOARDING MODAL
  //──────────────────────────────────────────────────────────────────────────────
  function onboardClose() {
    document.getElementById('onboardModal').style.display = 'none';
  }

  //──────────────────────────────────────────────────────────────────────────────
  // UTILITY FUNCTIONS
  //──────────────────────────────────────────────────────────────────────────────

  // Call OpenAI proxy
  async function callOpenAI(messages) {
    const res = await fetch('/.netlify/functions/openai-proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages })
    });
    if (!res.ok) throw new Error('Server error');
    const j = await res.json();
    return j.choices[0].message.content;
  }

  // Call Vision API proxy
  async function callVision(file) {
    const fd = new FormData();
    fd.append('file', file);
    const res = await fetch('/.netlify/functions/vision-proxy', {
      method: 'POST',
      body: fd
    });
    if (!res.ok) throw new Error('Vision error');
    return res.json();
  }

  // Simple markdown → HTML formatter
  function formatHTML(txt) {
    return txt
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .replace(/\[([^\]]+)\]/g,'<code>$1</code>')
      .split(/\n{2,}/).map(p=>`<p>${p.trim()}</p>`).join('');
  }

  // Show a friendly error message in a panel
  function showFriendlyError(panel) {
    panel.innerHTML = '<div class="result-content">😕 Oops! Something went wrong. Please try again.</div>';
    addClose(panel);
  }

  // Add close-“×” button to a response panel
  function addClose(panel) {
    if (panel.querySelector('.close-btn')) return;
    const btn = document.createElement('button');
    btn.className = 'close-btn';
    btn.textContent = '×';
    btn.onclick = () => panel.hidden = true;
    panel.prepend(btn);
  }

  // Add copy/download tools under the result-content
  function addTools(panel) {
    if (panel.querySelector('.tool-row')) return;
    const tools = document.createElement('div');
    tools.className = 'tool-row';
    tools.innerHTML = `
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"   title="Download"><i class="fas fa-download"></i></button>`;
    panel.append(tools);

    tools.querySelector('.copy-btn').onclick = () => {
   navigator.clipboard.writeText(panel.querySelector('.result-content').innerText);
  const toast = document.createElement('div');
  toast.textContent = 'Copied!';
  toast.className = 'copy-toast';
  document.body.append(toast);
  setTimeout(()=>toast.remove(), 1500);
 };

    tools.querySelector('.dl-btn').onclick = () => {
      const text = panel.querySelector('.result-content').innerText;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'response.txt'; a.click();
      URL.revokeObjectURL(url);
    };
  }

  //──────────────────────────────────────────────────────────────────────────────
  // CHARTS
  //──────────────────────────────────────────────────────────────────────────────

  function initCharts() {
    const cfg = (type, data) => ({
      type, data,
      options: { responsive: true, maintainAspectRatio: false, aspectRatio: 1.8, plugins: { legend: { display: false } } }
    });
    new Chart('chartAdoption', cfg('line', { labels:['Jan','Feb','Mar'], datasets:[{data:[50,75,100]}] }));
    new Chart('chartEfficacy',  cfg('bar',  { labels:['Mild','Mod','High'],   datasets:[{data:[30,45,25]}] }));
    new Chart('chartSupply',    cfg('pie',  { labels:['A','B','C'],         datasets:[{data:[200,150,300]}] }));
    new Chart('chartROI',       cfg('radar',{ labels:['Q1','Q2','Q3','Q4'],datasets:[{data:[5,7,6,8]}] }));
  }

  function exportAnalytics() {
    const ids = ['Adoption','Efficacy','Supply','ROI'];
    let csv = '';
    ids.forEach(id => {
      const ch = Chart.getChart('chart' + id);
      ch.data.labels.forEach((lab,i) => {
        csv += `${id},${lab},${ch.data.datasets[0].data[i]}\n`;
      });
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'analytics.csv'; a.click();
    URL.revokeObjectURL(url);
  }

  //──────────────────────────────────────────────────────────────────────────────
  // GENERIC FORM HANDLER
  //──────────────────────────────────────────────────────────────────────────────
  function wireForm(formId, sysPrompt, extract, outId) {
    document.getElementById(formId).onsubmit = async e => {
      e.preventDefault();
      const panel = document.getElementById(outId);
      panel.hidden = false;
      panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
      try {
        const reply = await callOpenAI([
          { role: 'system', content: sysPrompt },
          { role: 'user',   content: extract() }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
        addClose(panel); addTools(panel);
      } catch (err) {
        showFriendlyError(panel);
      }
    };
  }

  //──────────────────────────────────────────────────────────────────────────────
  // SYMPTOM CHECKER
  //──────────────────────────────────────────────────────────────────────────────
  document.getElementById('severity').oninput = e => {
    document.getElementById('sevValue').textContent = e.target.value;
  };

  document.getElementById('sym-form').onsubmit = async e => {
    e.preventDefault();
    const panel = document.getElementById('symResult');
    panel.hidden = false;
    panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
    const text = document.getElementById('symInput').value.trim();
    const cat  = document.getElementById('symCategories').value;
    const sev  = document.getElementById('severity').value;
    const dur  = document.getElementById('symDuration').value || 0;
    try {
      const txt = await callOpenAI([
        { role: 'system', content: 'You are a herbal diagnostician. Answer with a plain-text list.' },
        { role: 'user',   content: `Symptoms: ${text}; Category: ${cat}; Severity: ${sev}; Duration: ${dur}d.` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(txt)}</div>`;
      addClose(panel); addTools(panel);
    } catch (err) {
      showFriendlyError(panel);
    }
  };

  //──────────────────────────────────────────────────────────────────────────────
  // INDIVIDUAL FORM WIRINGS
  //──────────────────────────────────────────────────────────────────────────────

  // Plant Identifier
  document.getElementById('iden-form').onsubmit = async e => {
    e.preventDefault();
    const panel = document.getElementById('idenResult');
    panel.hidden = false;
    panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
    const file = e.target.querySelector('input[type=file]').files[0];
    const desc = document.getElementById('idenDesc').value.trim();
    if (!file && !desc) {
      panel.innerHTML = '<div class="result-content">⚠️ Please upload an image or description.</div>';
      addClose(panel);
      return;
    }
    try {
      let html = '';
      if (file) {
        const data = await callVision(file);
        html += `<strong>Name:</strong> ${data.name}<br/>
                 <strong>Uses:</strong> ${data.uses}<br/>
                 <strong>Cautions:</strong> ${data.cautions}<br/>
                 <strong>Regions:</strong> ${data.regions.join(', ')}<hr/>`;
      }
      if (desc) {
        const txt = await callOpenAI([
          { role: 'system', content: 'You are a plant expert. Reply plainly.' },
          { role: 'user',   content: `Describe plant: ${desc}` }
        ]);
        html += formatHTML(txt);
      }
      panel.innerHTML = `<div class="result-content">${html}</div>`;
      addClose(panel); addTools(panel);
    } catch (err) {
      showFriendlyError(panel);
    }
  };

  // Cultural Knowledge
  wireForm(
    'cultureQuery',
    'You are a cultural herbalist. Respond concisely.',
    () => document.getElementById('cultureQuery').value.trim(),
    'cultureResult'
  );

  // Safety Checker
  wireForm(
    'safety-form',
    'You warn of dangerous herb/med combos.',
    () => `${document.getElementById('safetyA').value}&${document.getElementById('safetyB').value}`,
    'safetyResult'
  );

  // Personalized Formulations
  wireForm(
    'pf-form',
    'You create safe herbal formulations.',
    () => `Herbs: ${document.getElementById('pfHerbs').value}; Age: ${document.getElementById('pfAge').value}; Weight: ${document.getElementById('pfWeight').value}kg`,
    'pfResult'
  );

  // Research Summaries
  wireForm(
    'research-form',
    'You summarize clinical research with citations.',
    () => document.getElementById('researchQuery').value.trim(),
    'researchResults'
  );

  // Inventory Forecast
  wireForm(
    'inventory-form',
    'You forecast weekly herb demand with buffer stock.',
    () => `Herb: ${document.getElementById('forecastHerb').value}; Weeks: ${document.getElementById('forecastPeriod').value}`,
    'inventoryResult'
  );

  // Genetics Match
  document.getElementById('genetics-form').onsubmit = async e => {
    e.preventDefault();
    const panel = document.getElementById('geneticResult');
    panel.hidden = false;
    panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
    const file = document.getElementById('geneticUpload').files[0];
    if (!file) {
      panel.innerHTML = '<div class="result-content">⚠️ Please upload CSV/JSON.</div>';
      addClose(panel);
      return;
    }
    try {
      const text = await file.text();
      const reply = await callOpenAI([
        { role: 'system', content: 'You interpret genetic SNP data for herb recommendations.' },
        { role: 'user',   content: text }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      addClose(panel); addTools(panel);
    } catch (err) {
      showFriendlyError(panel);
    }
  };

  // Dosage Calculator
  wireForm(
    'dose-form',
    'You calculate daily herbal dosages by weight, symptom, form.',
    () => `Weight: ${document.getElementById('weight').value}kg; Symptom: ${document.getElementById('symptom').value}; Form: ${document.getElementById('formType').value}`,
    'dosageResult'
  );

  // Interaction Checker
  wireForm(
    'int-form',
    'You check interactions between two herbs.',
    () => {
      const a = document.getElementById('herbA').value;
      const b = document.getElementById('herbB').value;
      if (a === b) throw new Error('Pick two distinct herbs.');
      return `${a}&${b}`;
    },
    'interactionResult'
  );

  // ROI Calculator
  document.getElementById('currency').onchange = e => {
    const sym = { GHS:'₵', USD:'$', EUR:'€' }[e.target.value];
    document.getElementById('curSym').textContent = sym;
  };

  document.getElementById('roi-form').onsubmit = async e => {
    e.preventDefault();
    const panel = document.getElementById('roiResult');
    panel.hidden = false;
    panel.innerHTML = '<div class="result-content">Calculating… <span class="spinner"></span></div>';
    const rx   = +document.getElementById('roiRx').value;
    const cost = +document.getElementById('roiCost').value;
    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You are a finance expert. Show equations and explain ROI step by step in plain HTML.' },
        { role: 'user',   content: `Volume: ${rx}; Unit cost: ${cost}; Currency: ${document.getElementById('currency').value}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      addClose(panel); addTools(panel);
    } catch (err) {
      showFriendlyError(panel);
    }
  };

  //──────────────────────────────────────────────────────────────────────────────
  // INIT & EVENT LISTENERS
  //──────────────────────────────────────────────────────────────────────────────
  document.addEventListener('DOMContentLoaded', () => {
    // Charts & export
    initCharts();
    document.querySelector('button[onclick="exportAnalytics()"]').onclick = exportAnalytics;

    // Sidebar shrink
    const sidebar     = document.getElementById('sidebar');
    const shrinkBtn   = document.getElementById('shrinkBtn');
    shrinkBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      shrinkBtn.querySelector('i').classList.toggle('fa-angle-double-right');
    });

    // Hamburger (mobile nav)
    const hamburger   = document.getElementById('hamburger');
    hamburger.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      themeToggle.classList.toggle('fa-sun');
      themeToggle.classList.toggle('fa-moon');
    });

    // AI Herbalist Chat enhancements
    const chatBox   = document.getElementById('chatBox');
    const history   = [];
    const sendChat  = document.getElementById('sendChat');
    const chatHint  = document.getElementById('chatHint');
    const chatInput = document.getElementById('chatInput');

    function addMessage(who, text) {
      const msg = document.createElement('div');
      msg.className = who === 'You' ? 'user-msg' : 'bot-msg';
      msg.innerHTML = `${formatHTML(text)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
      chatBox.append(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    sendChat.onclick = async () => {
      const txt = chatInput.value.trim();
      if (!txt) return;
      addMessage('You', txt);
      history.push({ who: 'You', text: txt });
      chatInput.value = '';
      chatHint.hidden = false;
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a friendly herbalist. Reply plainly.' },
          { role: 'user',   content: txt }
        ]);
        addMessage('Herbalist', reply);
        history.push({ who: 'Herbalist', text: reply });
      } catch (err) {
        addMessage('Herbalist', '⚠️ Oops! Something went wrong. Please try again.');
      } finally {
        chatHint.hidden = true;
      }
    };

    // Clear chat (does NOT erase history)
    document.getElementById('clearChat').onclick = () => {
      chatBox.innerHTML = '';
    };

    // View history modal
    document.getElementById('viewHistory').onclick = () => {
      const modal = document.createElement('div');
      modal.className = 'history-modal';
      modal.innerHTML = `
        <div class="history-content">
          <h3>Chat History</h3>
          <ul>
            ${history.map((m,i) => `
              <li>
                <strong>${m.who}:</strong> ${m.text}
                <button data-i="${i}" class="del-msg"><i class="fas fa-trash"></i></button>
              </li>`).join('')}
          </ul>
          <button class="close-history">Close</button>
        </div>`;
      document.body.append(modal);
      modal.querySelectorAll('.del-msg').forEach(btn => {
        btn.onclick = () => {
          history.splice(+btn.dataset.i,1);
          modal.remove();
          document.getElementById('viewHistory').click();
        };
      });
      modal.querySelector('.close-history').onclick = () => modal.remove();
    };
  });
</script>

</body>
</html>
