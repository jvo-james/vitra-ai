<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Herbal Medicine Hub</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /*──────────────── RESET & THEME ─────────────────*/
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Montserrat',sans-serif; }
    :root {
      --accent:    #8ECDF1;
      --bg-light:  #F5F5F5; --fg-light:  #222; --card-light: #FFF; --muted-light: #666;
      --bg-dark:   #121212; --fg-dark:  #E0E0E0; --card-dark:  #1E1E1E; --muted-dark:  #888;
      --radius:    10px; --trans: .3s;
      --sidebar-w: 240px;
    }
    html.light { --bg: var(--bg-light);  --fg: var(--fg-light);  --card: var(--card-light);  --muted: var(--muted-light); }
    html.dark  { --bg: var(--bg-dark);   --fg: var(--fg-dark);   --card: var(--card-dark);   --muted: var(--muted-dark);  }

    body {
      display:flex; height:100vh; background:var(--bg); color:var(--fg);
      transition: background var(--trans), color var(--trans);
      overflow:hidden;
    }
    a { color:inherit; text-decoration:none; }

    /*──────────────── SIDEBAR & NAV ─────────────────*/
    aside {
      position:relative; width:var(--sidebar-w);
      background:var(--card); box-shadow:2px 0 8px rgba(0,0,0,0.1);
      transition: transform var(--trans);
      z-index:1000;
    }
    aside.closed { transform: translateX(-100%); }
    nav[role="navigation"] { margin-top:2rem; }
    nav a {
      display:flex; align-items:center; gap:1rem; padding:0.75rem 1.25rem;
      font-weight:500; border-radius:var(--radius);
      transition:background var(--trans);
      font-size:0.95rem;
    }
    nav a:hover, nav a.active { background:rgba(142,205,241,0.2); }
    nav i { width:1rem; text-align:center; font-size:1rem; }

    /*──────────────── HEADER ─────────────────*/
    header {
      position:sticky; top:0; left:0; right:0;
      display:flex; justify-content:space-between; align-items:center;
      padding:1rem 1.5rem; background:var(--card);
      box-shadow:0 1px 4px rgba(0,0,0,0.1); z-index:500;
    }
    .hamburger, .theme-toggle {
      font-size:1.3rem; cursor:pointer; padding:0.25rem;
    }
    .hamburger { display:none; } /* shown on mobile */

    /*──────────────── MAIN CONTENT ─────────────────*/
    main[role="main"] {
      flex:1; overflow-y:auto; padding:1.5rem; display:flex; flex-direction:column;
    }
    .module {
      background:var(--card); border-radius:var(--radius);
      padding:1.5rem; margin-bottom:1.5rem;
      box-shadow:0 1px 4px rgba(0,0,0,0.1);
    }
    .module h2 {
      display:flex; align-items:center; gap:0.75rem; margin-bottom:0.75rem;
      font-size:1.2rem; font-weight:600;
    }
    .module p.desc { color:var(--muted); margin-bottom:1rem; }
    .module form { display:flex; flex-wrap:wrap; gap:0.75rem; align-items:flex-end; }
    .module input, .module select, .module textarea {
      flex:1 1 200px; padding:0.6rem;
      border:1px solid var(--muted); border-radius:var(--radius);
      transition:border-color var(--trans);
      background:var(--bg); color:var(--fg);
    }
    .module input:focus, .module select:focus, .module textarea:focus {
      outline:none; border-color:var(--accent);
    }
    .module button {
      background:var(--accent); color:var(--bg); border:none;
      padding:0.6rem 1.2rem; border-radius:var(--radius);
      cursor:pointer; transition:transform var(--trans), box-shadow var(--trans);
    }
    .module button:hover {
      transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .hint { font-size:0.85rem; color:var(--muted); }

    /*──────────────── RESPONSE PANEL ─────────────────*/
    .response {
      position:relative;
      background:rgba(142,205,241,0.1);
      border-left:4px solid var(--accent);
      padding:1rem; margin-top:0.75rem; border-radius:var(--radius);
    }
    .response .close-btn {
      position:absolute; top:0.5rem; right:0.5rem;
      background:transparent; border:none; font-size:1rem; cursor:pointer; color:var(--muted);
    }

    /*──────────────── LOADING SPINNER ─────────────────*/
    .spinner {
      width:20px; height:20px; border:3px solid var(--muted);
      border-top:3px solid var(--accent); border-radius:50%;
      animation:spin 1s linear infinite; display:inline-block; vertical-align:middle; margin-left:0.5rem;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    /*──────────────── CHAT ─────────────────*/
    #chatBox {
      height:180px; overflow-y:auto; padding:0.75rem;
      background:var(--bg); border:1px solid var(--muted);
      border-radius:var(--radius); margin-bottom:0.5rem;
    }

    /*──────────────── CHARTS ─────────────────*/
    .charts { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; margin-top:1rem; }
    .chart-card { padding:1rem; border-radius:var(--radius); background:var(--card); box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    canvas { max-height:220px !important; }

    /*──────────────── RESPONSIVE ─────────────────*/
    @media (max-width: 900px) {
      aside { position:fixed; top:0; left:0; bottom:0; }
      .hamburger { display:block; }
      nav a { font-size:1rem; }
      main { padding-top:4.5rem; }
    }
  </style>
</head>

<body>
  <!-- SIDEBAR / NAVIGATION -->
  <aside id="sidebar" class="closed">
    <div class="brand" aria-label="Vitra AI Home">
      <i class="fas fa-leaf"></i><span>Vitra AI</span>
    </div>
    <nav role="navigation" aria-label="Main menu">
      <a href="#" class="active"><i class="fas fa-seedling"></i>Herbal Medicine</a>
      <a href="#"><i class="fas fa-brain"></i>Psychology &amp; Mental Health</a>
      <a href="#"><i class="fas fa-utensils"></i>Dietetics</a>
      <a href="#"><i class="fas fa-pills"></i>E-Pharmacy</a>
      <a href="#"><i class="fas fa-calendar-check"></i>Consultation Booking</a>
      <hr/>
      <a href="#"><i class="fas fa-user"></i>Profile</a>
      <a href="#"><i class="fas fa-cog"></i>Settings</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main role="main">
    <header>
      <div>
        <i id="hamburger" class="fas fa-bars hamburger" aria-label="Toggle navigation"></i>
        <h1 style="display:inline; margin-left:0.5rem;">Herbal Medicine</h1>
      </div>
      <i id="themeToggle" class="fas fa-moon theme-toggle" aria-label="Toggle dark mode"></i>
    </header>

    <!-- Example Module: Diagnostics -->
    <section class="module" id="module-dx">
      <h2><i class="fas fa-stethoscope"></i> AI Diagnostics</h2>
      <p class="desc">Describe your symptoms; our AI will recommend herbs.</p>
      <form id="dx-form">
        <textarea id="dxInput" rows="2" placeholder="e.g. Persistent headaches & fatigue…" required></textarea>
        <button type="submit">Analyze</button>
        <div class="hint">Be specific: mention duration & intensity.</div>
      </form>
      <div id="dxResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    

    <!-- 2. Formulations -->
    <section class="module">
      <h2><i class="fas fa-user-shield"></i> Personalized Formulations</h2>
      <p class="desc">Pick herbs, age & weight for a custom blend.</p>
      <form id="pf-form">
        <select id="pfHerbs" multiple size="5">
          <!-- 20+ herbs -->
          <option>Ashwagandha</option><option>Astragalus</option><option>Basil</option><option>Chamomile</option>
          <option>Echinacea</option><option>Ginkgo Biloba</option><option>Ginseng</option><option>Lavender</option>
          <option>Licorice</option><option>Milk Thistle</option><option>Neem</option><option>Oregano</option>
          <option>Peppermint</option><option>Rosemary</option><option>St. John’s Wort</option><option>Turmeric</option>
          <option>Valerian</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Gotu Kola</option><option>Skullcap</option><option>Thyme</option><option>Yarrow</option>
        </select>
        <input id="pfAge" type="number" min="1" max="120" placeholder="Age (years)"/>
        <input id="pfWeight" type="number" min="10" max="300" placeholder="Weight (kg)"/>
        <button type="submit">Generate</button>
        <div class="hint">Hold Ctrl/Cmd to select multiple herbs.</div>
      </form>
      <div id="pfResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 3. Identification -->
    <section class="module">
      <h2><i class="fas fa-leaf"></i> Herb Identification</h2>
      <p class="desc">Upload a photo; we’ll name your plant.</p>
      <form id="ing-form">
        <input id="ingUpload" type="file" accept="image/*"/>
        <button type="submit">Identify</button>
        <div class="hint">Use a clear, close-up photo of a leaf or flower.</div>
      </form>
      <div id="ingResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 4. Efficacy Prediction -->
    <section class="module">
      <h2><i class="fas fa-chart-pie"></i> Efficacy Prediction</h2>
      <p class="desc">See how well an herb works for your condition.</p>
      <form id="pred-form">
        <input id="predInput" placeholder="e.g. Turmeric for arthritis"/>
        <button type="submit">Predict</button>
        <div class="hint">Format: “Herb for condition”.</div>
      </form>
      <div id="predResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 5. Chatbot -->
    <section class="module">
      <h2><i class="fas fa-graduation-cap"></i> Education Chatbot</h2>
      <p class="desc">Ask anything about herbal medicine.</p>
      <div id="chatBox"></div>
      <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
        <input id="chatInput" placeholder="Type your question…"/>
        <button id="sendChat"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div id="chatHint" class="hint" hidden>Our bot is thinking… hang tight!</div>
    </section>

    <!-- 6. Research Summaries -->
    <section class="module">
      <h2><i class="fas fa-book-reader"></i> Research Summaries</h2>
      <p class="desc">Paste study titles or keywords for a summary.</p>
      <form id="research-form">
        <input id="researchQuery" placeholder="e.g. ‘Ashwagandha anxiety RCT’"/>
        <button type="submit">Summarize</button>
        <div class="hint">Be specific: include herb and focus (e.g. stress, sleep)</div>
      </form>
      <div id="researchResults" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 7. Inventory Forecast -->
    <section class="module">
      <h2><i class="fas fa-warehouse"></i> Inventory Forecast</h2>
      <p class="desc">Predict your stock needs weeks ahead.</p>
      <form id="inventory-form">
        <select id="forecastHerb">
          <!-- 20+ herbs -->
          <option>Turmeric</option><option>Ginkgo Biloba</option><option>Ashwagandha</option><option>Echinacea</option>
          <option>Valerian</option><option>Chamomile</option><option>Lavender</option><option>Basil</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <input id="forecastPeriod" type="number" min="1" max="52" value="4" placeholder="Weeks ahead"/>
        <button type="submit">Forecast</button>
        <div class="hint">Choose 1–52 weeks into the future.</div>
      </form>
      <div id="inventoryResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 8. Genetics Match -->
    <section class="module">
      <h2><i class="fas fa-dna"></i> Genetics Match</h2>
      <p class="desc">Upload your genetic report for tailored herbs.</p>
      <form id="genetics-form">
        <input id="geneticUpload" type="file" accept=".csv,.json"/>
        <button type="submit">Analyze</button>
        <div class="hint">CSV or JSON with SNPs is ideal.</div>
      </form>
      <div id="geneticResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 9. Dosage Calculator -->
    <section class="module">
      <h2><i class="fas fa-calculator"></i> Dosage Calculator</h2>
      <p class="desc">Get daily dosage advice based on weight.</p>
      <form id="dose-form">
        <input id="weight" type="number" min="10" max="300" placeholder="Weight (kg)"/>
        <input id="symptom" placeholder="Symptom (e.g. headache)"/>
        <button type="submit">Calculate</button>
        <div class="hint">Weight 10–300 kg. Describe symptom briefly.</div>
      </form>
      <div id="dosageResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 10. Interaction Checker -->
    <section class="module">
      <h2><i class="fas fa-exchange-alt"></i> Interaction Checker</h2>
      <p class="desc">Select two herbs to check for interactions.</p>
      <form id="int-form">
        <select id="herbA">
          <!-- 20+ options -->
          <option>Turmeric</option><option>Ashwagandha</option><option>Ginkgo Biloba</option><option>St. John’s Wort</option>
          <option>Echinacea</option><option>Valerian</option><option>Chamomile</option><option>Lavender</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <select id="herbB">
          <!-- same 20+ options -->
          <option>Turmeric</option><option>Ashwagandha</option><option>Ginkgo Biloba</option><option>St. John’s Wort</option>
          <option>Echinacea</option><option>Valerian</option><option>Chamomile</option><option>Lavender</option>
          <option>Milk Thistle</option><option>Neem</option><option>Rosemary</option><option>Oregano</option>
          <option>Peppermint</option><option>Holy Basil</option><option>Green Tea</option><option>Aloe Vera</option>
          <option>Skullcap</option><option>Yarrow</option><option>Gotu Kola</option><option>Licorice</option>
        </select>
        <button type="submit">Check</button>
        <div class="hint">Pick two distinct herbs.</div>
      </form>
      <div id="interactionResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- CHARTS -->
   <!-- Charts Area -->
    <div class="charts">
      <div class="chart-card">
        <h2><i class="fas fa-chart-bar"></i> Top Growing Herbs</h2>
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-card">
        <h2><i class="fas fa-chart-pie"></i> Category Breakdown</h2>
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </main>

 <script>
  // ──────── ELEMENT REFERENCES & UTILITIES ────────
  const sidebar   = document.getElementById('sidebar');
  const hamburger = document.getElementById('hamburger');
  const themeBtn  = document.getElementById('themeToggle');

  function toggleSidebar() {
    sidebar.classList.toggle('closed');
  }

  function toggleTheme() {
    document.documentElement.classList.toggle('dark');
    document.documentElement.classList.toggle('light');
    themeBtn.classList.toggle('fa-sun');
  }

  // Attach “close” handlers to any response panels
  function attachCloseButtons() {
    document.querySelectorAll('.response .close-btn').forEach(btn => {
      btn.onclick = () => btn.parentElement.hidden = true;
    });
  }

  // Render a loading spinner & message inside a panel
  function setLoading(panel) {
    panel.querySelector('.result-content').innerHTML =
      'Brewing your herbal wisdom… <span class="spinner"></span>';
    panel.hidden = false;
  }

  // Show the AI’s reply inside a panel
  function showResult(panel, text) {
    panel.querySelector('.result-content').textContent = text;
    panel.hidden = false;
  }

  // Call your OpenAI proxy function
  async function callOpenAI(messages) {
    const res = await fetch('/.netlify/functions/openai-proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages })
    });
    if (!res.ok) {
      const errorText = await res.text();
      throw new Error(errorText || 'Network error');
    }
    const { choices } = await res.json();
    return choices[0].message.content.trim();
  }

  // Wire a form to OpenAI + result panel
  function wireModule({ formId, systemPrompt, getUserInput, resultPanelId }) {
    const form  = document.getElementById(formId);
    const panel = document.getElementById(resultPanelId);
    form.addEventListener('submit', async e => {
      e.preventDefault();
      setLoading(panel);
      try {
        const userContent = getUserInput();
        const reply = await callOpenAI([
          { role: 'system',  content: systemPrompt },
          { role: 'user',    content: userContent }
        ]);
        showResult(panel, reply);
      } catch (err) {
        showResult(panel, '⚠️ ' + err.message);
        console.error(err);
      }
    });
    // allow closing
    panel.querySelector('.close-btn').onclick = () => panel.hidden = true;
  }

  // ──────── INITIALIZATION ────────
  document.addEventListener('DOMContentLoaded', () => {
    // Sidebar & theme toggles
    hamburger.onclick = toggleSidebar;
    themeBtn.onclick  = toggleTheme;

    // Close buttons
    attachCloseButtons();

    // 1. AI Diagnostics
    wireModule({
      formId:        'dx-form',
      systemPrompt:  'You are a top-tier herbal diagnostic AI.',
      getUserInput:  () => document.getElementById('dxInput').value,
      resultPanelId: 'dxResult'
    });

    // 2. Personalized Formulations
    wireModule({
      formId:       'pf-form',
      systemPrompt: 'You are an expert at formulating personalized herbal blends.',
      getUserInput: () => {
        const herbs  = Array.from(document.getElementById('pfHerbs').selectedOptions)
                             .map(o => o.value)
                             .join(', ');
        const age    = document.getElementById('pfAge').value;
        const weight = document.getElementById('pfWeight').value;
        return `Herbs: ${herbs}; Age: ${age}; Weight: ${weight}kg`;
      },
      resultPanelId:'pfResult'
    });

    // 3. Herb Identification
    wireModule({
      formId:       'ing-form',
      systemPrompt: 'You are an accurate plant species identifier.',
      getUserInput: () => {
        const file = document.getElementById('ingUpload').files[0];
        // TODO: send actual file bytes via FormData in future
        return file ? file.name : '';
      },
      resultPanelId:'ingResult'
    });

    // 4. Efficacy Prediction
    wireModule({
      formId:       'pred-form',
      systemPrompt: 'You predict efficacy scores (0–100) for herbs against conditions.',
      getUserInput: () => document.getElementById('predInput').value,
      resultPanelId:'predResult'
    });

    // 5. Education Chatbot
    (function() {
      const chatBox  = document.getElementById('chatBox');
      const chatHint = document.getElementById('chatHint');
      const chatInput= document.getElementById('chatInput');
      const sendBtn  = document.getElementById('sendChat');
      let history = [{ role:'system', content:'You are a friendly herbal medicine tutor.' }];

      sendBtn.onclick = async () => {
        const msg = chatInput.value.trim();
        if (!msg) return;
        chatBox.innerHTML += `<p><strong>You:</strong> ${msg}</p>`;
        chatInput.value = '';
        history.push({ role:'user', content: msg });
        chatHint.hidden = false;

        try {
          const reply = await callOpenAI(history);
          history.push({ role:'assistant', content: reply });
          chatBox.innerHTML += `<p><strong>Vitra AI:</strong> ${reply}</p>`;
        } catch {
          chatBox.innerHTML += `<p><strong>Vitra AI:</strong> Sorry, something went wrong.</p>`;
        }
        chatHint.hidden = true;
        chatBox.scrollTop = chatBox.scrollHeight;
      };
    })();

    // 6. Research Summaries
    wireModule({
      formId:       'research-form',
      systemPrompt: 'You summarize clinical research findings concisely.',
      getUserInput: () => document.getElementById('researchQuery').value,
      resultPanelId:'researchResults'
    });

    // 7. Inventory Forecast
    wireModule({
      formId:       'inventory-form',
      systemPrompt: 'You forecast weekly herb demand based on trends.',
      getUserInput: () => {
        const herb  = document.getElementById('forecastHerb').value;
        const weeks = document.getElementById('forecastPeriod').value;
        return `Herb: ${herb}; Weeks ahead: ${weeks}`;
      },
      resultPanelId:'inventoryResult'
    });

    // 8. Genetics Match
    wireModule({
      formId:       'genetics-form',
      systemPrompt: 'You interpret genetic reports to recommend suitable herbs.',
      getUserInput: () => {
        const file = document.getElementById('geneticUpload').files[0];
        return file ? file.name : '';
      },
      resultPanelId:'geneticResult'
    });

    // 9. Dosage Calculator
    wireModule({
      formId:       'dose-form',
      systemPrompt: 'You calculate daily herbal dosages based on weight and symptom.',
      getUserInput: () => {
        const w = document.getElementById('weight').value;
        const s = document.getElementById('symptom').value;
        return `Weight: ${w}kg; Symptom: ${s}`;
      },
      resultPanelId:'dosageResult'
    });

    // 10. Interaction Checker
    wireModule({
      formId:       'int-form',
      systemPrompt: 'You check for interactions between two herbs.',
      getUserInput: () => {
        const a = document.getElementById('herbA').value;
        const b = document.getElementById('herbB').value;
        return `${a} & ${b}`;
      },
      resultPanelId:'interactionResult'
    });

    // ──────── CHARTS ────────
    new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: ['Turmeric','Ginkgo','Echinacea','Valerian','Ashwagandha'],
        datasets: [{
          data: [200,160,140,120,100],
          backgroundColor: 'rgba(142,205,241,0.8)'
        }]
      },
      options: {
        plugins: { legend: { display:false } },
        scales: { y: { beginAtZero:true } }
      }
    });

    new Chart(document.getElementById('pieChart'), {
      type: 'pie',
      data: {
        labels: ['Roots','Leaves','Flowers','Seeds','Barks'],
        datasets: [{
          data: [30,25,20,15,10],
          backgroundColor: ['#8ECDF1','#A0E0E0','#C0F0F0','#E0FFFF','#F0FFFF']
        }]
      }
    });
  });
</script>

</body>
</html>
