<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>E-Pharmacy AI Portal</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
 <script defer src="https://js.paystack.co/v1/inline.js"></script>
<style>
  /* ─────────────────────────────────────────────────────────────────────────────
     Global Variables & Theme Settings
     ───────────────────────────────────────────────────────────────────────────── */
  :root {
    --cb-primary: #3b3f88;
    --cb-primary-alt: #5c4d99;
    --cb-accent: #f08a5d;
    --cb-bg: #f7f6f9;
    --cb-surface: #ffffff;
    --cb-text: #2d2d2d;
    --cb-muted: #999999;
    --radius: 0.75rem;
    --padding: 1rem;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: 0.3s ease;
    --sidebar-width: 220px;
    --sidebar-collapsed-width: 60px;
  }

  html.dark {
    --cb-bg: #1a1b2e;
    --cb-surface: #2d2d44;
    --cb-text: #e0e0e0;
    --cb-muted: #aaaaaa;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Global Reset & Base Styles
     ───────────────────────────────────────────────────────────────────────────── */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    transition: var(--transition);
  }

  body {
    font-family: "Montserrat", sans-serif;
    background: var(--cb-bg);
    color: var(--cb-text);
    line-height: 1.5;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  img {
    max-width: 100%;
    display: block;
  }

  ul,
  ol {
    list-style: none;
  }

  button {
    font-family: inherit;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Layout: Sidebar
     ───────────────────────────────────────────────────────────────────────────── */
  aside#sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: var(--sidebar-width);
    background: var(--cb-surface);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    overflow: hidden;
  }

  aside#sidebar .brand {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: var(--padding);
    background: var(--cb-primary);
    color: #fff;
    font-size: 1.25rem;
  }

  aside#sidebar .brand i {
    font-size: 1.5rem;
  }

  aside#sidebar nav {
    flex: 1;
    overflow-y: auto;
  }

  aside#sidebar nav ul {
    margin-top: 1rem;
  }

  aside#sidebar nav li {
    margin-bottom: 0.25rem;
  }

  aside#sidebar nav li a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem var(--padding);
    border-radius: var(--radius);
    color: var(--cb-text);
    font-weight: 500;
  }

  aside#sidebar nav li.active a,
  aside#sidebar nav li a:hover {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  aside#sidebar nav li a i {
    font-size: 1.25rem;
  }

  #shrinkSidebar {
    background: none;
    border: none;
    font-size: 1.25rem;
    color: var(--cb-primary);
    cursor: pointer;
    margin: var(--padding);
    align-self: flex-end;
  }

  /* Sidebar: Collapsed State */
  body.sidebar-shrink aside#sidebar {
    width: var(--sidebar-collapsed-width);
  }

  body.sidebar-shrink aside#sidebar .brand span,
  body.sidebar-shrink aside#sidebar nav li a span {
    display: none;
  }

  body.sidebar-shrink aside#sidebar nav li a,
  body.sidebar-shrink aside#sidebar .brand {
    justify-content: center;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Layout: Header
     ───────────────────────────────────────────────────────────────────────────── */
  header {
    position: sticky;
    top: 0;
    margin-left: var(--sidebar-width);
    background: var(--cb-surface);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--padding);
    height: 60px;
    box-shadow: var(--shadow);
    z-index: 1001;
  }

  body.sidebar-shrink header {
    margin-left: var(--sidebar-collapsed-width);
  }

  header h1 {
    font-size: 1.25rem;
    color: var(--cb-primary);
  }

  #hamburger,
  #themeToggle {
    font-size: 1.5rem;
    color: var(--cb-primary);
    cursor: pointer;
  }

  #hamburger:hover,
  #themeToggle:hover {
    color: var(--cb-accent);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Main Content & Sections
     ───────────────────────────────────────────────────────────────────────────── */
  main,
  section,
  footer {
    margin-left: calc(var(--sidebar-width) - 1rem);
    padding: var(--padding);
    transition: margin-left var(--transition);
  }

  body.sidebar-shrink main,
  body.sidebar-shrink section,
  body.sidebar-shrink footer {
    margin-left: calc(var(--sidebar-collapsed-width) - 1rem);
  }

  footer {
    text-align: center;
    padding: var(--padding) 0;
    font-size: 0.875rem;
    color: var(--cb-muted);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Module Base (Panels, Cards, Sections)
     ───────────────────────────────────────────────────────────────────────────── */
  section.module {
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow);
  }

  section.module h2 {
    font-size: 1.5rem;
    color: var(--cb-primary);
    margin-bottom: 0.5rem;
  }

  section.module .desc {
    color: var(--cb-primary-alt);
    margin-bottom: 1rem;
    font-size: 1rem;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Hero Section
     ───────────────────────────────────────────────────────────────────────────── */
  #hero {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
    padding: 2rem var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    align-items: center;
  }

  #hero .hero-text h2 {
    font-size: 2.25rem;
    margin-bottom: 0.5rem;
  }

  #hero .hero-text .desc {
    font-size: 1rem;
    opacity: 0.9;
  }

  #hero .hero-text h2,
  #hero .hero-text .desc {
    color: #ffffff;
  }

  #hero .hero-graphic {
    text-align: center;
  }

  #hero .hero-graphic img {
    max-width: 90%;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  #hero .btn.hero-btn {
    margin-top: var(--padding);
    background: #ffffff;
    color: var(--cb-primary-alt);
    border: none;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: var(--shadow);
    transition: transform 0.2s ease;
  }

  #hero .btn.hero-btn:hover {
    transform: translateY(-2px);
    background: #f0f0f0;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Quick Actions Section
     ───────────────────────────────────────────────────────────────────────────── */
  #quickActions {
    background: var(--cb-primary);
    color: #fff;
  }

  #quickActions .quick-actions {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  #quickActions .quick-actions .btn {
    flex: 1 1 auto;
    min-width: 160px;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    padding: 0.75rem 1rem;
    border-radius: var(--radius);
    font-size: 1rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #quickActions .quick-actions .btn:hover {
    background: #d4724f;
    transform: translateY(-2px);
  }

  #quickActions .view-tabs {
    display: flex;
    gap: 0.5rem;
  }

  #quickActions .view-tabs .btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: 0.9rem;
  }

  #quickActions .view-tabs .btn-sm.active,
  #quickActions .view-tabs .btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #quickActions .tips {
    flex: 1 1 100%;
    text-align: right;
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9rem;
  }

  #quickActions .tips a {
    text-decoration: underline;
    color: var(--cb-accent);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  #quickActions .tips a:hover {
    color: #ffffff;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Forms & Inputs (Global)
     ───────────────────────────────────────────────────────────────────────────── */
  form label {
    display: block;
    margin-bottom: 1rem;
    font-weight: 600;
    font-size: 1rem;
  }

  input,
  select,
  textarea,
  button.btn-sm {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--cb-primary-alt);
    border-radius: var(--radius);
    background: var(--cb-bg);
    color: var(--cb-text);
    font-size: 1rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: var(--cb-accent);
    box-shadow: 0 0 0 3px rgba(240, 138, 93, 0.3);
    outline: none;
  }

  button.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    cursor: pointer;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-size: 1rem;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  button.btn:hover {
    background: #d4724f;
    transform: translateY(-2px);
  }

  button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  button.btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Match Panel (Provider Matching & Urgent Flow)
     ───────────────────────────────────────────────────────────────────────────── */
  #matchResults,
  #urgentMatchResults {
    position: relative;
    padding: 1.5rem;
    background: var(--cb-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-top: 1rem;
  }

  #matchResults .close-btn,
  #urgentMatchResults .close-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #matchResults .close-btn:hover,
  #urgentMatchResults .close-btn:hover {
    background: #d4724f;
    transform: scale(1.1);
  }

  #matchResults .card,
  #urgentMatchResults .card {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  #matchResults .card .details h4,
  #urgentMatchResults .card .details h4 {
    margin-bottom: 0.25rem;
    font-size: 1.1rem;
    color: var(--cb-primary);
  }

  #matchResults .card .details p,
  #urgentMatchResults .card .details p {
    color: var(--cb-text);
    font-size: 0.95rem;
  }

  #matchResults .btn-sm.back,
  #urgentMatchResults .btn-sm.back {
    position: absolute;
    bottom: var(--padding);
    left: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
  }

  /* Urgent Flow: Scheduling Buttons */
  #urgentScheduleBtn {
    background: var(--cb-accent);
    color: #fff;
    margin-right: 0.5rem;
  }

  #urgentScheduleBtn:hover {
    background: #d4724f;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Calendar & Time Slots (Provider Scheduling)
     ───────────────────────────────────────────────────────────────────────────── */
  .month-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .month-nav button {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .month-nav button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #calendar,
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--cb-bg);
    border-radius: var(--radius);
    overflow: hidden;
  }

  /* Weekday Headers */
  #calendar .cell:first-child,
  .calendar-grid .cell:first-child {
    font-weight: 600;
    background: var(--cb-surface);
    text-align: center;
    padding: 0.5rem 0;
  }

  /* Day Cells */
  #calendar .cell,
  .calendar-grid .cell {
    background: var(--cb-surface);
    padding: 0.75rem 0.25rem;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
    font-size: 0.95rem;
  }

  #calendar .cell.closed,
  .calendar-grid .cell.closed {
    background: #f0f0f0;
    color: var(--cb-muted);
    cursor: not-allowed;
  }

  #calendar .cell.open,
  .calendar-grid .cell.open {
    background: var(--cb-accent);
    color: #fff;
    font-weight: bold;
  }

  #calendar .cell.open:hover,
  .calendar-grid .cell.open:hover {
    transform: scale(1.05);
    z-index: 1;
  }

  #calendar .cell.today,
  .calendar-grid .cell.today {
    border: 2px dashed var(--cb-primary);
  }

  /* Time Slots */
  #timeSlots {
    margin-top: 1rem;
  }

  #timeSlots h4 {
    font-size: 1.1rem;
    color: var(--cb-primary-alt);
    margin-bottom: 0.5rem;
  }

  #timeSlots ul {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0;
    list-style: none;
  }

  #timeSlots ul li button {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: 0.9rem;
  }

  #timeSlots ul li button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Final Booking Form (Confirm)
     ───────────────────────────────────────────────────────────────────────────── */
  #confirmForm {
    margin-top: 1rem;
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: var(--shadow);
  }

  #confirmForm .btn-sm.back {
    position: absolute;
    top: var(--padding);
    left: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
  }

  #confirmForm .btn-sm.close-btn {
    position: absolute;
    top: var(--padding);
    right: var(--padding);
    background: var(--cb-accent);
    color: #fff;
  }

  #confirmForm h4 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
    color: var(--cb-primary);
  }

  #confirmForm label {
    margin-bottom: 1rem;
    font-weight: 600;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Rich Dashboard (Cards & Tabs)
     ───────────────────────────────────────────────────────────────────────────── */
  #feature-rich-dashboard .dashboard-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  #feature-rich-dashboard .dashboard-tabs button {
    flex: 1;
    padding: 0.75rem;
    border: none;
    border-radius: var(--radius);
    background: var(--cb-primary-alt);
    color: #fff;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #feature-rich-dashboard .dashboard-tabs button.active,
  #feature-rich-dashboard .dashboard-tabs button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #feature-rich-dashboard .dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--padding);
  }

  #feature-rich-dashboard .card {
    background: var(--cb-surface);
    padding: var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
  }

  #feature-rich-dashboard .card i {
    font-size: 1.75rem;
    color: var(--cb-primary-alt);
  }

  #feature-rich-dashboard .card .details h4 {
    margin-bottom: 0.25rem;
    font-size: 1.1rem;
    color: var(--cb-primary);
  }

  #feature-rich-dashboard .card .details p {
    color: var(--cb-text);
    font-size: 0.9rem;
  }

  #feature-rich-dashboard .card .actions {
    margin-left: auto;
    display: flex;
    gap: 0.5rem;
  }

  #feature-rich-dashboard .card .actions button,
  #feature-rich-dashboard .card .actions a {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    padding: 0.5rem;
    border-radius: var(--radius);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #feature-rich-dashboard .card .actions button:hover,
  #feature-rich-dashboard .card .actions a:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Upcoming Calendar Widget
     ───────────────────────────────────────────────────────────────────────────── */
  #upcomingCalendarWidget {
    margin-top: 1rem;
  }

  #upcomingCalendarWidget h4 {
    margin-bottom: 0.5rem;
    font-size: 1.25rem;
    color: var(--cb-primary);
    text-align: center;
  }

  #upcomingCalendarWidget .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--cb-bg);
    border-radius: var(--radius);
    overflow: hidden;
  }

  #upcomingCalendarWidget .calendar-grid .cell {
    background: var(--cb-surface);
    padding: 0.75rem 0.25rem;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
    font-size: 0.95rem;
  }

  #upcomingCalendarWidget .calendar-grid .cell.closed {
    background: #f0f0f0;
    color: var(--cb-muted);
    cursor: not-allowed;
  }

  #upcomingCalendarWidget .calendar-grid .cell.open {
    background: var(--cb-accent);
    color: #fff;
    font-weight: bold;
  }

  #upcomingCalendarWidget .calendar-grid .cell.open:hover {
    transform: scale(1.05);
    z-index: 1;
  }

  #upcomingCalendarWidget .calendar-grid .cell.today {
    border: 2px dashed var(--cb-primary);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Modals (Review & Cancel)
     ───────────────────────────────────────────────────────────────────────────── */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }

  .modal[hidden] {
    display: none !important;
  }

  .modal .modal-content {
    background: var(--cb-surface);
    padding: 1.5rem;
    border-radius: var(--radius);
    max-width: 400px;
    width: 90%;
    box-shadow: var(--shadow);
    position: relative;
  }

  .modal .modal-content h3 {
    margin-top: 0;
    color: var(--cb-primary);
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  .modal .modal-content p {
    margin-bottom: 1rem;
    color: var(--cb-text);
    font-size: 1rem;
  }

  .modal .modal-content button {
    margin-right: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 0.9rem;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .modal .modal-content button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  .modal .modal-content button.btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  .modal .modal-content button.btn {
    background: var(--cb-accent);
    color: #fff;
  }

  .modal .modal-content button.btn:hover {
    background: #d4724f;
    transform: translateY(-1px);
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Toast Notifications
     ───────────────────────────────────────────────────────────────────────────── */
  .toast {
    position: fixed;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    background: var(--cb-primary-alt);
    color: #fff;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 2000;
  }

  .toast.visible {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Responsive Adjustments
     ───────────────────────────────────────────────────────────────────────────── */
  @media (max-width: 1024px) {
    section.module {
      padding: 0.75rem;
    }
  }

  @media (max-width: 768px) {
    aside#sidebar {
      transform: translateX(-100%);
      position: absolute;
    }
    body.sidebar-open aside#sidebar {
      transform: translateX(0);
    }
    header {
      margin-left: 0;
    }
    main,
    section,
    footer {
      margin-left: 0;
      padding: 0.5rem;
    }
    #hero {
      grid-template-columns: 1fr;
      padding: 1.5rem var(--padding);
    }
    #hero .hero-graphic img {
      max-width: 100%;
    }
    #feature-rich-dashboard .dashboard-cards {
      grid-template-columns: 1fr;
    }
  }

  /* ─────────────────────────────────────────────────────────────────────────────
     Dark Mode Overrides (Optional)
     ───────────────────────────────────────────────────────────────────────────── */
  html.dark body {
    background: var(--cb-bg);
    color: var(--cb-text);
  }

  html.dark aside#sidebar {
    background: var(--cb-surface);
  }

  html.dark header {
    background: var(--cb-surface);
    box-shadow: var(--shadow);
  }

  html.dark section.module {
    background: var(--cb-surface);
    box-shadow: var(--shadow);
  }

  html.dark #hero {
    background: var(--cb-primary-alt);
  }

  html.dark #hero .hero-text h2,
  html.dark #hero .hero-text .desc {
    color: #ffffff;
  }

  html.dark #hero .btn.hero-btn {
    background: #ffffff;
    color: var(--cb-primary-alt);
  }

  html.dark input,
  html.dark select,
  html.dark textarea {
    background: var(--cb-bg);
    color: var(--cb-text);
    border-color: var(--cb-primary-alt);
  }

  html.dark button.btn,
  html.dark button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  html.dark button.btn:hover,
  html.dark button.btn-sm:hover {
    background: var(--cb-accent);
  }

  html.dark #calendar .cell.closed {
    background: #3b3f88;
    color: #aaa;
  }

  html.dark #calendar .cell.open {
    background: #f08a5d;
    color: #111;
  }
</style>
</head>

<body>
  <!-- Sidebar -->
  <aside id="sidebar">
    <div class="brand">
      <i class="fas fa-calendar-check"></i>
      <span>Vitra AI Consult</span>
    </div>
    <nav>
      <ul>
        <li class="active">
          <a href="#providerMatch"><i class="fas fa-user-md"></i><span>Provider Match</span></a>
        </li>
        <li>
          <a href="#feature-rich-dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        </li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar"><i class="fas fa-chevron-left"></i></button>
  </aside>

  <!-- Header -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>AI-Powered Consultation Booking</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <main>
    <!-- Hero -->
    <section id="hero" class="module">
      <div class="hero-text">
        <h2><i class="fas fa-stethoscope"></i> Seamless Consultation Booking</h2>
        <p class="desc">From instant provider match to one-click appointment, powered by AI.</p>
        <button class="btn hero-btn"><i class="fas fa-book-medical"></i> Book an Appointment</button>
      </div>
      <div class="hero-graphic">
        <img src="9E2CDE35-303A-4C5F-A4A9-1B0420CF8B0C.png" alt="Consultation illustration" />
      </div>
    </section>

    <!-- Quick Actions -->
    <section id="quickActions" class="module">
      <div class="quick-actions">
        <button class="btn"><i class="fas fa-calendar-plus"></i> Book an Appointment</button>
        <div class="view-tabs">
          <button id="viewUpcoming" class="btn-sm"><i class="fas fa-calendar-check"></i> View Upcoming</button>
          <button id="viewPast" class="btn-sm"><i class="fas fa-history"></i> View Past</button>
        </div>
        <p class="tips"><i class="fas fa-info-circle"></i> Need urgent care? <a id="urgentCare">Click here</a></p>
      </div>
    </section>

    <!-- Urgent Booking Module -->
    <section id="urgentBooking" class="module" hidden>
      <h2><i class="fas fa-exclamation-triangle"></i> Urgent Appointment</h2>
      <p class="desc">Describe your concern, pick a specialist, then choose date/time. ₵500 non-refundable fee.</p>

      <!-- Step 1 -->
      <div id="urgentStep1">
        <label>
          <i class="fas fa-notes-medical"></i> Chief Concern:
          <input type="text" id="urgentConcernInput" placeholder="e.g. severe headache" required />
        </label>
        <button type="button" id="urgentFindMatchBtn" class="btn">
          <i class="fas fa-search"></i> Find Specialist
        </button>
      </div>

      <!-- Step 2 -->
      <div id="urgentMatchResults" class="response" hidden>
        <button class="close-btn" id="urgentStep2Close"><i class="fas fa-times"></i></button>
        <div class="card">
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4 id="urgentMatchedName"></h4>
            <p id="urgentMatchedSpec"></p>
          </div>
        </div>
        <button id="urgentScheduleBtn" class="btn">
          <i class="fas fa-calendar-alt"></i> Schedule
        </button>
        <button class="btn-sm back" id="urgentStep2Back">Back</button>
      </div>

      <!-- Step 3 -->
      <div id="urgentCalendarFlow" hidden>
        <button class="btn-sm back" id="urgentStep3Back"><i class="fas fa-arrow-left"></i> Back</button>
        <label>Date: <input type="date" id="urgentDate" /></label>
        <label>Time: <input type="time" id="urgentTime" /></label>
        <button id="urgentNextToDetails" class="btn"><i class="fas fa-arrow-right"></i> Next</button>
        <button class="btn-sm close-btn" id="urgentStep3Close"><i class="fas fa-times"></i></button>
      </div>

      <!-- Step 4 -->
      <form id="urgentDetailsForm" hidden class="module">
        <button type="button" class="btn-sm back" id="urgentStep4Back"><i class="fas fa-arrow-left"></i> Back</button>
        <button type="button" class="btn-sm close-btn" id="urgentStep4Close"><i class="fas fa-times"></i></button>
        <label><i class="fas fa-user"></i> Your Name:
          <input id="urgentClientName" placeholder="Full Name" required />
        </label>
        <label><i class="fas fa-envelope"></i> Email:
          <input id="urgentClientEmail" type="email" required />
        </label>
        <button type="button" id="urgentConfirmBtn" class="btn">
          <i class="fas fa-check"></i> Review & Pay
        </button>
      </form>
    </section>

    <!-- Provider Matching -->
    <section id="providerMatch" class="module">
      <h2><i class="fas fa-user-md"></i> Find Your Specialist</h2>
      <p class="desc">Describe your health concern and let our AI pick the best in-network professional.</p>

      <!-- Step 1 -->
      <form id="matchForm">
        <label><i class="fas fa-notes-medical"></i> Chief Concern:
          <input type="text" id="concernInput" placeholder="e.g. persistent cough" required />
        </label>
        <label><i class="fas fa-exclamation-circle"></i> Urgency:
          <select id="urgencyInput"><option>Low</option><option>Medium</option><option>High</option></select>
        </label>
        <label><i class="fas fa-language"></i> Language:
          <select id="languageInput"><option>English</option><option>Twi</option><option>Ga</option></select>
        </label>
        <button type="button" id="findMatchBtn" class="btn">
          <i class="fas fa-search"></i> Predict Specialist
        </button>
      </form>

      <!-- Step 2 -->
      <div id="matchResults" class="response" hidden>
        <button class="close-btn" id="matchResultsClose"><i class="fas fa-times"></i></button>
        <button class="btn-sm back" id="matchResultsBack">Back</button>
        <div class="card">
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4 id="matchedName"></h4>
            <p id="matchedSpec"></p>
          </div>
        </div>
        <button id="scheduleMatchBtn" class="btn"><i class="fas fa-calendar-alt"></i> Schedule</button>
      </div>

      <!-- Step 3 -->
      <div id="appointmentFlow" hidden>
        <button class="btn-sm close-btn" id="appointmentFlowClose"><i class="fas fa-times"></i></button>
        <h3><i class="fas fa-calendar-alt"></i> Schedule with <span id="chosenProvider"></span></h3>
        <div class="month-nav">
          <button id="prevMonth" class="btn-sm"><i class="fas fa-chevron-left"></i></button>
          <div id="calendarHeader"></div>
          <button id="nextMonth" class="btn-sm"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div id="calendar" class="calendar-grid"></div>
        <div id="timeSlots"></div>

        <!-- Step 4 -->
        <form id="confirmForm" hidden class="module">
          <button class="btn-sm close-btn" id="confirmStep4Close"><i class="fas fa-times"></i></button>
          <button class="btn-sm back" id="confirmStep4Back">Back</button>
          <h4><i class="fas fa-check-circle"></i> Confirm</h4>
          <label><i class="fas fa-user"></i> Your Name:
            <input id="clientName" placeholder="Full Name" required />
          </label>
          <label><i class="fas fa-envelope"></i> Email:
            <input id="clientEmail" type="email" required />
          </label>
          <p id="summaryText"></p>
          <button id="confirmBtn" type="button" class="btn"><i class="fas fa-check"></i> Confirm</button>
        </form>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="feature-rich-dashboard" class="module">
      <h2><i class="fas fa-tachometer-alt"></i> Rich Dashboard</h2>
      <div class="dashboard-tabs">
        <button data-tab="rich-upcoming" class="active"><i class="fas fa-calendar-check"></i> Upcoming</button>
        <button data-tab="rich-past"><i class="fas fa-history"></i> Past</button>
        <button data-tab="rich-favorites"><i class="fas fa-heart"></i> Favorites</button>
      </div>
      <div id="rich-upcoming" class="dashboard-cards"></div>
      <div id="rich-past" class="dashboard-cards" hidden></div>
      <div id="rich-favorites" class="dashboard-cards" hidden></div>
    </section>

    <!-- Upcoming Calendar -->
    <section id="upcomingCalendar" class="module">
      <h2><i class="fas fa-calendar-alt"></i> Your Upcoming Appointments</h2>
      <p class="desc">Click any marked date to view details.</p>
      <div id="upcomingCalendarWidget"></div>
    </section>
  </main>

  <!-- Review Modal -->
  <div id="confirmModal" class="modal" hidden>
    <div class="modal-content">
      <h3>Review Your Appointment</h3>
      <div id="confirmDetails"></div>
      <button id="modalEdit" class="btn-sm">Edit</button>
      <button id="modalConfirm" class="btn">Confirm Booking</button>
      <button id="modalClose" class="btn-sm">Cancel</button>
    </div>
  </div>

  <!-- Cancel Modal -->
  <div id="cancelModal" class="modal" hidden>
    <div class="modal-content">
      <h3>Cancel Appointment?</h3>
      <p id="cancelMsg"></p>
      <button id="cancelNo" class="btn-sm">No, Keep It</button>
      <button id="cancelYes" class="btn">Yes, Cancel</button>
    </div>
  </div>

  <footer>
    <small>© 2025 AI-Pharmacy Chain — All rights reserved</small>
  </footer>


 <script defer src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
 <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<script defer>
document.addEventListener("DOMContentLoaded", () => {
  console.log("📣 DOMContentLoaded fired, main JS is running.");

  // ─── 1) GLOBALS & ELEMENT REFERENCES ─────────────────────────────────

  // Calendar widget state
  let widgetYear  = new Date().getFullYear();
  let widgetMonth = new Date().getMonth();

  // Flags & temporary variables
  let urgentProviderName = "";
  let uDate = "";
  let uTime = "";
  let urgentFlow = false;
  let providerId = "";
  let providerName = "";
  let year = new Date().getFullYear();
  let month = new Date().getMonth();
  let selDate = "";
  let selTime = "";

  // Main containers
  const richUpcoming = document.getElementById("rich-upcoming");
  const appointments  = [];
  const sidebar       = document.getElementById("sidebar");
  const hamburger     = document.getElementById("hamburger");
  const shrinkSidebarBtn = document.getElementById("shrinkSidebar");
  const themeToggle   = document.getElementById("themeToggle");
  const urgentCareLink = document.getElementById("urgentCare");

  // Urgent‐flow elements
  const urgentBooking      = document.getElementById("urgentBooking");
  const urgentStep1        = document.getElementById("urgentStep1");
  const urgentMatchResults = document.getElementById("urgentMatchResults");
  const urgentCalendarFlow = document.getElementById("urgentCalendarFlow");
  const urgentDetailsForm  = document.getElementById("urgentDetailsForm");
  const urgentFindMatchBtn = document.getElementById("urgentFindMatchBtn");
  const urgentMatchedName  = document.getElementById("urgentMatchedName");
  const urgentMatchedSpec  = document.getElementById("urgentMatchedSpec");
  const urgentScheduleBtn  = document.getElementById("urgentScheduleBtn");
  const urgentDate         = document.getElementById("urgentDate");
  const urgentTime         = document.getElementById("urgentTime");
  const urgentNextToDetails= document.getElementById("urgentNextToDetails");
  const urgentClientName   = document.getElementById("urgentClientName");
  const urgentClientEmail  = document.getElementById("urgentClientEmail");
  const urgentConfirmBtn   = document.getElementById("urgentConfirmBtn");
  const urgentStep2Back    = document.getElementById("urgentStep2Back");
  const urgentStep2Close   = document.getElementById("urgentStep2Close");
  const urgentStep3Close   = document.getElementById("urgentStep3Close");
  const urgentStep3Back    = document.getElementById("urgentStep3Back");
  const urgentStep4Back    = document.getElementById("urgentStep4Back");
  const urgentStep4Close   = document.getElementById("urgentStep4Close");

  // Provider‐match elements
  const matchForm         = document.getElementById("matchForm");
  const findMatchBtn      = document.getElementById("findMatchBtn");
  const matchResults      = document.getElementById("matchResults");
  const scheduleMatchBtn  = document.getElementById("scheduleMatchBtn");
  const matchedName       = document.getElementById("matchedName");
  const matchedSpec       = document.getElementById("matchedSpec");
  const appointmentFlow   = document.getElementById("appointmentFlow");
  const chosenProvider    = document.getElementById("chosenProvider");
  const prevMonthBtn      = document.getElementById("prevMonth");
  const nextMonthBtn      = document.getElementById("nextMonth");
  const calendarHeader    = document.getElementById("calendarHeader");
  const calendarGrid      = document.getElementById("calendar");
  const timeSlots         = document.getElementById("timeSlots");
  const confirmForm       = document.getElementById("confirmForm");
  const summaryText       = document.getElementById("summaryText");
  const confirmBtn        = document.getElementById("confirmBtn");
  const matchResultsBack  = document.getElementById("matchResultsBack");
  const matchResultsClose = document.getElementById("matchResultsClose");
  const appointmentFlowClose = document.getElementById("appointmentFlowClose");
  const confirmStep4Back  = document.getElementById("confirmStep4Back");
  const confirmStep4Close = document.getElementById("confirmStep4Close");

  // Modal elements
  const confirmModal = document.getElementById("confirmModal");
  const cancelModal  = document.getElementById("cancelModal");
  const modalEdit    = document.getElementById("modalEdit");
  const modalConfirm = document.getElementById("modalConfirm");
  const modalClose   = document.getElementById("modalClose");
  const cancelYes    = document.getElementById("cancelYes");
  const cancelNo     = document.getElementById("cancelNo");
  const cancelMsg    = document.getElementById("cancelMsg");

  // Upcoming calendar container
  const upcomingCalendarWidget = document.getElementById("upcomingCalendarWidget");

  // Rich Dashboard tabs
  const dashTabs     = document.querySelectorAll("#feature-rich-dashboard .dashboard-tabs button");
  const richUpcomingSection = document.getElementById("rich-upcoming");
  const richPastSection     = document.getElementById("rich-past");
  const richFavoritesSection= document.getElementById("rich-favorites");

  // ─── 2) STORAGE & RESTORE ────────────────────────────────────────────

  // Load appointments from localStorage
  const stored = localStorage.getItem("appointments");
  if (stored) {
    appointments.push(...JSON.parse(stored));
    renderUpcomingCalendarWidget();
    appointments.forEach(addToRichDashboard);
  }

  // Load urgent draft
  const draft = JSON.parse(localStorage.getItem("urgentDraft") || "{}");
  for (let k in draft) {
    const el = document.getElementById("urgent" + k);
    if (el) el.value = draft[k];
  }

  // ─── 3) HELPER FUNCTIONS ─────────────────────────────────────────────

  // Toast notification
  function showToast(msg) {
    const t = document.createElement("div");
    t.className = "toast";
    t.innerText = msg;
    document.body.append(t);
    requestAnimationFrame(() => t.classList.add("visible"));
    setTimeout(() => t.remove(), 3000);
  }

  // Call OpenAI proxy
  async function callOpenAI(messages) {
    try {
      const res = await fetch("/.netlify/functions/openai-proxy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages }),
      });
      if (!res.ok) throw new Error(await res.text());
      const j = await res.json();
      return j.choices?.[0]?.message?.content.trim() || "";
    } catch (err) {
      console.error("OpenAI error:", err);
      return "";
    }
  }

  // Generate a unique ID
  function generateId(prefix = "") {
    return prefix + Date.now().toString();
  }

  // Format amount in kobo (Paystack)
  const URGENT_FEE_KOBO = 500 * 100; // ₵500 => 50000 kobo

  // ─── 4) PROVIDERS & AVAILABILITY ────────────────────────────────────

  const providers = [
    { id: "p1",  name: "Dr. Kwame Asante",               specialty: "Pulmonologist",                facility: "Korle Bu Teaching Hospital" },
    { id: "p2",  name: "Dr. Abena Owusu",                 specialty: "Cardiologist",                 facility: "37 Military Hospital" },
    { id: "p3",  name: "Dr. Kojo Mensah",                 specialty: "Psychiatrist",                 facility: "Ridge Hospital" },
    { id: "p4",  name: "Dr. Yaa Dufie",                   specialty: "Clinical Dietitian",           facility: "Nyaho Medical Centre" },
    { id: "p5",  name: "Dr. Nana Adjei",                  specialty: "General Practitioner",         facility: "Cape Coast Teaching Hospital" },
    { id: "p6",  name: "Dr. Efua Amponsah",               specialty: "Endocrinologist",              facility: "LEKMA Hospital" },
    { id: "p7",  name: "Dr. Michael Addo",                specialty: "Neurologist",                  facility: "37 Military Hospital" },
    { id: "p8",  name: "Dr. Grace Ofori",                 specialty: "Dermatologist",                facility: "Accra Dermatology Centre" },
    { id: "p9",  name: "Dr. Joseph Kumi",                 specialty: "Orthopedic Surgeon",           facility: "Komfo Anokye Teaching Hospital" },
    { id: "p10", name: "Dr. Ama Brew",                    specialty: "Pediatrician",                 facility: "The Trust Hospital" },
    { id: "p11", name: "Ms. Akosua Baah",                 specialty: "Physiotherapist",              facility: "Tema General Hospital" },
    { id: "p12", name: "Mr. Daniel Boakye",               specialty: "Pharmacist",                   facility: "Ridge Hospital Pharmacy" },
    { id: "p13", name: "Mrs. Esther Kumi",                specialty: "Occupational Therapist",       facility: "Cape Coast Teaching Hospital" },
    { id: "p14", name: "Ms. Joy Mensah",                  specialty: "Speech and Language Therapist", facility: "LEKMA Hospital" },
    { id: "p15", name: "Dr. Paul Yeboah",                 specialty: "Dermatologist",                facility: "Korle Bu Teaching Hospital" },
    { id: "p16", name: "Dr. Linda Frimpong",              specialty: "Nephrologist",                 facility: "37 Military Hospital" },
    { id: "p17", name: "Mr. Kwesi Owusu",                 specialty: "Nutritionist",                 facility: "Nyaho Medical Centre" },
    { id: "p18", name: "Ms. Abena Boateng",               specialty: "Psychologist",                 facility: "Accra Psychology & Counselling Centre" }
  ];

  const availability = {
    p1:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-10": ["09:00","10:00","11:00"], "2025-06-12": ["14:00","15:00"], "2025-06-15": ["08:30","09:30","10:30"] },
    p2:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["10:00","13:00","16:00"], "2025-06-04": ["09:00","11:00"], "2025-06-15": ["12:00","14:00"] },
    p3:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-08": ["08:00","09:00","10:00","11:00"], "2025-06-11": ["13:30","14:30"], "2025-06-16": ["15:00","16:00"] },
    p4:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["09:30","10:30","11:30"], "2025-06-09": ["14:00","15:00","16:00"], "2025-06-18": ["08:00","09:00"] },
    p5:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-07": ["08:15","09:15","10:15"], "2025-06-13": ["13:00","14:00"], "2025-06-17": ["10:00","11:00","12:00"] },
    p6:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["09:00","10:00"], "2025-06-14": ["11:00","12:00","13:00"], "2025-06-19": ["14:00","15:00"] },
    p7:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-06": ["08:30","09:30","10:30"], "2025-06-12": ["13:00","14:00","15:00"], "2025-06-20": ["09:00","10:00"] },
    p8:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-01": ["10:00","11:00","12:00"], "2025-06-11": ["14:30","15:30"], "2025-06-16": ["08:00","09:00","10:00"] },
    p9:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-04": ["09:00","10:00","11:00"], "2025-06-13": ["13:00","14:00"], "2025-06-18": ["15:00","16:00"] },
    p10: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["08:00","09:00","10:00"], "2025-06-10": ["11:00","12:00","13:00"], "2025-06-17": ["14:00","15:00"] },
    p11: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["09:30","10:30","11:30"], "2025-06-14": ["13:00","14:00","15:00"], "2025-06-19": ["08:00","09:00"] },
    p12: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["10:00","11:00","12:00"], "2025-06-08": ["14:00","15:00"], "2025-06-20": ["09:00","10:00","11:00"] },
    p13: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-07": ["08:00","09:00","10:00"], "2025-06-12": ["11:30","12:30","13:30"], "2025-06-18": ["14:00","15:00"] },  
    p14: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["09:15","10:15","11:15"], "2025-06-09": ["13:00","14:00","15:00"], "2025-06-16": ["08:00","09:00"] },
    p15: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["08:30","09:30","10:30"], "2025-06-13": ["11:00","12:00","13:00"], "2025-06-19": ["14:30","15:30"] },
    p16: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["10:00","11:00","12:00"], "2025-06-11": ["13:15","14:15"], "2025-06-17": ["09:00","10:00","11:00"] },
    p17: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-04": ["09:00","10:00","11:00"], "2025-06-10": ["12:00","13:00","14:00"], "2025-06-15": ["15:00","16:00"] },
    p18: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-01": ["08:00","09:00","10:00"], "2025-06-08": ["11:30","12:30","13:30"], "2025-06-20": ["14:00","15:00","16:00"] }
  };

  // Keyword→provider ID map for rule‐based matching
  const symptomMap = {
    cough:         "p1", wheeze:      "p1", asthma:      "p1", pneumonia:   "p1", bronchitis:  "p1",
    chestpain:     "p2", "chest pain": "p2", palpitations:"p2", "shortness of breath": "p2",
    anxiety:       "p3", depression:  "p3", insomnia:    "p3", schizophrenia: "p3",
    diabetes:      "p4", weight:      "p4", nutrition:   "p4",
    fatigue:       "p5", weakness:    "p5", fever:       "p5", pain:        "p5",
    thyroid:       "p6", endocrine:   "p6", "blood sugar":"p6",
    headache:      "p7", migraine:    "p7", seizure:     "p7", nerve:       "p7",
    rash:          "p8", acne:        "p8", eczema:      "p8", skin:        "p8",
    fracture:      "p9", joint:       "p9", bone:        "p9",
    child:         "p10", kids:       "p10", pediatric:   "p10",
    rehab:         "p11", mobility:   "p11",
    medication:    "p12", drug:       "p12",
    occupational:  "p13",
    speech:        "p14",
    kidney:        "p16", renal:     "p16",
    diet:          "p17",
    psychologist:  "p18", counsel:   "p18"
  };

  // ─── 5) UI TOGGLE FUNCTIONS ──────────────────────────────────────────

  // 5a) Sidebar toggle (hamburger for mobile)
  if (hamburger) {
    hamburger.addEventListener("click", () => {
      document.body.classList.toggle("sidebar-open");
    });
  } else {
    console.error("hamburger element not found");
  }

  // 5b) Sidebar shrink/collapse
  if (shrinkSidebarBtn) {
    shrinkSidebarBtn.addEventListener("click", () => {
      document.body.classList.toggle("sidebar-shrink");
      const icon = shrinkSidebarBtn.querySelector("i");
      icon.classList.toggle("fa-chevron-left");
      icon.classList.toggle("fa-chevron-right");
    });
  } else {
    console.error("shrinkSidebarBtn element not found");
  }

  // 5c) Theme toggle
  if (themeToggle) {
    themeToggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      themeToggle.classList.toggle("fa-moon");
      themeToggle.classList.toggle("fa-sun");
    });
  } else {
    console.error("themeToggle element not found");
  }

  // 5d) Show urgent booking section
  if (urgentCareLink) {
    urgentCareLink.addEventListener("click", () => {
      urgentBooking.hidden = false;
    });
  } else {
    console.error("urgentCare element not found");
  }

  // ─── 6) URGENT FLOW NAVIGATION ───────────────────────────────────────

  // Step 2 → Back to Step 1
  if (urgentStep2Back) {
    urgentStep2Back.onclick = () => {
      urgentMatchResults.hidden = true;
      urgentStep1.hidden = false;
    };
  } else {
    console.error("urgentStep2Back element not found");
  }

  // Step 2 → Close urgent flow
  if (urgentStep2Close) {
    urgentStep2Close.onclick = () => {
      urgentBooking.hidden = true;
    };
  } else {
    console.error("urgentStep2Close element not found");
  }

  // Step 3 → Close urgent flow
  if (urgentStep3Close) {
    urgentStep3Close.onclick = () => {
      urgentBooking.hidden = true;
    };
  } else {
    console.error("urgentStep3Close element not found");
  }

  // Step 3 → Back to Step 2
  if (urgentStep3Back) {
    urgentStep3Back.onclick = () => {
      urgentCalendarFlow.hidden = true;
      urgentMatchResults.hidden = false;
    };
  } else {
    console.error("urgentStep3Back element not found");
  }

  // Step 4 → Back to Step 3
  if (urgentStep4Back) {
    urgentStep4Back.onclick = () => {
      urgentDetailsForm.hidden = true;
      urgentCalendarFlow.hidden = false;
    };
  } else {
    console.error("urgentStep4Back element not found");
  }

  // Step 4 → Close urgent flow
  if (urgentStep4Close) {
    urgentStep4Close.onclick = () => {
      urgentBooking.hidden = true;
    };
  } else {
    console.error("urgentStep4Close element not found");
  }

  // ─── 7) NORMAL MATCH FLOW NAVIGATION ─────────────────────────────────

  // Match Results → Back to Step 1
  if (matchResultsBack) {
    matchResultsBack.addEventListener("click", () => {
      matchResults.hidden = true;
      matchForm.hidden = false;
    });
  } else {
    console.error("matchResultsBack element not found");
  }

  // Match Results → Close panel
  if (matchResultsClose) {
    matchResultsClose.onclick = () => {
      matchResults.hidden = true;
      matchForm.hidden = false;
    };
  } else {
    console.error("matchResultsClose element not found");
  }

  // Appointment Flow → Close panel
  if (appointmentFlowClose) {
    appointmentFlowClose.onclick = () => {
      appointmentFlow.hidden = true;
    };
  } else {
    console.error("appointmentFlowClose element not found");
  }

  // Confirm Form → Back to Step 3
  if (confirmStep4Back) {
    confirmStep4Back.addEventListener("click", () => {
      confirmForm.hidden = true;
      appointmentFlow.hidden = false;
    });
  } else {
    console.error("confirmStep4Back element not found");
  }

  // Confirm Form → Close panel
  if (confirmStep4Close) {
    confirmStep4Close.addEventListener("click", () => {
      appointmentFlow.hidden = true;
    });
  } else {
    console.error("confirmStep4Close element not found");
  }

  // ─── 8) URGENT FLOW LOGIC ─────────────────────────────────────────────

  // Prevent past dates
  if (urgentDate) {
    urgentDate.min = new Date().toISOString().split("T")[0];
  }

  // Urgent: Find Specialist (rule‐based + GPT fallback)
  if (urgentFindMatchBtn) {
    urgentFindMatchBtn.onclick = async () => {
      const rawConcern = document.getElementById("urgentConcernInput").value.trim();
      if (!rawConcern) return showToast("Please enter your concern.");
      const lower = rawConcern.toLowerCase();

      // 1) Keyword scan
      let matchedProviderId = null;
      for (let keyword in symptomMap) {
        if (lower.includes(keyword)) {
          matchedProviderId = symptomMap[keyword];
          break;
        }
      }

      // 2) If found, pick that provider
      let chosenProviderObj = null;
      if (matchedProviderId) {
        chosenProviderObj = providers.find(p => p.id === matchedProviderId);
      }

      // 3) Otherwise, call GPT (force ID‐only)
      if (!chosenProviderObj) {
        urgentFindMatchBtn.disabled = true;
        urgentFindMatchBtn.textContent = "Matching…";

        const sys = `
You are an expert medical triage AI. 
Choose exactly one provider ID from the list below. Respond ONLY with the ID (e.g. "p3"), no extra text.
Providers:
${providers.map(p => `- ${p.id}: ${p.name} — ${p.specialty} at ${p.facility}`).join("\n")}
        `.trim();

        const usr = \`Concern="\${rawConcern}". Return exactly one provider ID (p1…p18).\`;
        let rawGPT = await callOpenAI([
          { role: "system", content: sys },
          { role: "user",   content: usr }
        ]);

        const clean = rawGPT.split(/\s+/)[0].trim();
        const isValid = providers.some(p => p.id === clean);
        if (isValid) {
          chosenProviderObj = providers.find(p => p.id === clean);
        } else {
          // Rare fallback
          chosenProviderObj = providers[Math.floor(Math.random() * providers.length)];
        }

        urgentFindMatchBtn.disabled = false;
        urgentFindMatchBtn.textContent = "Find Specialist";
      }

      // 4) Display result
      urgentMatchedName.textContent = chosenProviderObj.name;
      urgentMatchedSpec.textContent = \`\${chosenProviderObj.specialty}, \${chosenProviderObj.facility}\`;
      urgentProviderName = chosenProviderObj.name;

      // 5) Show Step 2, hide Step 1
      urgentMatchResults.hidden = false;
      urgentStep1.hidden = true;
    };
  } else {
    console.error("urgentFindMatchBtn element not found");
  }

  // Urgent: Schedule → show calendar inputs
  if (urgentScheduleBtn) {
    urgentScheduleBtn.onclick = () => {
      urgentMatchResults.hidden = true;
      urgentCalendarFlow.hidden = false;
    };
  } else {
    console.error("urgentScheduleBtn element not found");
  }

  // Urgent: Next → show details form
  if (urgentNextToDetails) {
    urgentNextToDetails.onclick = () => {
      if (!urgentDate.value || !urgentTime.value) return showToast("Select date & time.");
      uDate = urgentDate.value;
      uTime = urgentTime.value;
      // Hide the calendar before showing the “Details” form
      urgentCalendarFlow.hidden = true;
      urgentDetailsForm.hidden = false;
      urgentDetailsForm.scrollIntoView({ behavior: "smooth" });
    };
  } else {
    console.error("urgentNextToDetails element not found");
  }

  // Urgent: Confirm → open review modal (then payment)
  if (urgentConfirmBtn) {
    urgentConfirmBtn.onclick = () => {
      const name = urgentClientName.value.trim();
      const email = urgentClientEmail.value.trim();
      if (!name || !email) return showToast("Enter name & email");
      document.getElementById("confirmDetails").innerHTML = `
        <p><strong>Urgent Consult</strong></p>
        <p><strong>Provider:</strong> ${urgentProviderName}</p>
        <p><strong>Date:</strong> ${uDate}</p>
        <p><strong>Time:</strong> ${uTime}</p>
        <p><strong>Name:</strong> ${name}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>Fee:</strong> ₵500</p>
      `;
      confirmModal.hidden = false;
      localStorage.setItem("urgentDraft", JSON.stringify({
        ConcernInput: document.getElementById("urgentConcernInput").value,
        Date: uDate, Time: uTime,
        ClientName: name, ClientEmail: email
      }));
      urgentFlow = true;
    };
  } else {
    console.error("urgentConfirmBtn element not found");
  }

  // ─── 9) NORMAL MATCH FLOW LOGIC ─────────────────────────────────────

  // Normal: Find Specialist (rule‐based + GPT fallback)
  if (findMatchBtn) {
    findMatchBtn.onclick = async () => {
      const rawConcern = document.getElementById("concernInput").value.trim();
      if (!rawConcern) return showToast("Enter your concern.");
      const lower = rawConcern.toLowerCase();

      // 1) Keyword scan
      let matchedProviderId = null;
      for (let keyword in symptomMap) {
        if (lower.includes(keyword)) {
          matchedProviderId = symptomMap[keyword];
          break;
        }
      }

      // 2) If found, pick that provider
      let chosenProviderObj = null;
      if (matchedProviderId) {
        chosenProviderObj = providers.find(p => p.id === matchedProviderId);
      }

      // 3) Otherwise, call GPT (force ID‐only)
      if (!chosenProviderObj) {
        findMatchBtn.disabled = true;
        findMatchBtn.innerHTML = `Matching… <span class="spinner"></span>`;

        const sys = `
You are an expert medical triage AI. 
Choose exactly one provider ID from the list below. Respond ONLY with the ID (e.g. "p5"), no extra text.
Providers:
${providers.map(p => `- ${p.id}: ${p.name} — ${p.specialty} at ${p.facility}`).join("\n")}
        `.trim();

        const usr = \`Concern="\${rawConcern}", Urgency="\${document.getElementById("urgencyInput").value}". Return exactly one provider ID (p1…p18).\`;
        let rawGPT = await callOpenAI([
          { role: "system", content: sys },
          { role: "user",   content: usr }
        ]);

        const clean = rawGPT.split(/\s+/)[0].trim();
        const isValid = providers.some(p => p.id === clean);
        if (isValid) {
          chosenProviderObj = providers.find(p => p.id === clean);
        } else {
          // Rare fallback
          chosenProviderObj = providers[Math.floor(Math.random() * providers.length)];
        }

        findMatchBtn.disabled = false;
        findMatchBtn.innerHTML = '<i class="fas fa-search"></i> Predict Specialist';
      }

      // 4) Display result
      matchedName.textContent = chosenProviderObj.name;
      matchedSpec.textContent = `${chosenProviderObj.specialty}, ${chosenProviderObj.facility}`;
      providerId = chosenProviderObj.id;
      providerName = chosenProviderObj.name;

      // 5) Show Step 2 (hide the match‐form, show the results panel)
      matchResults.hidden = false;
      matchForm.hidden = true;
    };
  } else {
    console.error("findMatchBtn element not found");
  }

  // Normal: Schedule → show calendar widget
  if (scheduleMatchBtn) {
    scheduleMatchBtn.onclick = () => {
      matchResults.hidden = true;
      appointmentFlow.hidden = false;
      chosenProvider.textContent = providerName;
      buildCalendar(year, month);
    };
  } else {
    console.error("scheduleMatchBtn element not found");
  }

  // Change month in main calendar
  if (prevMonthBtn) {
    prevMonthBtn.onclick = () => {
      month = month > 0 ? month - 1 : 11;
      if (month === 11) year--;
      buildCalendar(year, month);
    };
  } else {
    console.error("prevMonthBtn element not found");
  }
  if (nextMonthBtn) {
    nextMonthBtn.onclick = () => {
      month = month < 11 ? month + 1 : 0;
      if (month === 0) year++;
      buildCalendar(year, month);
    };
  } else {
    console.error("nextMonthBtn element not found");
  }

  // Build main calendar grid
  function buildCalendar(y, m) {
    calendarHeader.textContent = new Date(y, m).toLocaleString("default", { month: "long", year: "numeric" });
    calendarGrid.innerHTML = "";
    // Weekday headers
    ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"].forEach(w => {
      const d = document.createElement("div");
      d.className = "cell";
      d.style.fontWeight = "600";
      d.innerText = w;
      calendarGrid.append(d);
    });
    const first = new Date(y, m, 1).getDay();
    const days = new Date(y, m + 1, 0).getDate();
    // Blank cells
    for (let i = 0; i < first; i++) {
      const b = document.createElement("div");
      b.className = "cell closed";
      calendarGrid.append(b);
    }
    // Day cells
    const avail = availability[providerId] || {};
    const todayMidnightTs = new Date().setHours(0, 0, 0, 0);
    for (let d = 1; d <= days; d++) {
      const key = `${y}-${String(m + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
      const thisDayTs = new Date(y, m, d).getTime();
      const past = thisDayTs < todayMidnightTs;
      const open = !past && Array.isArray(avail[key]);
      const cell = document.createElement("div");
      cell.className = `cell ${open ? "open" : "closed"}`;
      cell.dataset.date = key;
      cell.innerText = d;
      if (open) cell.addEventListener("click", () => selectDate(key));
      const today = new Date();
      if (today.getFullYear() === y && today.getMonth() === m && today.getDate() === d) {
        cell.classList.add("today");
      }
      calendarGrid.append(cell);
    }
    timeSlots.innerHTML = "";
    confirmForm.hidden = true;
  }

  // Select a date → show available time slots
  function selectDate(key) {
    selDate = key;
    const avail = availability[providerId] || {};
    const slots = avail[key] || [];
    timeSlots.innerHTML = `<h4>Available on ${key}:</h4>`;
    const ul = document.createElement("ul");
    ul.style.display = "flex";
    ul.style.gap = "0.5rem";
    slots.forEach(t => {
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn-sm";
      btn.innerText = t;
      btn.addEventListener("click", () => selectTime(t));
      li.append(btn);
      ul.append(li);
    });
    timeSlots.append(ul);
  }

  // Select a time → show confirm form
  function selectTime(t) {
    selTime = t;
    summaryText.textContent = `You selected ${selDate} at ${selTime}.`;
    confirmForm.hidden = false;
    confirmForm.scrollIntoView({ behavior: "smooth" });
  }

  // Normal: Confirm → open review modal
  if (confirmBtn) {
    confirmBtn.onclick = () => {
      const name = document.getElementById("clientName").value.trim();
      if (!name) return showToast("Enter your name");
      document.getElementById("confirmDetails").innerHTML = `
        <p><strong>Provider:</strong> ${providerName}</p>
        <p><strong>Date:</strong> ${selDate}</p>
        <p><strong>Time:</strong> ${selTime}</p>
        <p><strong>Your Name:</strong> ${name}</p>
      `;
      confirmModal.hidden = false;
    };
  } else {
    console.error("confirmBtn element not found");
  }

  // ─── 10) MODAL CONTROLS & PAYMENT LOGIC ──────────────────────────────

  // Close review modal
  if (modalClose) {
    modalClose.addEventListener("click", () => {
      confirmModal.hidden = true;
    });
  } else {
    console.error("modalClose element not found");
  }

  // Edit from modal → scroll back to form
  if (modalEdit) {
    modalEdit.addEventListener("click", () => {
      confirmModal.hidden = true;
      confirmForm.scrollIntoView({ behavior: "smooth" });
    });
  } else {
    console.error("modalEdit element not found");
  }

  // Confirm booking (handles both urgent & normal, with Paystack for urgent)
  if (modalConfirm) {
    modalConfirm.addEventListener("click", () => {
      if (urgentFlow) {
        // ─── Check that PaystackPop exists ─────────────────────────────────
        if (typeof PaystackPop === "undefined") {
          console.error("PaystackPop is not loaded. Cannot launch payment.");
          showToast("Payment library failed to load. Please try again.");
          return;
        }
        // Urgent: Launch Paystack inline payment
        const email = urgentClientEmail.value.trim();
        const handler = PaystackPop.setup({
          key: "pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa",
          email: email,
          amount: URGENT_FEE_KOBO,
          currency: "GHS",
          ref: generateId("U"), // Unique reference
          onClose: function() {
            // If user closes the payment popup, do nothing
          },
          callback: function(response) {
            // Payment successful → save appointment
            const id = generateId("U");
            appointments.push({ id, name: urgentProviderName, date: uDate, time: uTime, urgent: true });
            localStorage.setItem("appointments", JSON.stringify(appointments));
            addToRichDashboard({ id, name: urgentProviderName, date: uDate, time: uTime, urgent: true });
            renderUpcomingCalendarWidget();
            showToast("Urgent appointment saved!");
            urgentFlow = false;
            confirmModal.hidden = true;
          }
        });
        handler.openIframe();
      } else {
        // Normal: No payment → save directly
        const id = generateId();
        appointments.push({ id, name: providerName, date: selDate, time: selTime, urgent: false });
        localStorage.setItem("appointments", JSON.stringify(appointments));
        addToRichDashboard({ id, name: providerName, date: selDate, time: selTime, urgent: false });
        renderUpcomingCalendarWidget();
        showToast("Appointment confirmed!");
        confirmModal.hidden = true;
      }
    });
  } else {
    console.error("modalConfirm element not found");
  }

  // ─── 11) CANCELLATION MODAL ───────────────────────────────────────────

  if (cancelYes) {
    cancelYes.addEventListener("click", () => {
      // Find the appointment with matching ID and remove
      const id = cancelYes.dataset.apptId;
      const idx = appointments.findIndex(a => a.id === id);
      if (idx > -1) {
        appointments.splice(idx, 1);
        localStorage.setItem("appointments", JSON.stringify(appointments));
      }
      // Remove card from Rich Dashboard
      const card = document.querySelector(`.card[data-id="${id}"]`);
      if (card) card.remove();
      renderUpcomingCalendarWidget();
      showToast("Appointment canceled.");
      cancelModal.hidden = true;
    });
  } else {
    console.error("cancelYes element not found");
  }

  if (cancelNo) {
    cancelNo.addEventListener("click", () => {
      cancelModal.hidden = true;
    });
  } else {
    console.error("cancelNo element not found");
  }

  // ─── 12) RENDER UPCOMING CALENDAR WIDGET ─────────────────────────────

  function renderUpcomingCalendarWidget() {
    upcomingCalendarWidget.innerHTML = "";
    const ctrl = document.createElement("div");
    ctrl.style.display = "flex";
    ctrl.style.justifyContent = "space-between";
    ctrl.style.marginBottom = "0.5rem";
    const prev = document.createElement("button");
    prev.textContent = "‹ Prev";
    prev.className = "btn-sm";
    const next = document.createElement("button");
    next.textContent = "Next ›";
    next.className = "btn-sm";
    ctrl.append(prev, next);
    upcomingCalendarWidget.append(ctrl);

    prev.onclick = () => {
      widgetMonth--;
      if (widgetMonth < 0) {
        widgetMonth = 11;
        widgetYear--;
      }
      renderWidget();
    };
    next.onclick = () => {
      widgetMonth++;
      if (widgetMonth > 11) {
        widgetMonth = 0;
        widgetYear++;
      }
      renderWidget();
    };

    function renderWidget() {
      // Header
      const title = document.createElement("h4");
      title.innerText = new Date(widgetYear, widgetMonth).toLocaleString("default", { month: "long", year: "numeric" });
      // Grid
      const grid = document.createElement("div");
      grid.className = "calendar-grid";
      ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"].forEach(w => {
        const hd = document.createElement("div");
        hd.className = "cell";
        hd.style.fontWeight = "600";
        hd.innerText = w;
        grid.append(hd);
      });
      const firstDay = new Date(widgetYear, widgetMonth, 1).getDay();
      for (let i = 0; i < firstDay; i++) {
        const blank = document.createElement("div");
        blank.className = "cell";
        grid.append(blank);
      }
      const days = new Date(widgetYear, widgetMonth + 1, 0).getDate();
      const marks = new Set(
        appointments
          .filter(a => {
            const d = new Date(a.date);
            return d.getFullYear() === widgetYear && d.getMonth() === widgetMonth;
          })
          .map(a => new Date(a.date).getDate())
      );
      for (let d = 1; d <= days; d++) {
        const cell = document.createElement("div");
        const isMarked = marks.has(d);
        cell.className = isMarked ? "cell open" : "cell";
        cell.innerText = d;
        if (isMarked) {
          cell.addEventListener("click", () => {
            const list = appointments.filter(a => {
              const ad = new Date(a.date);
              return ad.getFullYear() === widgetYear && ad.getMonth() === widgetMonth && ad.getDate() === d;
            });
            alert(list.map(a => `${a.name}: ${a.time}`).join("\n"));
          });
        }
        grid.append(cell);
      }
      upcomingCalendarWidget.querySelectorAll("h4, .calendar-grid").forEach(n => n.remove());
      upcomingCalendarWidget.append(title, grid);
    }
    renderWidget();
  }

  // ─── 13) RICH DASHBOARD (CARDS + TABS) ───────────────────────────────

  // Add card to the “Upcoming” dashboard
  function addToRichDashboard(appt) {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.id = appt.id;
    card.innerHTML = `
      <i class="fas fa-user-md fa-2x"></i>
      <div class="details">
        <h4><strong>${appt.name}</strong></h4>
        <p>${appt.date} • ${appt.time}</p>
      </div>
      <div class="actions">
        <button class="btn-reschedule"><i class="fas fa-sync-alt"></i></button>
        <button class="btn-cancel"><i class="fas fa-times"></i></button>
      </div>
    `;

    // Reschedule logic
    const btnReschedule = card.querySelector(".btn-reschedule");
    if (btnReschedule) {
      btnReschedule.addEventListener("click", () => {
        if (appt.urgent) {
          // Urgent: open urgent flow at calendar step
          urgentProviderName = appt.name;
          urgentBooking.hidden = false;
          urgentStep1.hidden = true;
          urgentMatchResults.hidden = true;
          urgentCalendarFlow.hidden = false;
          urgentDate.value = appt.date;
          urgentTime.value = appt.time;
          uDate = appt.date;
          uTime = appt.time;
        } else {
          // Normal: open scheduling for this provider
          const found = providers.find(p => p.name === appt.name);
          if (found) {
            providerId = found.id;
            providerName = appt.name;
            appointmentFlow.hidden = false;
            chosenProvider.textContent = providerName;
            buildCalendar(year, month);
          } else {
            console.error("Provider not found for reschedule:", appt.name);
          }
        }
        document.getElementById("confirmDetails").innerHTML = `
          <p><strong>${appt.name}</strong></p>
          <p><strong>Date:</strong> ${appt.date}</p>
          <p><strong>Time:</strong> ${appt.time}</p>
        `;
      });
    } else {
      console.error("btn-reschedule element not found inside card");
    }

    // Cancel logic
    const btnCancel = card.querySelector(".btn-cancel");
    if (btnCancel) {
      btnCancel.onclick = () => {
        cancelMsg.innerText = appt.urgent
          ? "This was an urgent booking (₵500 non-refundable). Cancel anyway?"
          : "Are you sure you want to cancel this appointment?";
        cancelYes.dataset.apptId = appt.id;
        cancelModal.hidden = false;
      };
    } else {
      console.error("btn-cancel element not found inside card");
    }

    richUpcoming.append(card);
  }

  // Tab switching
  dashTabs.forEach(btn => {
    btn.addEventListener("click", () => {
      dashTabs.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      richUpcomingSection.hidden = (btn.dataset.tab !== "rich-upcoming");
      richPastSection.hidden     = (btn.dataset.tab !== "rich-past");
      richFavoritesSection.hidden= (btn.dataset.tab !== "rich-favorites");
    });
  });

  // If you’re using Animate On Scroll (AOS), initialize it here:
  if (typeof AOS !== "undefined") {
    AOS.init();
  }
});
</script>
  
</body>

</html>
