<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>E-Pharmacy AI Portal</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <style>
    :root {
      --cb-primary: #3b3f88;
      --cb-primary-alt: #5c4d99;
      --cb-accent: #f08a5d;
      --cb-bg: #f7f6f9;
      --cb-surface: #ffffff;
      --cb-text: #2d2d2d;
      --radius: 0.75rem;
      --padding: 1rem;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: 0.3s ease;
      --sidebar-width: 220px;
      --sidebar-collapsed-width: 60px;
    }
    html.dark {
      --cb-bg: #1a1b2e;
      --cb-surface: #2d2d44;
      --cb-text: #e0e0e0;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: var(--transition);
    }
    body {
      font-family: "Montserrat", sans-serif;
      background: var(--cb-bg);
      color: var(--cb-text);
      line-height: 1.5;
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    img {
      max-width: 100%;
      display: block;
    }

    /* ─── Layout ─────────────────────────────────────────────────── */
    aside#sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      background: var(--cb-surface);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }
   body.sidebar-shrink aside#sidebar {
  width: var(--sidebar-collapsed-width);
}

/* hide all link text when collapsed, keep icons */
body.sidebar-shrink aside#sidebar nav li a span,
body.sidebar-shrink aside#sidebar .brand span {
  display: none;
  overflow: hidden;
}
    body.sidebar-shrink aside#sidebar nav li a,
body.sidebar-shrink aside#sidebar .brand {
  justify-content: center;
}
    aside#sidebar .brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: var(--padding);
      background: var(--cb-primary);
      color: #fff;
      font-size: 1.25rem;
    }
    aside#sidebar nav {
      flex: 1;
      overflow-y: auto;
    }
    aside#sidebar nav ul {
      list-style: none;
    }
    aside#sidebar nav li a {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem var(--padding);
      border-radius: var(--radius);
      color: var(--cb-text);
    }
    aside#sidebar nav li.active a,
    aside#sidebar nav li a:hover {
      background: var(--cb-primary-alt);
      color: #fff;
    }
    #shrinkSidebar {
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--cb-primary);
      cursor: pointer;
      margin: var(--padding);
    }
    header {
      position: sticky;
      top: 0;
      margin-left: var(--sidebar-width);
      background: var(--cb-surface);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--padding);
      height: 60px;
      box-shadow: var(--shadow);
      z-index: 1001;
    }
    body.sidebar-shrink header {
      margin-left: var(--sidebar-collapsed-width);
    }
    header h1 {
      font-size: 1.25rem;
      color: var(--cb-primary);
    }
    #hamburger,
    #themeToggle {
      font-size: 1.5rem;
      color: var(--cb-primary);
      cursor: pointer;
    }
    main,
    section,
    footer {
      margin-left: var(--sidebar-width);
      padding: var(--padding);
      transition: margin-left var(--transition);
    }
    body.sidebar-shrink main,
    body.sidebar-shrink section,
    body.sidebar-shrink footer {
      margin-left: var(--sidebar-collapsed-width);
    }

    /* ─── Module Base ────────────────────────────────────────────── */
    section.module {
      background: var(--cb-surface);
      border-radius: var(--radius);
      padding: var(--padding);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }
    section.module h2 {
      font-size: 1.5rem;
      color: var(--cb-primary);
      margin-bottom: 0.5rem;
    }
    section.module .desc {
      color: var(--cb-primary-alt);
      margin-bottom: 1rem;
    }
 #matchResults .response {
 position: relative;
  padding-top: 2rem; /* give room for close */
 }
    /* ─── Hero & Quick Actions ─────────────────────────────────── */
    #hero {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--padding);
      background: var(--cb-primary-alt);
      color: #fff;
      padding: 2rem var(--padding);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    #hero .hero-text h2 {
      font-size: 2.25rem;
    }
    #hero .hero-text h2,
hero-text .desc {
 color: var(--secondary);
}
    #hero .btn {
      background: var(--cb-accent);
      color: #fff;
    }
    #quickActions .quick-actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    #quickActions .quick-actions .btn {
      flex: 1 1 auto;
      min-width: 160px;
    }
    #quickActions .view-tabs {
      display: flex;
      gap: 0.5rem;
    }
    #quickActions .view-tabs .btn-sm {
      background: var(--cb-primary-alt);
      color: #fff;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    #quickActions .tips {
      flex: 1 1 100%;
      text-align: right;
      color: var(--cb-bg);
      font-size: 0.9rem;
    }
    #quickActions .tips a {
      text-decoration: underline;
      color: var(--cb-bg);
      cursor: pointer;
    }

    /* ─── Forms & Inputs ──────────────────────────────────────── */
    form label {
      display: block;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    input,
    select,
    textarea,
    button.btn-sm {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--cb-primary-alt);
      border-radius: var(--radius);
      background: var(--cb-bg);
      color: var(--cb-text);
      font-size: 1rem;
    }
    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--cb-accent);
      box-shadow: 0 0 0 3px rgba(240, 138, 93, 0.3);
      outline: none;
    }
    button.btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--cb-accent);
      color: #fff;
      border: none;
      cursor: pointer;
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-size: 1rem;
    }
    button.btn:hover {
      background: #d4724f;
    }

    /* ─── Match Panel ─────────────────────────────────────────── */
    #matchResults .result-content {
      margin: 1rem 0;
      font-size: 1.1rem;
    }
    .match-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }
#matchResults .close-btn {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  background: var(--cb-accent);
  color: #fff;
  border-radius: 50%;
  width: 2rem; height: 2rem;
  display: flex; align-items:center; justify-content:center;
 }
    /* ─── Calendar & Time Slots ──────────────────────────────── */
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .month-nav .btn-sm {
      background: var(--cb-primary-alt);
      color: #fff;
    }
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: var(--cb-bg);
      border-radius: var(--radius);
    }
    #calendar .cell {
      padding: 0.75rem;
      background: var(--cb-surface);
      text-align: center;
      cursor: pointer;
      transition: transform var(--transition);
    }
    #calendar .cell.closed {
      background: #f0f0f0;
      color: var(--cb-muted);
      cursor: not-allowed;
    }
    #calendar .cell.open {
      background: var(--cb-accent);
      color: #fff;
      font-weight: bold;
    }
    #calendar .cell.open:hover {
      transform: scale(1.05);
      z-index: 1;
    }
    #calendar .cell.today {
      border: 2px dashed var(--cb-primary);
    }
    #timeSlots h4 {
      font-size: 1.1rem;
      color: var(--cb-primary-alt);
      margin-bottom: 0.5rem;
    }
    #timeSlots ul {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      list-style: none;
      padding: 0;
    }
    #timeSlots ul li button {
      background: var(--cb-primary-alt);
      color: #fff;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      box-shadow: var(--shadow);
      cursor: pointer;
    }

    /* ─── Final Booking ──────────────────────────────────────── */
    #finalBookingForm label {
      margin-bottom: 1rem;
    }

    /* ─── Rich Dashboard ────────────────────────────────────── */
    #feature-rich-dashboard .dashboard-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    #feature-rich-dashboard .dashboard-tabs button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: var(--radius);
      background: var(--cb-primary-alt);
      color: #fff;
      cursor: pointer;
    }
    #feature-rich-dashboard .dashboard-tabs button.active {
      background: var(--cb-accent);
    }
    #feature-rich-dashboard .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--padding);
    }
    #feature-rich-dashboard .card {
      background: var(--cb-surface);
      padding: var(--padding);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    #feature-rich-dashboard .card .details {
      flex: 1;
    }
    #feature-rich-dashboard .card .actions button,
    #feature-rich-dashboard .card .actions a {
      background: var(--cb-primary-alt);
      color: #fff;
      border: none;
      padding: 0.5rem;
      border-radius: var(--radius);
      margin-left: 0.25rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* ─── Toast ─────────────────────────────────────────────── */
    .toast {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      background: var(--cb-primary-alt);
      color: #fff;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      z-index: 2000;
    }
    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* ─── Responsive ───────────────────────────────────────── */
    @media (max-width: 1024px) {
      section.module {
        padding: 0.75rem;
      }
    }
    @media (max-width: 768px) {
      aside#sidebar {
        transform: translateX(-100%);
        position: absolute;
      }
      body.sidebar-open aside#sidebar {
        transform: translateX(0);
      }
      header {
        margin-left: 0;
      }
      main,
      section,
      footer {
        margin-left: 0;
        padding: 0.5rem;
      }
      #hero {
        grid-template-columns: 1fr;
        padding: 1.5rem;
      }
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside id="sidebar">
    <div class="brand">
      <i class="fas fa-calendar-check"></i>
      <span>Vitra AI Consult</span>
    </div>
    <nav>
      <ul>
        <li class="active">
          <a href="#providerMatch"><i class="fas fa-user-md"></i><span>Provider Match</span></a>
        </li>
        <li>
          <a href="#appointmentFlow"><i class="fas fa-calendar-alt"></i><span>Schedule</span></a>
        </li>
        <li>
          <a href="#feature-rich-dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        </li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar"><i class="fas fa-chevron-left"></i></button>
  </aside>

  <!-- Header -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>AI-Powered Consultation Booking</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <main>
    <!-- Hero -->
    <section id="hero" class="module">
      <div class="hero-text">
        <h2><i class="fas fa-stethoscope"></i> Seamless Consultation Booking</h2>
        <p class="desc">From instant provider match to one-click appointment, powered by AI.</p>
        <button class="btn hero-btn"><i class="fas fa-book-medical"></i> Book an Appointment</button>
      </div>
      <div class="hero-graphic">
        <img src="9E2CDE35-303A-4C5F-A4A9-1B0420CF8B0C.png" alt="Consultation illustration" />
      </div>
    </section>

    <!-- Quick Actions -->
    <section id="quickActions" class="module">
      <div class="quick-actions">
        <button class="btn"><i class="fas fa-calendar-plus"></i> Book an Appointment</button>
        <div class="view-tabs">
          <button id="viewUpcoming" class="btn-sm"><i class="fas fa-calendar-check"></i> View Upcoming</button>
          <button id="viewPast" class="btn-sm"><i class="fas fa-history"></i> View Past</button>
        </div>
        <p class="tips"><i class="fas fa-info-circle"></i> Need urgent care? <a id="urgentCare">Click here</a></p>
      </div>
    </section>

    <!-- Provider Matching -->
    <section id="providerMatch" class="module">
      <h2><i class="fas fa-user-md"></i> Personalized Provider Matching</h2>
      <p class="desc">Answer a few questions and get instantly matched to the best in-network specialist.</p>
      <form id="matchForm">
        <label><i class="fas fa-notes-medical"></i> Chief Concern:
          <input type="text" id="concernInput" placeholder="e.g. persistent cough" />
        </label>
        <label><i class="fas fa-exclamation-circle"></i> Urgency:
          <select id="urgencyInput">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
          </select>
        </label>
        <label><i class="fas fa-language"></i> Preferred Language:
          <select id="languageInput">
            <option>English</option>
            <option>Twi</option>
            <option>Ga</option>
            <option>Ewe</option>
          </select>
        </label>
        <button type="button" id="findMatch" class="btn">
          <i class="fas fa-search"></i> Find My Specialist
        </button>
      </form>

      <div id="matchResults" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
        <div id="chooseOwnSelect" hidden>
          <label><i class="fas fa-user-circle"></i> Pick Your Provider:
            <select id="ownProvider"></select>
          </label>
        </div>
        <div class="match-actions">
          <button id="proceedMatch" class="btn"><i class="fas fa-arrow-right"></i> Next</button>
          <button id="chooseOwn" class="btn btn-outline"><i class="fas fa-list"></i> Choose Own</button>
        </div>
      </div>
    </section>

    <!-- Schedule & Confirm -->
    <section id="appointmentFlow" class="module" hidden>
      <h2><i class="fas fa-calendar-alt"></i> Schedule with <span id="chosenProvider"></span></h2>
      <p class="desc">Select an available date, then pick a time slot.</p>
      <div class="month-nav">
        <button type="button" id="prevMonth" class="btn-sm"><i class="fas fa-chevron-left"></i></button>
        <div id="calendarHeader" class="calendar-header"></div>
        <button type="button" id="nextMonth" class="btn-sm"><i class="fas fa-chevron-right"></i></button>
      </div>
      <div id="calendar"></div>
      <div id="timeSlots"></div>

      <form id="finalBookingForm" hidden style="margin-top:1.5rem;">
        <h3><i class="fas fa-user"></i> Confirm Appointment</h3>
        <label><i class="fas fa-id-badge"></i> Your Name:
          <input id="clientNameFinal" placeholder="Full Name" required />
        </label>
        <label><i class="fas fa-envelope"></i> Email:
          <input id="clientEmail" type="email" required />
        </label>
        <label><i class="fas fa-phone"></i> Phone:
          <input id="clientPhone" type="tel" required />
        </label>
        <div id="summarySelection" style="margin-bottom:1rem;"></div>
        <div class="summary-actions">
          <button id="editSelection" type="button" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button id="confirmBookingFinal" type="button" class="btn">
            <i class="fas fa-check"></i> Confirm Booking
          </button>
        </div>
      </form>
    </section>

    <!-- Rich Dashboard -->
    <section id="feature-rich-dashboard" class="module">
      <h2><i class="fas fa-tachometer-alt"></i> Rich Dashboard</h2>
      <div class="dashboard-tabs">
        <button data-tab="rich-upcoming" class="active">
          <i class="fas fa-calendar-check"></i> Upcoming
        </button>
        <button data-tab="rich-past">
          <i class="fas fa-history"></i> Past
        </button>
        <button data-tab="rich-favorites">
          <i class="fas fa-heart"></i> Favorites
        </button>
      </div>
      <div id="rich-upcoming" class="dashboard-cards">
        <!-- upcoming cards injected here -->
      </div>
      <div id="rich-past" class="dashboard-cards" hidden>
        <!-- past cards -->
      </div>
      <div id="rich-favorites" class="dashboard-cards" hidden>
        <!-- favorites -->
      </div>
    </section>
  </main>

  <footer>
    <small>© 2025 AI-Pharmacy Chain — All rights reserved</small>
  </footer>

  <!-- ─── Script ─────────────────────────────────────────────────── -->
<script>
(function () {
  const PHASE = {
    findMatch: "Matching…",
    confirmBooking: "Confirming…",
  };

  function showToast(msg) {
    const t = document.createElement("div");
    t.className = "toast";
    t.innerText = msg;
    document.body.append(t);
    requestAnimationFrame(() => t.classList.add("visible"));
    setTimeout(() => t.remove(), 3000);
  }

  async function callOpenAI(messages) {
    try {
      const res = await fetch("/.netlify/functions/openai-proxy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages }),
      });
      if (!res.ok) throw new Error(await res.text());
      const j = await res.json();
      return j.choices?.[0]?.message?.content.trim() || "";
    } catch (err) {
      console.error("OpenAI error:", err);
      return "";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    // ─── ELEMENTS ─────────────────────────────────────────
    const bodyEl           = document.body;
    const sidebarBtn       = document.getElementById("shrinkSidebar");
    const hamburger        = document.getElementById("hamburger");
    const themeToggle      = document.getElementById("themeToggle");
    const btnBookHero      = document.querySelector("#hero .hero-btn");
    const btnBookQuick     = document.querySelector("#quickActions .btn");
    const btnViewUpcoming  = document.getElementById("viewUpcoming");
    const btnViewPast      = document.getElementById("viewPast");
    const urgentLink       = document.getElementById("urgentCare");

    // Match
    const findMatchBtn     = document.getElementById("findMatch");
    const concernInput     = document.getElementById("concernInput");
    const urgencyInput     = document.getElementById("urgencyInput");
    const languageInput    = document.getElementById("languageInput");
    const matchPanel       = document.getElementById("matchResults");
    const resultContent    = matchPanel.querySelector(".result-content");
    const ownSelect        = document.getElementById("ownProvider");
    const chooseOwnBtn     = document.getElementById("chooseOwn");
    const proceedMatchBtn  = document.getElementById("proceedMatch");

    // Schedule
    const appointmentEl    = document.getElementById("appointmentFlow");
    const calEl            = document.getElementById("calendar");
    const headerEl         = document.getElementById("calendarHeader");
    const prevBtn          = document.getElementById("prevMonth");
    const nextBtn          = document.getElementById("nextMonth");
    const timeSlotsEl      = document.getElementById("timeSlots");
    const finalForm        = document.getElementById("finalBookingForm");
    const clientNameInput  = document.getElementById("clientNameFinal");
    const clientEmail      = document.getElementById("clientEmail");
    const clientPhone      = document.getElementById("clientPhone");
    const summarySelection = document.getElementById("summarySelection");
    const editBtn          = document.getElementById("editSelection");
    const confirmBtn       = document.getElementById("confirmBookingFinal");

    // Rich Dashboard
    const richTabs         = document.querySelectorAll("#feature-rich-dashboard .dashboard-tabs button");
    const richUpcoming     = document.getElementById("rich-upcoming");
    const richPast         = document.getElementById("rich-past");
    const richFavorites    = document.getElementById("rich-favorites");

    // Providers + availability
    const providers = [
      { id: "p1",  name: "Dr. Kwame Asante", spec: "Pulmonologist, Korle Bu" },
      { id: "p2",  name: "Dr. Abena Owusu", spec: "Cardiologist, 37 Military" },
      { id: "p3",  name: "Dr. Kojo Mensah", spec: "Psychiatrist, Ridge" },
      { id: "p4",  name: "Dr. Yaa Dufie", spec: "Dietitian, Nyaho Medical" },
      { id: "p5",  name: "Dr. Nana Adjei", spec: "GP, Cape Coast" },
      { id: "p6",  name: "Dr. Efua Amponsah", spec: "Endocrinologist, LEKMA" },
      { id: "p7",  name: "Dr. Michael Addo", spec: "Neurologist, 37 Military" },
      { id: "p8",  name: "Dr. Grace Ofori", spec: "Dermatologist, Accra Derm." },
      { id: "p9",  name: "Dr. Joseph Kumi", spec: "Ortho Surgeon, Komfo Anokye" },
      { id: "p10", name: "Dr. Ama Brew", spec: "Pediatrician, Trust Hosp." },
      { id: "p11", name: "Ms. Akosua Baah", spec: "PT, Tema General" },
      { id: "p12", name: "Mr. Daniel Boakye", spec: "Pharmacist, Ridge" },
      { id: "p13", name: "Mrs. Esther Kumi", spec: "OT, Cape Coast" },
      { id: "p14", name: "Ms. Joy Mensah", spec: "Speech Therapist, LEKMA" },
      { id: "p15", name: "Dr. Paul Yeboah", spec: "Dermatologist, Korle Bu" },
      { id: "p16", name: "Dr. Linda Frimpong", spec: "Nephrologist, 37 Military" },
      { id: "p17", name: "Mr. Kwesi Owusu", spec: "Nutritionist, Nyaho Med." },
      { id: "p18", name: "Ms. Abena Boateng", spec: "Psychologist, Accra Psych." }
    ];
    const availability = {
      p1:  { "2025-06-10": ["09:00","10:00","11:00"], "2025-06-12": ["14:00","15:00"], "2025-06-15": ["08:30","09:30","10:30"] },
      p2:  { "2025-06-03": ["10:00","13:00","16:00"], "2025-06-04": ["09:00","11:00"], "2025-06-15": ["12:00","14:00"] },
      p3:  { "2025-06-08": ["08:00","09:00","10:00","11:00"], "2025-06-11": ["13:30","14:30"], "2025-06-16": ["15:00","16:00"] },
      p4:  { "2025-06-05": ["09:30","10:30","11:30"], "2025-06-09": ["14:00","15:00","16:00"], "2025-06-18": ["08:00","09:00"] },
      p5:  { "2025-06-07": ["08:15","09:15","10:15"], "2025-06-13": ["13:00","14:00"], "2025-06-17": ["10:00","11:00","12:00"] },
      p6:  { "2025-06-02": ["09:00","10:00"], "2025-06-14": ["11:00","12:00","13:00"], "2025-06-19": ["14:00","15:00"] },
      p7:  { "2025-06-06": ["08:30","09:30","10:30"], "2025-06-12": ["13:00","14:00","15:00"], "2025-06-20": ["09:00","10:00"] },
      p8:  { "2025-06-01": ["10:00","11:00","12:00"], "2025-06-11": ["14:30","15:30"], "2025-06-16": ["08:00","09:00","10:00"] },
      p9:  { "2025-06-04": ["09:00","10:00","11:00"], "2025-06-13": ["13:00","14:00"], "2025-06-18": ["15:00","16:00"] },
      p10: { "2025-06-03": ["08:00","09:00","10:00"], "2025-06-10": ["11:00","12:00","13:00"], "2025-06-17": ["14:00","15:00"] },
      p11: { "2025-06-05": ["09:30","10:30","11:30"], "2025-06-14": ["13:00","14:00","15:00"], "2025-06-19": ["08:00","09:00"] },
      p12: { "2025-06-02": ["10:00","11:00","12:00"], "2025-06-08": ["14:00","15:00"], "2025-06-20": ["09:00","10:00","11:00"] },
      p13: { "2025-06-07": ["08:00","09:00","10:00"], "2025-06-12": ["11:30","12:30","13:30"], "2025-06-18": ["14:00","15:00"] },
      p14: { "2025-06-03": ["09:15","10:15","11:15"], "2025-06-09": ["13:00","14:00","15:00"], "2025-06-16": ["08:00","09:00"] },
      p15: { "2025-06-05": ["08:30","09:30","10:30"], "2025-06-13": ["11:00","12:00","13:00"], "2025-06-19": ["14:30","15:30"] },
      p16: { "2025-06-02": ["10:00","11:00","12:00"], "2025-06-11": ["13:15","14:15"], "2025-06-17": ["09:00","10:00","11:00"] },
      p17: { "2025-06-04": ["09:00","10:00","11:00"], "2025-06-10": ["12:00","13:00","14:00"], "2025-06-15": ["15:00","16:00"] },
      p18: { "2025-06-01": ["08:00","09:00","10:00"], "2025-06-08": ["11:30","12:30","13:30"], "2025-06-20": ["14:00","15:00","16:00"] }
    };

    let currentProviderId = null;
    let currentProviderName = "";
    let displayYear = new Date().getFullYear();
    let displayMonth = new Date().getMonth();
    let selectedDate = "";
    let selectedTime = "";

    // ─── NAVIGATION HELPERS ─────────────────────────────────
    function scrollToSection(id) {
      document.querySelector(id).scrollIntoView({ behavior: "smooth" });
    }

    btnBookHero.addEventListener("click",  () => scrollToSection("#providerMatch"));
    btnBookQuick.addEventListener("click", () => scrollToSection("#providerMatch"));
    btnViewUpcoming.addEventListener("click",() => {
      scrollToSection("#feature-rich-dashboard");
      showRichTab("rich-upcoming");
    });
    btnViewPast.addEventListener("click",() => {
      scrollToSection("#feature-rich-dashboard");
      showRichTab("rich-past");
    });
    urgentLink.addEventListener("click", () => {
      showToast("For immediate care, please call 112 or visit your nearest ER.");
    });

    // ─── SIDEBAR & THEME TOGGLING ───────────────────────────
    sidebarBtn.addEventListener("click", () => {
      bodyEl.classList.toggle("sidebar-shrink");
      const icon = sidebarBtn.querySelector("i");
      icon.classList.toggle("fa-chevron-left");
      icon.classList.toggle("fa-chevron-right");
    });
    hamburger.addEventListener("click", () => {
      bodyEl.classList.toggle("sidebar-open");
      bodyEl.classList.remove("sidebar-shrink");
    });
    themeToggle.addEventListener("click", () => {
      const html = document.documentElement;
      html.classList.toggle("dark");
      html.setAttribute("aria-theme", html.classList.contains("dark") ? "dark" : "light");
      themeToggle.classList.toggle("fa-sun");
      themeToggle.classList.toggle("fa-moon");
    });

    // ─── PROVIDER MATCHING LOGIC (with guaranteed fallback) ───
    findMatchBtn.addEventListener("click", async () => {
      const concern = concernInput.value.trim();
      if (!concern) {
        showToast("Please enter your chief concern.");
        return;
      }

      // disable & show loading
      const origHTML = findMatchBtn.innerHTML;
      findMatchBtn.disabled = true;
      findMatchBtn.innerHTML = `${PHASE.findMatch} <span class="spinner"></span>`;

      let provider = null;
      try {
        const sys = `You are AI match. Providers:\n${providers.map(p => `- ${p.name} – ${p.spec}`).join("\n")}`;
        const usr = `Concern="${concern}", Urgency="${urgencyInput.value}", Language="${languageInput.value}". Pick best provider by exact name only.`;
        const raw = await callOpenAI([
          { role: "system", content: sys },
          { role: "user",   content: usr }
        ]);

        const cleaned = raw.replace(/```[\s\S]*?```/g, "").trim();
        const firstLine = cleaned.split(/\r?\n/)[0] || "";
        const matchName = firstLine.split("–")[0]?.trim();
        provider = providers.find(p => p.name === matchName);
      } catch (e) {
        console.error("Matching error:", e);
      }

      // fallback: random pick
      if (!provider) {
        provider = providers[Math.floor(Math.random() * providers.length)];
      }

      // restore button
      findMatchBtn.disabled = false;
      findMatchBtn.innerHTML = origHTML;

      // show result
      resultContent.innerHTML = `
        <div class="card">
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4><strong>${provider.name}</strong></h4>
            <p>${provider.spec}</p>
          </div>
        </div>`;
      matchPanel.hidden = false;

      chooseOwnBtn.onclick = () => {
   // hide the AI result, show the dropdown
   resultContent.hidden = true;
   const ownContainer = document.getElementById("chooseOwnSelect");
   ownContainer.hidden = false;
   // populate dropdown if empty
   const sel = document.getElementById("ownProvider");
   if (!sel.options.length) {
     providers.forEach(p => {
       const o = document.createElement("option");
       o.value = p.id; o.text = p.name + " – " + p.spec;
       sel.add(o);
     });
   }
   // focus it so user sees it
   sel.focus();
 };
      
      proceedMatchBtn.onclick = () => startAppointment(provider.name, provider.id);
      ownSelect.onchange = e => {
        const sel = providers.find(p => p.id === e.target.value);
        startAppointment(sel.name, sel.id);
      };
      matchPanel.querySelector(".close-btn").onclick = () => {
        matchPanel.hidden = true;
      };
    });

    function startAppointment(name, id) {
      currentProviderName = name;
      currentProviderId   = id;
      document.getElementById("chosenProvider").innerText = name;
      document.getElementById("providerMatch").hidden     = true;
      appointmentEl.hidden = false;
      generateCalendar(displayYear, displayMonth);
    }

    // ─── CALENDAR & BOOKINGS (unchanged) ─────────────────────
    function generateCalendar(yr, mth) {
      headerEl.innerText = new Date(yr, mth).toLocaleString("default", { month:"long", year:"numeric" });
      calEl.innerHTML = "";
      ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(wd => {
        const hd = document.createElement("div");
        hd.className = "cell"; hd.style.fontWeight="600"; hd.innerText=wd;
        calEl.append(hd);
      });
      const firstDay = new Date(yr, mth, 1).getDay();
      for (let i=0; i<firstDay; i++){
        const blank = document.createElement("div");
        blank.className="cell closed"; calEl.append(blank);
      }
      const avail = availability[currentProviderId] || {};
      const today = new Date();
      const daysInMon = new Date(yr, mth+1, 0).getDate();
      for (let d=1; d<=daysInMon; d++){
        const key = `${yr}-${String(mth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
        const open = Array.isArray(avail[key]);
        const cell = document.createElement("div");
        const dateObj = new Date(yr, mth, d);
        const isPast = dateObj < new Date().setHours(0,0,0,0);
        const state = isPast ? "closed" : (open ? "open" : "closed");
        cell.className = `cell ${state}`;
        cell.innerText = d;
          if(open){
          cell.addEventListener("click", ()=>{
            calEl.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));
            cell.classList.add("selected");
            renderTimeSlots(key, avail[key]);
          });
        }
        if(today.getFullYear()===yr && today.getMonth()===mth && today.getDate()===d){
          cell.classList.add("today");
        }
        calEl.append(cell);
      }
      timeSlotsEl.innerHTML="";
    }
    prevBtn.onclick=()=>{
      displayMonth--; if(displayMonth<0){displayMonth=11; displayYear--;}
      generateCalendar(displayYear, displayMonth);
    };
    nextBtn.onclick=()=>{
      displayMonth++; if(displayMonth>11){displayMonth=0; displayYear++;}
      generateCalendar(displayYear, displayMonth);
    };
    function renderTimeSlots(dateKey, slots){
      selectedDate=dateKey;
      timeSlotsEl.innerHTML=`<h4>Available on ${dateKey}:</h4>`;
      const ul=document.createElement("ul");
      slots.forEach(t=>{
        const li=document.createElement("li");
        const btn=document.createElement("button");
        btn.type="button"; btn.className="btn-sm"; btn.innerText=t;
        btn.addEventListener("click", ()=>{
          selectedTime=t; showSummary();
        });
        li.append(btn); ul.append(li);
      });
      timeSlotsEl.append(ul);
    }
    function showSummary(){
      calEl.hidden=true; timeSlotsEl.hidden=true; finalForm.hidden=false;
      summarySelection.innerHTML=`<p><strong>${selectedDate}</strong> at <strong>${selectedTime}</strong></p>`;
    }
    editBtn.addEventListener("click",()=>{
      calEl.hidden=false; timeSlotsEl.hidden=false; finalForm.hidden=true;
      summarySelection.innerHTML="";
      calEl.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));
    });
    confirmBtn.addEventListener("click",()=>{
      const name=clientNameInput.value.trim();
      if(!name) return showToast("Enter your name");
      showToast(PHASE.confirmBooking);
      setTimeout(()=>{
        finalForm.innerHTML=`
          <div class="result-content">
            🎉 Success, <strong>${name}</strong>!<br>
            Your appointment with <strong>${currentProviderName}</strong><br>
            on <strong>${selectedDate}</strong> at <strong>${selectedTime}</strong> is confirmed.
          </div>`;
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4><strong>${currentProviderName}</strong></h4>
            <p>${selectedDate} • ${selectedTime}</p>
          </div>
          <div class="actions">
            <button title="Reschedule"><i class="fas fa-sync-alt"></i></button>
            <button title="Cancel"><i class="fas fa-times"></i></button>
            <a title="Add to Calendar"><i class="fas fa-calendar-plus"></i></a>
          </div>`;
        richUpcoming.append(card);
        scrollToSection("#feature-rich-dashboard");
      },1000);
    });

    // ─── RICH DASHBOARD TABS ─────────────────────────────────
    function showRichTab(tab){
      richUpcoming.hidden  = (tab!=="rich-upcoming");
      richPast.hidden      = (tab!=="rich-past");
      richFavorites.hidden = (tab!=="rich-favorites");
      richTabs.forEach(b=>b.classList.toggle("active", b.dataset.tab===tab));
    }
    richTabs.forEach(btn=>btn.addEventListener("click",()=>showRichTab(btn.dataset.tab)));

    // INITIALIZE
    showRichTab("rich-upcoming");
  });
})();
</script>


</body>
</html>
