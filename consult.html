<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Consultation Booking</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
 <script defer src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
 
  :root {
    --cb-primary: #3b3f88;
    --cb-primary-alt: #5c4d99;
    --cb-accent: #f08a5d;
    --cb-bg: #f7f6f9;
    --cb-surface: #ffffff;
    --cb-text: #2d2d2d;
    --cb-muted: #999999;
    --radius: 0.75rem;
    --padding: 1rem;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: 0.3s ease;
    --sidebar-width: 280px;
    --sidebar-collapsed-width: 80px;
  }

  html.dark {
    --cb-bg: #1a1b2e;
    --cb-surface: #2d2d44;
    --cb-text: #e0e0e0;
    --cb-muted: #aaaaaa;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

   *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    transition: var(--transition);
  }

  body {
    font-family: "Montserrat", sans-serif;
    background: var(--cb-bg);
    color: var(--cb-text);
    line-height: 1.5;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  img {
    max-width: 100%;
    display: block;
  }

  ul,
  ol {
    list-style: none;
  }

  button {
    font-family: inherit;
  }

   aside#sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: var(--sidebar-width);
    background: var(--cb-surface);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    overflow: hidden;
  }

  aside#sidebar .logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: var(--padding);
    background: var(--cb-primary);
    color: #fff;
    font-size: 1.25rem;
  }

  aside#sidebar .logo svg {
    width:2.5rem; height:2.5rem;
  }

  aside#sidebar nav {
    flex: 1;
    overflow-y: auto;
  }

  aside#sidebar nav ul {
    margin-top: 1rem;
  }

  aside#sidebar nav li {
    margin-bottom: 0.25rem;
  }

  aside#sidebar nav li a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem var(--padding);
    border-radius: var(--radius);
    color: var(--cb-text);
    font-weight: 500;
  }

  aside#sidebar nav li.active a,
  aside#sidebar nav li a:hover {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  aside#sidebar nav li a i {
    font-size: 1.25rem;
  }

  #shrinkSidebar {
    background: none;
    border: none;
    font-size: 1.25rem;
    color: var(--cb-primary);
    cursor: pointer;
    margin: var(--padding);
    align-self: flex-end;
  }

  body.sidebar-shrink aside#sidebar {
    width: var(--sidebar-collapsed-width);
  }

  body.sidebar-shrink aside#sidebar .logo span,
  body.sidebar-shrink aside#sidebar nav li a span {
    display: none;
  }

  body.sidebar-shrink aside#sidebar nav li a,
  body.sidebar-shrink aside#sidebar .logo {
    justify-content: center;
  }

  header {
    position: sticky;
    top: 0;
    margin-left: var(--sidebar-width);
    background: var(--cb-surface);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--padding);
    height: 60px;
    box-shadow: var(--shadow);
    z-index: 1001;
  }

  body.sidebar-shrink header {
    margin-left: var(--sidebar-collapsed-width);
  }

  header h1 {
    font-size: 1.25rem;
    color: var(--cb-primary);
  }

  #hamburger,
  #themeToggle {
    font-size: 1.5rem;
    color: var(--cb-primary);
    cursor: pointer;
  }

  #hamburger:hover,
  #themeToggle:hover {
    color: var(--cb-accent);
  }

   main, footer {
    margin-left: var(--sidebar-width);
    padding: var(--padding);
     transition: margin-left var(--transition);
 }
 section.module {
    margin-left: 0;
 }

  body.sidebar-shrink main,
  body.sidebar-shrink footer {
    margin-left: var(--sidebar-collapsed-width);
  }

  body.sidebar-shrink main,
  body.sidebar-shrink section,
  body.sidebar-shrink footer {
    margin-left: calc(var(--sidebar-collapsed-width) - 1rem);
  }

  footer {
    text-align: center;
    padding: var(--padding) 0;
    font-size: 0.875rem;
    color: var(--cb-muted);
  }

   section.module {
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow);
  }

  section.module h2 {
    font-size: 1.5rem;
    color: var(--cb-primary);
    margin-bottom: 0.5rem;
  }

  section.module .desc {
    color: var(--cb-primary-alt);
    margin-bottom: 1rem;
    font-size: 1rem;
  }

   #hero {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
    padding: 2rem var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    align-items: center;
  }

  #hero .hero-text h2 {
    font-size: 2.25rem;
    margin-bottom: 0.5rem;
  }

  #hero .hero-text .desc {
    font-size: 1rem;
    opacity: 0.9;
  }

  #hero .hero-text h2,
  #hero .hero-text .desc {
    color: #ffffff;
  }

  #hero .hero-graphic {
    text-align: center;
  }

  #hero .hero-graphic img {
    max-width: 90%;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  #hero .btn.hero-btn {
    margin-top: var(--padding);
    background: #ffffff;
    color: var(--cb-primary-alt);
    border: none;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: var(--shadow);
    transition: transform 0.2s ease;
  }

  #hero .btn.hero-btn:hover {
    transform: translateY(-2px);
    background: #f0f0f0;
  }

   #quickActions {
    background: var(--cb-primary);
    color: #fff;
  }

  #quickActions .quick-actions {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  #quickActions .quick-actions .btn {
    flex: 1 1 auto;
    min-width: 160px;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    padding: 0.75rem 1rem;
    border-radius: var(--radius);
    font-size: 1rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #quickActions .quick-actions .btn:hover {
    background: #d4724f;
    transform: translateY(-2px);
  }

  #quickActions .view-tabs {
    display: flex;
    gap: 0.5rem;
  }

  #quickActions .view-tabs .btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: 0.9rem;
  }

  #quickActions .view-tabs .btn-sm.active,
  #quickActions .view-tabs .btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #quickActions .tips {
    flex: 1 1 100%;
    text-align: right;
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9rem;
  }

  #quickActions .tips a {
    text-decoration: underline;
    color: var(--cb-accent);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  #quickActions .tips a:hover {
    color: #ffffff;
  }

  form label {
    display: block;
    margin-bottom: 1rem;
    font-weight: 600;
    font-size: 1rem;
  }

  input,
  select,
  textarea,
  button.btn-sm {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--cb-primary-alt);
    border-radius: var(--radius);
    background: var(--cb-bg);
    color: var(--cb-text);
    font-size: 1rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: var(--cb-accent);
    box-shadow: 0 0 0 3px rgba(240, 138, 93, 0.3);
    outline: none;
  }

  button.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    cursor: pointer;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    font-size: 1rem;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  button.btn:hover {
    background: #d4724f;
    transform: translateY(-2px);
  }

  button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  button.btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

   #matchResults,
  #urgentMatchResults {
    position: relative;
    padding: 1.5rem;
    background: var(--cb-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-top: 1rem;
  }

  #matchResults .close-btn,
  #urgentMatchResults .close-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: var(--cb-accent);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #matchResults .close-btn:hover,
  #urgentMatchResults .close-btn:hover {
    background: #d4724f;
    transform: scale(1.1);
  }

  #matchResults .card,
  #urgentMatchResults .card {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  #matchResults .card .details h4,
  #urgentMatchResults .card .details h4 {
    margin-bottom: 0.25rem;
    font-size: 1.1rem;
    color: var(--cb-primary);
  }

  #matchResults .card .details p,
  #urgentMatchResults .card .details p {
    color: var(--cb-text);
    font-size: 0.95rem;
  }
 #matchResults .close-btn i, 
  #urgentMatchResults .close-btn i { color: #fff; }
  #matchResults .btn-sm.back,
  #urgentMatchResults .btn-sm.back {
    position: absolute;
    bottom: var(--padding);
    left: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
  }

  #urgentScheduleBtn {
    background: var(--cb-accent);
    color: #fff;
    margin-right: 0.5rem;
  }

  #urgentScheduleBtn:hover {
    background: #d4724f;
  }

    .month-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .month-nav button {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .month-nav button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #calendar,
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--cb-bg);
    border-radius: var(--radius);
    overflow: hidden;
  }

  #calendar .cell:first-child,
  .calendar-grid .cell:first-child {
    font-weight: 600;
    background: var(--cb-surface);
    text-align: center;
    padding: 0.5rem 0;
  }

  #calendar .cell,
  .calendar-grid .cell {
    background: var(--cb-surface);
    padding: 0.75rem 0.25rem;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
    font-size: 0.95rem;
  }

  #calendar .cell.closed,
  .calendar-grid .cell.closed {
    background: #f0f0f0;
    color: var(--cb-muted);
    cursor: not-allowed;
  }

  #calendar .cell.open,
  .calendar-grid .cell.open {
    background: var(--cb-accent);
    color: #fff;
    font-weight: bold;
  }

  #calendar .cell.open:hover,
  .calendar-grid .cell.open:hover {
    transform: scale(1.05);
    z-index: 1;
  }

  #calendar .cell.today,
  .calendar-grid .cell.today {
    border: 2px dashed var(--cb-primary);
  }

  #timeSlots {
    margin-top: 1rem;
  }

  #timeSlots h4 {
    font-size: 1.1rem;
    color: var(--cb-primary-alt);
    margin-bottom: 0.5rem;
  }

  #timeSlots ul {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0;
    list-style: none;
  }

  #timeSlots ul li button {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
    font-size: 0.9rem;
  }

  #timeSlots ul li button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #confirmForm {
    margin-top: 1rem;
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: var(--shadow);
  }

  #confirmForm .btn-sm.back {
    position: absolute;
    top: var(--padding);
    left: var(--padding);
    background: var(--cb-primary-alt);
    color: #fff;
  }

  #confirmForm .btn-sm.close-btn {
    position: absolute;
    top: var(--padding);
    right: var(--padding);
    background: var(--cb-accent);
    color: #fff;
  }

  #confirmForm h4 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
    color: var(--cb-primary);
  }

  #confirmForm label {
    margin-bottom: 1rem;
    font-weight: 600;
  }

   #feature-rich-dashboard .dashboard-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  #feature-rich-dashboard .dashboard-tabs button {
    flex: 1;
    padding: 0.75rem;
    border: none;
    border-radius: var(--radius);
    background: var(--cb-primary-alt);
    color: #fff;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #feature-rich-dashboard .dashboard-tabs button.active,
  #feature-rich-dashboard .dashboard-tabs button:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  #feature-rich-dashboard .dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--padding);
  }

  #feature-rich-dashboard .card {
    background: var(--cb-surface);
    padding: var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
  }

  #feature-rich-dashboard .card i {
    font-size: 1.75rem;
    color: var(--cb-primary-alt);
  }

  #feature-rich-dashboard .card .details h4 {
    margin-bottom: 0.25rem;
    font-size: 1.1rem;
    color: var(--cb-primary);
  }

  #feature-rich-dashboard .card .details p {
    color: var(--cb-text);
    font-size: 0.9rem;
  }

  #feature-rich-dashboard .card .actions {
    margin-left: auto;
    display: flex;
    gap: 0.5rem;
  }

  #feature-rich-dashboard .card .actions button,
  #feature-rich-dashboard .card .actions a {
    background: var(--cb-primary-alt);
    color: #fff;
    border: none;
    padding: 0.5rem;
    border-radius: var(--radius);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.9rem;
    box-shadow: var(--shadow);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  #feature-rich-dashboard .card .actions button:hover,
  #feature-rich-dashboard .card .actions a:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

   #upcomingCalendarWidget {
    margin-top: 1rem;
  }

  #upcomingCalendarWidget h4 {
    margin-bottom: 0.5rem;
    font-size: 1.25rem;
    color: var(--cb-primary);
    text-align: center;
  }

  #upcomingCalendarWidget .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--cb-bg);
    border-radius: var(--radius);
    overflow: hidden;
  }

  #upcomingCalendarWidget .calendar-grid .cell {
    background: var(--cb-surface);
    padding: 0.75rem 0.25rem;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
    font-size: 0.95rem;
  }

  #upcomingCalendarWidget .calendar-grid .cell.closed {
    background: #f0f0f0;
    color: var(--cb-muted);
    cursor: not-allowed;
  }

  #upcomingCalendarWidget .calendar-grid .cell.open {
    background: var(--cb-accent);
    color: #fff;
    font-weight: bold;
  }

  #upcomingCalendarWidget .calendar-grid .cell.open:hover {
    transform: scale(1.05);
    z-index: 1;
  }

  #upcomingCalendarWidget .calendar-grid .cell.today {
    border: 2px dashed var(--cb-primary);
  }

    .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }

  .modal[hidden] {
    display: none !important;
  }

  .modal .modal-content {
    background: var(--cb-surface);
    padding: 1.5rem;
    border-radius: var(--radius);
    max-width: 400px;
    width: 90%;
    box-shadow: var(--shadow);
    position: relative;
  }

  .modal .modal-content h3 {
    margin-top: 0;
    color: var(--cb-primary);
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  .modal .modal-content p {
    margin-bottom: 1rem;
    color: var(--cb-text);
    font-size: 1rem;
  }

  .modal .modal-content button {
    margin-right: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 0.9rem;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .modal .modal-content button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  .modal .modal-content button.btn-sm:hover {
    background: var(--cb-accent);
    transform: translateY(-1px);
  }

  .modal .modal-content button.btn {
    background: var(--cb-accent);
    color: #fff;
  }

  .modal .modal-content button.btn:hover {
    background: #d4724f;
    transform: translateY(-1px);
  }

   .toast {
    position: fixed;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    background: var(--cb-primary-alt);
    color: #fff;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 2000;
  }

  .toast.visible {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

   @media (max-width: 1024px) {
    section.module {
      padding: 0.75rem;
    }
  }

  @media (max-width: 768px) {
    aside#sidebar {
      transform: translateX(-100%);
      position: absolute;
    }
    body.sidebar-open aside#sidebar {
      transform: translateX(0);
    }
    header {
      margin-left: 0;
    }
    main,
    section,
    footer {
      margin-left: 0;
      padding: 0.5rem;
    }
    #hero {
      grid-template-columns: 1fr;
      padding: 1.5rem var(--padding);
    }
    #hero .hero-graphic img {
      max-width: 100%;
    }
    #feature-rich-dashboard .dashboard-cards {
      grid-template-columns: 1fr;
    }
  }

  
   html.dark body {
    background: var(--cb-bg);
    color: var(--cb-text);
  }

  html.dark aside#sidebar {
    background: var(--cb-surface);
  }

  html.dark header {
    background: var(--cb-surface);
    box-shadow: var(--shadow);
  }

  html.dark section.module {
    background: var(--cb-surface);
    box-shadow: var(--shadow);
  }

  html.dark #hero {
    background: var(--cb-primary-alt);
  }

  html.dark #hero .hero-text h2,
  html.dark #hero .hero-text .desc {
    color: #ffffff;
  }

  html.dark #hero .btn.hero-btn {
    background: #ffffff;
    color: var(--cb-primary-alt);
  }

  html.dark input,
  html.dark select,
  html.dark textarea {
    background: var(--cb-bg);
    color: var(--cb-text);
    border-color: var(--cb-primary-alt);
  }

  html.dark button.btn,
  html.dark button.btn-sm {
    background: var(--cb-primary-alt);
    color: #fff;
  }

  html.dark button.btn:hover,
  html.dark button.btn-sm:hover {
    background: var(--cb-accent);
  }

  html.dark #calendar .cell.closed {
    background: #3b3f88;
    color: #aaa;
  }

  html.dark #calendar .cell.open {
    background: #f08a5d;
    color: #111;
  }
  .link-style {
  background: none;
  border: none;
  color: var(--cb-accent);
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
  font: inherit;
}
.link-style:hover {
  color: #ffffff;
}
  #feature-rich-dashboard .card .actions .btn-reschedule,
#feature-rich-dashboard .card .actions .btn-cancel {
  background: var(--cb-primary);        
  color: #fff;                         
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  border: none;
  transition: background var(--transition), transform var(--transition);
  margin-left: 0.25rem;               
}

#feature-rich-dashboard .card .actions .btn-reschedule i,
#feature-rich-dashboard .card .actions .btn-cancel i {
  font-size: 1rem;                     
}

#feature-rich-dashboard .card .actions .btn-reschedule:hover {
  background: var(--cb-accent);        
  transform: translateY(-2px);
}

#feature-rich-dashboard .card .actions .btn-cancel:hover {
  background: #d4724f;                  
  transform: translateY(-2px);
}
#feature-rich-dashboard .card .actions .btn-reschedule:hover::after,
#feature-rich-dashboard .card .actions .btn-cancel:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.75);
  color: #fff;
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  border-radius: 0.25rem;
  white-space: nowrap;
  pointer-events: none;
}
  .modal .modal-content {
  background: var(--cb-surface);
  padding: 2rem;                          
  border-radius: var(--radius);
  max-width: 480px;                       
  width: 90%;
  box-shadow: var(--shadow);
  text-align: center;                      
  position: relative;
}

.modal .modal-content h3 {
  font-size: 1.75rem;
  margin-bottom: 1rem;
  color: var(--cb-primary);
}

.modal .modal-content p {
  margin-bottom: 1.25rem;
  color: var(--cb-text);
  font-size: 1rem;
}

.modal .modal-content button {
  margin: 0.5rem 0.25rem;
  padding: 0.75rem 1.25rem;
  font-size: 1rem;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}

.modal .modal-content button.btn-sm {
  background: var(--cb-primary-alt);
  color: #fff;
  font-size: 0.9rem;
}

.modal .modal-content button.btn-sm:hover {
  background: var(--cb-accent);
  transform: translateY(-2px);
}

.modal .modal-content button.btn {
  background: var(--cb-accent);
  color: #fff;
}

.modal .modal-content button.btn:hover {
  background: #d4724f;
  transform: translateY(-2px);
}

.modal .modal-content .btn-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: transparent;
  color: var(--cb-text);
  font-size: 1.25rem;
  line-height: 1;
  border: none;
}

.modal .modal-content .btn-close:hover {
  color: var(--cb-accent);
  transform: scale(1.1);
}
  #hamburger {
  display: none;
}

@media (max-width: 768px) {
  #hamburger {
    display: block;
    font-size: 1.5rem;
    cursor: pointer;
  }
  #shrinkSidebar {
    display: none;
  }

  aside#sidebar {
    transform: translateX(-100%);
    position: absolute;
    transition: transform var(--transition);
  }

  body.sidebar-open aside#sidebar {
    transform: translateX(0);
  }

  header {
    margin-left: 0 !important;
  }
  main,
  footer {
    margin-left: 0 !important;
    padding: 0.5rem;
  }
}
#feature-rich-dashboard .card .actions .btn-reschedule,
#feature-rich-dashboard .card .actions .btn-cancel {
  background: var(--cb-primary);
  color: #fff;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  border: none;
  transition: background var(--transition), transform var(--transition);
  margin-left: 0.25rem;
}
#feature-rich-dashboard .card .actions .btn-reschedule i,
#feature-rich-dashboard .card .actions .btn-cancel i {
  font-size: 1rem;
}
#feature-rich-dashboard .card .actions .btn-reschedule:hover {
  background: var(--cb-accent);
  transform: translateY(-2px);
}
#feature-rich-dashboard .card .actions .btn-cancel:hover {
  background: #d4724f;
  transform: translateY(-2px);
}


</style>
</head>


<body>

  <aside id="sidebar">
 <a style="text-decoration: none;" href="dashboard.html">  <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--primary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg> <span class="logo-text">Vitra AI</span>
    </div> </a>

    <nav>
      <ul>
         <li>
     <a href="herbal.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
        </li>
         <li>
    <a href="psychology.html"><i class="fas fa-brain"></i><span>Psychology & Mental Health</span></a>
        </li> <li>
    <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
        </li>
         <li>
    <a href="epharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
        </li>
        <li class="active">
 <a href="consult.html" id="consult-link" style="position:relative;">
      <i class="fas fa-calendar-check"></i><span>Consultation Booking</span></a>
        </li>
  <li>
    <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        </li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar">
      <i class="fas fa-chevron-left"></i>
    </button>
  </aside>

  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>AI-Powered Consultation Booking</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <main>
    <section id="hero" class="module">
      <div class="hero-text">
        <h2><i class="fas fa-stethoscope"></i> Seamless Consultation Booking</h2>
        <p class="desc">From instant provider match to one-click appointment, powered by AI.</p>
        <button id="heroBookBtn" data-target="#providerMatch" class="btn hero-btn">
          <i class="fas fa-book-medical"></i> Book an Appointment
        </button> <br>
         <p class="tips">
          <i class="fas fa-info-circle"></i>
          Need urgent care? <button id="urgentCare" type="button" class="link-style">Click here</button>
        </p>
      </div>
      <div class="hero-graphic">
        <img src="9E2CDE35-303A-4C5F-A4A9-1B0420CF8B0C.png" alt="Consultation illustration" />
      </div>
    </section>

    <section id="urgentBooking" class="module" hidden>
      <h2><i class="fas fa-exclamation-triangle"></i> Urgent Appointment</h2>
      <p class="desc">Describe your concern, pick a specialist, then choose date/time. ₵500 non-refundable fee.</p>

      <div id="urgentStep1">
        <label>
          <i class="fas fa-notes-medical"></i> Chief Concern:
          <input
            type="text"
            id="urgentConcernInput"
            placeholder="e.g. severe headache"
            required
          />
        </label>
        <button type="button" id="urgentFindMatchBtn" class="btn">
          <i class="fas fa-search"></i> Find Specialist
        </button>
      </div>

      <div id="urgentMatchResults" class="response" hidden>
        <button class="close-btn" id="urgentStep2Close" style="display: none;"><i class="fas fa-times"></i></button>
        <div class="card">
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4 id="urgentMatchedName"></h4>
            <p id="urgentMatchedSpec"></p>
          </div>
        </div>
        <button id="urgentScheduleBtn" class="btn">
          <i class="fas fa-calendar-alt"></i> Schedule
        </button>
        <button class="btn-sm back" id="urgentStep2Back" style="display: none;">Back</button>
      </div>

      <div id="urgentCalendarFlow" hidden>
        <button class="btn-sm back" id="urgentStep3Back" style="display: none;">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <label>Date: <input type="date" id="urgentDate" /></label>
        <label>Time: <input type="time" id="urgentTime" /></label>
        <button id="urgentNextToDetails" class="btn"><i class="fas fa-arrow-right"></i> Next</button>
        <button class="btn-sm close-btn" id="urgentStep3Close" style="display: none;"><i class="fas fa-times"></i></button>
      </div>

      <form id="urgentDetailsForm" class="module" hidden>
        <button type="button" class="btn-sm back" id="urgentStep4Back" style="display: none;">
          <i class="fas fa-arrow-left" style="display: none;"></i> Back
        </button>
        <button type="button" class="btn-sm close-btn" id="urgentStep4Close"><i class="fas fa-times"></i></button>
        <label>
          <i class="fas fa-user"></i> Your Name:
          <input id="urgentClientName" placeholder="Full Name" required />
        </label>
        <label>
          <i class="fas fa-envelope"></i> Email:
          <input id="urgentClientEmail" type="email" required />
        </label>
        <button type="button" id="urgentConfirmBtn" class="btn">
          <i class="fas fa-check"></i> Review & Pay
        </button>
      </form>
    </section>

    <section id="providerMatch" class="module">
      <h2><i class="fas fa-user-md"></i> Find Your Specialist</h2>
      <p class="desc">Describe your health concern and let our AI pick the best in-network professional.</p>

      <form id="matchForm">
        <label>
          <i class="fas fa-notes-medical"></i> Chief Concern:
          <input
            type="text"
            id="concernInput"
            placeholder="e.g. persistent cough"
            required
          />
        </label>
        <label>
          <i class="fas fa-exclamation-circle"></i> Urgency:
          <select id="urgencyInput">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
          </select>
        </label>
        <label>
          <i class="fas fa-language"></i> Language:
          <select id="languageInput">
            <option>English</option>
            <option>Twi</option>
            <option>Ga</option>
          </select>
        </label>
        <button type="button" id="findMatchBtn" class="btn">
          <i class="fas fa-search"></i>Find Specialist
        </button>
      </form>

      <div id="matchResults" class="response" hidden>
<button class="close-btn" id="matchResultsClose"><i class="fas fa-times"></i></button>
    <button class="btn-sm back" id="matchResultsBack" style="display: none;">Back</button>
        <div class="card">
          <i class="fas fa-user-md fa-2x"></i>
          <div class="details">
            <h4 id="matchedName"></h4>
            <p id="matchedSpec"></p>
          </div>
        </div>
        <button id="scheduleMatchBtn" class="btn"><i class="fas fa-calendar-alt"></i> Schedule</button>
      </div>

      <div id="appointmentFlow" hidden>
        <button class="btn-sm close-btn" id="appointmentFlowClose"><i class="fas fa-times"></i></button>
        <h3><i class="fas fa-calendar-alt"></i> Schedule with <span id="chosenProvider"></span></h3>
        <div class="month-nav">
          <button id="prevMonth" class="btn-sm"><i class="fas fa-chevron-left"></i></button>
          <div id="calendarHeader"></div>
          <button id="nextMonth" class="btn-sm"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div id="calendar" class="calendar-grid"></div>
        <div id="timeSlots"></div>

        <form id="confirmForm" class="module" hidden>
          <button class="btn-sm close-btn" id="confirmStep4Close"><i class="fas fa-times"></i></button>
          <button class="btn-sm back" id="confirmStep4Back">Back</button>
          <h4><i class="fas fa-check-circle"></i> Confirm</h4>
          <label>
            <i class="fas fa-user"></i> Your Name:
            <input id="clientName" placeholder="Full Name" required />
          </label>
          <label>
            <i class="fas fa-envelope"></i> Email:
            <input id="clientEmail" type="email" required />
          </label>
          <p id="summaryText"></p>
          <button id="confirmBtn" type="button" class="btn"><i class="fas fa-check"></i> Confirm</button>
        </form>
      </div>
    </section>

    <section id="feature-rich-dashboard" class="module">
      <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
      <div class="dashboard-tabs">
        <button data-tab="rich-upcoming" class="active"><i class="fas fa-calendar-check"></i> Upcoming</button>
        <button data-tab="rich-past"><i class="fas fa-history"></i> Past</button>
        <button data-tab="rich-favorites"><i class="fas fa-heart"></i> Favorites</button>
      </div>
      <div id="rich-upcoming" class="dashboard-cards"></div>
      <div id="rich-past" class="dashboard-cards" hidden></div>
      <div id="rich-favorites" class="dashboard-cards" hidden></div>
    </section>

    <section id="upcomingCalendar" class="module">
      <h2><i class="fas fa-calendar-alt"></i> Your Upcoming Appointments</h2>
      <p class="desc">Click any marked date to view details.</p>
      <div id="upcomingCalendarWidget"></div>
    </section>
  </main>

  <div id="confirmModal" class="modal" hidden>
    <div class="modal-content">
      <h3>Review Your Appointment</h3>
      <div id="confirmDetails"></div>
      <button id="modalEdit" class="btn-sm">Edit</button>
      <button id="modalConfirm" class="btn">Confirm Booking</button>
      <button id="modalClose" class="btn-sm">Cancel</button>
    </div>
  </div>

  <div id="cancelModal" class="modal" hidden>
    <div class="modal-content">
      <h3>Cancel Appointment?</h3>
      <p id="cancelMsg"></p>
      <button id="cancelNo" class="btn-sm">No, Keep It</button>
      <button id="cancelYes" class="btn">Yes, Cancel</button>
    </div>
  </div>

  <footer>
    <small>© 2025 AI-Pharmacy Chain — All rights reserved</small>
  </footer>



 <script defer src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="storage.js"></script>
  <script defer>
     let uid;
 const firebaseConfig = {
   apiKey: "AIzaSyBhaYOcLMXuobCT-vaXr-zXTZnBfaheAIY",
   authDomain: "vitra-ai-712ea.firebaseapp.com",
   projectId: "vitra-ai-712ea",
   storageBucket: "vitra-ai-712ea.appspot.com",
   messagingSenderId: "306868103753",
   appId: "1:306868103753:web:e2d7700f8ad34c1e17ed98"
 };
 firebase.initializeApp(firebaseConfig);
 const auth = firebase.auth();
 const db   = firebase.firestore();

auth.onAuthStateChanged(user => {
    if (!user) {
      location.href = "index.html?modal=signin";
      return;
    }
   uid = user.uid;
   db.collection('users').doc(uid)
     .collection('appointments')
     .get()
     .then(snap => {
       snap.docs.forEach(d => {
         const a = d.data();
         appointments.push(a);
         addToRichDashboard(a);
       });
       renderUpcomingCalendarWidget();
     })
     .catch(err => console.error("Failed loading appointments:", err));

   initConsultPage();
  });
function initConsultPage() {

  const providers = [
    {
      id: "p1",
      name: "Dr. Kwame Asante",
      specialty: "Pulmonologist",
      facility: "Korle Bu Teaching Hospital",
      description: `
        Dr. Kwame Asante is a consultant pulmonologist with 15 years of experience 
        treating complex lung conditions (e.g. COPD, asthma, pneumonia). He focuses 
        on diagnostic bronchoscopy and long‐term management of chronic respiratory diseases. 
        He has published research on tuberculosis diagnosis in Ghanaian adults.
      `
    },
    {
      id: "p2",
      name: "Dr. Abena Owusu",
      specialty: "Cardiologist",
      facility: "37 Military Hospital",
      description: `
        Dr. Abena Owusu is a board‐certified cardiologist with 10 years’ experience 
        managing ischemic heart disease, heart failure, and arrhythmias. She routinely 
        performs echocardiograms and stress tests, and excels at hypertensive emergencies 
        and advanced heart failure therapies.
      `
    },
    {
      id: "p3",
      name: "Dr. Kojo Mensah",
      specialty: "Psychiatrist",
      facility: "Ridge Hospital",
      description: `
        Dr. Kojo Mensah is a consultant psychiatrist specializing in mood disorders 
        (depression, bipolar), anxiety, and schizophrenia. He has 12 years of experience 
        in both inpatient and outpatient psychiatric care. He leads CBT groups for depression 
        and treats resistant cases as well as early‐onset psychosis.
      `
    },
    {
      id: "p4",
      name: "Dr. Yaa Dufie",
      specialty: "Clinical Dietitian",
      facility: "Nyaho Medical Centre",
      description: `
        Dr. Yaa Dufie is a registered clinical dietitian with expertise in diabetes 
        management, obesity treatment, and renal nutrition. With 8 years in hospital 
        practice, she designs personalized meal plans, counsels on weight management, 
        and monitors nutrition for renal failure patients.
      `
    },
    {
      id: "p5",
      name: "Dr. Nana Adjei",
      specialty: "General Practitioner",
      facility: "Cape Coast Teaching Hospital",
      description: `
        Dr. Nana Adjei is a general practitioner with 10 years of experience in primary 
        care. He diagnoses and treats a wide range of common illnesses (hypertension, diabetes, 
        viral infections) and refers patients to specialists as needed. He also runs a minor surgery 
        clinic for wound care and suturing.
      `
    },
    {
      id: "p6",
      name: "Dr. Efua Amponsah",
      specialty: "Endocrinologist",
      facility: "LEKMA Hospital",
      description: `
        Dr. Efua Amponsah is an endocrinologist with 12 years’ experience in managing 
        diabetes, thyroid disorders, and adrenal diseases. She conducts thyroid ultrasounds, 
        manages insulin pump therapy, and provides ongoing education for diabetic patients.
      `
    },
    {
      id: "p7",
      name: "Dr. Michael Addo",
      specialty: "Neurologist",
      facility: "37 Military Hospital",
      description: `
        Dr. Michael Addo is a neurologist specializing in stroke, epilepsy, and migraines. 
        With 9 years of experience, he interprets EEGs, orders and reads MRIs, and manages 
        seizure disorders. He also handles acute stroke thrombolysis and outpatient follow-up.
      `
    },
    {
      id: "p8",
      name: "Dr. Grace Ofori",
      specialty: "Dermatologist",
      facility: "Accra Dermatology Centre",
      description: `
        Dr. Grace Ofori is a dermatologist who treats acne, eczema, psoriasis, and skin infections. 
        With 7 years in practice, she performs skin biopsies, patch testing for allergies, 
        and cosmetic procedures like chemical peels. She also manages chronic dermatologic conditions 
        in both adults and children.
      `
    },
    {
      id: "p9",
      name: "Dr. Joseph Kumi",
      specialty: "Orthopedic Surgeon",
      facility: "Komfo Anokye Teaching Hospital",
      description: `
        Dr. Joseph Kumi is an orthopedic surgeon specializing in fractures, joint replacements, 
        and sports injuries. With 11 years’ experience, he performs hip and knee arthroplasties, 
        arthroscopic ACL repairs, and fracture fixations. He also leads a sports medicine clinic 
        for athletes and active adults.
      `
    },
    {
      id: "p10",
      name: "Dr. Ama Brew",
      specialty: "Pediatrician",
      facility: "The Trust Hospital",
      description: `
        Dr. Ama Brew is a pediatrician with expertise in neonatal care, childhood infections, 
        and developmental monitoring. Over 8 years, she has managed NICU patients, vaccine 
        schedules, and common pediatric illnesses (bronchiolitis, pneumonia). She also runs growth and 
        nutrition assessments for children under five.
      `
    },
    {
      id: "p11",
      name: "Ms. Akosua Baah",
      specialty: "Physiotherapist",
      facility: "Tema General Hospital",
      description: `
        Ms. Akosua Baah is a physiotherapist focusing on orthopedic rehabilitation, 
        post-surgical mobility, and sports injury recovery. With 6 years of experience, 
        she guides patients through exercises for back pain, knee replacement rehab, 
        and sports injury prevention.
      `
    },
    {
      id: "p12",
      name: "Mr. Daniel Boakye",
      specialty: "Pharmacist",
      facility: "Ridge Hospital Pharmacy",
      description: `
        Mr. Daniel Boakye is a clinical pharmacist specializing in medication therapy 
        management, drug interactions, and patient counseling. He has 5 years of experience 
        overseeing dispensation of antibiotics, chronic disease medications (antihypertensives, 
        antidiabetics), and advising on OTC vs prescription use.
      `
    },
    {
      id: "p13",
      name: "Mrs. Esther Kumi",
      specialty: "Occupational Therapist",
      facility: "Cape Coast Teaching Hospital",
      description: `
        Mrs. Esther Kumi is an occupational therapist with 7 years in pediatric and adult 
        rehab. She helps stroke survivors relearn daily tasks, provides adaptive equipment 
        for spinal cord injury patients, and runs sensory integration sessions for children 
        with autism.
      `
    },
    {
      id: "p14",
      name: "Ms. Joy Mensah",
      specialty: "Speech & Language Therapist",
      facility: "LEKMA Hospital",
      description: `
        Ms. Joy Mensah is a speech and language therapist who treats communication disorders, 
        swallowing difficulties, and developmental speech delays. In her 6 years of practice, 
        she has worked with post-stroke aphasia patients, pediatric speech delay, and voice 
        therapy for singers.
      `
    },
    {
      id: "p15",
      name: "Dr. Paul Yeboah",
      specialty: "Dermatologist",
      facility: "Korle Bu Teaching Hospital",
      description: `
        Dr. Paul Yeboah is a senior dermatologist focusing on surgical dermatology, 
        malignant melanoma, and chronic skin diseases. With 14 years’ experience, he 
        performs excisions of suspicious lesions, manages phototherapy for psoriasis, 
        and leads a melanoma screening program.
      `
    },
    {
      id: "p16",
      name: "Dr. Linda Frimpong",
      specialty: "Nephrologist",
      facility: "37 Military Hospital",
      description: `
        Dr. Linda Frimpong is a nephrologist specializing in chronic kidney disease, 
        dialysis, and hypertension management. Over 10 years, she has managed CKD clinics, 
        initiated hemodialysis programs, and treated acute renal failure in ICU settings.
      `
    },
    {
      id: "p17",
      name: "Mr. Kwesi Owusu",
      specialty: "Nutritionist",
      facility: "Nyaho Medical Centre",
      description: `
        Mr. Kwesi Owusu is a nutritionist specializing in sports nutrition, pediatric 
        nutrition, and weight management. He has 5 years of experience developing meal 
        plans for athletes, counseling diabetic children, and creating community 
        nutrition workshops on healthy eating.
      `
    },
    {
      id: "p18",
      name: "Ms. Abena Boateng",
      specialty: "Psychologist",
      facility: "Accra Psychology & Counselling Centre",
      description: `
        Ms. Abena Boateng is a clinical psychologist focusing on cognitive behavioral 
        therapy (CBT), trauma counseling, and stress management. With 8 years in practice, 
        she works with PTSD survivors, adolescent depression, and provides group therapy 
        for anxiety disorders.
      `
    }
  ];

  const availability = {
    p1:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-20": ["09:00","10:00","11:00"], "2025-06-17": ["14:00","15:00"], "2025-06-25": ["08:30","09:30","10:30"] },
    p2:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-23": ["10:00","13:00","16:00"], "2025-06-19": ["09:00","11:00"], "2025-06-25": ["12:00","14:00"] },
    p3:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-28": ["08:00","09:00","10:00","11:00"], "2025-06-18": ["13:30","14:30"], "2025-06-26": ["15:00","16:00"] },
    p4:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-25": ["09:30","10:30","11:30"], "2025-06-19": ["14:00","15:00","16:00"], "2025-06-28": ["08:00","09:00"] },
    p5:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-27": ["08:15","09:15","10:15"], "2025-06-17": ["13:00","14:00"], "2025-06-20": ["10:00","11:00","12:00"] },
    p6:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-22": ["09:00","10:00"], "2025-06-18": ["11:00","12:00","13:00"], "2025-06-29": ["14:00","15:00"] },
    p7:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-26": ["08:30","09:30","10:30"], "2025-06-17": ["13:00","14:00","15:00"], "2025-06-20": ["09:00","10:00"] },
    p8:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-21": ["10:00","11:00","12:00"], "2025-06-19": ["14:30","15:30"], "2025-06-26": ["08:00","09:00","10:00"] },
    p9:  { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-24": ["09:00","10:00","11:00"], "2025-06-18": ["13:00","14:00"], "2025-06-28": ["15:00","16:00"] },
    p10: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-23": ["08:00","09:00","10:00"], "2025-06-17": ["11:00","12:00","13:00"], "2025-06-27": ["14:00","15:00"] },
    p11: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-25": ["09:30","10:30","11:30"], "2025-06-19": ["13:00","14:00","15:00"], "2025-06-29": ["08:00","09:00"] },
    p12: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-22": ["10:00","11:00","12:00"], "2025-06-18": ["14:00","15:00"], "2025-06-30": ["09:00","10:00","11:00"] },
    p13: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-27": ["08:00","09:00","10:00"], "2025-06-18": ["11:30","12:30","13:30"], "2025-06-28": ["14:00","15:00"] },
    p14: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-23": ["09:15","10:15","11:15"], "2025-06-19": ["13:00","14:00","15:00"], "2025-06-26": ["08:00","09:00"] },
    p15: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-25": ["08:30","09:30","10:30"], "2025-06-16": ["11:00","12:00","13:00"], "2025-06-29": ["14:30","15:30"] },
    p16: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-22": ["10:00","11:00","12:00"], "2025-06-17": ["13:15","14:15"], "2025-06-27": ["09:00","10:00","11:00"] },
    p17: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-24": ["09:00","10:00","11:00"], "2025-06-18": ["12:00","13:00","14:00"], "2025-06-25": ["15:00","16:00"] },
    p18: { "2025-06-15": ["09:30","10:30","12:00"], "2025-06-21": ["08:00","09:00","10:00"], "2025-06-18": ["11:30","12:30","13:30"], "2025-06-30": ["14:00","15:00","16:00"] }
  };

  const symptomMap = {
    cough: "p1", wheeze: "p1", asthma: "p1", pneumonia: "p1", bronchitis: "p1",
    chestpain: "p2", "chest pain": "p2", palpitations: "p2", "shortness of breath": "p2",
    anxiety: "p3", depression: "p3", insomnia: "p3", schizophrenia: "p3",
    diabetes: "p4", weight: "p4", nutrition: "p4",
    fatigue: "p5", weakness: "p5", fever: "p5", pain: "p5",
    thyroid: "p6", endocrine: "p6", "blood sugar": "p6",
    headache: "p7", migraine: "p7", seizure: "p7", nerve: "p7",
    rash: "p8", acne: "p8", eczema: "p8", skin: "p8",
    fracture: "p9", joint: "p9", bone: "p9",
    child: "p10", kids: "p10", pediatric: "p10",
    rehab: "p11", mobility: "p11",
    medication: "p12", drug: "p12",
    occupational: "p13",
    speech: "p14",
    kidney: "p16", renal: "p16",
    diet: "p17",
    psychologist: "p18", counsel: "p18"
  };

  const URGENT_FEE_KOBO = 500 * 100;

  let year               = new Date().getFullYear();
  let month              = new Date().getMonth();
  let selDate            = "";    
  let selTime            = "";    
  let urgentProviderName = "";    
  let uDate              = "";    
  let uTime              = "";   
  let urgentFlow         = false; 
  let providerId         = "";   
  let providerName       = "";    
  let widgetYear         = new Date().getFullYear(); 
  let widgetMonth        = new Date().getMonth();   

  const sidebar               = document.getElementById("sidebar");
  const hamburger             = document.getElementById("hamburger");
  const shrinkSidebarBtn      = document.getElementById("shrinkSidebar");
  const themeToggle           = document.getElementById("themeToggle");
  const heroBookBtn           = document.getElementById("heroBookBtn");
  const urgentCareLink        = document.getElementById("urgentCare");

  const urgentBooking         = document.getElementById("urgentBooking");
  const urgentStep1           = document.getElementById("urgentStep1");
  const urgentMatchResults    = document.getElementById("urgentMatchResults");
  const urgentCalendarFlow    = document.getElementById("urgentCalendarFlow");
  const urgentDetailsForm     = document.getElementById("urgentDetailsForm");
  const urgentFindMatchBtn    = document.getElementById("urgentFindMatchBtn");
  const urgentMatchedName     = document.getElementById("urgentMatchedName");
  const urgentMatchedSpec     = document.getElementById("urgentMatchedSpec");
  const urgentScheduleBtn     = document.getElementById("urgentScheduleBtn");
  const urgentDate            = document.getElementById("urgentDate");
  const urgentTime            = document.getElementById("urgentTime");
  const urgentNextToDetails   = document.getElementById("urgentNextToDetails");
  const urgentClientName      = document.getElementById("urgentClientName");
  const urgentClientEmail     = document.getElementById("urgentClientEmail");
  const urgentConfirmBtn      = document.getElementById("urgentConfirmBtn");
  const urgentStep2Back       = document.getElementById("urgentStep2Back");
  const urgentStep2Close      = document.getElementById("urgentStep2Close");
  const urgentStep3Close      = document.getElementById("urgentStep3Close");
  const urgentStep3Back       = document.getElementById("urgentStep3Back");
  const urgentStep4Back       = document.getElementById("urgentStep4Back");
  const urgentStep4Close      = document.getElementById("urgentStep4Close");

  const matchForm             = document.getElementById("matchForm");
  const findMatchBtn          = document.getElementById("findMatchBtn");
  const matchResults          = document.getElementById("matchResults");
  const scheduleMatchBtn      = document.getElementById("scheduleMatchBtn");
  const matchedName           = document.getElementById("matchedName");
  const matchedSpec           = document.getElementById("matchedSpec");
  const appointmentFlow       = document.getElementById("appointmentFlow");
  const chosenProvider        = document.getElementById("chosenProvider");
  const prevMonthBtn          = document.getElementById("prevMonth");
  const nextMonthBtn          = document.getElementById("nextMonth");
  const calendarHeader        = document.getElementById("calendarHeader");
  const calendarGrid          = document.getElementById("calendar");
  const timeSlots             = document.getElementById("timeSlots");
  const confirmForm           = document.getElementById("confirmForm");
  const summaryText           = document.getElementById("summaryText");
  const confirmBtn            = document.getElementById("confirmBtn");
  const matchResultsBack      = document.getElementById("matchResultsBack");
  const matchResultsClose     = document.getElementById("matchResultsClose");
  const appointmentFlowClose  = document.getElementById("appointmentFlowClose");
  const confirmStep4Back      = document.getElementById("confirmStep4Back");
  const confirmStep4Close     = document.getElementById("confirmStep4Close");

  const confirmModal          = document.getElementById("confirmModal");
  const cancelModal           = document.getElementById("cancelModal");
  const modalEdit             = document.getElementById("modalEdit");
  const modalConfirm          = document.getElementById("modalConfirm");
  const modalClose            = document.getElementById("modalClose");
  const cancelYes             = document.getElementById("cancelYes");
  const cancelNo              = document.getElementById("cancelNo");
  const cancelMsg             = document.getElementById("cancelMsg");

  const upcomingCalendarWidget= document.getElementById("upcomingCalendarWidget");

  const dashTabs              = document.querySelectorAll("#feature-rich-dashboard .dashboard-tabs button");
  const richUpcomingSection   = document.getElementById("rich-upcoming");
  const richPastSection       = document.getElementById("rich-past");
  const richFavoritesSection  = document.getElementById("rich-favorites");

  const draft = JSON.parse(localStorage.getItem("urgentDraft") || "{}");
  for (let key in draft) {
    const el = document.getElementById("urgent" + key);
    if (el) el.value = draft[key];
  }


  function generateId(prefix = "") {
    return prefix + Date.now().toString();
  }

  function showToast(msg) {
    const t = document.createElement("div");
    t.className = "toast";
    t.innerText = msg;
    document.body.append(t);
    requestAnimationFrame(() => t.classList.add("visible"));
    setTimeout(() => t.remove(), 3000);
  }

  async function callOpenAI(messages) {
    const res = await fetch("/.netlify/functions/openai-proxy", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages })
    });
    const j = await res.json();
    return j.choices?.[0]?.message?.content.trim() || "";
  }
Storage.recordCategory("Consult");

  hamburger.addEventListener("click", () => {
    document.body.classList.toggle("sidebar-open");
  });

  shrinkSidebarBtn.addEventListener("click", () => {
    document.body.classList.toggle("sidebar-shrink");
    const icon = shrinkSidebarBtn.querySelector("i");
    icon.classList.toggle("fa-chevron-left");
    icon.classList.toggle("fa-chevron-right");
  });

  themeToggle.addEventListener("click", () => {
    document.documentElement.classList.toggle("dark");
    themeToggle.classList.toggle("fa-moon");
    themeToggle.classList.toggle("fa-sun");
  });

  heroBookBtn.addEventListener("click", () => {
    const target = document.querySelector(heroBookBtn.dataset.target);
    if (target) {
      target.scrollIntoView({ behavior: "smooth" });
    }
  });

  urgentCareLink.addEventListener("click", () => {
    urgentBooking.hidden = false;
  });


  urgentFindMatchBtn.addEventListener("click", async () => {
    const rawConcern = document.getElementById("urgentConcernInput").value.trim();
    if (!rawConcern) {
      showToast("Please enter your concern.");
      return;
    }
    const lower = rawConcern.toLowerCase();

    let matchedProviderId = null;
    Object.keys(symptomMap).forEach(keyword => {
      if (!matchedProviderId && lower.includes(keyword)) {
        matchedProviderId = symptomMap[keyword];
      }
    });

    let chosenProviderObj = matchedProviderId
      ? providers.find(p => p.id === matchedProviderId)
      : null;

    if (!chosenProviderObj) {
      urgentFindMatchBtn.disabled = true;
      urgentFindMatchBtn.innerText = "Matching…";

      const sys = `
You are an AI‐powered medical triage system. A patient will describe their symptoms, and your job is to pick exactly ONE provider ID (p1…p18) who best matches that patient’s needs. Respond only with the provider ID (e.g. "p3"), with no extra commentary.

Below is the detailed profile of each provider. Use the entire description—specialty, experience, procedural skills, patient focus—when deciding.

Providers:
${providers.map(p => `
- ${p.id}: ${p.name}
  • Specialty: ${p.specialty}
  • Facility: ${p.facility}
  • Profile: ${p.description.trim()}
`).join("\n")}
      `.trim();

      const usr = `Concern="${rawConcern}". Return exactly one provider ID (p1…p18).`;
      const rawGPT = await callOpenAI([
        { role: "system", content: sys },
        { role: "user",   content: usr }
      ]);

      const clean = rawGPT.split(/\s+/)[0].trim();
      const isValid = providers.some(p => p.id === clean);
      chosenProviderObj = isValid
        ? providers.find(p => p.id === clean)
        : providers[Math.floor(Math.random() * providers.length)];

      urgentFindMatchBtn.disabled = false;
      urgentFindMatchBtn.innerHTML = `<i class="fas fa-search"></i> Find Specialist`;
    }

    urgentMatchedName.textContent = chosenProviderObj.name;
    urgentMatchedSpec.textContent = `${chosenProviderObj.specialty}, ${chosenProviderObj.facility}`;
    urgentProviderName = chosenProviderObj.name;

    urgentMatchResults.hidden = false;
    urgentStep1.hidden = true;
  });

  urgentStep2Back.addEventListener("click", () => {
    urgentMatchResults.hidden = true;
    urgentStep1.hidden = false;
  });

  urgentStep2Close.addEventListener("click", () => {
    urgentBooking.hidden = true;
  });

  urgentScheduleBtn.addEventListener("click", () => {
    urgentMatchResults.hidden = true;
    urgentCalendarFlow.hidden = false;
  });

  urgentDate.min = new Date().toISOString().split("T")[0];

  urgentStep3Back.addEventListener("click", () => {
    urgentCalendarFlow.hidden = true;
    urgentMatchResults.hidden = false;
  });

  urgentStep3Close.addEventListener("click", () => {
    urgentBooking.hidden = true;
  });

  urgentNextToDetails.addEventListener("click", () => {
    if (!urgentDate.value || !urgentTime.value) {
      showToast("Select date & time.");
      return;
    }
    uDate = urgentDate.value;
    uTime = urgentTime.value;
    urgentCalendarFlow.hidden = true;
    urgentDetailsForm.hidden = false;
    urgentDetailsForm.scrollIntoView({ behavior: "smooth" });
  });

  urgentStep4Back.addEventListener("click", () => {
    urgentDetailsForm.hidden = true;
    urgentCalendarFlow.hidden = false;
  });

  urgentStep4Close.addEventListener("click", () => {
    urgentBooking.hidden = true;
  });

  urgentConfirmBtn.addEventListener("click", () => {
    const name = urgentClientName.value.trim();
    const email = urgentClientEmail.value.trim();
    if (!name || !email) {
      showToast("Enter name & email");
      return;
    }
    document.getElementById("confirmDetails").innerHTML = `
      <p><strong>Urgent Consult</strong></p>
      <p><strong>Provider:</strong> ${urgentProviderName}</p>
      <p><strong>Date:</strong> ${uDate}</p>
      <p><strong>Time:</strong> ${uTime}</p>
      <p><strong>Name:</strong> ${name}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Fee:</strong> ₵500</p>
    `;
    confirmModal.hidden = false;
    localStorage.setItem("urgentDraft", JSON.stringify({
      ConcernInput: document.getElementById("urgentConcernInput").value,
      Date: uDate, Time: uTime,
      ClientName: name, ClientEmail: email
    }));
    urgentFlow = true;
  });


  findMatchBtn.addEventListener("click", async () => {
    const rawConcern = document.getElementById("concernInput").value.trim();
    if (!rawConcern) {
      showToast("Enter your concern.");
      return;
    }
    const lower = rawConcern.toLowerCase();

    let matchedProviderId = null;
    Object.keys(symptomMap).forEach(keyword => {
      if (!matchedProviderId && lower.includes(keyword)) {
        matchedProviderId = symptomMap[keyword];
      }
    });

    let chosenProviderObj = matchedProviderId
      ? providers.find(p => p.id === matchedProviderId)
      : null;

    if (!chosenProviderObj) {
      findMatchBtn.disabled = true;
      findMatchBtn.innerHTML = `Matching… <span class="spinner"></span>`;

      const sys = `
You are an AI‐powered medical triage system. A patient will describe their symptoms, urgency level, and language preference. Your job is to pick exactly ONE provider ID (p1…p18) who best matches that patient’s needs. Respond only with the provider ID (e.g. "p7"), with no extra commentary.

Below is the detailed profile of each provider. Use the entire description—specialty, experience, procedural skills, patient focus—when deciding.

Providers:
${providers.map(p => `
- ${p.id}: ${p.name}
  • Specialty: ${p.specialty}
  • Facility: ${p.facility}
  • Profile: ${p.description.trim()}
`).join("\n")}
      `.trim();

      const usr = `Concern="${rawConcern}", Urgency="${document.getElementById("urgencyInput").value}", Language="${document.getElementById("languageInput").value}". Return exactly one provider ID (p1…p18).`;
      const rawGPT = await callOpenAI([
        { role: "system", content: sys },
        { role: "user",   content: usr }
      ]);

      const clean = rawGPT.split(/\s+/)[0].trim();
      const isValid = providers.some(p => p.id === clean);
      chosenProviderObj = isValid
        ? providers.find(p => p.id === clean)
        : providers[Math.floor(Math.random() * providers.length)];

      findMatchBtn.disabled = false;
      findMatchBtn.innerHTML = '<i class="fas fa-search"></i> Predict Specialist';
    }

    matchedName.textContent = chosenProviderObj.name;
    matchedSpec.textContent = `${chosenProviderObj.specialty}, ${chosenProviderObj.facility}`;
    providerId = chosenProviderObj.id;
    providerName = chosenProviderObj.name;

    matchResults.hidden = false;
    matchForm.hidden = true;
  });

  matchResultsBack.addEventListener("click", () => {
    matchResults.hidden = true;
    matchForm.hidden = false;
  });

  matchResultsClose.addEventListener("click", () => {
    matchResults.hidden = true;
    matchForm.hidden = false;
  });

  scheduleMatchBtn.addEventListener("click", () => {
    matchResults.hidden = true;
    appointmentFlow.hidden = false;
    chosenProvider.textContent = providerName;
    buildCalendar(year, month);
  });

  appointmentFlowClose.addEventListener("click", () => {
    appointmentFlow.hidden = true;
  });


  prevMonthBtn.addEventListener("click", () => {
    month = month > 0 ? month - 1 : 11;
    if (month === 11) year--;
    buildCalendar(year, month);
  });

  nextMonthBtn.addEventListener("click", () => {
    month = month < 11 ? month + 1 : 0;
    if (month === 0) year++;
    buildCalendar(year, month);
  });

  function buildCalendar(y, m) {
    calendarHeader.textContent = new Date(y, m).toLocaleString("default", { month: "long", year: "numeric" });
    calendarGrid.innerHTML = "";

    ["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(w => {
      const d = document.createElement("div");
      d.className = "cell";
      d.style.fontWeight = "600";
      d.innerText = w;
      calendarGrid.append(d);
    });

    const first = new Date(y, m, 1).getDay();
    for (let i = 0; i < first; i++) {
      const b = document.createElement("div");
      b.className = "cell closed";
      calendarGrid.append(b);
    }

    const days = new Date(y, m + 1, 0).getDate();
    const avail = availability[providerId] || {};
    const todayMidnight = new Date().setHours(0,0,0,0);

    for (let d = 1; d <= days; d++) {
      const key = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
      const thisDayTs = new Date(y, m, d).getTime();
      const past = thisDayTs < todayMidnight;
      const open = !past && Array.isArray(avail[key]);
      const cell = document.createElement("div");
      cell.className = `cell ${open ? "open" : "closed"}`;
      cell.dataset.date = key;
      cell.innerText = d;
      if (open) cell.addEventListener("click", () => selectDate(key));
      const today = new Date();
      if (today.getFullYear() === y && today.getMonth() === m && today.getDate() === d) {
        cell.classList.add("today");
      }
      calendarGrid.append(cell);
    }

    timeSlots.innerHTML = "";
    confirmForm.hidden = true;
  }

  function selectDate(key) {
    selDate = key;
    const avail = availability[providerId] || {};
    const slots = avail[key] || [];
    timeSlots.innerHTML = `<h4>Available on ${key}:</h4>`;
    const ul = document.createElement("ul");
    ul.style.display = "flex";
    ul.style.gap = "0.5rem";
    slots.forEach(t => {
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn-sm";
      btn.innerText = t;
      btn.addEventListener("click", () => selectTime(t));
      li.append(btn);
      ul.append(li);
    });
    timeSlots.append(ul);
  }

  function selectTime(t) {
    selTime = t;
    summaryText.textContent = `You selected ${selDate} at ${selTime}.`;
    confirmForm.hidden = false;
    confirmForm.scrollIntoView({ behavior: "smooth" });
  }

  confirmBtn.addEventListener("click", () => {
    const name = document.getElementById("clientName").value.trim();
    if (!name) {
      showToast("Enter your name");
      return;
    }
    document.getElementById("confirmDetails").innerHTML = `
      <p><strong>Provider:</strong> ${providerName}</p>
      <p><strong>Date:</strong> ${selDate}</p>
      <p><strong>Time:</strong> ${selTime}</p>
      <p><strong>Your Name:</strong> ${name}</p>
    `;
    confirmModal.hidden = false;
  });


  modalClose.addEventListener("click", () => {
    confirmModal.hidden = true;
  });

  modalEdit.addEventListener("click", () => {
    confirmModal.hidden = true;
    confirmForm.scrollIntoView({ behavior: "smooth" });
  });

  modalConfirm.addEventListener("click", () => {
    if (urgentFlow) {
      const email = urgentClientEmail.value.trim();
      const handler = PaystackPop.setup({
        key: "pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa",
        email: email,
        amount: URGENT_FEE_KOBO,
        currency: "GHS",
        ref: generateId("U"),
        onClose: function() {},
        callback: function(response) {
          const id = generateId("U");
         const newAppt = { id, name: urgentProviderName, date: uDate, time: uTime, urgent: true };
       appointments.push(newAppt);
       db.collection('users').doc(uid)
         .collection('appointments').doc(id)
         .set(newAppt);
          addToRichDashboard({ id, name: urgentProviderName, date: uDate, time: uTime, urgent: true });
          renderUpcomingCalendarWidget();
          urgentFlow = false;
          confirmModal.hidden = true;
        }
      });
      handler.openIframe();
    } else {
      const id = generateId();
      const newAppt = { id, name: providerName, date: selDate, time: selTime, urgent: false };
      appointments.push(newAppt);
      db.collection('users').doc(uid)
        .collection('appointments').doc(id)
        .set(newAppt);
      addToRichDashboard({ id, name: providerName, date: selDate, time: selTime, urgent: false });
      renderUpcomingCalendarWidget();
      confirmModal.hidden = true;
    }
  });


  cancelYes.addEventListener("click", () => {
    const id = cancelYes.dataset.apptId;
    const idx = appointments.findIndex(a => a.id === id);
    if (idx > -1) {
      appointments.splice(idx, 1);
      const apptId = cancelYes.dataset.apptId;
      db.collection('users').doc(uid)
        .collection('appointments').doc(apptId)
        .delete()
        .catch(err => console.error("Failed delete:", err));
    }
    const card = document.querySelector(`.card[data-id="${id}"]`);
    if (card) card.remove();
    renderUpcomingCalendarWidget();
    cancelModal.hidden = true;
  });

  cancelNo.addEventListener("click", () => {
    cancelModal.hidden = true;
  });


  function renderUpcomingCalendarWidget() {
    upcomingCalendarWidget.innerHTML = "";
    const ctrl = document.createElement("div");
    ctrl.style.display = "flex";
    ctrl.style.justifyContent = "space-between";
    ctrl.style.marginBottom = "0.5rem";
    const prev = document.createElement("button");
    prev.textContent = "‹ Prev";
    prev.className = "btn-sm";
    const next = document.createElement("button");
    next.textContent = "Next ›";
    next.className = "btn-sm";
    ctrl.append(prev, next);
    upcomingCalendarWidget.append(ctrl);

    prev.addEventListener("click", () => {
      widgetMonth--;
      if (widgetMonth < 0) {
        widgetMonth = 11;
        widgetYear--;
      }
      renderWidget();
    });

    next.addEventListener("click", () => {
      widgetMonth++;
      if (widgetMonth > 11) {
        widgetMonth = 0;
        widgetYear++;
      }
      renderWidget();
    });

    function renderWidget() {
      const title = document.createElement("h4");
      title.innerText = new Date(widgetYear, widgetMonth).toLocaleString("default", { month: "long", year: "numeric" });
      const grid = document.createElement("div");
      grid.className = "calendar-grid";

      ["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(w => {
        const hd = document.createElement("div");
        hd.className = "cell";
        hd.style.fontWeight = "600";
        hd.innerText = w;
        grid.append(hd);
      });

      const firstDay = new Date(widgetYear, widgetMonth, 1).getDay();
      for (let i = 0; i < firstDay; i++) {
        const blank = document.createElement("div");
        blank.className = "cell";
        grid.append(blank);
      }

      const days = new Date(widgetYear, widgetMonth + 1, 0).getDate();
      const marks = new Set(
        appointments
          .filter(a => {
            const d = new Date(a.date);
            return d.getFullYear() === widgetYear && d.getMonth() === widgetMonth;
          })
          .map(a => new Date(a.date).getDate())
      );

     for (let d = 1; d <= days; d++) {
  const cell = document.createElement("div");
  const isMarked = marks.has(d);
  cell.className = isMarked ? "cell open" : "cell";
  cell.innerText = d;

  const today = new Date();
  if (
    today.getFullYear() === widgetYear &&
    today.getMonth() === widgetMonth &&
    today.getDate() === d
  ) {
    cell.classList.add("today");
  }

  if (isMarked) {
    cell.addEventListener("click", () => {
      const list = appointments.filter(a => {
        const ad = new Date(a.date);
        return (
          ad.getFullYear() === widgetYear &&
          ad.getMonth() === widgetMonth &&
          ad.getDate() === d
        );
      });
      alert(list.map(a => `${a.name}: ${a.time}`).join("\n"));
    });
  }
  grid.append(cell);
}

      upcomingCalendarWidget.querySelectorAll("h4, .calendar-grid").forEach(n => n.remove());
      upcomingCalendarWidget.append(title, grid);
    }

    renderWidget();
  }


  function addToRichDashboard(appt) {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.id = appt.id;
    card.innerHTML = `
      <i class="fas fa-user-md fa-2x"></i>
      <div class="details">
        <h4><strong>${appt.name}</strong></h4>
        <p>${appt.date} • ${appt.time}</p>
      </div>
      <div class="actions">
        <button class="btn-reschedule"><i class="fas fa-sync-alt"></i></button>
        <button class="btn-cancel"><i class="fas fa-times"></i></button>
      </div>
    `;

    const btnReschedule = card.querySelector(".btn-reschedule");
    btnReschedule.addEventListener("click", () => {
      if (appt.urgent) {
        urgentProviderName = appt.name;
        urgentBooking.hidden = false;
        urgentStep1.hidden = true;
        urgentMatchResults.hidden = true;
        urgentCalendarFlow.hidden = false;
        urgentDate.value = appt.date;
        urgentTime.value = appt.time;
        uDate = appt.date;
        uTime = appt.time;
      } else {
        const found = providers.find(p => p.name === appt.name);
        if (found) {
          providerId = found.id;
          providerName = appt.name;
          appointmentFlow.hidden = false;
          chosenProvider.textContent = providerName;
          buildCalendar(year, month);
        }
      }
      document.getElementById("confirmDetails").innerHTML = `
        <p><strong>${appt.name}</strong></p>
        <p><strong>Date:</strong> ${appt.date}</p>
        <p><strong>Time:</strong> ${appt.time}</p>
      `;
    });

    const btnCancel = card.querySelector(".btn-cancel");
    btnCancel.addEventListener("click", () => {
      cancelMsg.innerText = appt.urgent
        ? "This was an urgent booking (₵500 non-refundable). Cancel anyway?"
        : "Are you sure you want to cancel this appointment?";
      cancelYes.dataset.apptId = appt.id;
      cancelModal.hidden = false;
    });

    richUpcomingSection.append(card);
  }

  dashTabs.forEach(btn => {
    btn.addEventListener("click", () => {
      dashTabs.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      richUpcomingSection.hidden   = (btn.dataset.tab !== "rich-upcoming");
      richPastSection.hidden       = (btn.dataset.tab !== "rich-past");
      richFavoritesSection.hidden  = (btn.dataset.tab !== "rich-favorites");
    });
  });

}
</script>

  
</body>

</html>
