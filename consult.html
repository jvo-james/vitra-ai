<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>E-Pharmacy AI Portal</title>

  <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Global Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  :root {
    --cb-primary: #3b3f88;       /* deep indigo */
    --cb-primary-alt: #5c4d99;   /* lighter indigo */
    --cb-accent: #f08a5d;        /* warm coral */
    --cb-bg: #f7f6f9;            /* light lavender */
    --cb-surface: #ffffff;       /* card backgrounds */
    --cb-text: #2d2d2d;          /* dark text */
    --cb-muted: #777777;         /* secondary text */
    --radius: 0.75rem;
    --padding: 1rem;
    --shadow: 0 4px 12px rgba(0,0,0,0.1);
    --transition: 0.3s ease;
  }
  html.dark {
    --cb-bg: #1a1b2e;
    --cb-surface: #2d2d44;
    --cb-text: #e0e0e0;
    --cb-muted: #aaaaaa;
    --shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  *, *::before, *::after {
    box-sizing: border-box;
    transition: var(--transition);
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Montserrat', sans-serif;
    background: var(--cb-bg);
    color: var(--cb-text);
    line-height: 1.5;
  }
  a { color: inherit; text-decoration: none; }
  h1,h2,h3,h4 { margin-bottom: 0.5rem; color: var(--cb-primary); }
  p.desc { color: var(--cb-muted); margin-bottom: 1rem; }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  aside#sidebar {
    position: fixed; top: 0; left: 0; bottom: 0;
    width: 220px; background: var(--cb-surface);
    box-shadow: var(--shadow); z-index: 1000;
    display: flex; flex-direction: column;
  }
  aside#sidebar .brand {
    padding: var(--padding);
    font-size: 1.25rem;
    background: var(--cb-primary);
    color: #fff;
    display: flex; align-items: center; gap: 0.5rem;
  }
  aside#sidebar nav ul {
    flex: 1; overflow-y: auto; margin: 0; padding: 0; list-style: none;
  }
  aside#sidebar nav li a {
    display: flex; align-items: center; gap: 0.75rem;
    padding: 0.75rem var(--padding);
    border-radius: var(--radius);
  }
  aside#sidebar nav li.active a,
  aside#sidebar nav li a:hover {
    background: var(--cb-primary-alt);
    color: #fff;
  }
  #shrinkSidebar {
    background: none; border: none; font-size: 1.25rem;
    color: var(--cb-primary); cursor: pointer;
    margin: var(--padding);
  }
.sidebar-shrink #sidebar {
  width: 60px;
}
.sidebar-open aside#sidebar {
  transform: translateX(0);
}
  @media (min-width: 769px) {
  #hamburger { display: none; }      
 }
  body.sidebar-open header,
 body.sidebar-open main {
 margin-left: 220px;  
 }
  header {
    position: sticky; top: 0;
    height: 60px; background: var(--cb-surface);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 var(--padding); flex-wrap: wrap;
    box-shadow: var(--shadow); z-index: 1001;
  }
  header h1 {
    flex: 1 1 auto;          /* + let the title shrink/grow */
    margin: 0.5rem 0;        /* + some vertical breathing room */
    word-break: break-word;  /* + wrap long titles */
    font-size: 1.25rem;      /* + a slightly smaller base size */
  }
  #hamburger, #themeToggle {
    font-size: 1.5rem; color: var(--cb-primary); cursor: pointer;
  }

  main {
    margin: 100px var(--padding) var(--padding) 240px;
    transition: margin-left var(--transition);
  }
  section.module {
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  #hero {
    display: grid; grid-template-columns: 1fr 1fr; gap: var(--padding);
    background: var(--cb-primary-alt); color: #fff;
    padding: 2rem var(--padding);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
  }
  #hero .hero-text h2 { font-size: 2.25rem; margin-bottom: 0.5rem; color: #fff; }
  #hero .hero-features {
    display: flex; flex-direction: column; gap: 1rem;
  }
  #hero .feature-card {
    background: #fff; color: var(--cb-primary);
    padding: 1rem; border-radius: var(--radius);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer;
  }
  #hero .feature-card:hover {
    background: var(--cb-accent); color: #fff;
    transform: translateY(-3px);
  }
  #hero .feature-card i { font-size: 2rem; }
  #hero .feature-card .btn {
    background: var(--cb-primary); color: #fff;
    padding: 0.5rem 1rem; border-radius: var(--radius);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Forms & Inputs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  label { display: block; margin-bottom: 1rem; }
  input, select, textarea {
    width: 100%; padding: 0.75rem; margin-top: 0.5rem;
    border: 2px solid var(--cb-primary-alt);
    border-radius: var(--radius);
    background: var(--cb-bg);
    color: var(--cb-text);
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--cb-accent);
    box-shadow: 0 0 0 3px rgba(240,138,93,0.3);
  }
  button.btn {
    background: var(--cb-accent); color: #fff;
    border: none; padding: 0.75rem 1.25rem;
    border-radius: var(--radius); box-shadow: var(--shadow);
    cursor: pointer;
  }
  button.btn:hover { background: #d4724f; }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Response Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  .response {
    background: var(--cb-surface);
    border-left: 4px solid var(--cb-accent);
    padding: var(--padding);
    margin-top: 1rem;
    position: relative;
    box-shadow: var(--shadow);
  }
  .response .close-btn {
    position: absolute; top: 0.5rem; right: 0.5rem;
    background: none; border: none; font-size: 1.1rem; cursor: pointer;
    color: var(--cb-muted);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Chat & History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  .chat-box {
    background: var(--cb-bg);
    border: 2px solid var(--cb-primary-alt);
    border-radius: var(--radius);
    padding: var(--padding);
    max-height: 300px; overflow-y: auto;
    margin-bottom: 1rem;
  }
  .chat-input { display: flex; gap: 0.5rem; }
  .chat-input input { flex: 1; border-radius: var(--radius) 0 0 var(--radius); }
  .chat-input button { border-radius: 0 var(--radius) var(--radius) 0; }
  .user-msg, .bot-msg {
    max-width: 70%; padding: 0.75rem; border-radius: var(--radius);
    margin-bottom: 0.5rem; word-wrap: break-word;
  }
  .user-msg {
    align-self: flex-end; background: var(--cb-primary); color: #fff;
    border-bottom-right-radius: 0;
  }
  .bot-msg {
    align-self: flex-start; background: var(--cb-surface); color: var(--cb-text);
    border-bottom-left-radius: 0;
  }
  .chat-date {
    text-align: center; margin: 1rem 0; font-size: 0.9rem;
    color: var(--cb-muted); font-weight: 600;
  }
  .msg-ts { font-size: 0.75rem; color: var(--cb-muted); }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Modals & History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
 .modal {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
   background: rgba(0,0,0,0.5);
   display: flex;                  /* show container as flex */
   align-items: center; justify-content: center;
    z-index: 2000;
 }
  /* hide when [hidden] is present */
  .modal[hidden] {
   display: none !important;
  }
  .modal-content {
    background: var(--cb-surface); padding: 1.5rem;
    border-radius: var(--radius); width: 90%; max-width: 600px;
    box-shadow: var(--shadow); position: relative;
  }
  .close-modal {
    position: absolute; top: 0.5rem; right: 0.75rem;
    font-size: 1.5rem; cursor: pointer; color: var(--cb-muted);
  }
  .history-item {
    background: var(--cb-bg); padding: 0.75rem; margin-bottom: 0.75rem;
    border-radius: var(--radius); display: flex;
    justify-content: space-between; align-items: center;
  }
  .delete-history {
    background: var(--cb-primary-alt); color: #fff;
    border: none; padding: 0.3rem 0.6rem; border-radius: var(--radius);
    cursor: pointer;
  }
  .delete-history:hover { background: var(--cb-primary); }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Analytics Cards & Calendar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  .analytics-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
    gap: var(--padding);
  }
  .analytics-card {
    background: var(--cb-surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: var(--shadow);
  }
  .calendar {
    width: 100%; background: var(--cb-surface);
    border-radius: var(--radius); overflow: hidden;
    box-shadow: var(--shadow);
  }
  .calendar .row {
    display: flex;
  }
  .calendar .cell {
    flex: 1; padding: 0.5rem; border: 1px solid var(--cb-bg);
    text-align: center; cursor: pointer;
  }
  .calendar .cell.closed { background: #eee; color: #999; cursor: not-allowed; }
  .calendar .cell.open { background: linear-gradient(135deg, var(--cb-accent), var(--cb-primary-alt));
    color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
  .calendar .cell.today { background: var(--cb-bg);
  border: 3px dashed var(--cb-primary-alt);
  font-weight: bold; }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  @media (max-width: 1024px) {
    header { left: 60px; }
    main { margin-left: 80px; }
     body.sidebar-shrink header,
    body.sidebar-shrink main {
      margin-left: 60px;
    }
  }
  @media (max-width: 768px) {
    aside#sidebar { transform: translateX(-100%); }
    body.sidebar-open aside#sidebar { transform: none; }
    header { left: 0; }
    main { margin-left: 1rem; margin-top: 100px; }
    #hero { grid-template-columns: 1fr; }
  }
    /* make our generated calendar look like your cells */
  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--cb-bg);
    border: 1px solid var(--cb-bg);
  }
  /* Spinner */
.spinner {
  border: 4px solid rgba(0,0,0,0.1);
  border-left-color: var(--cb-primary);
  border-radius: 50%;
  width: 24px; height: 24px;
  animation: spin 1s linear infinite;
  margin: .5rem auto;
}
@keyframes spin { to { transform: rotate(360deg); } }
.hero-graphic {
  display: flex;
  align-items: center;
  justify-content: center;
}

.hero-graphic .hero-img {
  max-width: 100%;
  max-height: 300px;      /* adjust as needed */
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
/* Toast */
.toast {
  position: fixed; bottom: 1rem; left: 50%;
  transform: translateX(-50%) translateY(100%);
  background: var(--cb-primary-alt); color: #fff;
  padding: .75rem 1.5rem; border-radius: var(--radius);
  box-shadow: var(--shadow); opacity: 0;
  transition: transform .3s, opacity .3s;
  z-index: 2000;
}
.toast.visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}
   .calendar .cell.selected {
  outline: 3px solid var(--cb-primary);
  transform: scale(1.1);
  z-index: 1;
 }

</style>
</head>
<body>
  <!-- Sidebar -->
  <aside id="sidebar">
    <div class="brand">
      <i class="fas fa-calendar-check"></i>
      <span>Vitra AI Consult</span>
    </div>
    <nav>
      <ul>
        <li class="active"><a href="#providerMatch"><i class="fas fa-user-md"></i><span>Provider Match</span></a></li>
        <li><a href="#availabilityCalendar"><i class="fas fa-calendar-alt"></i><span>Availability</span></a></li>
        <li><a href="#bookAppointment"><i class="fas fa-book-medical"></i><span>Book Appointment</span></a></li>
        <li><a href="#dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
        <li><a href="#feedback"><i class="fas fa-star"></i><span>Feedback</span></a></li>
        <li><a href="#analytics"><i class="fas fa-chart-line"></i><span>Analytics</span></a></li>
        <li><a href="#liveChat"><i class="fas fa-comments"></i><span>Live Chat</span></a></li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar"><i class="fas fa-chevron-left"></i></button>
  </aside>

  <!-- Header -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>AI-Powered Consultation Booking</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- Hero -->
  <section id="hero" class="module">
    <div class="hero-text">
      <h2><i class="fas fa-stethoscope"></i> Seamless Consultation Booking</h2>
      <p class="desc">From instant provider match to one-click appointment, powered by AI.</p>
      <a href="#providerMatch" class="btn hero-btn"><i class="fas fa-user-md"></i> Get Matched Now</a>
    </div>
    <div class="hero-graphic">
      <!-- You can replace this with an illustrative SVG or image -->
      <img class="hero-img" src="9E2CDE35-303A-4C5F-A4A9-1B0420CF8B0C.png" alt="Consultation illustration" />
    </div>
  </section>

  <!-- 1. Personalized AI Provider Matching -->
  <section id="providerMatch" class="module">
    <h2><i class="fas fa-user-md"></i> Personalized Provider Matching</h2>
    <p class="desc">Answer a few questions and get instantly matched to the best in-network specialist.</p>
    <form id="matchForm">
      <label>Chief Concern:
        <input type="text" id="concernInput" placeholder="e.g. persistent cough">
      </label>
      <label>Urgency:
        <select id="urgencyInput">
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
        </select>
      </label>
      <label>Preferred Language:
        <select id="languageInput">
          <option>English</option>
          <option>Twi</option>
          <option>Ga</option>
          <option>Ewe</option>
        </select>
      </label>
      <button type="button" id="findMatch" class="btn"><i class="fas fa-search"></i> Find My Specialist</button>
    </form>

    <div id="matchResults" class="response" hidden>
      <button class="close-btn"><i class="fas fa-times"></i></button>
      <div class="result-content">
        <!-- AI will choose among these pseudo-providers -->
        <ul id="providerList">
          <li data-id="p1"><strong>Dr. Kwame Asante</strong> â€“ Pulmonologist, Korle Bu Teaching Hospital</li>
          <li data-id="p2"><strong>Dr. Abena Owusu</strong> â€“ Cardiologist, 37 Military Hospital</li>
          <li data-id="p3"><strong>Dr. Kojo Mensah</strong> â€“ Psychiatrist, Ridge Hospital</li>
          <li data-id="p4"><strong>Dr. Yaa Dufie</strong> â€“ Dietitian, Nyaho Medical Centre</li>
          <li data-id="p5"><strong>Dr. Nana Adjei</strong> â€“ General Practitioner, Cape Coast Polyclinic</li>
          <li data-id="p6"><strong>Dr. Efua Amponsah</strong> â€“ Endocrinologist, LEKMA Hospital</li>
          <li data-id="p7"><strong>Dr. Michael Addo</strong> â€“ Neurologist, 37 Military Hospital</li>
          <li data-id="p8"><strong>Dr. Grace Ofori</strong> â€“ Dermatologist, Accra Dermatology Centre</li>
          <li data-id="p9"><strong>Dr. Joseph Kumi</strong> â€“ Orthopedic Surgeon, Komfo Anokye Teaching Hospital</li>
          <li data-id="p10"><strong>Dr. Ama Brew</strong> â€“ Pediatrician, Trust Hospital</li>
        </ul>
      </div>
      <div class="match-actions">
      <button id="proceedMatch" class="btn">Proceed with AI choice</button>
      <button id="chooseOwn" class="btn btn-outline">Choose own provider</button>
    </div>
    </div>
  </section>

 
  <section id="appointmentFlow" class="module" hidden>
    <h2><i class="fas fa-calendar-alt"></i> Schedule with <span id="chosenProvider"></span></h2>
    <div class="calendar-controls">
      <label>Select Professional:
        <select id="availProfessional">
         <option value="p1">Dr. Kwame Asante â€“ Pulmonologist, Korle Bu Teaching Hospital</option>
<option value="p2">Dr. Abena Owusu â€“ Cardiologist, 37 Military Hospital</option>
<option value="p3">Dr. Kojo Mensah â€“ Psychiatrist, Ridge Hospital</option>
<option value="p4">Dr. Yaa Dufie â€“ Dietitian, Nyaho Medical Centre</option>
<option value="p5">Dr. Nana Adjei â€“ General Practitioner, Cape Coast Polyclinic</option>
<option value="p6">Dr. Efua Amponsah â€“ Endocrinologist, LEKMA Hospital</option>
<option value="p7">Dr. Michael Addo â€“ Neurologist, 37 Military Hospital</option>
<option value="p8">Dr. Grace Ofori â€“ Dermatologist, Accra Dermatology Centre</option>
<option value="p9">Dr. Joseph Kumi â€“ Orthopedic Surgeon, Komfo Anokye Teaching Hospital</option>
<option value="p10">Dr. Ama Brew â€“ Pediatrician, Trust Hospital</option>
<option value="p11">Ms. Akosua Baah â€“ Physical Therapist, Tema General Hospital</option>
<option value="p12">Mr. Daniel Boakye â€“ Pharmacist, Ridge Hospital</option>
<option value="p13">Mrs. Esther Kumi â€“ Occupational Therapist, Cape Coast Polyclinic</option>
<option value="p14">Ms. Joy Mensah â€“ Speech Therapist, LEKMA Hospital</option>
<option value="p15">Dr. Paul Yeboah â€“ Nephrologist, Korle Bu Teaching Hospital</option>
<option value="p16">Dr. Linda Frimpong â€“ Rheumatologist, 37 Military Hospital</option>
<option value="p17">Mr. Kwesi Owusu â€“ Nutritionist, Nyaho Medical Centre</option>
<option value="p18">Ms. Abena Boateng â€“ Clinical Psychologist, Accra Psychology Clinic</option>        </select>
      </label>
      <label>Date:
        <input type="date" id="calendarDateInput">
      </label>
      <label>Time of Day:
        <select id="timeOfDayInput">
          <option>Morning</option>
          <option>Afternoon</option>
          <option>Evening</option>
        </select>
      </label>
      <label>Type:
        <select id="visitTypeInput">
          <option>Telehealth</option>
          <option>In-Person</option>
        </select>
      </label>
      <button type="button" id="filterSlots" class="btn"><i class="fas fa-filter"></i> Filter</button>
      <button type="button" id="nextAvailable" class="btn"><i class="fas fa-forward"></i> Next Available</button>
    </div>
     <div class="month-nav">
   <button type="button" id="prevMonth" class="btn-sm">&larr;</button>
   <div id="calendarHeader" class="calendar-header"></div>
   <button type="button" id="nextMonth" class="btn-sm">&rarr;</button>
  </div>
    <div id="calendar"></div>
    <div id="timeSlots"></div>
    <form id="finalBookingForm" hidden>
      <h3>Confirm your details</h3>
      <label>Your Name: <input id="clientNameFinal" required></label>
      <div id="summarySelection"></div>
      <button id="editSelection" type="button" class="btn-sm">Edit</button>
      <button id="confirmBookingFinal" type="button" class="btn">Confirm & Book</button>
    </form>
  </section>
  <!-- 4. Patient Dashboard & History -->
  <section id="dashboard" class="module">
    <h2><i class="fas fa-tachometer-alt"></i> Your Dashboard</h2>
    <p class="desc">Manage upcoming visits, review past appointments, download summaries.</p>
    <div class="dashboard-tabs">
      <button type="button" data-tab="upcoming" class="active">Upcoming</button>
      <button type="button" data-tab="past">Past</button>
    </div>
    <div id="upcoming" class="dashboard-list">
      <ul>
        <li>
          <strong>Dr. Abena Owusu</strong> â€“ 2025-05-30 14:00  
          <button type="button" class="btn-sm rescheduleBtn">Reschedule</button>
          <button type="button" class="btn-sm cancelBtn">Cancel</button>
        </li>
        <!-- more itemsâ€¦ -->
      </ul>
    </div>
    <div id="past" class="dashboard-list" hidden>
      <ul>
        <li>
          <strong>Dr. Kojo Mensah</strong> â€“ 2025-04-12 10:00  
          <button type="button" class="btn-sm">Download Summary</button>
          <button type="button" class="btn-sm">Download Invoice</button>
        </li>
        <!-- moreâ€¦ -->
      </ul>
    </div>
  </section>

  <!-- 5. Feedback & Ratings -->
  <section id="feedback" class="module">
    <h2><i class="fas fa-star"></i> Feedback & Ratings</h2>
    <p class="desc">Help us improveâ€”quick 1-min survey.</p>
    <label>Rate your last visit:  
      <select id="ratingInput">
        <option>â­</option><option>â­â­</option><option>â­â­â­</option><option>â­â­â­â­</option><option>â­â­â­â­â­</option>
      </select>
    </label>
    <label>Comments:
      <textarea id="feedbackInput" rows="3" placeholder="Any suggestions?"></textarea>
    </label>
    <button type="button" id="submitFeedback" class="btn"><i class="fas fa-paper-plane"></i> Submit</button>
  </section>

  <!-- 6. Analytics & Optimization -->
  <section id="analytics" class="module">
    <h2><i class="fas fa-chart-line"></i> Analytics & Optimization</h2>
    <div class="chart-container">
      <canvas id="noShowChart"></canvas>
      <canvas id="peakTimesChart" style="margin-top:1rem;"></canvas>
    </div>
    <button type="button" id="optimizeStaffing" class="btn"><i class="fas fa-cogs"></i> AI Suggest Staffing</button>
    <div id="optimizationResult" class="response" hidden>
      <button class="close-btn"><i class="fas fa-times"></i></button>
      <div class="result-content"></div>
    </div>
  </section>

  <!-- 7. Live AI Chat Support -->
  <section id="liveChat" class="module">
    <h2><i class="fas fa-comments"></i> Live AI Chat Support</h2>
    <p class="desc">24/7 assistant for all your booking questions.</p>
    <div class="chat-controls">
      <button type="button" id="clearChat" class="btn-sm"><i class="fas fa-trash"></i> Clear</button>
      <button type="button" id="showHistory" class="btn-sm"><i class="fas fa-history"></i> History</button>
    </div>
    <div id="chatBox" class="chat-box"></div>
    <form id="chatForm" class="chat-input">
      <input id="chatInput" type="text" placeholder="Ask me anythingâ€¦">
      <button type="button" id="sendChat" class="btn"><i class="fas fa-paper-plane"></i></button>
    </form>
    <!-- Chat history modal -->
    <div id="chatHistoryModal" class="modal" hidden>
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>Chat History</h3>
        <div id="chatHistoryList"></div>
        <button type="button" id="clearHistoryChat" class="btn-sm">Clear All</button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <small>Â© 2025 AI-Pharmacy Chain â€” All rights reserved</small>
  </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // 1. Elements
  const calEl       = document.getElementById('calendar');
  const headerEl    = document.getElementById('calendarHeader');
  const profSelect  = document.getElementById('availProfessional');
  const dateInput   = document.getElementById('calendarDateInput');
  const prevBtn     = document.getElementById('prevMonth');
  const nextBtn     = document.getElementById('nextMonth');
  const filterBtn   = document.getElementById('filterSlots');
  const nextAvailBtn= document.getElementById('nextAvailable');
  const timeSlotsEl = document.getElementById('timeSlots');
  const sidebarBtn = document.getElementById('shrinkSidebar');
  const hamburger  = document.getElementById('hamburger');
  const themeToggle= document.getElementById('themeToggle');
  const bodyEl      = document.body;
  
  sidebarBtn.addEventListener('click', () => {
    bodyEl.classList.toggle('sidebar-shrink');
  });
  hamburger.addEventListener('click', () => {
   bodyEl.classList.toggle('sidebar-open');
   bodyEl.classList.remove('sidebar-shrink'); 
  });

  // â”€â”€â”€ DARK MODE TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 themeToggle.addEventListener('click', () => {
   const html = document.documentElement;
   html.classList.toggle('dark');
   html.setAttribute('aria-theme', html.classList.contains('dark') ? 'dark' : 'light');
   themeToggle.classList.toggle('fa-sun');
   themeToggle.classList.toggle('fa-moon');
 });
  
  // 2. Mock availability for p1â€“p18
  const availability = {
    p1:  { '2025-06-10': ['09:00','10:00','11:00'], '2025-06-12': ['14:00','15:00'], '2025-06-15': ['08:30','09:30','10:30'] },
    p2:  { '2025-06-03': ['10:00','13:00','16:00'], '2025-06-04': ['09:00','11:00'], '2025-06-15': ['12:00','14:00'] },
    p3:  { '2025-06-08': ['08:00','09:00','10:00','11:00'], '2025-06-11': ['13:30','14:30'], '2025-06-16': ['15:00','16:00'] },
    p4:  { '2025-06-05': ['09:30','10:30','11:30'], '2025-06-09': ['14:00','15:00','16:00'], '2025-06-18': ['08:00','09:00'] },
    p5:  { '2025-06-07': ['08:15','09:15','10:15'], '2025-06-13': ['13:00','14:00'], '2025-06-17': ['10:00','11:00','12:00'] },
    p6:  { '2025-06-02': ['09:00','10:00'], '2025-06-14': ['11:00','12:00','13:00'], '2025-06-19': ['14:00','15:00'] },
    p7:  { '2025-06-06': ['08:30','09:30','10:30'], '2025-06-12': ['13:00','14:00','15:00'], '2025-06-20': ['09:00','10:00'] },
    p8:  { '2025-06-01': ['10:00','11:00','12:00'], '2025-06-11': ['14:30','15:30'], '2025-06-16': ['08:00','09:00','10:00'] },
    p9:  { '2025-06-04': ['09:00','10:00','11:00'], '2025-06-13': ['13:00','14:00'], '2025-06-18': ['15:00','16:00'] },
    p10: { '2025-06-03': ['08:00','09:00','10:00'], '2025-06-10': ['11:00','12:00','13:00'], '2025-06-17': ['14:00','15:00'] },
    p11: { '2025-06-05': ['09:30','10:30','11:30'], '2025-06-14': ['13:00','14:00','15:00'], '2025-06-19': ['08:00','09:00'] },
    p12: { '2025-06-02': ['10:00','11:00','12:00'], '2025-06-08': ['14:00','15:00'], '2025-06-20': ['09:00','10:00','11:00'] },
    p13: { '2025-06-07': ['08:00','09:00','10:00'], '2025-06-12': ['11:30','12:30','13:30'], '2025-06-18': ['14:00','15:00'] },
    p14: { '2025-06-03': ['09:15','10:15','11:15'], '2025-06-09': ['13:00','14:00','15:00'], '2025-06-16': ['08:00','09:00'] },
    p15: { '2025-06-05': ['08:30','09:30','10:30'], '2025-06-13': ['11:00','12:00','13:00'], '2025-06-19': ['14:30','15:30'] },
    p16: { '2025-06-02': ['10:00','11:00','12:00'], '2025-06-11': ['13:15','14:15'], '2025-06-17': ['09:00','10:00','11:00'] },
    p17: { '2025-06-04': ['09:00','10:00','11:00'], '2025-06-10': ['12:00','13:00','14:00'], '2025-06-15': ['15:00','16:00'] },
    p18: { '2025-06-01': ['08:00','09:00','10:00'], '2025-06-08': ['11:30','12:30','13:30'], '2025-06-20': ['14:00','15:00','16:00'] }
  };

  // 3. Calendar state
  let displayYear  = new Date().getFullYear();
  let displayMonth = new Date().getMonth();

  // 4. Render function
  function generateCalendar(yr, mth) {
    // header
    headerEl.innerText = new Date(yr, mth)
      .toLocaleString('default',{ month:'long', year:'numeric' });

    // weekdays
    calEl.innerHTML = '';
    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(wd => {
      const hd = document.createElement('div');
      hd.className = 'cell'; hd.style.fontWeight='600'; hd.innerText = wd;
      calEl.append(hd);
    });

    // blanks
    const firstDay = new Date(yr, mth, 1).getDay();
    for(let i=0; i<firstDay; i++){
      const blank = document.createElement('div');
      blank.className = 'cell closed';
      calEl.append(blank);
    }

    // days
    const availDates = availability[ profSelect.value ] || {};
    const today      = new Date();
    const daysInMon  = new Date(yr, mth+1, 0).getDate();

    for(let d=1; d<=daysInMon; d++){
      const dateKey = `${yr}-${String(mth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const open    = !!availDates[dateKey];
      const cell    = document.createElement('div');

      cell.className = `cell ${open?'open':'closed'}`;
      cell.innerText = d;

      if(open){
        cell.addEventListener('click', ()=>{
          // select
          calEl.querySelectorAll('.cell.selected')
            .forEach(x=>x.classList.remove('selected'));
          cell.classList.add('selected');
          // render times
          renderTimeSlots(dateKey, availDates[dateKey]);
        });
      }

      // today border
      if(today.getFullYear()===yr && today.getMonth()===mth && today.getDate()===d){
        cell.classList.add('today');
      }

      calEl.append(cell);
    }

    // clear old slots
    timeSlotsEl.innerHTML = '';
  }

  // 5. Time-slots renderer
  function renderTimeSlots(dateKey, slots){
    timeSlotsEl.innerHTML = `<h4>Available times on ${dateKey}:</h4>`;
    const ul = document.createElement('ul');
    ul.style.listStyle = 'none';
    ul.style.padding   = '0';

    slots.forEach(t => {
      const li  = document.createElement('li');
      const btn = document.createElement('button');
      btn.type      = 'button';
      btn.className = 'btn-sm';
      btn.innerText = t;
      btn.style.margin = '0.25rem';
      btn.addEventListener('click', () => {
        alert(`You picked ${dateKey} at ${t}`);
      });
      li.append(btn);
      ul.append(li);
    });

    timeSlotsEl.append(ul);
  }

  // 6. Initial render + controls
  generateCalendar(displayYear, displayMonth);
  prevBtn.onclick     = () => { displayMonth--; if(displayMonth<0){displayMonth=11;displayYear--;} generateCalendar(displayYear, displayMonth); };
  nextBtn.onclick     = () => { displayMonth++; if(displayMonth>11){displayMonth=0;displayYear++;} generateCalendar(displayYear, displayMonth); };
  profSelect.onchange = () => generateCalendar(displayYear, displayMonth);
  dateInput.onchange  = e => {
    const d = new Date(e.target.value);
    if(!isNaN(d)){ displayYear=d.getFullYear(); displayMonth=d.getMonth(); }
    generateCalendar(displayYear, displayMonth);
  };
  filterBtn.onclick   = () => alert('Filter coming soon');
  nextAvailBtn.onclick= () => alert('See highlighted dates');
});
</script>
<script>
(async()=>{
  // â”€â”€â”€ CORE AI CALLER & HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function callOpenAI(messages) {
    try {
      const res = await fetch('/.netlify/functions/openai-proxy', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages })
      });
      if (!res.ok) {
        const err = await res.text();
        throw new Error(err);
      }
      const j = await res.json();
      return j.choices?.[0]?.message?.content.trim() || 'âš ï¸ Unexpected AI response.';
    } catch(err) {
      if (err.message.includes('Sandbox.Timedout')) {
        return 'âš ï¸ Server busyâ€”please try again shortly.';
      }
      return 'âš ï¸ Error: '+err.message;
    }
  }
  function showToast(msg) {
    const t = document.createElement('div');
    t.className = 'toast';
    t.innerText = msg;
    document.body.append(t);
    requestAnimationFrame(()=>t.classList.add('visible'));
    setTimeout(()=>t.remove(),3000);
  }
  function formatHTML(txt) {
    return txt
      .replace(/^#### (.*$)/gm,'<h4>$1</h4>')
      .replace(/^### (.*$)/gm,'<h3>$1</h3>')
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .replace(/```([\s\S]+?)```/g,'<pre><code>$1</code></pre>')
      .split(/\n{2,}/g).map(p=>`<p>${p.trim()}</p>`).join('');
  }
  function injectTools(panel) {
    if (panel.querySelector('.tool-row')) return;
    const row = document.createElement('div');
    row.className = 'tool-row';
    row.innerHTML = `
      <button class="copy-btn"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"><i class="fas fa-download"></i></button>
    `;
    panel.append(row);
  }
  const PHASE = {
    findMatch: 'Matchingâ€¦',
    filterSlots: 'Filteringâ€¦',
    bookNow: 'Preparingâ€¦',
    confirmBooking: 'Confirmingâ€¦',
    submitFeedback: 'Submittingâ€¦',
    optimizeStaffing: 'Analyzingâ€¦',
    sendChat: 'Thinkingâ€¦'
  };
  function startSpinner(panel, phase) {
    panel.hidden = false;
    panel.innerHTML = `
      <div class="spin-text">${PHASE[phase]||'Thinkingâ€¦'}</div>
      <div class="spinner"></div>
    `;
  }

  document.addEventListener('DOMContentLoaded',()=>{

    // â”€â”€â”€ 1. PROVIDER MATCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const providers = [
      { id:'p1', name:'Dr. Kwame Asante', spec:'Pulmonologist, Korle Bu' },
      { id:'p2', name:'Dr. Abena Owusu', spec:'Cardiologist, 37 Military' },
      { id:'p3', name:'Dr. Kojo Mensah', spec:'Psychiatrist, Ridge' },
      { id:'p4', name:'Dr. Yaa Dufie', spec:'Dietitian, Nyaho Medical' },
      { id:'p5', name:'Dr. Nana Adjei', spec:'GP, Cape Coast' },
      { id:'p6', name:'Dr. Efua Amponsah', spec:'Endocrinologist, LEKMA' },
      { id:'p7', name:'Dr. Michael Addo', spec:'Neurologist, 37 Military' },
      { id:'p8', name:'Dr. Grace Ofori', spec:'Dermatologist, Accra Derm.' },
      { id:'p9', name:'Dr. Joseph Kumi', spec:'Ortho Surgeon, Komfo Anokye' },
      { id:'p10',name:'Dr. Ama Brew', spec:'Pediatrician, Trust Hosp.' },
      // + 8 more creative roles
      { id:'p11', name:'Ms. Akosua Baah', spec:'PT, Tema General' },
      { id:'p12', name:'Mr. Daniel Boakye', spec:'Pharmacist, Ridge' },
      { id:'p13', name:'Mrs. Esther Kumi', spec:'OT, Cape Coast' },
      { id:'p14', name:'Ms. Joy Mensah', spec:'Speech Therapist, LEKMA' },
      { id:'p15', name:'Dr. Paul Yeboah', spec:'Dermatologist, Korle Bu' },
      { id:'p16', name:'Dr. Linda Frimpong', spec:'Nephrologist, 37 Military' },
      { id:'p17', name:'Mr. Kwesi Owusu', spec:'Nutritionist, Nyaho Med.' },
      { id:'p18', name:'Ms. Abena Boateng', spec:'Psychologist, Accra Psych.' }
    ];
    document.getElementById('findMatch').onclick = async e=>{
      e.preventDefault();
      const btn = e.currentTarget;
      const concern = document.getElementById('concernInput').value.trim();
      if (!concern) return showToast('Enter your chief concern');
      const urgency = document.getElementById('urgencyInput').value;
      const lang = document.getElementById('languageInput').value;
      const sys = `You are AI match. Providers:\n${providers.map(p=>`- ${p.name}, ${p.spec}`).join('\n')}`;
      const user = `Concern="${concern}", urgency="${urgency}", lang="${lang}". Pick best provider.`;
      btn.disabled = true; btn.innerText = PHASE.findMatch;
      const panel = document.getElementById('matchResults');
      try {
        startSpinner(panel,'findMatch');
        const reply = await callOpenAI([
          {role:'system',content:sys},
          {role:'user',content:user}
        ]);
      // build matchResults including both the AI text *and* the action buttons
   panel.innerHTML = `
     <div class="result-content">${formatHTML(reply)}</div>
     <ul id="providerList">
       <li data-id="p1">Dr. Kwame Asante â€“ Pulmonologist</li>
       <li data-id="p2">Dr. Abena Owusu â€“ Cardiologist</li>
       <li data-id="p3">Dr. Kojo Mensah â€“ Psychiatrist</li>
       <li data-id="p4">Dr. Yaa Dufie â€“ Dietitian</li>
       <li data-id="p5">Dr. Nana Adjei â€“ General Practitioner</li>
       <li data-id="p6">Dr. Efua Amponsah â€“ Endocrinologist</li>
       <li data-id="p7">Dr. Michael Addo â€“ Neurologist</li>
       <li data-id="p8">Dr. Grace Ofori â€“ Dermatologist</li>
       <li data-id="p9">Dr. Joseph Kumi â€“ Orthopedic Surgeon</li>
       <li data-id="p10">Dr. Ama Brew â€“ Pediatrician</li>

     </ul>
     <div class="match-actions">
       <button id="proceedMatch" class="btn">Proceed with AI choice</button>
       <button id="chooseOwn"   class="btn btn-outline">Choose own provider</button>
     </div>`;

  // 1) let the user pick one of these
  const items = panel.querySelectorAll('#providerList li');
  items.forEach(li => li.addEventListener('click', () => {
    items.forEach(x => x.classList.remove('selected'));
    li.classList.add('selected');
  }));

  // 2) wire up â€œProceedâ€
  document.getElementById('proceedMatch').addEventListener('click', () => {
    const sel = panel.querySelector('#providerList li.selected') || items[0];
    startAppointmentFlow(sel.dataset.id);
    panel.hidden = true;
  });
  document.getElementById('chooseOwn').addEventListener('click', () => {
    panel.hidden = true;
    document.getElementById('appointmentFlow').hidden = false;
  });
    injectTools(panel);
    panel.hidden = false;
    // capture the AI-chosen provider (assumes AI reply highlights one <li data-id="â€¦">)
    const chosenLi = panel.querySelector('li.selected, li.highlight'); 
    const providerId = chosenLi?.dataset.id || profSelect.value;
    document.getElementById('proceedMatch').onclick = () => startAppointmentFlow(providerId);
    document.getElementById('chooseOwn').onclick   = () => {
      panel.hidden = true;
      document.getElementById('appointmentFlow').hidden = false;
    };        
      } catch(err) {
        showToast(err);
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-search"></i> Find My Specialist';
      }
    };
    document.querySelector('#matchResults .close-btn').onclick = ()=> {
      document.getElementById('matchResults').hidden = true;
    };

   /** Initialize merged flow **/
function startAppointmentFlow(selectedId) {
  const flow = document.getElementById('appointmentFlow');
  const headerName = providers.find(p=>p.id===selectedId).name;
  document.getElementById('chosenProvider').innerText = headerName;
  flow.hidden = false;
  generateCalendar(displayYear, displayMonth); // reuse existing
  profSelect.value = selectedId;
}

// when user clicks on a time slot button:
document.body.addEventListener('click', e=>{
  if (e.target.matches('#timeSlots button')) { 
    // capture date/time
    const date = e.target.closest('#timeSlots').querySelector('h4').textContent.split(' on ')[1];
    const time = e.target.innerText;
    // store globally
    window.selectedDate = date;
    window.selectedTime = time;
    // hide calendar, show final form
    document.getElementById('calendar').hidden = true;
    document.getElementById('timeSlots').hidden = true;
    const form = document.getElementById('finalBookingForm');
    form.hidden = false;
    document.getElementById('summarySelection').innerHTML =
      `<p>${date} @ ${time}</p>`;
  }
});

// confirm & book flow
document.getElementById('confirmBookingFinal').onclick = async ()=> {
  const name = document.getElementById('clientNameFinal').value.trim();
  if(!name) return showToast('Enter your name');
  // simulate loading
  showToast('Bookingâ€¦');
  await new Promise(r=>setTimeout(r, 1500));
  // creative success
  alert(`ğŸ‰ Hey ${name}! Your appointment is booked on ${window.selectedDate} at ${window.selectedTime}. Canâ€™t wait to see you!`);
};
document.getElementById('editSelection').onclick = () => {
  // reset in-page without full reload
  document.getElementById('calendar').hidden       = false;
  document.getElementById('timeSlots').hidden      = false;
  document.getElementById('finalBookingForm').hidden = true;
  document.querySelectorAll('.cell.selected').forEach(c=>c.classList.remove('selected'));
  document.getElementById('summarySelection').innerHTML = '';
};

    // â”€â”€â”€ 3. BOOK APPOINTMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const modal = document.getElementById('bookingModal');
    document.getElementById('bookNow').onclick = e=>{
      e.preventDefault();
      const n=document.getElementById('clientName').value.trim();
      const p=document.getElementById('professionalSelect').value;
      const dt=document.getElementById('apptDate').value;
      const tm=document.getElementById('apptTime').value;
      if(!n||!dt||!tm) return showToast('Fill all fields');
      modal.hidden = false;
      document.getElementById('bookingSummary').innerHTML = `
        <p><strong>${n}</strong> â†’ <em>${p}</em></p><p>${dt} @ ${tm}</p>`;
    };
    document.querySelector('#bookingModal .close-modal').onclick = ()=>modal.hidden=true;
    document.getElementById('confirmBooking').onclick = async ()=>{
      modal.hidden = true; showToast(PHASE.confirmBooking);
      const reply = await callOpenAI([
        {role:'system',content:'You are appointment assistant.'},
        {role:'user',content:'Confirm booking.'}
      ]);
      alert(reply);
    };

    // â”€â”€â”€ 4. DASHBOARD TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let appointments = [
      { id:1, doc:'Dr. Abena Owusu', datetime:'2025-05-30T14:00', status:'upcoming' },
      { id:2, doc:'Dr. Kojo Mensah', datetime:'2025-04-12T10:00', status:'past' }
    ];
    function renderDashboard() {
      ['upcoming','past'].forEach(tab=>{
        const container = document.getElementById(tab);
        container.querySelector('ul').innerHTML = appointments
          .filter(a=>a.status===tab)
          .map(a=>`
            <li data-id="${a.id}">
              <strong>${a.doc}</strong> â€“ ${a.datetime.replace('T',' ')}
              ${tab==='upcoming'
                ? `<button class="btn-sm rescheduleBtn">Reschedule</button>
                   <button class="btn-sm cancelBtn">Cancel</button>`
                : `<button class="btn-sm downloadSummary">Summary</button>
                   <button class="btn-sm downloadInvoice">Invoice</button>`
              }
            </li>`).join('');
      });
      // wire buttons
      document.querySelectorAll('.rescheduleBtn').forEach(btn=>{
        btn.type='button';
        btn.addEventListener('click', e=>{
          const li = e.target.closest('li');
          const id = +li.dataset.id;
          const newDt = prompt('New datetime (YYYY-MM-DDThh:mm):');
          if(newDt){
            appointments.find(a=>a.id===id).datetime=newDt;
            renderDashboard();
            showToast('Rescheduled');
          }
        });
      });
      document.querySelectorAll('.cancelBtn').forEach(btn=>{
        btn.type='button';
        btn.addEventListener('click', e=>{
          const id = +e.target.closest('li').dataset.id;
          appointments = appointments.filter(a=>a.id!==id);
          renderDashboard();
          showToast('Cancelled');
        });
      });
      document.querySelectorAll('.downloadSummary').forEach(btn=>{
        btn.type='button';
        btn.addEventListener('click', ()=> {
          const blob=new Blob(['Visit summary...'],'text/plain');
          const a=document.createElement('a');
          a.href=URL.createObjectURL(blob); a.download='summary.txt'; a.click();
        });
      });
      document.querySelectorAll('.downloadInvoice').forEach(btn=>{
        btn.type='button';
        btn.addEventListener('click', ()=> {
          const blob=new Blob(['Invoice pdf...'],'application/pdf');
          const a=document.createElement('a');
          a.href=URL.createObjectURL(blob); a.download='invoice.pdf'; a.click();
        });
      });
    }
    renderDashboard();
    document.querySelectorAll('.dashboard-tabs button').forEach(b=>{
      b.type='button';
      b.addEventListener('click',()=>{
        document.querySelectorAll('.dashboard-tabs button')
          .forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        document.querySelectorAll('.dashboard-list')
          .forEach(d=>d.hidden = d.id!==b.dataset.tab);
      });
    });


    // â”€â”€â”€ 5. FEEDBACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('submitFeedback').onclick = async ()=>{
      const r=document.getElementById('ratingInput').value;
      const c=document.getElementById('feedbackInput').value.trim();
      const panel=document.createElement('div');
      panel.className='response';
      startSpinner(panel,'submitFeedback');
      document.body.append(panel);
      const scan = await callOpenAI([
        {role:'system',content:'You are feedback analyzer.'},
        {role:'user',content:`Rating=${r}, Comment="${c}"`}
      ]);
      panel.innerHTML = `<div class="result-content">${scan.includes('red-flag')
        ? 'âš ï¸ Red-flag feedback routed.' : 'Thanks for your feedback!'}</div>`;
      injectTools(panel);
    };

    // â”€â”€â”€ 6. ANALYTICS & OPTIMIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const noShowCtx = document.getElementById('noShowChart').getContext('2d');
    const peakCtx   = document.getElementById('peakTimesChart').getContext('2d');
    const noShowChart = new Chart(noShowCtx, {
      type:'bar',
      data:{labels:['W1','W2','W3','W4'],datasets:[{label:'No-Show %',data:[10,12,8,15]}]}
    });
    const peakChart = new Chart(peakCtx, {
      type:'line',
      data:{labels:['Mon','Tue','Wed','Thu','Fri'],datasets:[{label:'Bookings',data:[30,45,60,55,70]}]}
    });
    document.getElementById('optimizeStaffing').type='button';
    document.getElementById('optimizeStaffing').addEventListener('click', async ()=>{
      document.getElementById('optimizationResult').hidden = false;
      document.querySelector('#optimizationResult .result-content').innerText = 'Analyzingâ€¦';
      try {
        const advice = await callOpenAI([
          {role:'system',content:'You are a staffing optimization AI.'},
          {role:'user',content:'Provide staffing suggestions based on no-show & peak data.'}
        ]);
        document.querySelector('#optimizationResult .result-content').innerText = advice;
      } catch(e){
        showToast(e.message);
      }
    });
    document.querySelector('#optimizationResult .close-btn').addEventListener('click', ()=>{
      document.getElementById('optimizationResult').hidden = true;
    });
    // â”€â”€â”€ 7. LIVE AI CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const chatBox = document.getElementById('chatBox');
    let lastDay = null;
    let chatHistory = JSON.parse(localStorage.getItem('liveChat')||'[]');
    function renderChat(who,txt,iso){
      const d=new Date(iso),day=d.toDateString();
      if(day!==lastDay){
        const sep=document.createElement('div');
        sep.className='chat-date';
        sep.innerText = (day===new Date().toDateString()?'Today':day);
        chatBox.append(sep);
        lastDay=day;
      }
      const m=document.createElement('div');
      m.className=who==='user'?'user-msg':'bot-msg';
      m.innerHTML=`<div class="msg-text">${formatHTML(txt)}</div>
                   <div class="msg-ts">${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>`;
      chatBox.append(m);
      chatBox.scrollTop=chatBox.scrollHeight;
    }
    chatHistory.forEach(m=>renderChat(m.role,m.text,m.iso));
    document.getElementById('sendChat').onclick = async ()=>{
      const txt=document.getElementById('chatInput').value.trim();
      if(!txt) return showToast('Type a question');
      const iso=new Date().toISOString();
      renderChat('user',txt,iso);
      chatHistory.push({role:'user',text:txt,iso});
      document.getElementById('chatInput').value='';
      const spinner=document.createElement('div');
      spinner.className='bot-msg';
      spinner.innerHTML=`<div class="spin-text">${PHASE.sendChat}</div>
                         <div class="spinner"></div>`;
      chatBox.append(spinner);
      const reply=await callOpenAI([
        {role:'system',content:'You are chat support.'},
        {role:'user',content:txt}
      ]);
      spinner.remove();
      renderChat('bot',reply,new Date().toISOString());
      chatHistory.push({role:'bot',text:reply,iso:new Date().toISOString()});
      localStorage.setItem('liveChat',JSON.stringify(chatHistory));
    };
    document.getElementById('clearChat').onclick = ()=>{
      chatBox.innerHTML=''; chatHistory=[]; lastDay=null;
      localStorage.removeItem('liveChat');
    };
    document.getElementById('showHistory').onclick = ()=>{
      const modal=document.getElementById('chatHistoryModal');
      const list=document.getElementById('chatHistoryList');
      list.innerHTML = chatHistory.map((m,i)=>`
        <div class="history-item">
          <span><strong>${m.role==='user'?'You':'AI'}:</strong> ${m.text}</span>
          <div class="msg-ts">${new Date(m.iso).toLocaleString()}</div>
          <button class="delete-history" data-i="${i}">&times;</button>
        </div>`).join('');
      list.querySelectorAll('.delete-history').forEach(btn=>{
        btn.onclick=e=>{
          const i=+e.target.dataset.i;
          chatHistory.splice(i,1);
          localStorage.setItem('liveChat',JSON.stringify(chatHistory));
          e.target.closest('.history-item').remove();
        };
      });
      modal.hidden=false;
    };
    document.querySelector('#chatHistoryModal .close-modal').onclick = ()=>{
      document.getElementById('chatHistoryModal').hidden=true;
    };

  }); // DOMContentLoaded
})(); // IIFE
</script>
  
</body>
</html>
