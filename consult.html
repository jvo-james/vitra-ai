<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>E-Pharmacy AI Portal</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
<script src="https://js.paystack.co/v1/inline.js"></script>
  <style>
    :root {
      --cb-primary: #3b3f88;
      --cb-primary-alt: #5c4d99;
      --cb-accent: #f08a5d;
      --cb-bg: #f7f6f9;
      --cb-surface: #ffffff;
      --cb-text: #2d2d2d;
      --radius: 0.75rem;
      --padding: 1rem;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: 0.3s ease;
      --sidebar-width: 220px;
      --sidebar-collapsed-width: 60px;
    }
    html.dark {
      --cb-bg: #1a1b2e;
      --cb-surface: #2d2d44;
      --cb-text: #e0e0e0;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: var(--transition);
    }
    body {
      font-family: "Montserrat", sans-serif;
      background: var(--cb-bg);
      color: var(--cb-text);
      line-height: 1.5;
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    img {
      max-width: 100%;
      display: block;
    }

    /* ─── Layout ─────────────────────────────────────────────────── */
    aside#sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      background: var(--cb-surface);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }
   body.sidebar-shrink aside#sidebar {
  width: var(--sidebar-collapsed-width);
}

/* hide all link text when collapsed, keep icons */
body.sidebar-shrink aside#sidebar nav li a span,
body.sidebar-shrink aside#sidebar .brand span {
  display: none;
  overflow: hidden;
}
    body.sidebar-shrink aside#sidebar nav li a,
body.sidebar-shrink aside#sidebar .brand {
  justify-content: center;
}
    aside#sidebar .brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: var(--padding);
      background: var(--cb-primary);
      color: #fff;
      font-size: 1.25rem;
    }
    aside#sidebar nav {
      flex: 1;
      overflow-y: auto;
    }
    aside#sidebar nav ul {
      list-style: none;
    }
    aside#sidebar nav li a {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem var(--padding);
      border-radius: var(--radius);
      color: var(--cb-text);
    }
    aside#sidebar nav li.active a,
    aside#sidebar nav li a:hover {
      background: var(--cb-primary-alt);
      color: #fff;
    }
    #shrinkSidebar {
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--cb-primary);
      cursor: pointer;
      margin: var(--padding);
    }
    header {
      position: sticky;
      top: 0;
      margin-left: var(--sidebar-width);
      background: var(--cb-surface);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--padding);
      height: 60px;
      box-shadow: var(--shadow);
      z-index: 1001;
    }
    body.sidebar-shrink header {
      margin-left: var(--sidebar-collapsed-width);
    }
    header h1 {
      font-size: 1.25rem;
      color: var(--cb-primary);
    }
    #hamburger,
    #themeToggle {
      font-size: 1.5rem;
      color: var(--cb-primary);
      cursor: pointer;
    }
    main,
    section,
    footer {
      margin-left: var(--sidebar-width);
      padding: var(--padding);
      transition: margin-left var(--transition);
    }
    body.sidebar-shrink main,
    body.sidebar-shrink section,
    body.sidebar-shrink footer {
      margin-left: var(--sidebar-collapsed-width);
    }

    /* ─── Module Base ────────────────────────────────────────────── */
    section.module {
      background: var(--cb-surface);
      border-radius: var(--radius);
      padding: var(--padding);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }
    section.module h2 {
      font-size: 1.5rem;
      color: var(--cb-primary);
      margin-bottom: 0.5rem;
    }
    section.module .desc {
      color: var(--cb-primary-alt);
      margin-bottom: 1rem;
    }
 #matchResults .response {
 position: relative;
  padding-top: 2rem; /* give room for close */
 }
    /* ─── Hero & Quick Actions ─────────────────────────────────── */
    #hero {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--padding);
      background: var(--cb-primary-alt);
      color: #fff;
      padding: 2rem var(--padding);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    #hero .hero-text h2 {
      font-size: 2.25rem;
    }
    #hero .hero-text h2,
hero-text .desc {
 color: var(--secondary);
}
    #hero .btn {
      background: var(--cb-accent);
      color: #fff;
    }
    #quickActions .quick-actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    #quickActions .quick-actions .btn {
      flex: 1 1 auto;
      min-width: 160px;
    }
    #quickActions .view-tabs {
      display: flex;
      gap: 0.5rem;
    }
    #quickActions .view-tabs .btn-sm {
      background: var(--cb-primary-alt);
      color: #fff;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    #quickActions .tips {
      flex: 1 1 100%;
      text-align: right;
      color: var(--cb-bg);
      font-size: 0.9rem;
    }
    #quickActions .tips a {
      text-decoration: underline;
       color: var(--cb-accent);

      cursor: pointer;
    }

    /* ─── Forms & Inputs ──────────────────────────────────────── */
    form label {
      display: block;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    input,
    select,
    textarea,
    button.btn-sm {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--cb-primary-alt);
      border-radius: var(--radius);
      background: var(--cb-bg);
      color: var(--cb-text);
      font-size: 1rem;
    }
    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--cb-accent);
      box-shadow: 0 0 0 3px rgba(240, 138, 93, 0.3);
      outline: none;
    }
    button.btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--cb-accent);
      color: #fff;
      border: none;
      cursor: pointer;
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-size: 1rem;
    }
    button.btn:hover {
      background: #d4724f;
    }

    /* ─── Match Panel ─────────────────────────────────────────── */
    #matchResults .result-content {
      margin: 1rem 0;
      font-size: 1.1rem;
    }
    .match-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }
#matchResults .close-btn {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  background: var(--cb-accent);
  color: #fff;
  border-radius: 50%;
  width: 2rem; height: 2rem;
  display: flex; align-items:center; justify-content:center;
 }
    /* ─── Calendar & Time Slots ──────────────────────────────── */
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .month-nav .btn-sm {
      background: var(--cb-primary-alt);
      color: #fff;
    }
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: var(--cb-bg);
      border-radius: var(--radius);
    }
    #calendar .cell {
      padding: 0.75rem;
      background: var(--cb-surface);
      text-align: center;
      cursor: pointer;
      transition: transform var(--transition);
    }
    #calendar .cell.closed {
      background: #f0f0f0;
      color: var(--cb-muted);
      cursor: not-allowed;
    }
    #calendar .cell.open {
      background: var(--cb-accent);
      color: #fff;
      font-weight: bold;
    }
    #calendar .cell.open:hover {
      transform: scale(1.05);
      z-index: 1;
    }
    #calendar .cell.today {
      border: 2px dashed var(--cb-primary);
    }
    #timeSlots h4 {
      font-size: 1.1rem;
      color: var(--cb-primary-alt);
      margin-bottom: 0.5rem;
    }
    #timeSlots ul {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      list-style: none;
      padding: 0;
    }
    #timeSlots ul li button {
      background: var(--cb-primary-alt);
      color: #fff;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      box-shadow: var(--shadow);
      cursor: pointer;
    }

    /* ─── Final Booking ──────────────────────────────────────── */
    #finalBookingForm label {
      margin-bottom: 1rem;
    }

    /* ─── Rich Dashboard ────────────────────────────────────── */
    #feature-rich-dashboard .dashboard-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    #feature-rich-dashboard .dashboard-tabs button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: var(--radius);
      background: var(--cb-primary-alt);
      color: #fff;
      cursor: pointer;
    }
    #feature-rich-dashboard .dashboard-tabs button.active {
      background: var(--cb-accent);
    }
    #feature-rich-dashboard .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--padding);
    }
    #feature-rich-dashboard .card {
      background: var(--cb-surface);
      padding: var(--padding);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    #feature-rich-dashboard .card .details {
      flex: 1;
    }
    #feature-rich-dashboard .card .actions button,
    #feature-rich-dashboard .card .actions a {
      background: var(--cb-primary-alt);
      color: #fff;
      border: none;
      padding: 0.5rem;
      border-radius: var(--radius);
      margin-left: 0.25rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* ─── Toast ─────────────────────────────────────────────── */
    .toast {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      background: var(--cb-primary-alt);
      color: #fff;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      z-index: 2000;
    }
    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* ─── Responsive ───────────────────────────────────────── */
    @media (max-width: 1024px) {
      section.module {
        padding: 0.75rem;
      }
    }
    @media (max-width: 768px) {
      aside#sidebar {
        transform: translateX(-100%);
        position: absolute;
      }
      body.sidebar-open aside#sidebar {
        transform: translateX(0);
      }
      header {
        margin-left: 0;
      }
      main,
      section,
      footer {
        margin-left: 0;
        padding: 0.5rem;
      }
      #hero {
        grid-template-columns: 1fr;
        padding: 1.5rem;
      }
    }
    /* ─── Upcoming Calendar Entries ───────────────────────── */
#upcomingCalendarContainer .calendar-entry {
  padding: .5rem;
  margin-bottom: .5rem;
  border-left: 4px solid var(--cb-accent);
  background: var(--cb-bg);
}
/* ─── CSS for Provider Matching + Scheduling ─────────────────── */
#providerMatch .response,
#providerMatch #appointmentFlow {
  margin-top: 1.5rem;
}

#matchResults {
  position: relative;
  padding: 1.5rem;
  background: var(--cb-surface);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
#matchResults .close-btn {
  position: absolute;
  top: 0.5rem; right: 0.5rem;
  background: var(--cb-accent);
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 2rem; height: 2rem;
  display:flex; align-items:center; justify-content:center;
  cursor: pointer;
}
#matchResults .card {
  display:flex; align-items:center; gap:1rem;
  margin-bottom:1rem;
}
#matchResults .details h4 { margin-bottom:0.25rem; }

.month-nav {
  display:flex; align-items:center; justify-content:center; gap:1rem;
  margin-bottom:1rem;
}
.btn-sm {
  background: var(--cb-primary-alt);
  color:#fff;
  border:none;
  border-radius:var(--radius);
  padding:0.5rem 1rem;
  cursor:pointer;
}

.calendar-grid {
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  gap:1px;
  margin-bottom:1rem;
}
.calendar-grid .cell {
  background: var(--cb-surface);
  padding:0.5rem;
  text-align:center;
  cursor:pointer;
  transition:transform 0.2s;
}
.calendar-grid .cell.closed {
  background:#f0f0f0;
  color:var(--cb-muted);
  cursor:not-allowed;
}
.calendar-grid .cell.open {
  background:var(--cb-accent);
  color:#fff;
  font-weight:600;
}
.calendar-grid .cell.today {
  border:2px dashed var(--cb-primary);
}
.calendar-grid .cell.open:hover {
  transform:scale(1.05);
}

#timeSlots h4 { margin-bottom:0.5rem; color:var(--cb-primary-alt); }
#timeSlots ul { display:flex; flex-wrap:wrap; gap:0.5rem; padding:0; list-style:none; }
#timeSlots ul li button {
  background:var(--cb-primary-alt);
  color:#fff;
  border:none;
  padding:0.5rem 1rem;
  border-radius:var(--radius);
  cursor:pointer;
}
 .modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center;
    z-index: 2000;
  }
  .modal-content {
    background: var(--cb-surface); padding: 1.5rem; border-radius: var(--radius);
    max-width: 400px; width: 90%; box-shadow: var(--shadow);
  }
  .modal-content h3 { margin-top: 0; color: var(--cb-primary); }
  .modal-content button { margin-right: 0.5rem; }
     .modal[hidden] {
    display: none !important;
  }
    #urgentMatchResults .close-btn {
   position: absolute;
   top: 0.5rem;
   right: 0.5rem;
   background: var(--cb-accent);
   color: #fff;
   border-radius: 50%;
   width: 2rem; height: 2rem;
   display:flex; align-items:center; justify-content:center;
   cursor:pointer;
 }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside id="sidebar">
    <div class="brand">
      <i class="fas fa-calendar-check"></i>
      <span>Vitra AI Consult</span>
    </div>
    <nav>
      <ul>
        <li class="active">
          <a href="#providerMatch"><i class="fas fa-user-md"></i><span>Provider Match</span></a>
        </li>
        <li>
          <a href="#appointmentFlow"><i class="fas fa-calendar-alt"></i><span>Schedule</span></a>
        </li>
        <li>
          <a href="#feature-rich-dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        </li>
      </ul>
    </nav>
    <button id="shrinkSidebar" title="Toggle sidebar"><i class="fas fa-chevron-left"></i></button>
  </aside>

  <!-- Header -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>AI-Powered Consultation Booking</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <main>
    <!-- Hero -->
    <section id="hero" class="module">
      <div class="hero-text">
        <h2><i class="fas fa-stethoscope"></i> Seamless Consultation Booking</h2>
        <p class="desc">From instant provider match to one-click appointment, powered by AI.</p>
        <button class="btn hero-btn"><i class="fas fa-book-medical"></i> Book an Appointment</button>
      </div>
      <div class="hero-graphic">
        <img src="9E2CDE35-303A-4C5F-A4A9-1B0420CF8B0C.png" alt="Consultation illustration" />
      </div>
    </section>

    <!-- Quick Actions -->
    <section id="quickActions" class="module">
      <div class="quick-actions">
        <button class="btn"><i class="fas fa-calendar-plus"></i> Book an Appointment</button>
        <div class="view-tabs">
          <button id="viewUpcoming" class="btn-sm"><i class="fas fa-calendar-check"></i> View Upcoming</button>
          <button id="viewPast" class="btn-sm"><i class="fas fa-history"></i> View Past</button>
        </div>
        <p class="tips"><i class="fas fa-info-circle"></i> Need urgent care? <a id="urgentCare">Click here</a></p>
      </div>
    </section>

  <!-- Urgent Booking Module (AI-match → schedule → details → review → payment) -->
<section id="urgentBooking" class="module" hidden>
  <h2><i class="fas fa-exclamation-triangle"></i> Urgent Appointment</h2>
  <p class="desc">Describe your concern, pick a specialist, then choose date/time. ₵500 non-refundable fee.</p>

  <!-- Step 1: Concern input -->
  <div id="urgentStep1">
    <label>
      <i class="fas fa-notes-medical"></i> Chief Concern:
      <input type="text" id="urgentConcernInput" placeholder="e.g. severe headache" required />
    </label>
    <button type="button" id="urgentFindMatchBtn" class="btn">
      <i class="fas fa-search"></i> Find Specialist
    </button>
    <button type="button" id="urgentStep1Back" class="btn-sm" hidden>Back</button>
  </div>

  <!-- Step 2: Display the AI-picked specialist -->
  <div id="urgentMatchResults" class="response" hidden>
    <button class="close-btn"><i class="fas fa-times"></i></button>
    <div class="card">
      <i class="fas fa-user-md fa-2x"></i>
      <div class="details">
        <h4 id="urgentMatchedName"></h4>
        <p id="urgentMatchedSpec"></p>
      </div>
    </div>
    <button id="urgentScheduleBtn" class="btn">
      <i class="fas fa-calendar-alt"></i> Schedule with this Specialist
    </button>
    <button type="button" id="urgentStep2Back" class="btn-sm">Back</button>
    <button type="button" id="urgentStep2Close" class="btn-sm">Close</button>

  </div>

  <!-- Step 3: Calendar & Time -->
 <div id="urgentCalendarFlow" hidden>
    <label>
      Date:
     <input 
      type="date" 
      id="urgentDate" 
    />
    </label>
    <label>
      Time:
      <input type="time" id="urgentTime" />
    </label>
    <button id="urgentNextToDetails" class="btn">
      <i class="fas fa-arrow-right"></i> Next
    </button>
   <button type="button" id="urgentStep3Back" class="btn-sm">Back</button>
    <button type="button" id="urgentStep3Close" class="btn-sm">Close</button>

  </div>

  <!-- Step 4: Your Details & Confirm (opens review-modal) -->
  <form id="urgentDetailsForm" hidden class="module">
    <label>
      <i class="fas fa-user"></i> Your Name:
      <input id="urgentClientName" placeholder="Full Name" required />
    </label>
    <label>
      <i class="fas fa-envelope"></i> Email:
      <input id="urgentClientEmail" type="email" required />
    </label>
    <button type="button" id="urgentConfirmBtn" class="btn">
      <i class="fas fa-check"></i> Review & Pay ₵500
    </button>
     <button type="button" id="urgentStep4Back" class="btn-sm">Back</button>
    <button type="button" id="urgentStep4Close" class="btn-sm">Close</button>
  </form>
</section>
    
    <!-- ─── Provider Matching & Scheduling Section ─────────────────── -->
<section id="providerMatch" class="module">
  <h2><i class="fas fa-user-md"></i> Find Your Specialist</h2>
  <p class="desc">
    Describe your health concern and let our AI pick the best in-network professional for you.
  </p>

  <!-- Step 1: Gather user inputs -->
  <form id="matchForm">
    <label>
      <i class="fas fa-notes-medical"></i> Chief Concern:
      <input type="text" id="concernInput" placeholder="e.g. persistent cough" required />
    </label>
    <label>
      <i class="fas fa-exclamation-circle"></i> Urgency:
      <select id="urgencyInput">
        <option>Low</option>
        <option>Medium</option>
        <option>High</option>
      </select>
    </label>
    <label>
      <i class="fas fa-language"></i> Preferred Language:
      <select id="languageInput">
        <option>English</option>
        <option>Twi</option>
        <option>Ga</option>
      </select>
    </label>
    <button type="button" id="findMatchBtn" class="btn">
      <i class="fas fa-search"></i> Predict Specialist
    </button>
    </form>

  <!-- Step 2: Display the AI-picked specialist -->
  <div id="matchResults" class="response" hidden>
    <button id="matchResultsClose" class="close-btn"><i class="fas fa-times"></i></button>
    <button id="matchResultsBack" class="btn-sm">Back</button>
    <div class="card">
      <i class="fas fa-user-md fa-2x"></i>
      <div class="details">
        <h4 id="matchedName"></h4>
        <p id="matchedSpec"></p>
      </div>
    </div>
    <button id="scheduleMatchBtn" class="btn">
      <i class="fas fa-calendar-alt"></i> Schedule with this Specialist
    </button>
  </div>

  <!-- Step 3: Calendar & Time Slots for the matched provider -->
  <div id="appointmentFlow" hidden>
    <button id="appointmentFlowClose" class="btn-sm">Close</button>
    <h3><i class="fas fa-calendar-alt"></i> Schedule with <span id="chosenProvider"></span></h3>

    <div class="month-nav">
      <button id="prevMonth" class="btn-sm"><i class="fas fa-chevron-left"></i></button>
      <div id="calendarHeader"></div>
      <button id="nextMonth" class="btn-sm"><i class="fas fa-chevron-right"></i></button>
    </div>
    <div id="calendar" class="calendar-grid"></div>
    <div id="timeSlots"></div>

    <form id="confirmForm" hidden class="module">
      <button id="confirmStep4Close" class="btn-sm">Close</button>
      <button id="confirmStep4Back" class="btn-sm">Back</button>
      <h4><i class="fas fa-check-circle"></i> Confirm Your Appointment</h4>
      <label>
        <i class="fas fa-user"></i> Your Name:
        <input id="clientName" placeholder="Full Name" required />
      </label>
      <label>
        <i class="fas fa-envelope"></i> Email:
        <input id="clientEmail" type="email" required />
      </label>
      <p id="summaryText"></p>
      <button id="confirmBtn" type="button" class="btn">
        <i class="fas fa-check"></i> Confirm
      </button>
    </form>
  </div>
</section>

    
   
    <!-- Rich Dashboard -->
    <section id="feature-rich-dashboard" class="module">
      <h2><i class="fas fa-tachometer-alt"></i> Rich Dashboard</h2>
      <div class="dashboard-tabs">
        <button data-tab="rich-upcoming" class="active">
          <i class="fas fa-calendar-check"></i> Upcoming
        </button>
        <button data-tab="rich-past">
          <i class="fas fa-history"></i> Past
        </button>
        <button data-tab="rich-favorites">
          <i class="fas fa-heart"></i> Favorites
        </button>
      </div>
      <div id="rich-upcoming" class="dashboard-cards">
        <!-- upcoming cards injected here -->
      </div>
      <div id="rich-past" class="dashboard-cards" hidden>
        <!-- past cards -->
      </div>
      <div id="rich-favorites" class="dashboard-cards" hidden>
        <!-- favorites -->
      </div>
    </section>

    </section>  <!-- end rich-dashboard -->


<!-- Upcoming Appointments Overview -->
<section id="upcomingCalendar" class="module">
  <h2><i class="fas fa-calendar-alt"></i> Your Upcoming Appointments</h2>
  <p class="desc">Below is a calendar view of all your confirmed appointments. Click a date to view details.</p>
  <div id="upcomingCalendarWidget"></div> <!-- calendar will render here -->
</section>

<!-- Confirm‐Before‐Scheduling Modal -->
<div id="confirmModal" class="modal" hidden>
  <div class="modal-content">
    <h3>Review Your Appointment</h3>
    <div id="confirmDetails"></div>
    <button id="modalEdit" class="btn-sm">Edit</button>
    <button id="modalConfirm" class="btn">Confirm Booking</button>
    <button id="modalClose" class="btn-sm">Cancel</button>
  </div>
</div>

<!-- Cancel Appointment Modal -->
<div id="cancelModal" class="modal" hidden>
  <div class="modal-content">
    <h3>Cancel Appointment?</h3>
    <p id="cancelMsg"></p>
    <button id="cancelNo" class="btn-sm">No, Keep It</button>
    <button id="cancelYes" class="btn">Yes, Cancel</button>
  </div>
</div>

  </main>

  <footer>
    <small>© 2025 AI-Pharmacy Chain — All rights reserved</small>
  </footer>


<script>
    // On load, restore appointments & urgent draft
    const stored = localStorage.getItem("appointments");
    if (stored) {
      appointments.push(...JSON.parse(stored));
      renderUpcomingCalendarWidget();
      appointments.forEach(addToRichDashboard);
    }
    // Urgent draft (concern, date, time, name, email)
    const draft = JSON.parse(localStorage.getItem("urgentDraft")||"{}");
    Object.entries(draft).forEach(([k,v])=>{
      const el = document.getElementById("urgent"+k);
      if (el) el.value = v;
    });
  </script>

  <script>
(function () {

    // Providers + availability
    const providers = [
      { id: "p1",  name: "Dr. Kwame Asante", spec: "Pulmonologist, Korle Bu" },
      { id: "p2",  name: "Dr. Abena Owusu", spec: "Cardiologist, 37 Military" },
      { id: "p3",  name: "Dr. Kojo Mensah", spec: "Psychiatrist, Ridge" },
      { id: "p4",  name: "Dr. Yaa Dufie", spec: "Dietitian, Nyaho Medical" },
      { id: "p5",  name: "Dr. Nana Adjei", spec: "GP, Cape Coast" },
      { id: "p6",  name: "Dr. Efua Amponsah", spec: "Endocrinologist, LEKMA" },
      { id: "p7",  name: "Dr. Michael Addo", spec: "Neurologist, 37 Military" },
      { id: "p8",  name: "Dr. Grace Ofori", spec: "Dermatologist, Accra Derm." },
      { id: "p9",  name: "Dr. Joseph Kumi", spec: "Ortho Surgeon, Komfo Anokye" },
      { id: "p10", name: "Dr. Ama Brew", spec: "Pediatrician, Trust Hosp." },
      { id: "p11", name: "Ms. Akosua Baah", spec: "PT, Tema General" },
      { id: "p12", name: "Mr. Daniel Boakye", spec: "Pharmacist, Ridge" },
      { id: "p13", name: "Mrs. Esther Kumi", spec: "OT, Cape Coast" },
      { id: "p14", name: "Ms. Joy Mensah", spec: "Speech Therapist, LEKMA" },
      { id: "p15", name: "Dr. Paul Yeboah", spec: "Dermatologist, Korle Bu" },
      { id: "p16", name: "Dr. Linda Frimpong", spec: "Nephrologist, 37 Military" },
      { id: "p17", name: "Mr. Kwesi Owusu", spec: "Nutritionist, Nyaho Med." },
      { id: "p18", name: "Ms. Abena Boateng", spec: "Psychologist, Accra Psych." }
    ];
    const availability = {
      p1:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-10": ["09:00","10:00","11:00"], "2025-06-12": ["14:00","15:00"], "2025-06-15": ["08:30","09:30","10:30"] },
      p2:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["10:00","13:00","16:00"], "2025-06-04": ["09:00","11:00"], "2025-06-15": ["12:00","14:00"] },
      p3:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-08": ["08:00","09:00","10:00","11:00"], "2025-06-11": ["13:30","14:30"], "2025-06-16": ["15:00","16:00"] },
      p4:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["09:30","10:30","11:30"], "2025-06-09": ["14:00","15:00","16:00"], "2025-06-18": ["08:00","09:00"] },
      p5:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-07": ["08:15","09:15","10:15"], "2025-06-13": ["13:00","14:00"], "2025-06-17": ["10:00","11:00","12:00"] },
      p6:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["09:00","10:00"], "2025-06-14": ["11:00","12:00","13:00"], "2025-06-19": ["14:00","15:00"] },
      p7:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-06": ["08:30","09:30","10:30"], "2025-06-12": ["13:00","14:00","15:00"], "2025-06-20": ["09:00","10:00"] },
      p8:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-01": ["10:00","11:00","12:00"], "2025-06-11": ["14:30","15:30"], "2025-06-16": ["08:00","09:00","10:00"] },
      p9:  { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-04": ["09:00","10:00","11:00"], "2025-06-13": ["13:00","14:00"], "2025-06-18": ["15:00","16:00"] },
      p10: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["08:00","09:00","10:00"], "2025-06-10": ["11:00","12:00","13:00"], "2025-06-17": ["14:00","15:00"] },
      p11: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["09:30","10:30","11:30"], "2025-06-14": ["13:00","14:00","15:00"], "2025-06-19": ["08:00","09:00"] },
      p12: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["10:00","11:00","12:00"], "2025-06-08": ["14:00","15:00"], "2025-06-20": ["09:00","10:00","11:00"] },
      p13: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-07": ["08:00","09:00","10:00"], "2025-06-12": ["11:30","12:30","13:30"], "2025-06-18": ["14:00","15:00"] },
      p14: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-03": ["09:15","10:15","11:15"], "2025-06-09": ["13:00","14:00","15:00"], "2025-06-16": ["08:00","09:00"] },
      p15: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-05": ["08:30","09:30","10:30"], "2025-06-13": ["11:00","12:00","13:00"], "2025-06-19": ["14:30","15:30"] },
      p16: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-02": ["10:00","11:00","12:00"], "2025-06-11": ["13:15","14:15"], "2025-06-17": ["09:00","10:00","11:00"] },
      p17: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-04": ["09:00","10:00","11:00"], "2025-06-10": ["12:00","13:00","14:00"], "2025-06-15": ["15:00","16:00"] },
      p18: { "2025-05-31": ["09:30","10:30","12:00"], "2025-06-01": ["08:00","09:00","10:00"], "2025-06-08": ["11:30","12:30","13:30"], "2025-06-20": ["14:00","15:00","16:00"] }
    };

  const PHASE = {
    findMatch: "Matching…",
    confirmBooking: "Confirming…",
  };

  function showToast(msg) {
    const t = document.createElement("div");
    t.className = "toast";
    t.innerText = msg;
    document.body.append(t);
    requestAnimationFrame(() => t.classList.add("visible"));
    setTimeout(() => t.remove(), 3000);
  }

  async function callOpenAI(messages) {
    try {
      const res = await fetch("/.netlify/functions/openai-proxy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages }),
      });
      if (!res.ok) throw new Error(await res.text());
      const j = await res.json();
      return j.choices?.[0]?.message?.content.trim() || "";
    } catch (err) {
      console.error("OpenAI error:", err);
      return "";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
     //  Initialize upcoming calendar widget state
    let widgetYear = new Date().getFullYear(), widgetMonth = new Date().getMonth();

// — URGENT flow navigation —

// Step2 Back / Close
document.getElementById("urgentStep2Back").onclick = () => {
  document.getElementById("urgentMatchResults").hidden = true;
  document.getElementById("urgentStep1").hidden       = false;
};
document.getElementById("urgentStep2Close").onclick = () => {
  document.getElementById("urgentBooking").hidden    = true;
};

document.getElementById("urgentStep3Close").onclick = () => {
  document.getElementById("urgentBooking").hidden        = true;
};
 // Step3 Back
 document.getElementById("urgentStep3Back").onclick = () => {
   document.getElementById("urgentCalendarFlow").hidden   = true;
   document.getElementById("urgentMatchResults").hidden   = false;
 };
    
// Step4 Back / Close
document.getElementById("urgentStep4Back").onclick = () => {
  document.getElementById("urgentDetailsForm").hidden   = true;
  document.getElementById("urgentCalendarFlow").hidden  = false;
};
document.getElementById("urgentStep4Close").onclick = () => {
  document.getElementById("urgentBooking").hidden       = true;
};

// — PROVIDER flow navigation —

// Step2 Back / Close
document.getElementById("matchResultsBack").onclick = () => {
  document.getElementById("matchResults").hidden    = true;
  document.getElementById("matchForm").hidden       = false;
};
document.getElementById("matchResultsClose").onclick = () => {
  document.getElementById("matchResults").hidden    = true;
};

// Step3 (calendar) 
 document.getElementById("appointmentFlowClose").onclick = () => {
   document.getElementById("appointmentFlow").hidden = true;
 };

// Confirm step (Step4) Back / Close
document.getElementById("confirmStep4Back").onclick = () => {
  document.getElementById("confirmForm").hidden     = true;
  document.getElementById("appointmentFlow").hidden = false;
};
document.getElementById("confirmStep4Close").onclick = () => {
  document.getElementById("appointmentFlow").hidden = true;
};

    // URGENT FLOW STATE
  let urgentProviderId, urgentProviderName;
  let uYear = new Date().getFullYear(), uMonth = new Date().getMonth();
  let uSelectedDate, uSelectedTime;
    
    // ─── ELEMENT REFERENCES ─────────────────────────────────────────
    const bodyEl         = document.body;
    const sidebarBtn     = document.getElementById("shrinkSidebar");
    const hamburger      = document.getElementById("hamburger");
    const themeToggle    = document.getElementById("themeToggle");
    const btnBookHero    = document.querySelector("#hero .hero-btn");
    const btnBookQuick   = document.querySelector("#quickActions .btn");
    const btnViewUpcoming= document.getElementById("viewUpcoming");
    const btnViewPast    = document.getElementById("viewPast");
    const urgentLink     = document.getElementById("urgentCare");
    const urgentBooking  = document.getElementById("urgentBooking");

    // Provider-match & calendar
    const matchForm      = document.getElementById("matchForm");
    const findMatchBtn   = document.getElementById("findMatchBtn");
    const matchResults   = document.getElementById("matchResults");
    const closeBtn       = matchResults.querySelector(".close-btn");
    const scheduleBtn    = document.getElementById("scheduleMatchBtn");
    const matchedNameEl  = document.getElementById("matchedName");
    const matchedSpecEl  = document.getElementById("matchedSpec");
    const appointFlow    = document.getElementById("appointmentFlow");
    const chosenProv     = document.getElementById("chosenProvider");
    const calHeader      = document.getElementById("calendarHeader");
    const calGrid        = document.getElementById("calendar");
    const prevMonthBtn   = document.getElementById("prevMonth");
    const nextMonthBtn   = document.getElementById("nextMonth");
    const timeSlotsEl    = document.getElementById("timeSlots");
    const confirmForm    = document.getElementById("confirmForm");
    const summaryText    = document.getElementById("summaryText");
    const confirmBtn     = document.getElementById("confirmBtn");

    // Rich Dashboard
    const richTabs       = document.querySelectorAll("#feature-rich-dashboard .dashboard-tabs button");
    const richUpcoming   = document.getElementById("rich-upcoming");
    const richPast       = document.getElementById("rich-past");
    const richFavorites  = document.getElementById("rich-favorites");

   const step1             = document.getElementById("urgentStep1");
  const findBtn          = document.getElementById("urgentFindMatchBtn");
  const resultsDiv       = document.getElementById("urgentMatchResults");
  const urgentNameEl     = document.getElementById("urgentMatchedName");
  const urgentSpecEl     = document.getElementById("urgentMatchedSpec");
  const urgentScheduleBtn= document.getElementById("urgentScheduleBtn");
    const calFlow          = document.getElementById("urgentCalendarFlow");
 const dateInput        = document.getElementById("urgentDate");
  const timeInput        = document.getElementById("urgentTime");
  const nextToDetailsBtn = document.getElementById("urgentNextToDetails");
  const detailsFormU = document.getElementById("urgentDetailsForm");
  const confirmU     = document.getElementById("urgentConfirmBtn");

    // ————— Initialize urgent date’s min to today —————
  dateInput.min = new Date().toISOString().split("T")[0];
    
  // 1) Find match
  findBtn.onclick = async () => {
    const concern = document.getElementById("urgentConcernInput").value.trim();
    if (!concern) return showToast("Please enter your concern.");
    findBtn.disabled = true;
    findBtn.textContent = "Matching…";
    // AI call (or fallback random)
    let pick = "";
    try {
      const sys = `You are an AI match. Providers:\n${providers.map(p=>`- ${p.name} – ${p.spec}`).join("\n")}`;
              const usr = `Concern="${concern}". Pick best provider by exact name only.`;
      pick = await callOpenAI([ {role:"system",content:sys}, {role:"user",content:usr} ]);
      pick = pick.split("\n")[0].replace(/[^a-zA-Z\s]/g,"").trim();
    } catch {
      /* ignore */ 
    }
    const found = providers.find(p=>p.name===pick) || providers[Math.floor(Math.random()*providers.length)];
   urgentNameEl.textContent = found.name;
    urgentSpecEl.textContent = found.spec;
    resultsDiv.hidden = false;
    step1.hidden = true;
    findBtn.disabled = false; findBtn.textContent = "Find Specialist";
     resultsDiv.querySelector(".close-btn").onclick = () => {
      resultsDiv.hidden = true;
      step1.hidden = false;
    };
  };

 // 2) Schedule with this specialist
 urgentScheduleBtn.onclick = () => {
    urgentProviderName = urgentNameEl.textContent;
    resultsDiv.hidden  = true;
    calFlow.hidden     = false;
  };

// 3) Now pick any future date/time
  nextToDetailsBtn.onclick = () => {
    const d = dateInput.value, t = timeInput.value;
    if (!d || !t) return showToast("Please select date and time.");
    uSelectedDate = d;
    uSelectedTime = t;
    detailsFormU.hidden = false;
    detailsFormU.scrollIntoView({ behavior: "smooth" });
  };

  function pickUrgentDate(key){
    uSelectedDate = key;
    const slots = availability[urgentProviderId][key]||[];
   timeSlotsU.innerHTML = `<h4>Available on ${key}:</h4>`;
    const ul = document.createElement("ul");
    slots.forEach(t=>{
      const li=document.createElement("li");
      const b=document.createElement("button");
      b.type='button'; b.className='btn-sm'; b.innerText=t; b.onclick=()=> pickUrgentTime(t);
      li.append(b); ul.append(li);
    });
    timeSlotsU.append(ul);
  }

  function pickUrgentTime(t){
    uSelectedTime = t;
    detailsFormU.hidden = false;
    detailsFormU.scrollIntoView({behavior:'smooth'});
  }

  // 4) Details → review-modal
  confirmU.onclick = () => {
    const name = document.getElementById("urgentClientName").value.trim();
    const email= document.getElementById("urgentClientEmail").value.trim();
    if(!name||!email) return showToast("Enter name & email");
    urgentFlow = true;
    document.getElementById("confirmDetails").innerHTML = `
      <p><strong>Urgent Consult</strong></p>
     <p><strong>Provider:</strong> ${urgentProviderName}</p>
      <p><strong>Date:</strong> ${uSelectedDate}</p>
      <p><strong>Time:</strong> ${uSelectedTime}</p>
      <p><strong>Name:</strong> ${name}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Fee:</strong> ₵500 (non-refundable)</p>
    `;
    document.getElementById("confirmModal").hidden = false;
  };
    // Upcoming calendar container
     const upcomingContainer = document.getElementById("upcomingCalendarWidget");
   
  
    // State
    let providerId, providerName;
    const appointments = []; // { id, name, date, time, urgent }
    let year = new Date().getFullYear(), month = new Date().getMonth();
    let selectedDate, selectedTime;

    // ─── BUTTON LISTENERS ─────────────────────────────────────────

    // Hero & Quick-action “Book appointment”
    btnBookHero.addEventListener("click",  () => scrollToSection("#providerMatch"));
    btnBookQuick.addEventListener("click", () => scrollToSection("#providerMatch"));

    // View Upcoming / Past in Rich Dashboard
    btnViewUpcoming.addEventListener("click", () => {
      scrollToSection("#feature-rich-dashboard");
      showRichTab("rich-upcoming");
    });
    btnViewPast.addEventListener("click", () => {
      scrollToSection("#feature-rich-dashboard");
      showRichTab("rich-past");
    });

    // Urgent care toggle
    urgentLink.addEventListener("click", () => {
      urgentBooking.hidden = false;
      scrollToSection("#urgentBooking");
    });


    // Sidebar toggle
    sidebarBtn.addEventListener("click", () => {
      bodyEl.classList.toggle("sidebar-shrink");
      const icon = sidebarBtn.querySelector("i");
      icon.classList.toggle("fa-chevron-left");
      icon.classList.toggle("fa-chevron-right");
    });

    // Mobile hamburger
    hamburger.addEventListener("click", () => {
      bodyEl.classList.toggle("sidebar-open");
      bodyEl.classList.remove("sidebar-shrink");
    });

    // Dark/light mode
    themeToggle.addEventListener("click", () => {
      const html = document.documentElement;
      html.classList.toggle("dark");
      html.setAttribute("aria-theme", html.classList.contains("dark") ? "dark" : "light");
      themeToggle.classList.toggle("fa-sun");
      themeToggle.classList.toggle("fa-moon");
    });

    // Match → AI prediction
    findMatchBtn.addEventListener("click", async () => {
      const concern = document.getElementById("concernInput").value.trim();
      if (!concern) {
        showToast("Please enter your chief concern.");
        return;
      }
      findMatchBtn.disabled = true;
      findMatchBtn.innerHTML = `${PHASE.findMatch} <span class="spinner"></span>`;

      let provider = null;
      try {
        const sys = `You are AI match. Providers:\n${providers.map(p => `- ${p.name} – ${p.spec}`).join("\n")}`;
        const usr = `Concern="${concern}", Urgency="${document.getElementById("urgencyInput").value}", Language="${document.getElementById("languageInput").value}". Pick best provider by exact name only.`;
        const raw = await callOpenAI([
          { role: "system", content: sys },
          { role: "user",   content: usr }
        ]);
        const firstLine = raw.replace(/```[\s\S]*?```/g, "").split(/\r?\n/)[0].trim();
        const matchName = firstLine.split("–")[0]?.trim();
        provider = providers.find(p => p.name === matchName);
      } catch (e) {
        console.error(e);
      }
      if (!provider) {
        provider = providers[Math.floor(Math.random() * providers.length)];
      }

      findMatchBtn.disabled = false;
      findMatchBtn.innerHTML = '<i class="fas fa-search"></i> Predict Specialist';

      matchedNameEl.textContent = provider.name;
      matchedSpecEl.textContent = provider.spec;
      providerId = provider.id;
      providerName = provider.name;
      matchResults.hidden = false;
    });

    // Close AI result
    closeBtn.addEventListener("click", () => {
      matchResults.hidden = true;
    });

    // Go to scheduling
    scheduleBtn.addEventListener("click", () => {
      matchResults.hidden = true;
      appointFlow.hidden = false;
      chosenProv.textContent = providerName;
      buildCalendar(year, month);
    });

    // Calendar nav
    prevMonthBtn.addEventListener("click", () => {
      month--; if (month < 0) { month = 11; year--; }
      buildCalendar(year, month);
    });
    nextMonthBtn.addEventListener("click", () => {
      month++; if (month > 11) { month = 0; year++; }
      buildCalendar(year, month);
    });

    function buildCalendar(y, m) {
      calHeader.textContent = new Date(y, m).toLocaleString("default", { month: "long", year: "numeric" });
      calGrid.innerHTML = "";
      ["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(w => {
        const hd = document.createElement("div");
        hd.className = "cell"; hd.style.fontWeight = "600"; hd.innerText = w;
        calGrid.append(hd);
      });
      const firstDay = new Date(y, m, 1).getDay();
      for (let i = 0; i < firstDay; i++) {
        const blank = document.createElement("div");
        blank.className = "cell closed"; calGrid.append(blank);
      }
      const days = new Date(y, m + 1, 0).getDate();
      const avail = availability[providerId] || {};
      const today = new Date();
      for (let d = 1; d <= days; d++) {
        const dateKey = `${y}-${String(m + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
        const isPast = new Date(y, m, d) < new Date().setHours(0,0,0,0);
        const open = !isPast && Array.isArray(avail[dateKey]);
        const cell = document.createElement("div");
        cell.className = `cell ${open ? "open" : "closed"}`;
        cell.innerText = d;
        if (open) cell.addEventListener("click", () => selectDate(dateKey));
        if (today.getFullYear() === y && today.getMonth() === m && today.getDate() === d) {
          cell.classList.add("today");
        }
        calGrid.append(cell);
      }
      timeSlotsEl.innerHTML = "";
      confirmForm.hidden = true;
    }

    function selectDate(key) {
      selectedDate = key;
      const slots = availability[providerId][key] || [];
      timeSlotsEl.innerHTML = `<h4>Available on ${key}:</h4>`;
      const ul = document.createElement("ul");
      ul.style.display = "flex"; ul.style.gap = "0.5rem";
      slots.forEach(t => {
        const li = document.createElement("li");
        const btn = document.createElement("button");
        btn.type = "button"; btn.className = "btn-sm"; btn.innerText = t;
        btn.addEventListener("click", () => selectTime(t));
        li.append(btn); ul.append(li);
      });
      timeSlotsEl.append(ul);
    }

    function selectTime(t) {
      selectedTime = t;
      summaryText.textContent = `You selected ${selectedDate} at ${selectedTime}.`;
      confirmForm.hidden = false;
      confirmForm.scrollIntoView({ behavior: "smooth" });
    }

   // 5) Instead of immediate confirm, open the review‐modal
    confirmBtn.addEventListener("click", () => {
      const name = document.getElementById("clientName").value.trim();
      if (!name) { showToast("Enter your name"); return; }
      // prepare modal
      document.getElementById("confirmDetails").innerHTML = `
        <p><strong>Provider:</strong> ${providerName}</p>
        <p><strong>Date:</strong> ${selectedDate}</p>
        <p><strong>Time:</strong> ${selectedTime}</p>
        <p><strong>Your Name:</strong> ${name}</p>
      `;
     document.getElementById("confirmModal").hidden = false;
    // save draft
    localStorage.setItem("urgentDraft", JSON.stringify({
      ConcernInput: document.getElementById("urgentConcernInput").value,
      Date: uSelectedDate,
      Time: uSelectedTime,
      ClientName: document.getElementById("urgentClientName").value,
      ClientEmail: document.getElementById("urgentClientEmail").value
    }));
    });

    // modal controls
    document.getElementById("modalClose").onclick = () => {
      document.getElementById("confirmModal").hidden = true;
    };
    document.getElementById("modalEdit").onclick = () => {
      document.getElementById("confirmModal").hidden = true;
      document.getElementById("confirmForm").scrollIntoView();
    };
    
    document.getElementById("modalConfirm").onclick = () => {
      if (urgentFlow) {
        if (!urgentReschedule) {
        PaystackPop.setup({
          key: "pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa",
          email: "guest@domain.com",
          amount: 50000,
          currency: "GHS",
          ref: "URGENT_" + Date.now(),
          callback() {
            // 2) on success, push urgent appt
            const d = document.getElementById("urgentDate").value;
            const t = document.getElementById("urgentTime").value;
            const id = "U" + Date.now();
            appointments.push({ id, name: urgentProviderName, date: d, time: t, urgent: true });
            localStorage.setItem("appointments", JSON.stringify(appointments));
            addToRichDashboard({ id, name: urgentProviderName, date: d, time: t, urgent: true });
            renderUpcomingCalendarWidget();
            showToast("Urgent appointment booked!");
          },
          onClose() {
            showToast("Payment cancelled.");
          }
        }).openIframe();
           } else {
          finalizeUrgent();
        }
      } else {
        // normal flow (provider match)
        const name = document.getElementById("clientName").value.trim();
        const id   = Date.now().toString();
        appointments.push({ id, name: providerName, date: selectedDate, time: selectedTime, urgent: false });
        addToRichDashboard({ id, name: providerName, date: selectedDate, time: selectedTime, urgent: false });
        renderUpcomingCalendarWidget();
        showToast("Appointment confirmed!");
      }
      function finalizeUrgent() {
      localStorage.setItem("appointments", JSON.stringify(appointments));
      renderUpcomingCalendarWidget();
      showToast("Urgent appointment updated!");
      urgentReschedule = false;
    }
      // reset
      urgentFlow = false;
      document.getElementById("confirmModal").hidden = true;
    };
    // ─── URGENT FLOW ─────────────────────────────────────────
    let urgentFlow = false;  // flag for modalConfirm
    let urgentReschedule = false;

    // Replace direct Paystack with “review” modal
    urgentPayBtn.onclick = () => {
      const d = document.getElementById("urgentDate").value;
      const t = document.getElementById("urgentTime").value;
      if (!d || !t) {
        return showToast("Please select date and time.");
      }
      // prepare confirmModal for urgent
      urgentFlow = true;
      document.getElementById("confirmDetails").innerHTML = `
        <p><strong>Urgent Consult</strong></p>
        <p><strong>Date:</strong> ${d}</p>
        <p><strong>Time:</strong> ${t}</p>
        <p><strong>Urgent Fee:</strong> ₵500.00</p>
      `;
      document.getElementById("confirmModal").hidden = false;
    };

    // ─── Rich Dashboard Tabs ───────────────────────────────────
    function showRichTab(tab) {
      richUpcoming.hidden  = (tab !== "rich-upcoming");
      richPast.hidden      = (tab !== "rich-past");
      richFavorites.hidden = (tab !== "rich-favorites");
      richTabs.forEach(b => b.classList.toggle("active", b.dataset.tab === tab));
    }
    richTabs.forEach(btn => btn.addEventListener("click", () => showRichTab(btn.dataset.tab)));
    showRichTab("rich-upcoming");

   // helper to inject into Rich Dashboard
    function addToRichDashboard(appt) {
      const card = document.createElement("div");
      card.className = "card";
      card.dataset.id = appt.id;
      card.innerHTML = `
        <i class="fas fa-user-md fa-2x"></i>
        <div class="details">
          <h4><strong>${appt.name}</strong></h4>
          <p>${appt.date} • ${appt.time}</p>
        </div>
        <div class="actions">
<button class="btn-reschedule"><i class="fas fa-sync-alt"></i></button>
          <button class="btn-cancel"><i class="fas fa-times"></i></button>
        </div>
      `;
       // Reschedule button
      card.querySelector(".btn-reschedule").addEventListener("click", () => {
        // populate scheduling flow for this appt
        if (appt.urgent) {
         urgentProviderName = appt.name;
         urgentBooking.hidden = false;
         // skip AI-match, go directly to calendar
         document.getElementById("urgentStep1").hidden = true;
         document.getElementById("urgentMatchResults").hidden = true;
         document.getElementById("urgentCalendarFlow").hidden = false;
         uSelectedDate = appt.date;
         uSelectedTime = appt.time;
         // rebuild calendar for that provider
         buildUrgentCalendar(uYear, uMonth);
       } else {
         providerId = providers.find(p=>p.name===appt.name).id;
         providerName = appt.name;
         matchResults.hidden = true;
         appointmentFlow.hidden = false;
         chosenProvider.textContent = providerName;
        buildCalendar(year, month);
       }
        document.getElementById("confirmDetails").innerHTML = `
          <p><strong>${appt.name}</strong></p>
          <p><strong>Date:</strong> ${appt.date}</p>
          <p><strong>Time:</strong> ${appt.time}</p>
        `;
      });
      // wire cancellation
      card.querySelector(".btn-cancel").onclick = () => {
        const modal = document.getElementById("cancelModal");
        modal.hidden = false;
        const msg = appt.urgent
          ? "This was an urgent booking with a payment of ₵500 which is non-refundable. Do you still want to cancel?"
          : "Are you sure you want to cancel this appointment?";
        document.getElementById("cancelMsg").innerText = msg;
        // on confirm cancellation:
        document.getElementById("cancelYes").onclick = () => {
          // remove from state & UI
          const idx = appointments.findIndex(a => a.id === appt.id);
          if (idx > -1) appointments.splice(idx,1);
          card.remove();
          renderUpcomingCalendarWidget();
          showToast("Appointment canceled.");
          modal.hidden = true;
        };
        document.getElementById("cancelNo").onclick = () => {
          modal.hidden = true;
        };
      };
      richUpcoming.append(card);
    }

  // 3) Build a month‐view calendar, highlighting appointment dates
    function renderUpcomingCalendarWidget() {
      const container = document.getElementById("upcomingCalendarWidget");
      container.innerHTML = ""; 
       // add prev/next controls
      const ctrl = document.createElement("div");
      ctrl.style.display = "flex"; ctrl.style.justifyContent = "space-between"; ctrl.style.marginBottom = "0.5rem";
      const prev = document.createElement("button");
      prev.textContent = "‹ Prev"; prev.className = "btn-sm";
      const next = document.createElement("button");
      next.textContent = "Next ›"; next.className = "btn-sm";
      ctrl.append(prev, next);
      container.append(ctrl);

      prev.onclick = () => { widgetMonth--; if (widgetMonth < 0) { widgetMonth = 11; widgetYear--; } render(); };
      next.onclick = () => { widgetMonth++; if (widgetMonth > 11) { widgetMonth = 0; widgetYear++; } render(); };

      function render() {
        // header
        const title = document.createElement("h4");
        title.innerText = new Date(widgetYear, widgetMonth).toLocaleString("default",{month:'long',year:'numeric'});
        // grid
        const grid = document.createElement("div");
        grid.className = "calendar-grid";
        ["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(w=>{
          const hd = document.createElement("div"); hd.className="cell"; hd.style.fontWeight="600"; hd.innerText=w;
          grid.append(hd);
        });
        const firstDay = new Date(widgetYear,widgetMonth,1).getDay();
        for(let i=0;i<firstDay;i++){
          const blank = document.createElement("div"); blank.className="cell"; grid.append(blank);
        }
        const days = new Date(widgetYear,widgetMonth+1,0).getDate();
        const marks = new Set(appointments.filter(a=>
          new Date(a.date).getFullYear()===widgetYear &&
          new Date(a.date).getMonth()===widgetMonth
        ).map(a=>new Date(a.date).getDate()));
        for(let d=1; d<=days; d++){
          const cell = document.createElement("div");
          const isMarked = marks.has(d);
          cell.className = isMarked ? "cell open" : "cell";
          cell.innerText = d;
          if(isMarked){
            cell.onclick = () => {
              const list = appointments.filter(a=>
                new Date(a.date).getFullYear()===widgetYear &&
                new Date(a.date).getMonth()===widgetMonth &&
                new Date(a.date).getDate()===d
              );
              alert(list.map(a=>`${a.name}: ${a.time}`).join("\n"));
            };
          }
          grid.append(cell);
        }
        container.querySelectorAll("h4, .calendar-grid").forEach(n=>n.remove());
        container.append(title, grid);
      }
      render();
   
    }
   

    // Scroll‐helper
    function scrollToSection(id) {
      document.querySelector(id).scrollIntoView({ behavior: "smooth" });
    }
  });
})();
</script>

</body>
</html>
