<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Herbal Medicine Hub</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
 <style>
   *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  html {
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    scroll-behavior: smooth;
    --primary: #2a6f4e;            
    --secondary: #8e6c4b;        
    --accent: #d4c5a2;            
    --bg: #f8f6f0;                
    --surface: #ffffff;
    --text: #333333;
    --muted: #6b6b6b;
    --bg-dark: #1f1f1f;
    --surface-dark: #2a2a2a;
    --text-dark: #ececec;
    --muted-dark: #888888;
    --radius: 0.75rem;
    --padding: 1rem;
    --transition: 0.3s ease;
    --sidebar-w: 280px;
    --sidebar-collapsed-w: 80px;
    --header-h: 64px;
  }
  html.dark {
    --bg: var(--bg-dark);
    --surface: var(--surface-dark);
    --text: var(--text-dark);
    --muted: var(--muted-dark);
  }
  body {
    display: flex;
    min-height: 100vh;
    background: var(--bg);
    color: var(--text);
    overflow-x: hidden;
    transition: background var(--transition), color var(--transition);
  }
  a {
    color: var(--primary);
    text-decoration: none;
    transition: color var(--transition);
  }
  a:hover {
    color: var(--secondary);
  }
  img {
    max-width: 100%;
    display: block;
  }
  button {
    font-family: inherit;
  }
  ul, ol {
    list-style: none;
  }

  aside#sidebar {
    flex: 0 0 var(--sidebar-w);
    position: sticky;
    top: 0;
    height: 100vh;
    background: var(--surface);
    box-shadow: 2px 0 12px rgba(0, 0, 0, 0.05);
    transition: flex var(--transition), background var(--transition);
    overflow: hidden;
    z-index: 1000;
    display: flex;
    flex-direction: column;
  }
  aside#sidebar .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: var(--padding);
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--primary);
  }
  aside#sidebar .logo svg {
    width: 1.8rem;
    height: 1.8rem;
    fill: var(--primary);
    transition: transform var(--transition);
  }
  aside#sidebar .logo:hover svg {
    transform: scale(1.1);
  }
  aside#sidebar .logo .logo-text {
    font-size: 1.4rem;
  }
  aside#sidebar nav {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  aside#sidebar nav a {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem var(--padding);
    border-radius: var(--radius);
    color: var(--text);
    font-weight: 500;
    transition: background var(--transition), padding-left var(--transition), color var(--transition);
  }
  aside#sidebar nav a i {
    font-size: 1.2rem;
    width: 1.2rem;
    text-align: center;
  }
  aside#sidebar nav a:hover,
  aside#sidebar nav a.active {
    background: var(--primary);
    color: #fff;
    padding-left: calc(var(--padding) + 0.5rem);
  }
    aside#sidebar nav a.active {
   background: var(--primary);
   color: #fff;
    font-weight: 700;
  }
  aside#sidebar.collapsed {
    flex: 0 0 var(--sidebar-collapsed-w);
  }
  aside#sidebar.collapsed .logo .logo-text,
  aside#sidebar.collapsed nav a span {
    display: none;
  }
  aside#sidebar.collapsed nav a {
    justify-content: center;
  }

  #shrinkBtn i {
    font-size: 1.2rem;
  }
  #shrinkBtn {
    position: absolute;
    bottom: var(--padding);
    left: 50%;
    transform: translateX(-50%);
    width: 36px;
    height: 36px;
    background: none;
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color var(--transition), border-color var(--transition), transform var(--transition);
  }
  #shrinkBtn:hover {
    color: var(--secondary);
    border-color: var(--secondary);
    transform: translateX(-50%) scale(1.1);
  }
   
  header {
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    height: var(--header-h);
    background: var(--surface);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--padding);
    z-index: 999;
    transition: left var(--transition), background var(--transition);
  }
  aside#sidebar.collapsed ~ header {
    left: var(--sidebar-collapsed-w);
  }
  header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text);
  }
  header .hamburger,
  header .theme-toggle {
    font-size: 1.4rem;
    color: var(--primary);
    cursor: pointer;
    transition: transform var(--transition), color var(--transition);
  }
  header .hamburger:hover,
  header .theme-toggle:hover {
    transform: scale(1.1);
    color: var(--secondary);
  }

   main {
    flex: 1;
    padding: calc(var(--header-h) + var(--padding)) var(--padding) var(--padding);
    background: var(--bg);
    transition: background var(--transition);
  }

   .module {
    background: var(--surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    margin-bottom: 1.5rem;
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .module:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  }
  .module h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    font-size: 1.25rem;
    color: var(--primary);
  }
  .module p.desc {
    font-size: 0.95rem;
    color: var(--muted);
    margin-bottom: 1rem;
  }

  .module form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-end;
  }
  .module form label {
    font-size: 0.95rem;
    color: var(--text);
    margin-bottom: 0.25rem;
    display: block;
    font-weight: 500;
  }
  .module form input,
  .module form select,
  .module form textarea {
    flex: 1 1 200px;
    padding: 0.75rem;
    border: 1.5px solid rgba(0, 0, 0, 0.1);
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    border-radius: var(--radius);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .module form input:focus,
  .module form select:focus,
  .module form textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  .module form button {
    background: var(--primary);
    color: #fff;
    padding: 0.7rem 1.4rem;
    border: none;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    border-radius: var(--radius);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .module form button:hover:not([disabled]) {
    transform: scale(1.03);
    box-shadow: 0 5px 14px rgba(0, 0, 0, 0.12);
    background: var(--secondary);
  }
  .module form button[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .hint {
    width: 100%;
    font-size: 0.85rem;
    color: var(--muted);
  }

  .response {
    background: rgba(42, 111, 78, 0.1);
    border-left: 4px solid var(--secondary);
    padding: var(--padding);
    border-radius: var(--radius);
    margin-top: 1rem;
    position: relative;
    transition: background var(--transition);
  }
  .response .close-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: none;
    color: var(--secondary);
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
  }
  .response .close-btn:hover {
    color: var(--primary);
    transform: scale(1.1);
  }
  .response .result-content {
    margin-top: 0.5rem;
    color: var(--text);
    line-height: 1.5;
  }
  .tool-row {
    position: static;                
    margin-top: 1rem;              
    display: flex;
    display: flex;
    gap: 0.5rem;
  }
  .tool-row button {
    font-size: 0.85rem;
    width: 1.6rem;
    height: 1.6rem;
    padding: 0.2rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  .tool-row button:hover {
    background: var(--primary);
    color: #fff;
    transform: scale(1.1);
  }

  .hero-module {
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: left;
    border-radius: var(--radius);
    padding: 4rem 2rem;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    transition: background var(--transition), box-shadow var(--transition);
  }
  .hero-module:hover {
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  }
  .hero-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    gap: 2rem;
  }
  .hero-content {
    flex: 1;
    padding-right: 2rem;
  }
  .hero-content h1 {
    font-size: 2.8rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary);
  }
  .hero-subtitle {
    font-size: 1.1rem;
    margin-bottom: 2rem;
    color: var(--muted);
  }
  .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }
  .hero-actions .btn-primary,
  .hero-actions .btn-secondary,
  .hero-actions .btn-tertiary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-radius: var(--radius);
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border: none;
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .hero-actions .btn-primary {
    background: var(--primary);
    color: #fff;
  }
  .hero-actions .btn-secondary {
    background: var(--secondary);
    color: #fff;
  }
  .hero-actions .btn-tertiary {
    background: var(--bg);
    color: var(--primary);
    border: 2px solid var(--primary);
  }
  .hero-actions a:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  .hero-image {
    flex: 1;
    text-align: right;
  }
  .hero-image img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    transition: transform var(--transition), box-shadow var(--transition);
  }
  .hero-image img:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  }
  .hero-bg-icon {
    position: absolute;
    font-size: 9rem;
    color: rgba(42, 111, 78, 0.05);
    pointer-events: none;
    user-select: none;
    transition: color var(--transition);
  }
  html.dark .hero-bg-icon {
    color: rgba(212, 197, 162, 0.05);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    1. AI PLANT SCANNER
  ──────────────────────────────────────────────────────────────────────────────*/
  #hero–identifier form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-start;
  }
  #hero–identifier textarea,
  #hero–identifier input[type="file"] {
    flex: 1 1 200px;
  }
  #hero–identifier button {
    flex: 0 0 auto;
  }
  #idenPreview {
    margin-top: 1rem;
    border-radius: var(--radius);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }
  #idenClear a {
    color: var(--primary);
    font-size: 0.9rem;
    transition: color var(--transition);
  }
  #idenClear a:hover {
    color: var(--secondary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    2. SYMPTOM CHECKER
  ──────────────────────────────────────────────────────────────────────────────*/
  #hero-symptom .sym-form {
    display: grid;
    grid-template:
      "labels1 inputs1" auto
      "labels2 inputs2" auto
      "actions actions" auto / 1fr 1fr;
    gap: 1rem 1.5rem;
  }
  #hero-symptom .field:nth-child(1) { grid-area: labels1; }
  #hero-symptom .field:nth-child(2) { grid-area: inputs1; }
  #hero-symptom .range-field {
    grid-area: labels2 / inputs2;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  #hero-symptom button.btn-primary {
    grid-area: actions;
    justify-self: center;
    background: var(--primary);
    color: #fff;
    padding: 0.75rem 1.5rem;
  }
  #hero-symptom textarea,
  #hero-symptom select,
  #hero-symptom input[type="number"],
  #hero-symptom input[type="range"] {
    min-width: 280px;
    width: 100%;
    padding: 0.6rem;
    font-size: 0.9rem;
    border-radius: var(--radius);
    border: 1px solid rgba(0, 0, 0, 0.1);
    background: var(--bg);
    color: var(--text);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  #hero-symptom textarea:focus,
  #hero-symptom select:focus,
  #hero-symptom input[type="number"]:focus,
  #hero-symptom input[type="range"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  #hero-symptom .response.sym-response {
    margin-top: 1.5rem;
    background: rgba(42, 111, 78, 0.1);
    border-left: 4px solid var(--primary);
    padding: var(--padding);
    border-radius: var(--radius);
    position: relative;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    3. CULTURAL KNOWLEDGE
  ──────────────────────────────────────────────────────────────────────────────*/
  #hero–cultural .culture-input-wrapper {
    display: flex;
    gap: 0.5rem;
    align-items: flex-end;
    margin-bottom: 1rem;
  }
  #hero–cultural input {
    flex: 1 1 250px;
    padding: 0.6rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 0.9rem;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  #hero–cultural input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  #hero–cultural .btn-culture {
    background: var(--primary);
    color: #fff;
    padding: 0.7rem 1.2rem;
    border: none;
    border-radius: var(--radius);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
    font-weight: 600;
  }
  #hero–cultural .btn-culture:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    background: var(--secondary);
  }
  #hero–cultural .response {
    margin-top: 1rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    4. SAFETY CHECKER
  ──────────────────────────────────────────────────────────────────────────────*/
  #hero–safety input {
    flex: 1 1 200px;
    padding: 0.75rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  #hero–safety input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  #hero–safety button {
    background: var(--primary);
    color: #fff;
    padding: 0.7rem 1.4rem;
    font-weight: 600;
    border-radius: var(--radius);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  #hero–safety button:hover {
    transform: scale(1.03);
    box-shadow: 0 5px 14px rgba(0, 0, 0, 0.12);
    background: var(--secondary);
  }
  #hero–safety .response {
    margin-top: 1rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    5. AI HERBALIST CHAT
  ──────────────────────────────────────────────────────────────────────────────*/
  #hero–chat {
    display: flex;
    flex-direction: column;
  }
  #hero–chat .chat-controls {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  #hero–chat .chat-controls button {
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  #hero–chat .chat-controls button:hover {
    background: var(--primary);
    color: #fff;
    transform: scale(1.1);
  }
  .chat-box {
    background: var(--bg);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: var(--radius);
    padding: var(--padding);
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
    transition: background var(--transition), border-color var(--transition);
  }
  .user-msg, .bot-msg {
    max-width: 80%;
    margin: 0.5rem 0;
    padding: 0.8rem 1rem;
    border-radius: 1.2rem;
    position: relative;
    transition: background var(--transition), color var(--transition);
  }
  .user-msg {
    background: var(--primary);
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 0.2rem;
  }
  .bot-msg {
    background: #e8f5f1;
    color: var(--text);
    align-self: flex-start;
    border-bottom-left-radius: 0.2rem;
  }
  html.dark .bot-msg {
    background: var(--surface-dark);
    color: var(--text-dark);
  }
  .timestamp {
    font-size: 0.7rem;
    position: absolute;
    bottom: -1.2rem;
    right: 0.8rem;
    color: var(--muted);
  }
  .chat-date-separator {
    text-align: center;
    margin: 0.75rem 0;
    font-weight: bold;
    color: var(--muted);
    user-select: none;
  }
  .chat-input-row {
    display: flex;
    gap: 0.5rem;
  }
  .chat-input-row input {
    flex: 1 1 100%;
    padding: 0.8rem 1rem;
    border: 1px solid var(--muted);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .chat-input-row input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  .chat-input-row button {
    background: var(--primary);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: background var(--transition), transform var(--transition);
  }
  .chat-input-row button:hover {
    transform: scale(1.1);
    background: var(--secondary);
  }
  #chatHint {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    6. PERSONALIZED FORMULATIONS
  ──────────────────────────────────────────────────────────────────────────────*/
  #formulations select,
  #inventory select,
  #int-form select,
  #roi-form select,
  #pf-form select,
  #research-form input,
  #contact-form input,
  #contact-form textarea {
    max-width: 200px;
  }
  #pf-form select,
  #pf-form input,
  #pf-form button {
    padding: 0.75rem 1.2rem;
  }
  #pf-form button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #pf-form button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #pfResult {
    margin-top: 1rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    7. RESEARCH SUMMARIES
  ──────────────────────────────────────────────────────────────────────────────*/
  #research-form input,
  #research-form button {
    padding: 0.75rem 1.2rem;
  }
  #research-form button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #research-form button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #researchResults a {
    display: inline-block;
    margin-top: 0.5rem;
    color: var(--primary);
    font-weight: 500;
    transition: color var(--transition);
  }
  #researchResults a:hover {
    color: var(--secondary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    8. INVENTORY FORECAST
  ──────────────────────────────────────────────────────────────────────────────*/
  #inventory select,
  #inventory input,
  #inventory button {
    padding: 0.75rem 1.2rem;
  }
  #inventory button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #inventory button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    9. GENETICS MATCH
  ──────────────────────────────────────────────────────────────────────────────*/
  #genetics-form input,
  #genetics-form button {
    padding: 0.75rem 1.2rem;
  }
  #genetics-form button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #genetics-form button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #geneticResult .hint {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--muted);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    10. DOSAGE CALCULATOR
  ──────────────────────────────────────────────────────────────────────────────*/
  #dosage input,
  #dosage select,
  #dosage button {
    padding: 0.75rem 1.2rem;
  }
  #dosage button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #dosage button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #dosageResult {
    margin-top: 1rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    11. INTERACTION CHECKER
  ──────────────────────────────────────────────────────────────────────────────*/
  #int-form select,
  #int-form button {
    padding: 0.75rem 1.2rem;
  }
  #int-form button {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    transition: background var(--transition), transform var(--transition);
  }
  #int-form button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #interactionResult {
    margin-top: 1rem;
  }


  /*──────────────────────────────────────────────────────────────────────────────
    13. ROI CALCULATOR
  ──────────────────────────────────────────────────────────────────────────────*/
  .roi-form {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    align-items: flex-end;
  }
  .roi-form .field {
    flex: 1 1 200px;
    display: flex;
    flex-direction: column;
  }
  .roi-form label {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text);
  }
  .roi-form select,
  .roi-form input {
    padding: 0.75rem;
    font-size: 0.95rem;
    border: 1.5px solid #d1dce5;
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .roi-form select:focus,
  .roi-form input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  .roi-form button {
    background: var(--primary);
    color: #fff;
    padding: 0.8rem 1.6rem;
    border: none;
    border-radius: var(--radius);
    font-size: 1rem;
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background var(--transition), transform var(--transition);
    margin-top: 0.5rem;
  }
  .roi-form button:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #roiResult {
    margin-top: 1.5rem;
    background: rgba(142,108,75,0.1);
    border-left: 4px solid var(--secondary);
    padding: var(--padding);
    border-radius: var(--radius);
    position: relative;
  }
  #roiResult .result-content {
    font-size: 0.95rem;
    line-height: 1.5;
  }
  #roiResult .close-btn {
    display: block;
    margin-bottom: 0.5rem;
    background: none;
    color: var(--secondary);
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
  }
  #roiResult .close-btn:hover {
    color: var(--primary);
    transform: scale(1.1);
  }
  #roiResult .tool-row {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    display: flex;
    gap: 0.5rem;
  }
  #roiResult .tool-row button {
    font-size: 0.85rem;
    width: 1.6rem;
    height: 1.6rem;
    padding: 0.2rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  #roiResult .tool-row button:hover {
    background: var(--primary);
    color: #fff;
    transform: scale(1.1);
  }

    .copy-toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    font-size: 0.95rem;
    animation: fade-in-out 2s ease forwards;
    z-index: 2000;
  }
  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
    10% { opacity: 1; transform: translateX(-50%) translateY(0); }
    90% { opacity: 1; }
    100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
  }
  /*──────────────────────────────────────────────────────────────────────────────
    14. EXECUTIVE ANALYTICS DASHBOARD
  ──────────────────────────────────────────────────────────────────────────────*/
  /*────────────────── Analytics Styles ──────────────────*/
  .charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.25rem;
    margin-top: 1rem;
  }
  .chart-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: box-shadow var(--transition);
  }
  .chart-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  }
  .chart-card canvas {
    flex: 1 1 auto;
    width: 100% !important;
    height: 200px !important;
  }
  .chart-card figcaption {
    padding: 0.5rem 0.75rem;
    background: var(--bg);
    font-size: 0.9rem;
    color: var(--text);
  }
  .chart-desc {
    padding: 0 0.75rem 0.75rem;
    font-size: 0.85rem;
    color: var(--muted);
  }
  #exportCSV {
    margin-top: 1rem;
    background: var(--primary);
    color: #fff;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: background var(--transition), transform var(--transition);
    cursor: pointer;
  }
  #exportCSV:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
  #analytics button {
    margin-top: 1rem;
    background: var(--primary);
    color: #fff;
    padding: 0.7rem 1.4rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  #analytics button:hover {
    transform: scale(1.03);
    box-shadow: 0 5px 14px rgba(0, 0, 0, 0.12);
    background: var(--secondary);
  }


  /*──────────────────────────────────────────────────────────────────────────────
    FOOTER
  ──────────────────────────────────────────────────────────────────────────────*/
  footer {
    background: var(--surface);
    padding: var(--padding);
    text-align: center;
    font-size: 0.85rem;
    color: var(--muted);
    margin-top: 2rem;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
  }
  footer a {
    color: var(--primary);
    text-decoration: none;
    margin: 0 0.5rem;
    transition: color var(--transition);
  }
  footer a:hover {
    color: var(--secondary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    SPINNER ICON
  ──────────────────────────────────────────────────────────────────────────────*/
  .spinner {
    display: inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid var(--primary);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    vertical-align: middle;
    margin-left: 0.25em;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /*──────────────────────────────────────────────────────────────────────────────
    RESPONSIVE
  ──────────────────────────────────────────────────────────────────────────────*/
  @media (max-width: 1024px) {
    aside#sidebar {
      position: fixed !important;
      transform: translateX(-100%);
      z-index: 900;
      flex: 0 0 var(--sidebar-w);
    }
    aside#sidebar.open {
      transform: translateX(0);
    }
    header {
      left: 0 !important;
    }
  }
  @media (max-width: 768px) {
    #hero-symptom .sym-form {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      gap: 1rem;
    }
    .hero-inner {
      flex-direction: column;
      gap: 2rem;
    }
    .hero-content {
      padding-right: 0;
    }
    .hero-content h1 {
      font-size: 2.2rem;
    }
    .charts {
      grid-template-columns: 1fr !important;
    }
    .chart-card {
      height: auto;
    }
    .hero-subtitle, .module p.desc {
      font-size: 0.95rem;
    }
  }
  @media (max-width: 640px) {
    form, .chat-input-row {
      flex-direction: column;
      gap: 0.75rem;
    }
    input, select, textarea, button {
      width: 100% !important;
    }
    .chart-card canvas {
      height: 180px !important;
    }
    #hero h1 {
      font-size: 2rem;
    }
    #shrinkBtn {
      bottom: 0.5rem;
    }
    aside#sidebar:not(.open) {
      display: none;
    }
  }
  @media (max-width: 480px) {
    input, select, textarea, button {
      font-size: 0.9rem;
    }
    .hero-content h1 {
      font-size: 1.8rem;
      flex-direction: column;
    }
    .hero-actions {
      flex-direction: column;
    }
    .hero-actions a {
      width: 100%;
      justify-content: center;
    }
    .chat-box {
      max-height: 220px;
    }
  }

   .other-input {
    display: none;
    margin-top: 0.5rem;
    padding: 0.75rem;
    border: 1.5px solid #d1dce5;
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    border-radius: var(--radius);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .other-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  /*──────────────────────────────────────────────────────────────────────────────
    DARK MODE OVERRIDES
  ──────────────────────────────────────────────────────────────────────────────*/
  html.dark aside#sidebar {
    background: var(--surface);
  }
  html.dark header {
    background: var(--surface);
    border-bottom-color: rgba(255, 255, 255, 0.1);
  }
  html.dark .module {
    background: var(--surface);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  html.dark input,
  html.dark select,
  html.dark textarea {
    background: var(--bg);
    color: var(--text);
    border-color: var(--muted);
  }
  html.dark button {
    background: var(--secondary);
    color: #fff;
  }
  html.dark button:hover {
    background: var(--primary);
  }
  html.dark .response {
    background: rgba(142, 108, 75, 0.15);
    border-color: var(--accent);
  }
  html.dark .chat-box {
    background: var(--bg);
    border-color: var(--muted);
  }
  html.dark .bot-msg {
    background: var(--surface-dark);
    color: var(--text-dark);
  }
  html.dark .user-msg {
    background: var(--secondary);
    color: #fff;
  }
  html.dark footer {
    background: var(--surface);
    color: var(--muted);
    border-top-color: rgba(255, 255, 255, 0.1);
  }
    /*────────────────── HISTORY MODAL STYLING ──────────────────*/
  .history-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
  }
  .history-content {
    background: var(--surface);
    padding: 2rem;
    border-radius: var(--radius);
    width: 90%;
    max-width: 600px;
    max-height: 80%;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    position: relative;
  }
  .history-content h3 {
    margin-bottom: 1rem;
    color: var(--primary);
    font-size: 1.5rem;
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.5rem;
  }
  .history-content ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .history-content li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
  }
  .history-content li:last-child {
    border-bottom: none;
  }
  .history-content .del-msg {
    background: none;
    border: none;
    color: var(--secondary);
    font-size: 1.1rem;
    cursor: pointer;
    transition: color var(--transition);
  }
  .history-content .del-msg:hover {
    color: var(--primary);
  }
  .history-content .close-history {
    display: block;
    margin: 1.5rem auto 0;
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 1rem;
    transition: background var(--transition), transform var(--transition);
  }
  .history-content .close-history:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }
    .history-table-wrapper {
    overflow-x: auto;
    margin-bottom: var(--padding);
  }
  .history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }
  .history-table th,
  .history-table td {
    padding: 0.6rem 0.8rem;
    text-align: left;
    border: none;
  }
  .history-table tbody tr:nth-child(odd) {
    background: rgba(0,0,0,0.03);
  }
  .history-actions {
    position: sticky;
    bottom: 0;
    background: var(--surface);
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding-top: var(--padding);
    border-top: 1px solid rgba(0,0,0,0.1);
  }
  .history-actions button {
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background var(--transition), transform var(--transition);
  }
  .history-actions button:hover {
    background: var(--secondary);
    transform: translateY(-1px);
  }
    #roi-form input,
      #roi-form select {
          padding: 0.75rem;
          font-size: 0.95rem;
          border: 1.5px solid #d1dce5;
          border-radius: var(--radius);
        }

   .other-input {
  display: none;
  margin-top: 0.5rem;
  padding: 0.75rem;
  border: 1.5px solid #d1dce5;
  background: var(--bg);
  color: var(--text);
  font-size: 0.95rem;
  border-radius: var(--radius);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.other-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 8px var(--primary);
}
   
.meet-module {
  background: linear-gradient(135deg, rgba(42,111,78,0.1), rgba(212,197,162,0.1));
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 2rem;
  border-radius: var(--radius);
  margin-bottom: 2rem;
}
.meet-content {
  display: flex;
  align-items: center;
  max-width: 900px;
  width: 100%;
  gap: 2rem;
}
.meet-icon {
  flex: 0 0 80px;
  height: 80px;
  background: var(--primary);
  color: #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.meet-text h2 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  color: var(--secondary);
  line-height: 1.2;
}
.meet-text p {
  font-size: 1rem;
  margin-bottom: 1rem;
  color: var(--text);
  line-height: 1.4;
}
.btn-schedule {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  color: #fff;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 1rem;
  transition: transform var(--transition), box-shadow var(--transition);
}
.btn-schedule:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

 </style>


</head>

<body>
  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--primary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span class="logo-text">Vitra AI</span>
    </div>
    <nav role="navigation">
      <a href="herbal.html" id="link-herbal" class="active">
        <i class="fas fa-seedling"></i>
        <span>Herbal Medicine</span>
      </a>
      <a href="psychology.html">
        <i class="fas fa-brain"></i>
        <span>Psychology &amp; Mental Health</span>
      </a>
      <a href="dietetics.html">
        <i class="fas fa-utensils"></i>
        <span>Dietetics</span>
      </a>
      <a href="pharmacy.html">
        <i class="fas fa-prescription-bottle-alt"></i>
        <span>E-Pharmacy</span>
      </a>
      <a href="consult.html">
        <i class="fas fa-calendar-check"></i>
        <span>Consultation Booking</span>
      </a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar">
      <i class="fas fa-angle-double-left"></i>
    </button>
  </aside>

  <!-- HEADER -->
  <header>
    <div style="display:flex; align-items:center; gap:1rem;">
      <i id="hamburger" class="fas fa-bars hamburger" aria-label="Toggle navigation"></i>
      <h1>Herbal Medicine Hub</h1>
    </div>
    <div>
      <i id="themeToggle" class="fas fa-moon theme-toggle" aria-label="Toggle theme"></i>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main role="main">
    <!-- HERO SECTION -->
    <section id="hero" class="module hero-module">
      <div class="hero-inner">
        <div class="hero-content">
          <h1><i class="fas fa-seedling"></i> Empower Your Herbal Journey</h1>
          <p class="hero-subtitle">
            Explore our AI-powered toolkit to identify plants, analyze symptoms, discover cultural wisdom, and manage inventory—all in one place.
          </p>
          <div class="hero-actions">
            <a href="#hero–identifier" class="btn-primary">
              <i class="fas fa-camera"></i> Scan a Plant
            </a>
            <a href="#hero-symptom" class="btn-secondary">
              <i class="fas fa-notes-medical"></i> Check Symptoms
            </a>
            <a href="#hero–chat" class="btn-tertiary">
              <i class="fas fa-comments"></i> Chat with Herbalist
            </a>
          </div>
        </div>
        <div class="hero-image">
          <img src="herbs.webp" alt="Assortment of medicinal herbs">
        </div>
      </div>
      <!-- SUBTLE BACKGROUND ICONS -->
      <i class="fas fa-seedling hero-bg-icon" style="top: 8%; left: 7%;"></i>
      <i class="fas fa-leaf     hero-bg-icon" style="top: 5%; right: 9%;"></i>
      <i class="fas fa-flask    hero-bg-icon" style="bottom: 10%; left: 12%;"></i>
      <i class="fas fa-stethoscope hero-bg-icon" style="bottom: 8%; right: 15%;"></i>
      <i class="fas fa-chart-line  hero-bg-icon" style="top: 45%; left: 45%;"></i>
    </section>

    <!-- 1. AI Plant Scanner -->
    <section id="hero–identifier" class="module">
      <h2><i class="fas fa-camera"></i> AI Plant Scanner</h2>
      <p class="desc">
        Upload a photo of a leaf, flower, or entire plant, or describe it in text. Our AI will identify the species and provide medicinal uses, precautions, and regional information.
      </p>
      <form id="iden-form">
        <textarea id="idenDesc" rows="2" placeholder="Or describe your plant here…"></textarea>
        <input type="file" accept="image/*" aria-label="Upload plant image" onchange="previewImage(this)"/>
        <button type="submit">Identify Plant</button>
        <div class="hint">Use a clear, well-lit close-up of the plant part. Supported image types: JPG, PNG.</div>
      </form>
      <img id="idenPreview" alt="Plant preview" style="max-width:200px; margin-top:1rem; display:none;"/>
      <div id="idenClear" style="display:none; margin-top:.5rem;">
        <a href="#" onclick="clearPreview(); return false;">Remove Image</a>
      </div>
      <div id="idenResult" class="response" role="status" aria-live="polite" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 2. Symptom Checker -->
 <section id="hero-symptom" class="module">
  <h2><i class="fas fa-notes-medical"></i> Symptom Checker</h2>
  <p class="desc">
    Describe your symptoms and duration, choose severity, and our AI will recommend herbs, dosages, and precautions.
  </p>
  <form id="sym-form" class="sym-form">
    <div class="field">
      <label for="symInput">Your Symptoms</label>
      <textarea
        id="symInput"
        required
        placeholder="e.g. headache, nausea…"
      ></textarea>
    </div>

    <div class="field">
      <label for="symCategories">Category</label>
      <select id="symCategories" multiple size="4" required>
        <option disabled>Select category…</option>
        <option value="pain">Pain</option>
        <option value="digestive">Digestive</option>
        <option value="respiratory">Respiratory</option>
        <option value="stress">Stress</option>
        <option value="sleep">Sleep</option>
        <option value="energy">Energy</option>
        <option value="immune">Immune</option>
        <option value="skin">Skin</option>
        <option value="mental">Mental</option>
        <option value="cardio">Cardiovascular</option>
        <option value="Other">Other</option>
      </select>
      <input
        type="text"
        id="symCategoriesOther"
        placeholder="Please specify…"
        class="other-input"
      />
    </div>

    <div class="field range-field">
      <label for="severity">Severity</label>
      <input type="range" id="severity" min="1" max="10" value="5"/>
      <span id="sevValue">5</span>/10
    </div>

    <div class="field">
      <label for="symDuration">Duration (days)</label>
      <input type="number" id="symDuration" min="0" placeholder="e.g. 3"/>
    </div>

    <button type="submit" class="btn-primary">Get Recommendations</button>
  </form>

  <div id="symResult" class="response sym-response" hidden>
    <button class="close-btn" aria-label="Close result">×</button>
    <div class="result-content"></div>
    <div class="tool-row">
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
    </div>
  </div>
</section>


    <!-- 3. Cultural Knowledge -->
    <section id="hero–cultural" class="module">
      <h2><i class="fas fa-globe"></i> Cultural Knowledge</h2>
      <p class="desc">
        Learn about traditional rituals, folklore, and regional herbal practices. Enter a country, tradition, or herb name to get rich cultural insights.
      </p>
      <form id="culture-form" class="culture-input-wrapper">
        <input id="cultureQuery" name="q" type="text" placeholder="e.g. West African herbal uses…" required/>
        <button type="submit" class="btn-culture">Get Insights</button>
      </form>
      <div id="cultureResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 4. Safety Checker -->
    <section id="hero–safety" class="module">
      <h2><i class="fas fa-shield-alt"></i> Safety Checker</h2>
      <p class="desc">
        Check for potential adverse interactions between two herbs or medications. Enter both items to ensure safe usage.
      </p>
      <form id="safety-form">
        <input id="safetyA" placeholder="Item A (e.g. Turmeric)" aria-label="Item A" required/>
        <input id="safetyB" placeholder="Item B (e.g. Warfarin)" aria-label="Item B" required/>
        <button type="submit">Check Interaction</button>
        <div class="hint">Ensure both entries are distinct and correctly spelled.</div>
      </form>
      <div id="safetyResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
         <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <!-- 5. AI Herbalist Chat -->
    <section id="hero–chat" class="module">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
        <h2><i class="fas fa-comments"></i> AI Herbalist Chat</h2>
        <div class="chat-controls">
          <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
          <button id="clearChat" title="Clear Chat"><i class="fas fa-trash-alt"></i></button>
        </div>
      </div>
       <div id="chatBox" class="chat-box" role="log" aria-live="polite"></div>
      <div class="chat-input-row">
        <input id="chatInput" placeholder="Ask about herbal remedies…" aria-label="Type your question"/>
        <button id="sendChat" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
      </div>
    </section>

    <!-- 6. Personalized Formulations -->
    <section id="formulations" class="module">
      <h2><i class="fas fa-prescription-bottle"></i> Personalized Formulations</h2>
      <p class="desc">
        Select one herb, enter age and weight, and receive a custom formulation tailored to your profile.
      </p>
      <form id="pf-form">
        <select id="pfHerbs" aria-label="Select herb" required>
          <option disabled selected>Select herb…</option>
          <option>Ashwagandha</option>
          <option>Astragalus</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
          <option>Roselle</option>
          <option>Soursop</option>
          <option>Baobab</option>
          <option>Moringa</option>
          <option>Ginger</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
         <option value="Other">Other</option>
        </select>
        <input type="text" id="pfHerbsOther" placeholder="Please specify herb…" class="other-input hidden"/>

        <input id="pfAge" type="number" min="1" max="120" placeholder="Age (years)" required/>
        <input id="pfWeight" type="number" min="10" max="300" placeholder="Weight (kg)" required/>
        <button type="submit">Generate Formulation</button>
        <div class="hint">Select one herb from the dropdown, then enter valid age and weight.</div>
      </form>
      <div id="pfResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <p class="hint"><em>Formulation meets recommended dosage safety limits.</em></p>
      </div>
    </section>

    <!-- 7. Research Summaries -->
    <section id="research" class="module">
      <h2><i class="fas fa-book-reader"></i> Research Summaries</h2>
      <p class="desc">
        Paste study titles, abstracts, or keywords and get a concise, plain-text summary of findings, including key citations.
      </p>
      <form id="research-form">
        <input id="researchQuery" placeholder="e.g. ‘Ashwagandha anxiety RCT’" aria-label="Research query" required/>
        <button type="submit">Generate Summary</button>
        <div class="hint">Include herb name and research focus for best results.</div>
      </form>
      <div id="researchResults" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <a href="#" target="_blank">Read Original Study</a>
      </div>
    </section>

    <!-- 8. Inventory Forecast -->
    <section id="inventory" class="module">
      <h2><i class="fas fa-warehouse"></i> Inventory Forecast</h2>
      <p class="desc">
        Predict future stock requirements for your herbal inventory. Select a herb and forecast period (1–52 weeks).
      </p>
      <form id="inventory-form">
        <select id="forecastHerb" aria-label="Select herb for forecast" required>
          <option disabled selected>Select herb…</option>
          <option>Ashwagandha</option>
          <option>Astragalus</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
          <option>Roselle</option>
          <option>Soursop</option>
          <option>Baobab</option>
          <option>Moringa</option>
          <option>Ginger</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
         <option value="Other">Other</option>
        </select>
        <input type="text" id="forecastHerbOther" placeholder="Please specify herb…" class="other-input hidden"/>

       <input id="forecastPeriod" type="number" min="1" max="52" value="4" placeholder="Weeks ahead" required/>
        <button type="submit">Forecast Inventory</button>
        <div class="hint">Enter number of weeks (1–52) for demand prediction.</div>
      </form>
      <div id="inventoryResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 9. Genetics Match -->
    <section id="genetics" class="module">
      <h2><i class="fas fa-dna"></i> Genetics Match</h2>
      <p class="desc">
        Upload your genetic report (CSV or JSON) to receive herb recommendations tailored to your SNP profile.
      </p>
      <form id="genetics-form">
        <input id="geneticUpload" type="file" accept=".csv,.json" aria-label="Upload genetic report"/>
        <button type="submit">Analyze Genetics</button>
        <div class="hint">Supported formats: CSV or JSON with SNP data.</div>
      </form>
      <div id="geneticResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <p class="hint"><em>Tier 1: evidence-based recommendations. Tier 2: emerging scientific data.</em></p>
      </div>
    </section>

    <!-- 10. Dosage Calculator -->
    <section id="dosage" class="module">
      <h2><i class="fas fa-calculator"></i> Dosage Calculator</h2>
      <p class="desc">
        Calculate daily herbal dosage based on your weight, symptom, and extract form for accurate guidance.
      </p>
      <form id="dose-form">
        <input id="weight" type="number" min="10" max="300" placeholder="Weight (kg)" required/>
        <input id="symptom" placeholder="Symptom (e.g. headache)" required/>
        <select id="formType" aria-label="Select extract type">
          <option value="powder">Powder</option>
          <option value="tincture">Tincture</option>
          <option value="capsule">Capsule</option>
        <option value="Other">Other</option>
        </select>
        <input type="text" id="formTypeOther" placeholder="Please specify form…" class="other-input hidden"/>

        <button type="submit">Calculate Dosage</button>
        <div class="hint">Specify extract form for precise calculations.</div>
      </form>
      <div id="dosageResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
         <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <!-- 11. Interaction Checker -->
    <section id="interaction" class="module">
      <h2><i class="fas fa-exchange-alt"></i> Interaction Checker</h2>
      <p class="desc">
        Select two herbs to verify if any harmful interactions exist. Helps ensure safe co-administration.
      </p>
      <form id="int-form">
        <select id="herbA" aria-label="Herb A" required>
          <option disabled selected>Herb A…</option>
          <option>Ashwagandha</option>
          <option>Baobab</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginger</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Moringa</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
        </select>
        <select id="herbB" aria-label="Herb B" required>
          <option disabled selected>Herb B…</option>
          <option>Ashwagandha</option>
          <option>Baobab</option>
          <option>Basil</option>
          <option>Chamomile</option>
          <option>Echinacea</option>
          <option>Ginger</option>
          <option>Ginkgo Biloba</option>
          <option>Ginseng</option>
          <option>Hibiscus</option>
          <option>Holy Basil</option>
          <option>Lavender</option>
          <option>Licorice</option>
          <option>Milk Thistle</option>
          <option>Neem</option>
          <option>Moringa</option>
          <option>Oregano</option>
          <option>Peppermint</option>
          <option>Rosemary</option>
          <option>St. John’s Wort</option>
          <option>Turmeric</option>
          <option>Valerian</option>
        </select>
        <button type="submit">Check Interaction</button>
        <div class="hint">Be sure to pick two different herbs to compare.</div>
      </form>
      <div id="interactionResult" class="response" role="status" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
         <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>


      <!-- 12. Meet a Herbal Health Expert -->
<section id="meet-professional" class="module meet-module">
    <div class="meet-content">
      <div class="meet-icon">
        <i class="fas fa-user-md"></i>
      </div>
      <div class="meet-text">
        <h2>Meet a<BR>Herbal Health Expert</h2>
        <p>Get one-on-one guidance from our licensed herbal practitioners. Discover tailored wellness plans, expert dosage advice, and safe herbal combinations.</p>
        <a href="consult.html" class="btn-schedule">
          <i class="fas fa-calendar-check"></i>
          Schedule Consultation
        </a>
      </div>
    </div>
  </section>
    
    <!-- 13. ROI Calculator -->
    <section id="roi" class="module">
      <h2><i class="fas fa-dollar-sign"></i> Business Insights &amp; ROI Calculator</h2>
     <p class="desc">
        Calculate the financial return on investment (ROI) of integrating our AI‐driven herbal prescription system into your practice. 
        <br>1) Choose your currency. 2) Enter your average monthly number of AI‐generated herb prescriptions. 
        <br>3) Enter your average cost per herb prescription. 
        <br><strong>The result will show estimated monthly savings vs. traditional methods and ROI percentage.</strong>
      </p>
      <form id="roi-form">
        <div class="field">
          <label for="currency">Currency</label>
          <select id="currency">
            <option value="GHS" selected>Ghanaian Cedi (GHS)</option>
            <option value="USD">US Dollar (USD)</option>
            <option value="EUR">Euro (EUR)</option>
             <option value="Other">Other</option>
          </select>
          <input type="text" id="currencyOther" placeholder="Please specify currency…" class="other-input"/>
        </div>
        <div class="field">
          <label for="roiRx">Monthly Prescriptions</label>
          <input type="number" id="roiRx" required placeholder="e.g. 100"/>
        </div>
        <div class="field">
          <label for="roiCost">Avg. Herb Cost (<span id="curSym">₵</span>)</label>
          <input type="number" id="roiCost" required placeholder="e.g. 25"/>
        </div>
        <button type="submit">Calculate ROI</button>
      </form>
      <div id="roiResult" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 14. Executive Analytics Dashboard -->
    <section id="analytics" class="module">
      <h2><i class="fas fa-chart-line"></i> Executive Analytics &amp; KPIs</h2>
      <p class="desc">
        Monitor real-time metrics to track user adoption, efficacy, inventory usage, and financial ROI—visualized in interactive charts.
      </p>
      <div class="charts">
        <figure class="chart-card">
          <canvas id="chartAdoption"></canvas>
 <figcaption><strong>Adoption Over Time:</strong> Number of new users subscribing to the AI Herbalist each month.</figcaption>
          <p class="chart-desc">This line chart shows how many unique practitioners started using AI‐based prescriptions from Jan to May.</p>

        </figure>
        <figure class="chart-card">
          <canvas id="chartEfficacy"></canvas>
 <figcaption><strong>Adoption Over Time:</strong> Number of new users subscribing to the AI Herbalist each month.</figcaption>
          <p class="chart-desc">This line chart shows how many unique practitioners started using AI‐based prescriptions from Jan to May.</p>
        </figure>
        <figure class="chart-card">
          <canvas id="chartSupply"></canvas>
  <figcaption><strong>Supply Impact:</strong> Proportion of top‐three herbs used weekly.</figcaption>
          <p class="chart-desc">This pie chart shows how inventory usage is split among Herb A, Herb B, and Herb C.</p>
        </figure>
        <figure class="chart-card">
          <canvas id="chartROI"></canvas>
<figcaption><strong>Financial ROI:</strong> Quarterly return on investment percentages.</figcaption>
         <p class="chart-desc">This radar chart displays ROI metrics for Q1–Q4.</p>
        </figure>
      </div>
 <button id="exportCSV" class="btn-primary">Export Full CSV</button>
    </section>


     <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 Vitra AI. <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms &amp; Conditions</a></p>
  </footer>
  </main>

  <script>
      document.addEventListener("DOMContentLoaded", () => {
        ["idenResult","symResult","cultureResult","safetyResult",
         "pfResult","researchResults","inventoryResult","geneticResult",
         "dosageResult","interactionResult","roiResult"]
        .forEach(id => {
          const panel = document.getElementById(id);
          const saved = localStorage.getItem(id);
          if (saved) {
            panel.innerHTML = saved;
            panel.hidden = false;
            // Re-attach close & tool buttons after restoring
            panel.querySelectorAll(".close-btn").forEach(btn => btn.onclick = () => panel.hidden = true);
            if (panel.querySelector(".tool-row")) {
              panel.querySelectorAll(".copy-btn").forEach(cb => {
                cb.onclick = () => {
                  const content = panel.querySelector(".result-content").innerText;
                  navigator.clipboard.writeText(content);
                  const t = document.createElement("div");
                  t.className = "copy-toast";
                  t.textContent = "Copied!";
                  document.body.append(t);
                  setTimeout(() => t.remove(), 1500);
                };
              });
              panel.querySelectorAll(".dl-btn").forEach(db => {
                db.onclick = () => {
                  const text = panel.querySelector(".result-content").innerText;
                  const blob = new Blob([text], { type: "text/plain" });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement("a");
                  a.href = url;
                  a.download = "response.txt";
                  document.body.append(a);
                  a.click();
                  URL.revokeObjectURL(url);
                  a.remove();
                };
              });
            }
          }
        });
      });
    </script>
 
<script>
  // ───── Utility: sanitize user-provided strings ─────
  function escapeHtml(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  document.addEventListener("DOMContentLoaded", () => {
    // ─── UTILITY FUNCTIONS ─────────────────────────────────────────────────

    // Send messages to OpenAI via proxy
    async function callOpenAI(messages) {
      try {
        const response = await fetch("/.netlify/functions/openai-proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages })
        });
        if (!response.ok) throw new Error("OpenAI request failed");
        const data = await response.json();
        return data.choices?.[0]?.message?.content.trim() || "";
      } catch (err) {
        console.error(err);
        throw err;
      }
    }

    
    // Send an image file to Vision API via proxy
    async function callVision(file) {
      // Build FormData
      const fd = new FormData();
      fd.append("file", file);

      // Send to Netlify function
      const res = await fetch("/.netlify/functions/vision-proxy", {
        method: "POST",
        body: fd,
      });

      // Grab raw text (in case the function returned non-JSON or JSON with { error: ... })
      const rawText = await res.text();
      let payload = null;
      try {
        payload = JSON.parse(rawText);
      } catch {
        // Not valid JSON → keep raw text
        payload = null;
      }

      if (!res.ok) {
        // If payload.error exists, show it. Otherwise show raw text.
        const errMsg = payload && payload.error ? payload.error : rawText;
        throw new Error("Vision API error: " + errMsg);
      }

      // At this point, res.ok is true. Return parsed JSON (or raw text if JSON.parse failed).
      return payload !== null ? payload : rawText;
    }

    // Convert simple markdown to HTML paragraphs and headers
    function formatHTML(text) {
      if (!text) return "";
      return text
        .replace(/^######\s*(.+)$/gm, "<h6>$1</h6>")
        .replace(/^#####\s*(.+)$/gm, "<h5>$1</h5>")
        .replace(/^####\s*(.+)$/gm, "<h4>$1</h4>")
        .replace(/^###\s*(.+)$/gm, "<h3>$1</h3>")
        .replace(/^##\s*(.+)$/gm, "<h2>$1</h2>")
        .replace(/^#\s*(.+)$/gm, "<h1>$1</h1>")
        .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
        .replace(/\*(.+?)\*/g, "<em>$1</em>")
        .replace(/`([^`]+)`/g, "<code>$1</code>")
        .split(/\n{2,}/)
        .map(p => `<p>${p.trim()}</p>`)
        .join("");
    }

    // Append a close ("×") button to a response panel
    function addClose(panel) {
      if (panel.querySelector(".close-btn")) return;
      const btn = document.createElement("button");
      btn.className = "close-btn";
      btn.setAttribute("aria-label", "Close result");
      btn.textContent = "×";
      btn.onclick = () => (panel.hidden = true);
      panel.prepend(btn);
    }

    // Add copy and download tools below the result-content
    function addTools(panel) {
      if (panel.querySelector(".tool-row")) return;
      const tools = document.createElement("div");
      tools.className = "tool-row";
      tools.innerHTML = `
        <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
        <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>`;
      panel.append(tools);

      const copyBtn = tools.querySelector(".copy-btn");
      const dlBtn = tools.querySelector(".dl-btn");
      const contentDiv = panel.querySelector(".result-content");

      copyBtn.onclick = () => {
        if (!contentDiv) return;
        navigator.clipboard.writeText(contentDiv.innerText || "");
        const toast = document.createElement("div");
        toast.className = "copy-toast";
        toast.textContent = "Copied!";
        document.body.append(toast);
        setTimeout(() => toast.remove(), 1500);
      };

      dlBtn.onclick = () => {
        if (!contentDiv) return;
        const text = contentDiv.innerText || "";
        const blob = new Blob([text], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "response.txt";
        document.body.append(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      };
    }

    // Show a friendly error in a panel
    function showFriendlyError(panel) {
      panel.innerHTML = '<div class="result-content">😕 Oops! Something went wrong. Please try again.</div>';
      addClose(panel);
    }

    // Helper to wire up form submissions with AI calls
    function wireForm({ formId, systemPrompt, inputExtractor, resultPanelId }) {
      const form = document.getElementById(formId);
      const panel = document.getElementById(resultPanelId);
      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
        try {
          const userContent = inputExtractor();
          const reply = await callOpenAI([
            { role: "system", content: systemPrompt },
            { role: "user", content: userContent }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
          addClose(panel);
          addTools(panel);
        } catch (err) {
          showFriendlyError(panel);
        }
      };
    }

    // ─── SIDEBAR & THEME TOGGLES ─────────────────────────────────────────────

    const sidebar = document.getElementById("sidebar");
    const shrinkBtn = document.getElementById("shrinkBtn");
    const hamburger = document.getElementById("hamburger");
    const themeToggle = document.getElementById("themeToggle");

    // Toggle collapsed sidebar
   shrinkBtn.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      const icon = shrinkBtn.querySelector("i");
      icon.classList.toggle("fa-angle-double-left");
      icon.classList.toggle("fa-angle-double-right");
    });

    // Toggle sidebar visibility on mobile
    hamburger.addEventListener("click", () => {
      sidebar.classList.toggle("open");
    });

    // Toggle dark mode
    themeToggle.addEventListener("click", () => {
      const htmlEl = document.documentElement;
      const isDark = htmlEl.classList.toggle("dark");
      themeToggle.classList.toggle("fa-sun", isDark);
      themeToggle.classList.toggle("fa-moon", !isDark);
      htmlEl.setAttribute("aria-theme", isDark ? "dark" : "light");
    });

    // Show hamburger icon only under 1024px
    const mq = window.matchMedia("(max-width: 1024px)");
    function updateHamburgerVisibility() {
      hamburger.style.display = mq.matches ? "block" : "none";
    }
    mq.addListener(updateHamburgerVisibility);
    updateHamburgerVisibility();

    // Whenever a <select> gets value “Other”, reveal its corresponding .other-input
    document.querySelectorAll("select").forEach((sel) => {
      sel.addEventListener("change", (e) => {
         const otherField = document.getElementById(sel.id + "Other");
       if (!otherField) return;
       // If “Other” is one of the chosen options, show & require that field
       const pickedOther = Array.from(sel.selectedOptions).some(opt => opt.value === "Other");
       if (pickedOther) {
         otherField.style.display = "block";
         otherField.required = true;
       } else {
         otherField.style.display = "none";
         otherField.required = false;
       }
      });
    });
    
    // ─── PLANT IDENTIFIER ─────────────────────────────────────────────────

    const idenForm = document.getElementById("iden-form");
    const idenResult = document.getElementById("idenResult");
    const idenPreview = document.getElementById("idenPreview");
    const idenClear = document.getElementById("idenClear");

    function previewImage(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
          idenPreview.src = e.target.result;
          idenPreview.style.display = "block";
          idenClear.style.display = "block";
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    window.previewImage = previewImage; // expose to onchange

    function clearPreview() {
      idenPreview.style.display = "none";
      idenPreview.src = "";
      idenClear.style.display = "none";
      document.querySelector("#iden-form input[type=file]").value = "";
      document.getElementById("idenDesc").value = "";
    }
    window.clearPreview = clearPreview; // expose to onclick

    idenForm.onsubmit = async (e) => {
      e.preventDefault();
      const panel = idenResult;
      panel.hidden = false;
      panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';

      const fileInput = idenForm.querySelector('input[type="file"]');
      const file = fileInput.files[0];
      const desc = document.getElementById("idenDesc").value.trim();

      if (!file && !desc) {
        panel.innerHTML = '<div class="result-content">⚠️ Please upload an image or provide a description.</div>';
        addClose(panel);
        return;
      }

      try {
        let html = "";

        if (file) {
          // Call your Vision-proxy function
          const data = await callVision(file);
          html += `
            <p><strong>Plant Name:</strong> ${escapeHtml(data.name)}</p>
            <p><strong>Medicinal Uses:</strong> ${escapeHtml(data.uses)}</p>
            <p><strong>Cautions:</strong> ${escapeHtml(data.cautions)}</p>
            <p><strong>Native Regions:</strong> ${Array.isArray(data.regions) ? escapeHtml(data.regions.join(", ")) : "N/A"}</p>
            <hr/>`;
        }

        if (desc) {
         // If user typed a description, also send it to OpenAI
            panel.innerHTML = `<div class="result-content">Consulting AI about your text… <span class="spinner"></span></div>`;
            const sys = `
You are a world‐class botanist. Given a user’s plant description, reply with a concise paragraph that includes:
• Plant name  
• Medicinal uses  
• Any cautions or side effects  
• Native or regional information  
Add any additional helpful notes in a coherent, single paragraph.
          `.trim();
          const aiReply = await callOpenAI([
            { role: "system", content: sys },
            { role: "user", content: `Describe plant: "${desc}"` }
          ]);
          html += `<p>${escapeHtml(aiReply)}</p>`;
       }

        panel.innerHTML = `<div class="result-content">${html}</div>`;
        localStorage.setItem("idenResult", panel.innerHTML);
        addClose(panel);
        addTools(panel);
      } catch (err) {
        // 1) Log full error in console for debugging
        console.error("Vision or AI call failed:", err);

        // 2) Show the actual message (or full error) in the UI
        const msg = err.message || JSON.stringify(err);
        panel.innerHTML = `
          <div class="result-content">
            😕 Something went wrong.<br>
            <em>${escapeHtml(msg)}</em>
          </div>`;
        addClose(panel);
      }
    };

    // ─── SYMPTOM CHECKER ─────────────────────────────────────────────────────

    const severitySlider = document.getElementById("severity");
    const sevValueSpan = document.getElementById("sevValue");
    severitySlider.oninput = (e) => {
      sevValueSpan.textContent = e.target.value;
    };

    document.getElementById("sym-form").onsubmit = async (e) => {
      e.preventDefault();
      const panel = document.getElementById("symResult");
      panel.hidden = false;
      panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';

      const symptoms = document.getElementById("symInput").value.trim();
      const categories = Array.from(
        document.getElementById("symCategories").selectedOptions
      ).map(o => o.value).join(", ");
      const severity = document.getElementById("severity").value;
      const duration = document.getElementById("symDuration").value || "0";

      try {
        const aiReply = await callOpenAI([
          {
            role: "system",
            content: `
You are an expert herbal diagnostician. A user will give you:
• Their symptoms  
• Chosen categories  
• Severity (1–10)  
• Duration in days  

Provide:
1) A short introductory paragraph acknowledging the symptoms.  
2) One paragraph listing recommended herbs (with their dosages).  
3) One paragraph detailing any precautions or contraindications.  
Write in clear, complete sentences and separate each section into its own paragraph.
            `.trim()
          },
          {
            role: "user",
            content: `Symptoms: ${symptoms}
Categories: ${categories}
Severity: ${severity}
Duration: ${duration} days`
          }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        localStorage.setItem("symResult", panel.innerHTML);
        addClose(panel);
        addTools(panel);
      } catch (err) {
        showFriendlyError(panel);
      }
    };

    // ─── CULTURAL KNOWLEDGE ─────────────────────────────────────────────────

    wireForm({
      formId: "culture-form",
      systemPrompt: `
You are an expert in cultural herbalism and folklore. A user will give you a region, tradition, or herb name. Provide concise, culturally relevant practices, rituals, and folklore associated with that input. Format as short paragraphs or bullet points.
      `.trim(),
      inputExtractor: () => document.getElementById("cultureQuery").value.trim(),
      resultPanelId: "cultureResult"
    });

    // ─── SAFETY CHECKER ─────────────────────────────────────────────────────

    wireForm({
      formId: "safety-form",
      systemPrompt: `
You are a safety expert in herbal and pharmaceutical interactions. Given two herbs or medications (Item A and Item B), determine if there are any known adverse interactions or contraindications. Respond with clear explanations, including references to known compounds if relevant.
      `.trim(),
      inputExtractor: () => {
        const a = document.getElementById("safetyA").value.trim();
        const b = document.getElementById("safetyB").value.trim();
        return `Item A: ${a}\nItem B: ${b}`;
      },
      resultPanelId: "safetyResult"
    });

    // ─── AI HERBALIST CHAT ──────────────────────────────────────────────────

    const chatBox = document.getElementById("chatBox");
    const sendChatBtn = document.getElementById("sendChat");
    const chatInput = document.getElementById("chatInput");
    const viewHistoryBtn = document.getElementById("viewHistory");
    const clearChatBtn = document.getElementById("clearChat");
    let lastDateHeader = null;

    // Load persisted history
    let chatHistory = JSON.parse(localStorage.getItem("chatHistory") || "[]");
    function formatDateSeparator(date) {
      const today = new Date();
      const diffDays = Math.floor((today.setHours(0, 0, 0, 0) - date.setHours(0, 0, 0, 0)) / 86400000);
      if (diffDays === 0) return "Today";
      if (diffDays === 1) return "Yesterday";
      return date.toLocaleDateString();
    }

    function addMessage(who, text, timestamp = new Date()) {
      const msgDate = timestamp instanceof Date ? timestamp : new Date(timestamp);
      const msgDay = msgDate.toDateString();
      if (msgDay !== lastDateHeader) {
        const sep = document.createElement("div");
        sep.className = "chat-date-separator";
        sep.textContent = formatDateSeparator(msgDate);
        chatBox.append(sep);
        lastDateHeader = msgDay;
      }
      const msgDiv = document.createElement("div");
      msgDiv.className = who === "You" ? "user-msg" : "bot-msg";
      msgDiv.innerHTML = `
        ${formatHTML(text)}
      <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true })}</div>
      `;
      chatBox.append(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Render saved history
    chatHistory.forEach(m => addMessage(m.who, m.text, new Date(m.timestamp)));

    // Send user message and get AI response
   sendChatBtn.onclick = async () => {
      const userText = chatInput.value.trim();
      if (!userText) return;
      // 1) Display user’s message
      const userTime = new Date();
      addMessage("You", userText, userTime);
      chatHistory.push({ who: "You", text: userText, timestamp: new Date().toISOString() });
      localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
      chatInput.value = "";

      // 2) Create a “bot-msg” placeholder with a spinner
      const spinnerDiv = document.createElement("div");
      spinnerDiv.className = "bot-msg";
      spinnerDiv.innerHTML = `<div class="spinner"></div>`;
      chatBox.append(spinnerDiv);
      chatBox.scrollTop = chatBox.scrollHeight;

      // 3) Call OpenAI
      try {
        const aiReply = await callOpenAI([
          {
            role: "system",
            content: `
You are a friendly, knowledgeable herbalist. A user will ask questions about herbs, remedies, dosages, or plant facts. Respond in plain language, giving clear instructions or information about herbal care.
          `.trim()
          },
          { role: "user", content: userText }
       ]);

        // 4) Replace spinnerDiv with actual message
       const msgDate = new Date();
        spinnerDiv.innerHTML = `
          ${formatHTML(aiReply)}
          <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}</div>
        `;
        chatHistory.push({ who: "Herbalist", text: aiReply, timestamp: msgDate.toISOString() });
        localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
      } catch (err) {
        spinnerDiv.innerHTML = `<div class="result-content">⚠️ Oops! Something went wrong. Please try again.</div>`;
      }
      chatBox.scrollTop = chatBox.scrollHeight;
    };

    // Clear chat box (history cleared)
    clearChatBtn.onclick = () => {
      chatBox.innerHTML = "";
      lastDateHeader = null;
    };

    // View chat history in a modal
    viewHistoryBtn.onclick = () => {
     const modal = document.createElement("div");
      modal.className = "history-modal";
       const grouped = {};
      chatHistory.forEach((m, i) => {
        const dt = new Date(m.timestamp);
        const label = formatDateSeparator(dt);
        if (!grouped[label]) grouped[label] = [];
        grouped[label].push({ who: m.who, text: m.text, idx: i });
      });
      // Build table HTML: one <thead> per group, then <tbody> rows
      let tableHTML = `<table class="history-table">`;
      Object.keys(grouped).forEach((label) => {
        tableHTML += `
          <thead>
            <tr><th colspan="3">${label}</th></tr>
            <tr>
              <th>Sender</th>
              <th>Message</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            ${grouped[label]
              .map(m =>
                `<tr data-index="${m.idx}">
                   <td>${m.who}</td>
                   <td>${escapeHtml(m.text)}</td>
                   <td><button class="del-msg" data-index="${m.idx}" title="Delete"><i class="fas fa-trash-alt"></i></button></td>
                 </tr>`
              ).join("")}
          </tbody>`;
      });
      tableHTML += `</table>`;

      modal.innerHTML = `
        <div class="history-content">
          <h3>Chat History</h3>
          <div class="history-table-wrapper">
            ${tableHTML}
          </div>
          <div class="history-actions">
            <button class="clear-history"><i class="fas fa-trash"></i> Clear History</button>
            <button class="close-history"><i class="fas fa-times"></i> Close</button>
          </div>
        </div>`;
    document.body.append(modal);

    // Hook up delete buttons (per‐row)
      modal.querySelectorAll(".del-msg").forEach(btn => {
        btn.onclick = () => {
          const idx = +btn.dataset.index;
          chatHistory.splice(idx, 1);
          localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
          // Remove that <tr> from the table
          const row = modal.querySelector(`tr[data-index="${idx}"]`);
          if (row) row.remove();
          // Re‐index the remaining rows’ data-index attributes
          modal.querySelectorAll(".history-table tbody tr").forEach((tr, i) => {
            tr.dataset.index = i;
            tr.querySelector(".del-msg").dataset.index = i;
          });
        };
      });
      // “Clear History” button
      modal.querySelector(".clear-history").onclick = () => {
        chatHistory = [];
        localStorage.removeItem("chatHistory");
        modal.remove();
      };
      // “Close” button
      modal.querySelector(".close-history").onclick = () => modal.remove();
    };

    // ─── PERSONALIZED FORMULATIONS ────────────────────────────────────────────

    wireForm({
      formId: "pf-form",
      systemPrompt: `
You are an expert herbal pharmacist. A user will provide one herb, age, and weight. Create a safe, personalized herbal formulation. Specify dosage, preparation method (e.g., tea, tincture), and any safety precautions. Use plain text bullet points.
      `.trim(),
      inputExtractor: () => {
        let herb = document.getElementById("pfHerbs").value;
      if (herb === "Other") {
        herb = document.getElementById("pfHerbsOther").value.trim();
      }
        const age = document.getElementById("pfAge").value;
        const weight = document.getElementById("pfWeight").value;
        return `Herb: ${herb}\nAge: ${age}\nWeight: ${weight} kg`;
      },
      resultPanelId: "pfResult"
    });

    // ─── RESEARCH SUMMARIES ───────────────────────────────────────────────────

    wireForm({
      formId: "research-form",
      systemPrompt: `
You are an expert researcher specializing in herbal clinical studies. The user will provide study titles, abstracts, or keywords. Provide a concise, plain-text summary of the research, highlighting methodology, results, and conclusions. Include citations where appropriate.
      `.trim(),
      inputExtractor: () => document.getElementById("researchQuery").value.trim(),
      resultPanelId: "researchResults"
    });

    // ─── INVENTORY FORECAST ───────────────────────────────────────────────────

    wireForm({
      formId: "inventory-form",
      systemPrompt: `
You are an experienced inventory analyst for herbal dispensaries. Given a herb name and a number of weeks, forecast weekly stock needs with buffer stock recommendations. Provide the answer as a short report with bullet points.
      `.trim(),
      inputExtractor: () => {
         let herb = document.getElementById("forecastHerb").value;
         if (herb === "Other") {
            herb = document.getElementById("forecastHerbOther").value.trim();
         }
        const weeks = document.getElementById("forecastPeriod").value;
        return `Herb: ${herb}\nWeeks Ahead: ${weeks}`;
      },
      resultPanelId: "inventoryResult"
    });

    // ─── GENETICS MATCH ───────────────────────────────────────────────────────

    document.getElementById("genetics-form").onsubmit = async (e) => {
      e.preventDefault();
      const panel = document.getElementById("geneticResult");
      panel.hidden = false;
      panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';

      const fileInput = document.getElementById("geneticUpload");
      const file = fileInput.files[0];
      if (!file) {
        panel.innerHTML = '<div class="result-content">⚠️ Please upload a CSV or JSON file containing genetic SNP data.</div>';
        addClose(panel);
        return;
      }
      const allowedTypes = ["application/json", "text/csv"];
      if (!allowedTypes.includes(file.type)) {
        panel.innerHTML = '<div class="result-content">⚠️ Invalid file type. Upload a .csv or .json file.</div>';
        addClose(panel);
        return;
      }

      try {
        const fileText = await file.text();
        const aiReply = await callOpenAI([
          {
            role: "system",
            content: `
You are a genetics expert in herbal medicine. The user will upload a genetic report as CSV or JSON containing SNP data. Analyze the SNPs and recommend herbs tailored to their genetic profile. Provide evidence-level details: Tier 1 (strong evidence), Tier 2 (emerging). Format as bullet points.
            `.trim()
          },
          { role: "user", content: fileText }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        localStorage.setItem("geneticResult", panel.innerHTML);
        addClose(panel);
        addTools(panel);
      } catch (err) {
        showFriendlyError(panel);
      }
    };

    // ─── DOSAGE CALCULATOR ───────────────────────────────────────────────────

    wireForm({
      formId: "dose-form",
      systemPrompt: `
You are a dosage calculation expert for herbal preparations. Given a user’s weight (in kg), symptom (e.g., headache), and extract form (powder, tincture, or capsule), calculate a safe daily dosage range. Provide the answer in plain text, specifying units (e.g., mg, ml) and any relevant safety notes.
      `.trim(),
      inputExtractor: () => {
        const weight = document.getElementById("weight").value;
        const symptom = document.getElementById("symptom").value.trim();
        let formType = document.getElementById("formType").value;
         if (formType === "Other") {
           formType = document.getElementById("formTypeOther").value.trim();
         }
        return `Weight: ${weight} kg\nSymptom: ${symptom}\nForm Type: ${formType}`;
      },
      resultPanelId: "dosageResult"
    });

    // ─── INTERACTION CHECKER ───────────────────────────────────────────────────

    wireForm({
      formId: "int-form",
      systemPrompt: `
You are a qualified pharmacologist specialized in herb-herb interactions. Given two herbs, evaluate if any known harmful interactions exist. Provide a clear explanation, including mechanisms if known, and any safety advice.
      `.trim(),
      inputExtractor: () => {
        const a = document.getElementById("herbA").value;
        const b = document.getElementById("herbB").value;
        if (a === b) throw new Error("Please select two distinct herbs.");
        return `Herb A: ${a}\nHerb B: ${b}`;
      },
      resultPanelId: "interactionResult"
    });

    // ─── ROI CALCULATOR ───────────────────────────────────────────────────────

    document.getElementById("currency").onchange = (e) => {
      const symbolMap = { GHS: "₵", USD: "$", EUR: "€" };
      document.getElementById("curSym").textContent = symbolMap[e.target.value] || "";
    };

     document.getElementById("roi-form").onsubmit = async (e) => {
      e.preventDefault();
      const panel = document.getElementById("roiResult");
      panel.hidden = false;
      panel.innerHTML = '<div class="result-content">Calculating… <span class="spinner"></span></div>';

      const rxCount = +document.getElementById("roiRx").value;
      const cost = +document.getElementById("roiCost").value;
      const currency = document.getElementById("currency").value;
      let currency = document.getElementById("currency").value;
      if (herb === "Other") {
        herb = document.getElementById("currencyOther").value.trim();
      }
      if (!(rxCount > 0 && cost > 0)) {
        panel.innerHTML = '<div class="result-content">⚠️ Please enter positive numbers for prescriptions and cost.</div>';
        return;
      }

      try {
        const aiReply = await callOpenAI([
          {
            role: "system",
            content: `
You are a healthcare financial analyst. A user will provide:
1) Monthly AI-generated herb prescriptions (rxCount)
2) Average cost per prescription (cost)
3) Currency symbol (currency)

Calculate:
- Total monthly cost using AI (rxCount × cost)
- Estimate the cost if done via traditional manual methods (e.g., 25% higher than AI).
- Monthly savings = Traditional cost – AI cost
- ROI (%) = (Monthly savings / AI cost) × 100

Provide step-by-step calculations in plain text, using currency: ${currency}. 
Conclude with final ROI percentage and a short summary line.
            `.trim()
          },
          {
            role: "user",
            content: `Monthly Prescriptions: ${rxCount}\nAverage Cost: ${cost}`
          }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
        localStorage.setItem("roiResult", panel.innerHTML);
        addClose(panel);
        addTools(panel);
      } catch (err) {
        showFriendlyError(panel);
      }
    };

    // ─── EXECUTIVE ANALYTICS DASHBOARD ───────────────────────────────────────

   // ─── Executive Analytics: Real‐Data Charts ────────────────────────────
  function getCSSVar(name) {
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  }

  function initRealCharts() {
    const colorText = getCSSVar("--text");
    const colorMuted = getCSSVar("--muted");

    // 1) Adoption Over Time (line)
    new Chart("chartAdoption", {
      type: "line",
      data: {
        labels: ["January","February","March","April","May","June","July"],
        datasets: [{
          label: "New Users",
          data: [45, 60, 80, 95, 120, 135, 150],
          borderColor: getCSSVar("--primary"),
          backgroundColor: "rgba(58,118,84,0.1)",
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { 
            ticks: { color: colorText },
            grid: { display: false }
          },
          y: {
            ticks: { color: colorText },
            grid: { color: colorMuted }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // 2) Efficacy Outcomes (bar): positive feedback % per herb
    new Chart("chartEfficacy", {
      type: "bar",
      data: {
        labels: ["Ashwagandha","Turmeric","Ginger","Chamomile"],
        datasets: [{
          data: [78, 85, 72, 90],
          backgroundColor: [
            "rgba(42,111,78,0.7)",
            "rgba(142,108,75,0.7)",
            "rgba(212,197,162,0.7)",
            "rgba(42,111,78,0.4)"
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { ticks: { color: colorText }, grid: { display: false } },
          y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true, max: 100 }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // 3) Inventory Impact (pie): usage (kg) of top herbs this week
    new Chart("chartSupply", {
      type: "pie",
      data: {
        labels: ["Turmeric","Moringa","Ginger","Hibiscus"],
        datasets: [{
          data: [120, 95, 80, 60],
          backgroundColor: [
            "rgba(142,108,75,0.7)",
            "rgba(42,111,78,0.7)",
            "rgba(212,197,162,0.7)",
            "rgba(42,111,78,0.4)"
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "bottom",
            labels: { color: colorText }
          }
        }
      }
    });

    // 4) Financial ROI (radar) for Q1–Q4
    new Chart("chartROI", {
      type: "radar",
      data: {
        labels: ["Q1","Q2","Q3","Q4"],
        datasets: [{
          label: "ROI (%)",
          data: [12, 18, 22, 15],
          borderColor: getCSSVar("--secondary"),
          backgroundColor: "rgba(142,108,75,0.2)"
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            angleLines: { color: colorMuted },
            grid: { color: colorMuted },
            pointLabels: { color: colorText }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  // ─── Export all charts + descriptions as CSV ─────────────────────────
  document.getElementById("exportCSV").addEventListener("click", () => {
    const charts = [
      {
        id: "Adoption",
        desc: "Adoption Over Time: New AI users each month",
        labels: ["January","February","March","April","May","June","July"],
        values: [45, 60, 80, 95, 120, 135, 150]
      },
      {
        id: "Efficacy",
        desc: "Efficacy Outcomes: Positive feedback % per herb",
        labels: ["Ashwagandha","Turmeric","Ginger","Chamomile"],
        values: [78, 85, 72, 90]
      },
      {
        id: "Supply",
        desc: "Inventory Impact: Weekly usage (kg) of top herbs",
        labels: ["Turmeric","Moringa","Ginger","Hibiscus"],
        values: [120, 95, 80, 60]
      },
      {
        id: "ROI",
        desc: "Financial ROI: Quarterly ROI (%)",
        labels: ["Q1","Q2","Q3","Q4"],
        values: [12, 18, 22, 15]
      }
    ];
    let csvContent = "Chart,Description,Label,Value\n";
    charts.forEach(ch => {
      ch.labels.forEach((lab, idx) => {
        csvContent += `"${ch.id}","${ch.desc}","${lab}",${ch.values[idx]}\n`;
      });
    });
    const blob = new Blob([csvContent], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "analytics_full.csv";
    document.body.append(a);
    a.click();
    URL.revokeObjectURL(url);
    a.remove();
  });

    // ─── RESPONSE PANEL CLOSE BUTTONS ─────────────────────────────────────────

    // Ensure all static panels have close behavior
    document.querySelectorAll(".response .close-btn").forEach((btn) => {
      btn.onclick = () => {
        const panel = btn.closest(".response");
        if (panel) panel.hidden = true;
      };
    });
  });
</script>
  <script>
    window.addEventListener("load", () => {
      if (typeof initRealCharts === "function") {
        initRealCharts();
      }
    });
  </script>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Grab all sidebar links:
    document.querySelectorAll('aside#sidebar nav a').forEach((link) => {
      // If the href of that link matches the current page’s filename...
      const linkHref = link.getAttribute("href").split("/").pop(); // e.g. "herbal.html"
      const pageNow = window.location.pathname.split("/").pop();    // e.g. "herbal.html"

      if (linkHref === pageNow) {
        link.classList.add("active");
      } else {
        link.classList.remove("active");
      }
    });
  });
</script>

</body>
</html>
