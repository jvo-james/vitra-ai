<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Dietetics & Nutrition</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>

/*────────────────────── Theme & Reset ──────────────────────*/
:root {
  --color-primary: #D4AC0D;
  --color-primary-alt: #B7950B;
  --color-secondary: #884EA0;
  --color-accent: rgba(255,255,224,0.8);
  --color-bg: #FEF9E7;
  --color-surface: rgba(255,255,240,0.9);
  --color-text: #3E3E3E;
  --color-muted: #7D6608;
  --radius: 1rem;
  --padding: 1rem;
  --transition: 0.3s ease;
  --shadow: 0 6px 20px rgba(0,0,0,0.1);
  --sidebar-width: 220px;
  --sidebar-collapsed: 60px;
}
html.dark {
  --color-bg: #1A1A1A;
  --color-surface: rgba(30,30,30,0.9);
  --color-text: #ECECEC;
  --color-muted: #AAA;
}
* {
  margin: 0; padding: 0; box-sizing: border-box;
  font-family: 'Montserrat', sans-serif;
}
body {
  display: flex; min-height: 100vh;
  background: var(--color-bg);
  color: var(--color-text);
  overflow-x: hidden;
  transition: background var(--transition), color var(--transition);
}
a { color: inherit; text-decoration: none; }
button, input, textarea, select { font: inherit; transition: var(--transition); }
:focus { outline: none; }

/*────────────────────── Sidebar ──────────────────────*/
aside#sidebar {
  position: fixed; top: 0; left: 0; bottom: 0;
  width: var(--sidebar-width);
  background: var(--color-surface);
  box-shadow: var(--shadow);
  display: flex; flex-direction: column;
  z-index: 1000;
}
aside#sidebar .brand {
  display: flex; align-items: center; gap: .75rem;
  padding: var(--padding);
  font-size: 1.25rem; font-weight: 700;
  color: var(--color-primary);
}
aside#sidebar nav ul {
  list-style: none; flex: 1; overflow-y: auto;
}
aside#sidebar nav li { }
aside#sidebar nav a {
  display: flex; align-items: center; gap: .75rem;
  padding: .75rem var(--padding);
  border-radius: var(--radius);
  color: var(--color-text);
  transition: background var(--transition), transform var(--transition);
}
aside#sidebar nav a:hover,
aside#sidebar nav .active a {
  background: var(--color-primary-alt);
  color: #fff;
  transform: translateX(4px);
}
#shrinkSidebar {
  margin: var(--padding); align-self: center;
  background: var(--color-primary);
  border: none; border-radius: 50%;
  width: 36px; height: 36px;
  color: #fff; box-shadow: var(--shadow);
  cursor: pointer;
}
aside#sidebar.collapsed {
width: var(--sidebar-collapsed);
 }
 aside#sidebar.collapsed .brand span,
 aside#sidebar.collapsed nav a span {  display: none;
 }
 aside#sidebar.collapsed nav a {
 justify-content: center;
 }
/*────────────────────── Header ──────────────────────*/
header {
  position: fixed; top: 0; left: var(--sidebar-width); right: 0;
  height: 60px;
  background: var(--color-surface);
  box-shadow: var(--shadow);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 var(--padding);
  z-index: 1001;
  transition: left var(--transition), background var(--transition);
}
header #hamburger {
  display: none; font-size: 1.5rem; color: var(--color-primary);
  cursor: pointer;
}
header #themeToggle {
  font-size: 1.5rem; color: var(--color-primary);
  cursor: pointer;
}
@media(max-width: 768px) {
  header #hamburger { display: block; }
  body.sidebar-open aside#sidebar { transform: translateX(0); }
  aside#sidebar { transform: translateX(-100%); transition: transform var(--transition); }
  header, main { left: 0 !important; }
}

/*────────────────────── Main & Modules ──────────────────────*/
main {
  flex: 1;
  margin-top: 60px;
  margin-left: var(--sidebar-width);
  padding: var(--padding);
  transition: margin-left var(--transition);
}
section.module {
  background: var(--color-surface);
  border-radius: var(--radius);
  padding: var(--padding);
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow);
  transition: transform var(--transition);
}
section.module:hover {
  transform: translateY(-4px);
}
h2 {
  display: flex; align-items: center; gap: .5rem;
  font-size: 1.6rem; color: var(--color-primary);
  margin-bottom: .75rem;
}
.desc {
  color: var(--color-muted);
  margin-bottom: 1rem;
}

/*────────────────────── Hero ──────────────────────*/
#hero .hero-features {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
  gap: 1rem;
  margin-top: 1rem;
}
.feature-card {
  background: var(--color-bg);
  border-radius: var(--radius);
  padding: var(--padding);
  box-shadow: var(--shadow);
  display: flex; flex-direction: column; align-items: flex-start;
  transition: transform var(--transition), box-shadow var(--transition);
}
.feature-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}
.feature-card i {
  font-size: 2rem; color: var(--color-primary-alt);
  margin-bottom: .5rem;
}
.feature-card h3 {
  margin-bottom: .75rem;
  font-size: 1.2rem;
}
.feature-card input,
.feature-card select {
  width: 100%; margin-bottom: .5rem;
}
.feature-card button {
  align-self: flex-end;
}

/*────────────────────── Chatbot ──────────────────────*/
.chat-controls {
  display: flex; gap: .5rem; margin-bottom: .5rem;
}
.chat-box {
  background: var(--color-bg);
  border: 1px solid var(--color-muted);
  border-radius: var(--radius);
  padding: var(--padding);
  max-height: 300px; overflow-y: auto;
  display: flex; flex-direction: column; gap: .5rem;
}
.chat-input {
  display: flex; gap: .5rem; margin-top: .5rem;
}
.chat-input input {
  flex: 1;
}
.user-msg, .bot-msg {
  max-width: 80%;
  padding: .75rem 1rem;
  border-radius: var(--radius);
  position: relative;
}
.user-msg {
  background: var(--color-primary-alt);
  color: #000; align-self: flex-end;
}
.bot-msg {
  background: var(--color-accent);
  color: var(--color-text); align-self: flex-start;
}
.timestamp {
  font-size: .65rem;
  color: var(--color-muted);
  position: absolute;
  bottom: -1.2rem; right: 1rem;
}

/*────────────────────── Forms & Inputs ──────────────────────*/
input, textarea, select {
  width: 100%;
  padding: .75rem;
  border: 1px solid var(--color-muted);
  border-radius: var(--radius);
  background: var(--color-accent);
  color: var(--color-text);
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
}
select + .other-input {
  margin-top: .5rem;
  display: none;
}
button.btn {
  display: inline-flex; align-items: center; gap: .5rem;
  padding: .75rem 1.25rem;
  border: none; border-radius: var(--radius);
  background: var(--color-primary); color: #000; font-weight: 600;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
button.btn:hover {
  background: var(--color-primary-alt);
  transform: translateY(-2px);
}
button.btn-secondary {
  background: var(--color-secondary); color: #fff;
}
button.btn-secondary:hover {
  background: var(--color-secondary-alt, #733d91);
}

/*────────────────────── Response Panels ──────────────────────*/
.response {
  background: var(--color-surface);
  border-left: 4px solid var(--color-secondary);
  border-radius: var(--radius);
  padding: var(--padding);
  margin-top: 1rem;
  position: relative;
  box-shadow: var(--shadow);
}
.response .result-content {
  white-space: pre-wrap;
  line-height: 1.5;
}
.tool-row {
  position: absolute; bottom: var(--padding); right: var(--padding);
  display: flex; gap: .5rem;
}
.close-btn, .copy-btn, .dl-btn {
  background: none; border: none; cursor: pointer;
}
.copy-btn, .dl-btn {
  width: 1.6rem; height: 1.6rem;
  display: flex; align-items: center; justify-content: center;
  border: 1px solid var(--color-muted);
  border-radius: 50%;
  background: var(--color-accent);
}
.copy-btn:hover, .dl-btn:hover {
  background: var(--color-primary-alt);
}

/*────────────────────── Fieldsets & Checkbox Groups ──────────────────────*/
fieldset {
  border: 1px solid var(--color-muted);
  border-radius: var(--radius);
  padding: .75rem;
  margin-bottom: 1rem;
}
legend {
  padding: 0 .5rem; font-weight: 600; color: var(--color-secondary);
}
.checkbox-group {
  display: flex; flex-wrap: wrap; gap: .5rem;
}
.checkbox-group label {
  display: flex; align-items: center; gap: .25rem;
}

/*────────────────────── Metabolomic & Fitness Sections ──────────────────────*/
#risk-form label, #fitness-form fieldset label {
  margin-bottom: .75rem;
}
#risk-form input[type="date"],
#fitness-form input[type="date"],
#fitness-form input[type="time"] {
  width: auto; display: inline-block; margin-left: .5rem;
}

/*────────────────────── Responsive Adjustments ──────────────────────*/
@media(max-width: 1024px) {
 main { padding: .5rem; margin-left: 0; }
  #hero .hero-features { grid-template-columns: 1fr; }
 }
@media(max-width: 640px) {
  section.module { padding: .75rem; margin-left: 0; }
  .chat-input, .chat-controls { flex-direction: column; }
  .tool-row { position: static; margin-top: .5rem; }
}

    .copy-tooltip {
  position: absolute;
  top: 0.5rem; right: 0.5rem;
  background: var(--color-primary-alt);
  color: #fff;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius);
  font-size: 0.75rem;
  animation: fadeOut 1.5s forwards;
}
@keyframes fadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-10px); }
}
    /* under your CSS */
.spinner {
  border: 4px solid rgba(0,0,0,0.1);
  border-top: 4px solid var(--color-primary);
  border-radius: 50%;
  width: 24px; height: 24px;
  animation: spin 0.8s linear infinite;
  margin: 1rem auto;
}
@keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside id="sidebar">
    <div class="brand">
      <i class="fas fa-utensils"></i>
      <span>Vitra AI Dietetics</span>
    </div>
    <nav>
      <ul>
        <li><a href="herbal.html"><i class="fas fa-seedling"></i> Herbal Medicine</a></li>
        <li><a href="psych.html"><i class="fas fa-brain"></i> Psychology & MH</a></li>
        <li class="active"><a href="#"><i class="fas fa-apple-alt"></i> Dietetics</a></li>
        <li><a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i> E-Pharmacy</a></li>
        <li><a href="consult.html"><i class="fas fa-calendar-check"></i> Consult Booking</a></li>
      </ul>
    </nav>
    <button id="shrinkSidebar" aria-label="Toggle sidebar">
      <i class="fas fa-angle-double-left"></i>
    </button>
  </aside>

  <!-- Header -->
  <header>
    <i id="hamburger" class="fas fa-bars" aria-label="Open menu"></i>
    <h1>Dietetics & Nutrition</h1>
    <i id="themeToggle" class="fas fa-moon" aria-label="Toggle dark mode"></i>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    <section id="hero" class="module">
      <h2><i class="fas fa-apple-alt"></i> Empower Your Nutrition</h2>
      <p class="desc">AI-driven tools for meal planning, nutrient insights, recipe inspiration & more.</p>
      <div class="hero-features">
        <!-- Recipe Search -->
        <div class="feature-card">
          <i class="fas fa-search"></i>
          <h3>Recipe Search</h3>
          <input type="text" id="heroRecipeSearch" placeholder="e.g. Jollof rice with chicken">
          <button id="heroSearchBtn" class="btn">Search</button>
        </div>
        <!-- Today's Tip -->
        <div class="feature-card">
          <i class="fas fa-lightbulb"></i>
          <h3>Today's Nutrition Tip</h3>
        <div id="dailyTip" class="response">
   <div class="tool-row">
     <button class="close-btn"><i class="fas fa-times"></i></button>
     <button class="copy-btn"><i class="fas fa-copy"></i></button>
     <button class="dl-btn"><i class="fas fa-download"></i></button>
   </div>
   <div class="result-content">Loading tip…</div>
 </div>
          <button id="refreshTip" class="btn-secondary">Refresh Tip</button>
        </div>
        <!-- Quick Macro Snapshot -->
        <div class="feature-card">
          <i class="fas fa-chart-pie"></i>
          <h3>Macro Snapshot</h3>
          <div id="macroSnapshot">Protein: – g / Carbs: – g / Fat: – g</div>
          <button id="refreshMacro" class="btn-secondary">Update</button>
        </div>
      </div>
    </section>

    <!-- 1. Nutrition Chatbot -->
    <section id="dietBot" class="module">
      <h2><i class="fas fa-comments"></i> Nutrition Chatbot</h2>
      <p class="desc">Ask any diet or nutrition question and get instant, tailored advice.</p>
      <div class="chat-controls">
        <button id="clearDiet" class="btn-secondary"><i class="fas fa-trash"></i> Clear Chat</button>
        <button id="viewDietHistory" class="btn-secondary"><i class="fas fa-history"></i> Chat History</button>
      </div>
      <div id="dietChatBox" class="chat-box"></div>
      <form id="diet-form" class="chat-input">
        <input id="dietInput" type="text" placeholder="Type your question…" required>
        <button id="sendDiet" class="btn"><i class="fas fa-paper-plane"></i></button>
      </form>
      <div id="dietHint" class="desc" style="display:none;">AI is thinking…</div>
    </section>

    <!-- 2. Meal Plan Generator -->
    <section id="mealPlanner" class="module">
      <h2><i class="fas fa-calendar-alt"></i> Meal Plan Generator</h2>
      <p class="desc">Create a 7-day meal plan that fits your calories, style, and restrictions.</p>
      <form id="planner-form">
        <label>Daily Calories:
          <input type="number" id="calories" min="800" max="4000" value="2000" required>
        </label>
        <label>Diet Type:
          <select id="dietType">
            <option>Balanced</option>
            <option>Low-Carb</option>
            <option>Vegan</option>
            <option>Ketogenic</option>
            <option>Mediterranean</option>
            <option>Plant-Based</option>
            <option value="Other">Other</option>
          </select>
          <input class="other-input" placeholder="Specify diet…" style="display:none;">
        </label>
        <label>Allergies & Intolerances:
          <select id="allergyList" multiple>
            <option>Gluten</option><option>Dairy</option><option>Nuts</option>
            <option>Shellfish</option><option>Soy</option><option>Eggs</option>
            <option>Sesame</option><option>Other</option>
          </select>
          <input class="other-input" placeholder="Specify others…" style="display:none;">
        </label>
        <label>Budget:
          <select id="budget">
            <option>Low</option><option>Medium</option><option>High</option>
          </select>
        </label>
        <button id="genPlan" class="btn"><i class="fas fa-utensils"></i> Generate Plan</button>
      </form>
      <div id="planPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 3. Nutrient Analyzer -->
    <section id="nutriAnalyzer" class="module">
      <h2><i class="fas fa-vial"></i> Nutrient Analyzer</h2>
      <p class="desc">Get a complete macro and micronutrient breakdown of any recipe or meal log.</p>
      <form id="analyze-form">
        <label>Ingredients / Food Log:
          <textarea id="foodLog" rows="4" placeholder="e.g. 200g yam, 1 egg, spinach…"></textarea>
        </label>
        <label>Portion Size Units:
          <select id="unitSelect">
            <option>grams</option><option>pieces</option><option>cups</option>
            <option>tablespoons</option><option>servings</option>
          </select>
        </label>
        <button id="analyzeNutri" class="btn"><i class="fas fa-chart-bar"></i> Analyze</button>
      </form>
      <div id="nutriPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 4. Recipe Recommender -->
    <section id="recipeRec" class="module">
      <h2><i class="fas fa-book-open"></i> Recipe Recommender</h2>
      <p class="desc">Transform your pantry into delicious meals across global cuisines.</p>
      <form id="recipe-form">
        <label>Pantry Items:
          <input id="pantry" type="text" placeholder="e.g. Rice, Beans, Plantain">
        </label>
        <label>Cuisine Style:
          <select id="cuisineType">
            <option>West African</option><option>Italian</option><option>Asian Fusion</option>
            <option>Mexican</option><option>Middle Eastern</option><option value="Other">Other</option>
          </select>
          <input class="other-input" placeholder="Specify cuisine…" style="display:none;">
        </label>
        <label>Difficulty:
          <select id="recipeDifficulty">
            <option>Easy</option><option>Medium</option><option>Advanced</option>
          </select>
        </label>
        <label>Max Prep Time:
          <input type="number" id="maxTime" min="5" max="180" value="30"> minutes
        </label>
        <button id="getRecipes" class="btn"><i class="fas fa-hamburger"></i> Get Recipes</button>
      </form>
      <div id="recipePanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 5. Deficiency Risk Scanner -->
    <section id="deficiency" class="module">
      <h2><i class="fas fa-exclamation-triangle"></i> Deficiency Risk Scanner</h2>
      <p class="desc">Identify potential nutrient shortfalls based on symptoms and diet.</p>
      <form id="def-form">
        <label>Select Symptoms (up to 5):
          <div class="checkbox-group">
            <label><input type="checkbox" name="symptom" value="Fatigue"> Fatigue</label>
            <label><input type="checkbox" name="symptom" value="Hair Loss"> Hair Loss</label>
            <label><input type="checkbox" name="symptom" value="Muscle Cramps"> Muscle Cramps</label>
            <label><input type="checkbox" name="symptom" value="Pale Skin"> Pale Skin</label>
            <label><input type="checkbox" name="symptom" value="Bleeding Gums"> Bleeding Gums</label>
            <label><input type="checkbox" name="symptom" value="Bone Pain"> Bone Pain</label>
            <label><input type="checkbox" name="symptom" value="Bruising"> Bruising</label>
            <label><input type="checkbox" name="symptom" value="Other"> Other</label>
          </div>
        </label>
        <label>Brief Diet Overview:
          <textarea id="dietOverview" rows="3" placeholder="e.g. Mostly rice, occasional vegetables…"></textarea>
        </label>
        <button id="scanDef" class="btn"><i class="fas fa-stethoscope"></i> Scan Deficiency</button>
      </form>
      <div id="defPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 6. Metabolomic Risk Radar -->
    <section id="riskRadar" class="module">
      <h2><i class="fas fa-chart-pie"></i> Metabolomic Risk Radar</h2>
      <p class="desc">Continuous biomarker tracking and predictive health alerts.</p>
      <form id="risk-form">
        <label>Date Range:
          <input type="date" id="riskFrom"> – <input type="date" id="riskTo">
        </label>
        <label><input type="checkbox" id="syncBiomarkers"> Enable Continuous Biomarker Sync</label>
        <button id="runRisk" class="btn"><i class="fas fa-biohazard"></i> Run Radar</button>
      </form>
      <div id="riskPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 7. AI-Driven Fitness Nutrition Coach -->
    <section id="fitnessCoach" class="module">
      <h2><i class="fas fa-dumbbell"></i> Fitness Nutrition Coach</h2>
      <p class="desc">Tailor your macros, pre/post-workout blends, and recovery support.</p>
      <form id="fitness-form">
        <!-- 1. Performance Profiling -->
        <fieldset>
          <legend>1. Performance Profiling</legend>
          <label>Workout Goal:
            <select id="fitGoal">
              <option>Endurance</option>
              <option>Strength</option>
              <option>Hybrid</option>
              <option>Weight Loss</option>
              <option>General Health</option>
              <option value="Other">Other</option>
            </select>
            <input class="other-input" placeholder="Specify goal…" style="display:none;">
          </label>
          <label>Weekly Workouts:
            <select id="fitFreq">
              <option>1–2</option><option>3–4</option><option>5–7</option>
            </select>
          </label>
        </fieldset>
        <!-- 2. Pre/Post-Workout -->
        <fieldset>
          <legend>2. Pre/Post-Workout Micro-Blends</legend>
          <label>Available Ingredients:
            <select id="blendIngredients" multiple>
              <option>Pea Protein</option><option>Beetroot Powder</option>
              <option>Taurine</option><option>Banana</option>
              <option>Oats</option><option>Other</option>
            </select>
            <input class="other-input" placeholder="Add ingredient…" style="display:none;">
          </label>
        </fieldset>
        <!-- 3. Carb-Timing Calendar -->
        <fieldset>
          <legend>3. Carb-Timing Calendar</legend>
          <label>Start Date:
            <input type="date" id="carbDate">
          </label>
          <label>Intensity Level:
            <select id="intensity">
              <option>Low</option><option>Moderate</option><option>High</option>
            </select>
          </label>
        </fieldset>
        <!-- 4. Recovery Monitor -->
        <fieldset>
          <legend>4. Recovery & Inflammation</legend>
          <label>Track CRP & CK Levels:
            <input type="number" id="crpLevel" placeholder="CRP mg/L">
          </label>
          <label>Nutraceutical Preference:
            <select id="nutraPref">
              <option>Curcumin</option><option>Omega-3</option>
              <option>Turmeric</option><option>Ginger</option>
              <option>Other</option>
            </select>
            <input class="other-input" placeholder="Specify…"
                   style="display:none;">
          </label>
        </fieldset>
        <button id="runFitness" class="btn"><i class="fas fa-running"></i> Generate Plan</button>
      </form>
      <div id="fitnessPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 8. Pharma-Integrated Nutrient & Medication Suite -->
    <section id="pharmaSuite" class="module">
      <h2><i class="fas fa-pills"></i> Pharma-Integrated Nutrient & Medication Suite</h2>
      <p class="desc">Drug–nutrient interactions, compounding suggestions, reminders & analytics.</p>
      <form id="pharma-form">
        <!-- 1. Drug–Nutrient Interaction -->
        <fieldset>
          <legend>1. Interaction Engine</legend>
          <label>Medications (comma-sep):
            <input id="medList" type="text" placeholder="e.g. Warfarin, Metformin">
          </label>
          <label>Food Items (comma-sep):
            <input id="foodList" type="text" placeholder="e.g. Grapefruit, Spinach">
          </label>
        </fieldset>
        <!-- 2. Custom Compounding -->
        <fieldset>
          <legend>2. Compounding Suggestions</legend>
          <label>Desired Outcome:
            <select id="compoundGoal">
              <option>Increased Absorption</option><option>Anti-inflammatory</option>
              <option>Energy Boost</option><option>Other</option>
            </select>
            <input class="other-input" placeholder="Specify…" style="display:none;">
          </label>
        </fieldset>
        <!-- 3. Adherence & Reminder Hub -->
        <fieldset>
          <legend>3. Adherence & Reminders</legend>
          <label>Reminder Method:
            <select id="reminderMethod">
              <option>SMS</option><option>Email</option><option>App Notification</option>
            </select>
          </label>
          <label>Reminder Times:
            <input type="time" id="reminderTime1">,
            <input type="time" id="reminderTime2">
          </label>
        </fieldset>
        <!-- 4. Outcome Analytics -->
        <fieldset>
          <legend>4. Outcome Analytics</legend>
          <label>Compare Cohort:
            <select id="cohortSelect">
              <option>Diet-only</option><option>Diet+Supplements</option>
              <option>Diet+Meds</option><option>Other</option>
            </select>
            <input class="other-input" placeholder="Specify…" style="display:none;">
          </label>
        </fieldset>
        <button id="runPharma" class="btn"><i class="fas fa-flask"></i> Run Suite</button>
      </form>
      <div id="pharmaPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 9. Symptom-to-Treatment Advisor -->
    <section id="symptomAdvisor" class="module">
      <h2><i class="fas fa-user-md"></i> Symptom-to-Treatment Advisor</h2>
      <p class="desc">Describe your symptoms and receive drug suggestions & suitable foods eaten in Ghana.</p>
      <form id="symptom-form">
        <label>Your Age:
          <input type="number" id="sympAge" min="1" max="120" required>
        </label>
        <label>Describe Symptoms:
          <textarea id="sympDesc" rows="4" placeholder="e.g. headache, fever, cough…"></textarea>
        </label>
        <label>Food Preferences (comma-sep):
          <input id="foodPref" type="text" placeholder="e.g. Jollof rice, Pizza, Burger">
        </label>
        <button id="runSymptom" class="btn"><i class="fas fa-stethoscope"></i> Get Advice</button>
      </form>
      <div id="symptomPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>
    <!-- 6. Progress Charts -->
<section class="module">
  <h2><i class="fas fa-chart-line"></i> Progress Charts</h2>
  <canvas id="intakeChart"></canvas>
  <canvas id="macroChart"></canvas>
</section>
  </main>

 <!-- Chart.js & App Logic -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  // ── Inject Additional CSS ─────────────────────────────────────────
  (function injectStyles() {
    const css = `
      /* Toast */
      .toast {
        position: fixed; bottom: 2rem; left: 50%;
        transform: translateX(-50%) translateY(100%);
        background: var(--color-primary-alt); color: #fff;
        padding: .75rem 1.5rem; border-radius: var(--radius);
        opacity: 0; transition: transform .3s, opacity .3s;
        z-index: 2000;
      }
      .toast.visible {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
      /* Spinner */
      .spinner {
        border: 4px solid rgba(0,0,0,0.1);
        border-top: 4px solid var(--color-primary);
        border-radius: 50%;
        width: 24px; height: 24px;
        animation: spin .8s linear infinite;
        margin: 1rem auto;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      /* Response panel button positions and hide while waiting */
      .response .close-btn {
        position: absolute; top: var(--padding); right: var(--padding);
      }
      .response .tool-row {
        position: absolute; bottom: var(--padding); right: var(--padding);
      }
      .response.waiting .close-btn,
      .response.waiting .tool-row {
        display: none !important;
      }
      /* Chat history modal */
      .history-modal {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.5);
        display: flex; align-items: center; justify-content: center;
        z-index: 2000;
      }
      .history-modal .modal-content {
        background: var(--color-surface);
        padding: var(--padding);
        border-radius: var(--radius);
        max-height: 80%; overflow-y: auto;
        width: 90%; max-width: 400px;
        position: relative;
      }
      .history-modal h3 { margin-bottom: 1rem; }
      .history-modal ul { list-style: none; padding: 0; margin: 0 0 1rem; }
      .history-modal ul li {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: .5rem;
      }
      .history-modal .delete-btn {
        background: none; border: none; cursor: pointer;
        color: var(--color-primary-alt); font-size: 1rem;
      }
      .history-modal .close-modal,
      .history-modal .clear-all-btn {
        background: var(--color-primary); color: #fff;
        border: none; padding: .5rem 1rem; border-radius: var(--radius);
        cursor: pointer; margin-top: 1rem;
      }
      /* Checkbox layout */
      .checkbox-group { display: flex; flex-wrap: wrap; gap: .5rem; }
      .checkbox-group label {
        flex: 1 1 45%;
        display: flex; align-items: center; gap: .25rem;
      }
      /* Dark-mode fixes */
      html.dark input,
      html.dark select,
      html.dark textarea {
        background: var(--color-surface);
        border-color: var(--color-muted);
        color: var(--color-text);
      }
    `;
    const style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
  })();

  // ── Helper Functions ─────────────────────────────────────────────
  function showToast(msg) {
    const t = document.createElement('div');
    t.className = 'toast';
    t.innerText = msg;
    document.body.appendChild(t);
    requestAnimationFrame(() => t.classList.add('visible'));
    setTimeout(() => t.classList.remove('visible'), 1800);
    setTimeout(() => t.remove(), 2200);
  }

  async function callOpenAI(messages) {
    const res = await fetch('/.netlify/functions/openai-proxy', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ messages })
    });
    if (!res.ok) throw new Error('OpenAI error');
    const j = await res.json();
    return j.choices[0].message.content;
  }

  function formatHTML(txt) {
    return txt
      .replace(/^### (.*$)/gm,'<h3>$1</h3>')
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .split(/\n{2,}/).map(p=>`<p>${p.trim()}</p>`).join('');
  }

  function getSelectValue(sel) {
    const oi = sel.parentElement.querySelector('.other-input');
    return (oi && sel.value==='Other') ? oi.value.trim() : sel.value;
  }

  document.addEventListener('DOMContentLoaded', () => {
    // ── Sidebar & Theme ───────────────────────────────────────────
    document.getElementById('hamburger').onclick = () =>
      document.body.classList.toggle('sidebar-open');
    document.getElementById('shrinkSidebar').onclick = () => {
      const sb = document.getElementById('sidebar');
      sb.classList.toggle('collapsed');
      const left = sb.classList.contains('collapsed')
        ? 'var(--sidebar-collapsed)' : 'var(--sidebar-width)';
      document.querySelector('header').style.left = left;
      document.querySelector('main').style.marginLeft = left;
    };
    document.getElementById('themeToggle').onclick = () => {
      document.documentElement.classList.toggle('dark');
      document.getElementById('themeToggle').classList.toggle('fa-sun');
    };

    // ── “Other” Inputs ─────────────────────────────────────────────
    document.querySelectorAll('select').forEach(sel => {
      sel.addEventListener('change', () => {
        const oi = sel.parentElement.querySelector('.other-input');
        if (oi) oi.style.display = sel.value==='Other'?'block':'none';
      });
    });

    // ── Chatbot Logic ──────────────────────────────────────────────
    const box = document.getElementById('dietChatBox'),
          hint = document.getElementById('dietHint');
    let hist = [];
    function addMsg(who, txt) {
      const m = document.createElement('div');
      m.className = who==='You' ? 'user-msg' : 'bot-msg';
      m.innerHTML = `${formatHTML(txt)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
      box.append(m);
      box.scrollTop = box.scrollHeight;
    }
    document.getElementById('sendDiet').onclick = async e => {
      e.preventDefault();
      const txt = document.getElementById('dietInput').value.trim();
      if (!txt) { showToast('Please type a question.'); return; }
      addMsg('You', txt);
      hist.push({who:'You',text:txt});
      document.getElementById('dietInput').value = '';
      hint.style.display = 'block';
      try {
        const nationality = document.getElementById('nationality')?.value.trim() || '';
        const reply = await callOpenAI([
          {role:'system',content:`User nationality: ${nationality}`},
          {role:'system',content:'You are a dietetics assistant.'},
          {role:'user',content:txt}
        ]);
        addMsg('AI', reply);
        hist.push({who:'AI',text:reply});
      } catch {
        addMsg('AI','⚠️ Something went wrong.');
      } finally {
        hint.style.display = 'none';
      }
    };
    document.getElementById('clearDiet').onclick = () => {
      box.innerHTML = '';
    };
    document.getElementById('viewDietHistory').onclick = () => {
      const modal = document.createElement('div');
      modal.className = 'history-modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h3>Chat History</h3>
          <ul>
            ${hist.map((m,i)=>
              `<li>
                <span><strong>${m.who}:</strong> ${m.text}</span>
                <button class="delete-btn" data-i="${i}"><i class="fas fa-trash"></i></button>
              </li>`
            ).join('')}
          </ul>
          <button class="clear-all-btn">Delete Chat History</button>
          <button class="close-modal">Close</button>
        </div>
      `;
      document.body.append(modal);
      // per-message delete
      modal.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = () => {
          hist.splice(btn.dataset.i, 1);
          btn.closest('li').remove();
        };
      });
      // clear all
      modal.querySelector('.clear-all-btn').onclick = () => {
        hist = [];
        modal.querySelector('ul').innerHTML = '';
      };
      // close
      modal.querySelector('.close-modal').onclick = () => modal.remove();
    };

    // ── Global Panel Buttons ────────────────────────────────────────
    document.body.addEventListener('click', e => {
      const resp = e.target.closest('.response');
      if (!resp) return;
      if (e.target.closest('.close-btn')) {
        resp.hidden = true;
        return;
      }
      if (e.target.closest('.copy-btn')) {
        const txt = resp.querySelector('.result-content').innerText;
        navigator.clipboard.writeText(txt).then(() => showToast('Copied!'));
        return;
      }
      if (e.target.closest('.dl-btn')) {
        const txt = resp.querySelector('.result-content').innerText;
        const blob = new Blob([txt],{type:'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'response.txt';
        a.click();
      }
    });

    // ── Hero Handlers ───────────────────────────────────────────────
    async function handleHero(panelId, sysPrompt, queryFn) {
      const q = queryFn();
      if (!q) { showToast('Please enter a value.'); return; }
      const panel = document.getElementById(panelId);
      panel.hidden = false;
      panel.classList.add('waiting');
      panel.querySelector('.result-content').innerHTML = '<div class="spinner"></div>';
      try {
        const nationality = document.getElementById('nationality')?.value.trim() || '';
        const reply = await callOpenAI([
          {role:'system',content:`User nationality: ${nationality}`},
          {role:'system',content:sysPrompt},
          {role:'user',content:q}
        ]);
        panel.querySelector('.result-content').innerHTML = formatHTML(reply);
      } catch {
        panel.querySelector('.result-content').innerText = '⚠️ Something went wrong.';
      } finally {
        panel.classList.remove('waiting');
      }
    }
    document.getElementById('heroSearchBtn').onclick = e => {
      e.preventDefault();
      handleHero('dailyTip','You are a recipe finder.', ()=>
        document.getElementById('heroRecipeSearch').value.trim()
      );
    };
    document.getElementById('refreshTip').onclick = () =>
      handleHero('dailyTip','You are a nutrition tip generator.', ()=>'Give one daily nutrition tip.');
    document.getElementById('refreshMacro').onclick = () =>
      handleHero('macroSnapshot','You are a macro snapshot AI.', ()=>'Provide protein/carbs/fat split for standard diet.');

    // ── Generic Section Wiring ─────────────────────────────────────
    function wire(btnId, allFields, requiredFields, sysPrompt) {
      document.getElementById(btnId).onclick = async e => {
        e.preventDefault();
        // validate
        for (let id of requiredFields) {
          if (id==='symptoms') {
            if (!document.querySelector('input[name="symptom"]:checked')) {
              showToast('Please select at least one symptom.');
              return;
            }
          } else {
            const el = document.getElementById(id);
            if (!el || !el.value.trim()) {
              showToast('Please fill in all required fields.');
              return;
            }
          }
        }
        // find panel
        const raw = btnId.replace(/^(send|gen|analyze|get|scan|run)/,'');
        const panelId = raw.charAt(0).toLowerCase()+raw.slice(1)+'Panel';
        const panel = document.getElementById(panelId);
        panel.hidden = false;
        panel.classList.add('waiting');
        panel.querySelector('.result-content').innerHTML = '<div class="spinner"></div>';
        // gather inputs
        let content = '';
        const nat = document.getElementById('nationality')?.value.trim() || '';
        for (let id of allFields) {
          if (id==='symptoms') {
            const vals = Array.from(document.querySelectorAll('input[name="symptom"]:checked'))
                          .map(cb=>cb.value).join(', ');
            content += `symptoms: ${vals}\n`;
          } else {
            const el = document.getElementById(id);
            if (!el) continue;
            if (el.tagName==='SELECT' && el.multiple) {
              content += `${id}: ${Array.from(el.selectedOptions).map(o=>o.value).join(', ')}\n`;
            } else if (el.tagName==='SELECT') {
              content += `${id}: ${getSelectValue(el)}\n`;
            } else {
              content += `${id}: ${el.value}\n`;
            }
          }
        }
        // call AI
        try {
          const reply = await callOpenAI([
            {role:'system',content:`User nationality: ${nat}`},
            {role:'system',content:sysPrompt},
            {role:'user',content}
          ]);
          panel.querySelector('.result-content').innerHTML = formatHTML(reply);
        } catch {
          panel.querySelector('.result-content').innerText = '⚠️ Something went wrong.';
        } finally {
          panel.classList.remove('waiting');
        }
      };
    }

    // 2. Meal Plan
    wire('genPlan',['calories','dietType','allergyList','budget'],['calories','dietType'],'You are a meal planning AI.');
    // 3. Nutrient Analyzer
    wire('analyzeNutri',['foodLog','unitSelect'],['foodLog'],'You are a nutrient analysis AI.');
    // 4. Recipe Recommender
    wire('getRecipes',['pantry','cuisineType','recipeDifficulty','maxTime'],['pantry'],'You are a recipe recommendation AI.');
    // 5. Deficiency Scanner
    wire('scanDef',['symptoms','dietOverview'],['symptoms'],'You are a deficiency risk AI.');
    // 6. Metabolomic Radar
    wire('runRisk',['riskFrom','riskTo','syncBiomarkers'],['riskFrom','riskTo'],'You are a metabolomic risk AI. Provide continuous biomarker tracking alerts and explanations.');
    // 7. Fitness Coach
    wire('runFitness',['fitGoal','fitFreq','blendIngredients','carbDate','intensity','crpLevel','nutraPref'],['fitGoal','fitFreq'],'You are a fitness nutrition AI.');
    // 8. Pharma Suite
    wire('runPharma',['medList','foodList','compoundGoal','reminderMethod','reminderTime1','reminderTime2','cohortSelect'],['medList'],'You are a pharma-nutrient interaction AI.');
    // 9. Symptom Advisor
    wire('runSymptom',['sympAge','sympDesc','foodPref'],['sympAge','sympDesc'],'You are a symptom-to-treatment advisor AI.');

    // ── Progress Charts ─────────────────────────────────────────────
    const ctx1 = document.getElementById('intakeChart')?.getContext('2d');
    if (ctx1) new Chart(ctx1,{ type:'line', data:{
      labels:['Mon','Tue','Wed','Thu','Fri'],
      datasets:[{
        label:'Calories In',
        data:[2000,1800,2100,1900,2050],
        borderColor:getComputedStyle(document.documentElement)
                       .getPropertyValue('--color-secondary').trim(),
        fill:false
      }]
    }});
    const ctx2 = document.getElementById('macroChart')?.getContext('2d');
    if (ctx2) new Chart(ctx2,{ type:'pie', data:{
      labels:['Carbs','Protein','Fat'],
      datasets:[{ data:[50,25,25] }]
    }});
  });
</script>
</body>
</html>
