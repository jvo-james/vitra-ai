 <!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Neuropharma Command Center</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<style>

 /*----------------------------------------
  Part 1/15: Variables, Reset, Sidebar & Header
----------------------------------------*/

/* 1. Color & Theme Variables */
:root {
  --primary:   #E24A4A;
  --secondary: #4A90E2;
  --bg:        #121212;
  --fg:        #EFEFEF;
  --muted:     #777777;
}

[aria-theme="light"] {
  --bg:    #FFFFFF;
  --fg:    #111111;
  --muted: #AAAAAA;
}

/* 2. Breakpoints */
$bp-mobile:  480px;
$bp-tablet:  768px;
$bp-desktop: 1024px;

/* 3. Reset & Base */
*,
*::before,
*::after {
  margin:   0;
  padding:  0;
  box-sizing: border-box;
  scrollbar-width: thin;
  scrollbar-color: var(--secondary) var(--bg);
}

html, body {
  width:  100%;
  height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background-color: var(--bg);
  color:            var(--fg);
}

img, svg {
  max-width: 100%;
  height:    auto;
  display:   block;
}

/* 4. Utility Mixins */
@mixin respond($min-width) {
  @media (min-width: $min-width) { @content; }
}

@mixin btn($bg) {
  background-color: $bg;
  color:            var(--bg);
  border:           none;
  border-radius:    0.5rem;
  padding:          0.75rem 1.5rem;
  font-weight:      600;
  cursor:           pointer;
  transition:       filter 0.2s;
  &:hover { filter: brightness(1.1); }
}

/* 5. Sidebar */
#sidebar {
  position: fixed;
  top:      0;
  left:     0;
  width:    260px;
  height:   100vh;
  background-color: var(--bg);
  display:  flex;
  flex-direction: column;
  transition: width 0.3s ease;

  .logo {
    display:       flex;
    align-items:   center;
    padding:       1rem;
    svg {
      width:  2.5rem;
      height: 2.5rem;
      fill:   var(--secondary);
    }
    .logo-text {
      margin-left:  0.75rem;
      font-size:    1.25rem;
      font-weight:  bold;
      color:        var(--fg);
    }
  }

  nav {
    flex: 1;
    display: flex;
    flex-direction: column;

    a {
      display:        flex;
      align-items:    center;
      padding:        0.75rem 1rem;
      text-decoration: none;
      color:           var(--fg);
      transition:      background 0.2s;
      i {
        margin-right: 0.75rem;
        width:        1.25rem;
        text-align:   center;
      }
      &:hover { background: rgba(226,74,74,0.2); }
      &.active { background: rgba(226,74,74,0.3); }
    }
  }

  #shrinkBtn {
    @include btn(var(--secondary));
    align-self:  center;
    margin:      1rem 0;
    i { font-size: 1rem; }
  }

  &.collapsed {
    width: 80px;
    .logo-text, nav a span { display: none; }
  }

  @include respond($bp-tablet) {
    position: static;
    transform: none !important;
  }
  @media (max-width: $bp-tablet) {
    transform: translateX(-100%);
    &.open { transform: translateX(0); transition: transform 0.3s ease; }
  }
}

/* 6. Header */
header {
  position:       sticky;
  top:            0;
  z-index:        100;
  display:        flex;
  justify-content: space-between;
  align-items:    center;
  padding:        1rem 2rem;
  background-color: var(--bg);
  box-shadow:     0 2px 4px rgba(0,0,0,0.2);

  .hamburger {
    font-size: 1.5rem;
    cursor:    pointer;
    display:   none;
  }

  h1 {
    font-size:   1.5rem;
    font-weight: 600;
    color:       var(--fg);
  }

  .theme-toggle {
    font-size: 1.25rem;
    cursor:    pointer;
    color:     var(--fg);
    &:hover { color: var(--primary); }
  }

  &.sidebar-collapsed {
    margin-left: 80px;
    @include respond($bp-tablet) {
      margin-left: 260px;
    }
  }
}

#hamburger {
  @media (max-width: $bp-tablet) {
    display: block;
  }
}

main {
  margin-left: 260px;
  padding:     2rem;
  transition:  margin-left 0.3s ease;

  @include respond($bp-tablet) {
    margin-left: 80px;
  }
  @media (max-width: $bp-tablet) {
    margin-left: 0;
  }
}

 #hero {
  background-color: var(--bg);
  padding: 4rem 2rem;
  position: relative;
  overflow: hidden;
  .hero-inner {
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    @include respond($bp-tablet) {
      flex-direction: row;
      align-items: flex-start;
    }
  }
  .hero-content {
    max-width: 600px;
    text-align: center;
    h1 {
      font-size: 2.5rem;
      color: var(--fg);
      margin-bottom: 1rem;
      i {
        color: var(--primary);
        margin-right: 0.5rem;
      }
    }
    .hero-subtitle {
      color: var(--muted);
      font-size: 1.125rem;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    .hero-actions {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      a {
        @include btn(var(--primary));
        display: inline-flex;
        align-items: center;
        font-size: 1rem;
        i {
          margin-right: 0.5rem;
        }
        &.btn-secondary {
          @include btn(var(--secondary));
        }
      }
    }
  }
  .hero-image {
    margin-bottom: 2rem;
    @include respond($bp-tablet) {
      margin-bottom: 0;
      margin-left: 2rem;
    }
    img {
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
  }
  .hero-bg-icon {
    position: absolute;
    font-size: 4rem;
    opacity: 0.1;
    color: var(--secondary);
  }
}
#therapybot {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  .chat-controls {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 1rem;
    button {
      @include btn(var(--secondary));
      padding: 0.5rem;
      margin-left: 0.5rem;
      i {
        color: var(--bg);
      }
    }
  }
  .chat-box {
    background-color: darken(var(--bg), 2%);
    border: 1px solid var(--muted);
    border-radius: 0.75rem;
    height: 350px;
    padding: 1rem;
    overflow-y: auto;
    .chat-date-separator {
      text-align: center;
      color: var(--muted);
      margin: 1rem 0;
      font-size: 0.875rem;
    }
    .user-msg, .bot-msg {
      position: relative;
      max-width: 80%;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      border-radius: 1rem;
      .timestamp {
        position: absolute;
        font-size: 0.75rem;
        color: var(--muted);
        bottom: -1.25rem;
        right: 0.75rem;
      }
    }
    .user-msg {
      background-color: var(--primary);
      color: var(--bg);
      margin-left: auto;
    }
    .bot-msg {
      background-color: var(--secondary);
      color: var(--bg);
      margin-right: auto;
    }
    .spinner {
      width: 1.5rem;
      height: 1.5rem;
      border: 3px solid var(--muted);
      border-top-color: var(--secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 1rem auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    button.speak-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: var(--fg);
      font-size: 1rem;
      cursor: pointer;
    }
  }
  .chat-input-row {
    display: flex;
    align-items: center;
    margin-top: 1rem;
    button {
      @include btn(var(--primary));
      padding: 0.75rem;
      i {
        color: var(--bg);
      }
    }
    input {
      flex: 1;
      margin: 0 0.5rem;
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus {
        border-color: var(--primary);
      }
    }
  }
}
.history-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  .history-content {
    background-color: var(--bg);
    padding: 2rem;
    border-radius: 1rem;
    max-width: 90%;
    max-height: 90%;
    overflow-y: auto;
    h3 {
      color: var(--fg);
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }
    .history-table-wrapper {
      overflow-y: auto;
      max-height: 60vh;
      margin-bottom: 1rem;
      table {
        width: 100%;
        border-collapse: collapse;
        thead {
          tr {
            background: rgba(74,144,226,0.2);
            th {
              padding: 0.75rem;
              color: var(--fg);
              text-align: left;
              font-weight: 600;
            }
          }
        }
        tbody {
          tr {
            &:nth-child(odd) { background: rgba(226,74,74,0.1); }
            td {
              padding: 0.75rem;
              color: var(--fg);
            }
            .del-msg {
              @include btn(var(--secondary));
              padding: 0.5rem;
              font-size: 0.875rem;
            }
          }
        }
      }
    }
    .history-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
      }
      .close-history {
        background-color: var(--primary);
      }
    }
  }
}
#moodTracker {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#mood-form {
    display: grid;
    gap: 1.5rem;
    label {
      font-weight: 600;
      color: var(--fg);
    }
    #moodRange {
      width: 100%;
      -webkit-appearance: none;
      height: 0.5rem;
      background: var(--muted);
      border-radius: 0.25rem;
      &::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        background: var(--primary);
        border: 2px solid var(--fg);
        cursor: pointer;
      }
    }
    #moodValue {
      color: var(--primary);
      font-weight: bold;
    }
    fieldset {
      border: none;
      margin: 0;
      padding: 0;
      legend {
        font-weight: 600;
        color: var(--fg);
        margin-bottom: 0.5rem;
      }
      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 0.5rem;
        label {
          display: flex;
          align-items: center;
          color: var(--fg);
          input {
            margin-right: 0.5rem;
            accent-color: var(--primary);
          }
        }
      }
      .other-input {
        display: none;
        padding: 0.75rem;
        border: 1px solid var(--muted);
        border-radius: 0.5rem;
        background-color: var(--bg);
        color: var(--fg);
        margin-top: 0.5rem;
      }
    }
    #moodNote {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      resize: vertical;
      &:focus {
        border-color: var(--primary);
      }
    }
    button[type="submit"] {
      @include btn(var(--primary));
      display: inline-flex;
      align-items: center;
      font-size: 1rem;
      i { margin-right: 0.5rem; }
      justify-self: start;
      margin-top: 1rem;
    }
  }
  #moodPanel {
    margin-top: 1.5rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      @include btn(var(--secondary));
      background: none;
      color: var(--fg);
      font-size: 1.25rem;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i { color: var(--bg); }
      }
    }
  }
}
#moodStats {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1rem;
    line-height: 1.6;
  }
  .chart-card {
    background-color: darken(var(--bg), 2%);
    border-radius: 0.75rem;
    position: relative;
    height: 300px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    canvas { width: 100% !important; height: 100% !important; }
    figcaption {
      margin-top: 0.5rem;
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }
  }
  #exportMoodStats {
    @include btn(var(--secondary));
    margin-top: 1rem;
  }
}

 #neurotransmitter {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#nt-form {
    display: grid;
    gap: 1.5rem;
    label {
      font-weight: 600;
      color: var(--fg);
    }
    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      height: 0.5rem;
      background: var(--muted);
      border-radius: 0.25rem;
      &::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 1.5rem;
        height: 1.5rem;
        background: var(--secondary);
        border: 2px solid var(--fg);
        border-radius: 50%;
        cursor: pointer;
      }
    }
    .two-column-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      @include respond($bp-tablet) {
        grid-template-columns: repeat(2,1fr);
      }
    }
    select, input[type="text"] {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus {
        border-color: var(--secondary);
      }
    }
    .other-input {
      display: none;
      margin-top: -0.5rem;
    }
    button#analyzeNeuro {
      @include btn(var(--primary));
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-top: 1rem;
    }
  }
  #neurotransmitterPanel {
    margin-top: 1rem;
    background-color: darken(var(--bg), 2%);
    padding: 1rem;
    border-radius: 0.75rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--fg);
      cursor: pointer;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i {
          color: var(--bg);
        }
      }
    }
  }
}
#pharmacogenomics {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#pgx-form {
    display: grid;
    gap: 1.5rem;
    .two-column-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      @include respond($bp-tablet) {
        grid-template-columns: repeat(2,1fr);
      }
    }
    label {
      font-weight: 600;
      color: var(--fg);
    }
    input[type="file"],
    input[type="number"],
    select,
    input[type="text"] {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus { border-color: var(--secondary); }
    }
    .other-input {
      display: none;
      margin-top: -0.5rem;
    }
    button#runPGx {
      @include btn(var(--primary));
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-top: 1rem;
    }
  }
  #pharmacogenomicsPanel {
    margin-top: 1rem;
    background-color: darken(var(--bg), 2%);
    padding: 1rem;
    border-radius: 0.75rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--fg);
      cursor: pointer;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i { color: var(--bg); }
      }
    }
  }
}
#interactions {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#int-form {
    display: grid;
    gap: 1.5rem;
    label {
      font-weight: 600;
      color: var(--fg);
    }
    select,
    input[type="text"] {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus { border-color: var(--secondary); }
    }
    .other-input {
      display: none;
      margin-top: -0.5rem;
    }
    button#checkInt {
      @include btn(var(--primary));
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-top: 1rem;
    }
  }
  #interactionsPanel {
    margin-top: 1rem;
    background-color: darken(var(--bg), 2%);
    padding: 1rem;
    border-radius: 0.75rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--fg);
      cursor: pointer;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i { color: var(--bg); }
      }
    }
  }
}
#eeg {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#eeg-form {
    display: grid;
    gap: 1.5rem;
    label {
      font-weight: 600;
      color: var(--fg);
    }
    input[type="file"],
    select,
    input[type="text"] {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus { border-color: var(--secondary); }
    }
    .other-input {
      display: none;
      margin-top: -0.5rem;
    }
    button#analyzeEEG {
      @include btn(var(--primary));
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-top: 1rem;
    }
  }
  #eegPanel {
    margin-top: 1rem;
    background-color: darken(var(--bg), 2%);
    padding: 1rem;
    border-radius: 0.75rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--fg);
      cursor: pointer;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i { color: var(--bg); }
      }
    }
  }
}

#trialmatch {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  h2 {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    color: var(--fg);
    i { color: var(--primary); margin-right: 0.75rem; }
    margin-bottom: 1rem;
  }
  .desc {
    color: var(--muted);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
  form#trial-form {
    display: grid;
    gap: 1.5rem;
    label {
      font-weight: 600;
      color: var(--fg);
    }
    select,
    input[type="text"] {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: 0.5rem;
      background-color: var(--bg);
      color: var(--fg);
      &:focus { border-color: var(--secondary); }
    }
    .other-input {
      display: none;
      margin-top: -0.5rem;
    }
    button#findTrials {
      @include btn(var(--primary));
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-top: 1rem;
    }
  }
  #trialmatchPanel {
    margin-top: 1rem;
    background-color: darken(var(--bg), 2%);
    padding: 1rem;
    border-radius: 0.75rem;
    .result-content {
      color: var(--fg);
      line-height: 1.6;
    }
    .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--fg);
      cursor: pointer;
    }
    .tool-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      button {
        @include btn(var(--secondary));
        padding: 0.5rem;
        i { color: var(--bg); }
      }
    }
  }
}

.charts {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
  @include respond($bp-tablet) {
    grid-template-columns: repeat(2,1fr);
  }
  .chart-card {
    position: relative;
    background-color: var(--bg);
    border-radius: 0.75rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    padding: 1rem;
    height: 300px;
    canvas { width: 100% !important; height: 100% !important; }
    figcaption {
      margin-top: 0.5rem;
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }
  }
}

button#exportCharts {
  @include btn(var(--secondary));
  margin-top: 1rem;
}

.copy-toast,
.download-toast,
.notification-toast {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  background-color: var(--secondary);
  color: var(--bg);
  padding: 0.75rem 1.25rem;
  border-radius: 0.5rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  font-weight: 500;
  opacity: 0;
  animation: toast-in 0.3s forwards, toast-out 0.3s 1.7s forwards;
  z-index: 200;
}

@keyframes toast-in {
  from { opacity: 0; transform: translateY(1rem); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes toast-out {
  to { opacity: 0; transform: translateY(1rem); }
}
.meet-module {
  background-color: var(--bg);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  .meet-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1.5rem;
    @include respond($bp-tablet) {
      flex-direction: row;
      text-align: left;
    }
    .meet-icon {
      background-color: var(--secondary);
      color: var(--bg);
      padding: 1rem;
      border-radius: 50%;
      font-size: 2rem;
    }
    .meet-text {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      h2 {
        font-size: 2rem;
        color: var(--fg);
      }
      p {
        color: var(--muted);
        line-height: 1.6;
      }
      .btn-schedule {
        @include btn(var(--primary));
        display: inline-flex;
        align-items: center;
        i { margin-right: 0.5rem; }
      }
    }
  }
}

footer {
  background-color: var(--bg);
  padding: 2rem;
  text-align: center;
  color: var(--muted);
  a {
    color: var(--secondary);
    text-decoration: none;
    transition: color 0.2s;
    &:hover { color: var(--primary); }
  }
}

*::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

*::-webkit-scrollbar-track {
  background: var(--bg);
}

*::-webkit-scrollbar-thumb {
  background-color: var(--secondary);
  border-radius: 4px;
  border: 2px solid var(--bg);
}

a, button, input, select, textarea {
  transition: background-color 0.2s, border-color 0.2s, color 0.2s;
}

.modal-open {
  overflow: hidden;
}

[aria-theme="dark"] {
  /* dark-mode specifics if needed */
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }
}

</style>

  <body>
  <aside id="sidebar">
    <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--secondary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span class="logo-text">Vitra AI</span>
    </div>
    <nav role="navigation">
          <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
      <a href="herbal.html">
        <i class="fas fa-seedling"></i>
        <span>Herbal Medicine</span>
      </a>
      <a href="psychology.html" class="active">
        <i class="fas fa-brain"></i>
        <span>Psychology &amp; Mental Health</span>
      </a>
      <a href="dietetics.html">
        <i class="fas fa-utensils"></i>
        <span>Dietetics</span>
      </a>
      <a href="epharmacy.html">
        <i class="fas fa-prescription-bottle-alt"></i>
        <span>E-Pharmacy</span>
      </a>
      <a href="consult.html">
        <i class="fas fa-calendar-check"></i>
        <span>Consultation Booking</span>
      </a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar">
      <i class="fas fa-angle-double-left"></i>
    </button>
  </aside>

  <header>
    <div style="display:flex; align-items:center; gap:1rem;">
      <i id="hamburger" class="fas fa-bars hamburger" aria-label="Toggle navigation"></i>
      <h1>Neuropharma Command Center</h1>
    </div>
    <div>
      <i id="themeToggle" class="fas fa-moon theme-toggle" aria-label="Toggle theme"></i>
    </div>
  </header>

  <main role="main">
    <section id="hero" class="module hero-module">
      <div class="hero-inner">
        <div class="hero-content">
          <h1><i class="fas fa-brain"></i> Empower Your Mental Wellness</h1>
          <p class="hero-subtitle">
            AI-powered toolkit for therapy, mood insights, neurochemical balance, and clinical trial matching—all in one interactive dashboard.
        </p>
          <div class="hero-actions">
            <a href="#therapybot" class="btn-primary">
              <i class="fas fa-comments"></i> Therapy Bot
            </a>
           
            <a href="#neurotransmitter" class="btn-primary">
              <i class="fas fa-vial"></i> Neuro Balance
            </a>
            <a href="#pharmacogenomics" class="btn-secondary">
              <i class="fas fa-dna"></i> Pharmaco-Genomics
            </a>
          </div>
        </div>
        <div class="hero-image">
          <img src="mental.jpg" alt="Abstract illustration of mind–body wellness">
        </div>
      </div>
     <i class="fas fa-pills hero-bg-icon" style="top: 10%; left: 10%;"></i>
    <i class="fas fa-wave-square hero-bg-icon" style="bottom: 15%; left: 5%;"></i>
     <i class="fas fa-chart-line hero-bg-icon" style="top: 20%; left: 40%;"></i>    </section>

    <section id="therapybot" class="module">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
        <h2><i class="fas fa-robot"></i> AI Therapist Chat</h2>
        <div class="chat-controls">
          <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
          <button id="clearChat" title="Clear Chat"><i class="fas fa-trash-alt"></i></button>
        </div>
      </div>
      <div id="chatBox" class="chat-box" role="log" aria-live="polite"></div>
      <div class="chat-input-row">
      <button id="startSpeech" title="Speak"><i class="fas fa-microphone"></i></button>
        <input id="chatInput" placeholder="Type your message…" aria-label="Type your question"/>
        <button id="sendChat" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
      </div>
    </section>

    <section id="moodTracker" class="module">
      <h2><i class="fas fa-heartbeat"></i> Daily Mood Tracker</h2>
      <p class="desc">
        Record your mood on a 1–10 scale, select salient emotions (e.g., “Anxious,” “Calm”), and identify potential triggers (e.g., “Sleep,” “Finance”). 
        Our AI performs real‐time data aggregation, pattern recognition (PR), and generates personalized self‐care recommendations via Natural Language Generation (NLG).
      </p>
      <form id="mood-form">
        <label for="moodRange">Mood Score: <strong><span id="moodValue">5</span>/10</strong></label>
        <input type="range" id="moodRange" min="1" max="10" value="5"/>

          <legend>Emotions (select up to 20)</legend>
          <div class="checkbox-group emotions-group">
            <label><input type="checkbox" name="emotions" value="Happy"> Happy</label>
            <label><input type="checkbox" name="emotions" value="Sad"> Sad</label>
            <label><input type="checkbox" name="emotions" value="Anxious"> Anxious</label>
            <label><input type="checkbox" name="emotions" value="Calm"> Calm</label>
            <label><input type="checkbox" name="emotions" value="Angry"> Angry</label>
            <label><input type="checkbox" name="emotions" value="Motivated"> Motivated</label>
            <label><input type="checkbox" name="emotions" value="Stressed"> Stressed</label>
            <label><input type="checkbox" name="emotions" value="Relaxed"> Relaxed</label>
            <label><input type="checkbox" name="emotions" value="Focused"> Focused</label>
            <label><input type="checkbox" name="emotions" value="Overwhelmed"> Overwhelmed</label>
            <label><input type="checkbox" name="emotions" value="Bored"> Bored</label>
            <label><input type="checkbox" name="emotions" value="Confident"> Confident</label>
            <label><input type="checkbox" name="emotions" value="Nervous"> Nervous</label>
            <label><input type="checkbox" name="emotions" value="Lonely"> Lonely</label>
            <label><input type="checkbox" name="emotions" value="Hopeful"> Hopeful</label>
            <label><input type="checkbox" name="emotions" value="Frustrated"> Frustrated</label>
            <label><input type="checkbox" name="emotions" value="Joyful"> Joyful</label>
            <label><input type="checkbox" name="emotions" value="Dull"> Dull</label>
            <label><input type="checkbox" name="emotions" value="Energetic"> Energetic</label>
            <label><input type="checkbox" name="emotions" value="Tired"> Tired</label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Triggers (select up to 20)</legend>
          <div class="checkbox-group triggers-group">
            <label><input type="checkbox" name="triggers" value="Work"> Work</label>
            <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
            <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
            <label><input type="checkbox" name="triggers" value="Health"> Health</label>
            <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
            <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
            <label><input type="checkbox" name="triggers" value="Exercise"> Exercise</label>
            <label><input type="checkbox" name="triggers" value="Family"> Family</label>
            <label><input type="checkbox" name="triggers" value="Social"> Social</label>
            <label><input type="checkbox" name="triggers" value="Weather"> Weather</label>
            <label><input type="checkbox" name="triggers" value="Noise"> Noise</label>
            <label><input type="checkbox" name="triggers" value="Light"> Light</label>
            <label><input type="checkbox" name="triggers" value="Crowds"> Crowds</label>
            <label><input type="checkbox" name="triggers" value="Traffic"> Traffic</label>
            <label><input type="checkbox" name="triggers" value="Media"> Media</label>
            <label><input type="checkbox" name="triggers" value="Pets"> Pets</label>
            <label><input type="checkbox" name="triggers" value="Home"> Home</label>
            <label><input type="checkbox" name="triggers" value="Commute"> Commute</label>
            <label><input type="checkbox" name="triggers" value="Finances"> Finances</label>
            <label><input type="checkbox" name="triggers" value="Other"> Other</label>
          </div>
          <input type="text" id="moodTriggersOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </fieldset>

        <label for="moodNote">Journal Entry:</label>
        <textarea id="moodNote" rows="3" placeholder="Describe today’s events…"></textarea>

      <button type="submit" class="btn-primary">
          <i class="fas fa-chart-line"></i> Analyze Mood
        </button>
      </form>
      <div id="moodPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="moodStats" class="module">
      <h2><i class="fas fa-chart-bar"></i> Mood Tracker Statistics</h2>
      <p class="desc">
        Overview of your mood patterns over the past week. Chart updates automatically as new entries are logged.
      </p>
      <div class="chart-card">
        <canvas id="moodStatsChart"></canvas>
        <figcaption>Average Mood Score (1–10) per Day</figcaption>
      </div>
      <p class="chart-desc">
        This line chart dynamically reflects the average mood score each day. Hover to see exact values or export data via CSV.
      </p>
      <button id="exportMoodStats" class="button">Export Mood Stats CSV</button>
    </section>
    
    <section id="neurotransmitter" class="module">
      <h2><i class="fas fa-vial"></i> Neurotransmitter Balance</h2>
      <p class="desc">
       Provide quantitative mood data, subjective sleep quality (e.g., “Fair,” “Good”), appetite status, and pharmacotherapy adherence. 
           </p>
      <form id="nt-form">
        <label for="ntMood">Mood (1–10):</label>
        <input type="range" id="ntMood" min="1" max="10" value="5"/>
        <div class="two-column-grid">
      <div>
        <label for="ntSleep">Sleep Quality:</label>
        <select id="ntSleep" required>
          <option>Poor</option>
          <option>Fair</option>
          <option>Good</option>
          <option>Excellent</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="ntSleepOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="ntAppetite">Appetite:</label>
        <select id="ntAppetite" required>
          <option>Low</option>
          <option>Normal</option>
          <option>High</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="ntAppetiteOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="ntAdherence">Medication Adherence:</label>
        <select id="ntAdherence" required>
          <option>Poor</option>
          <option>Fair</option>
          <option>Good</option>
          <option>Excellent</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="ntAdherenceOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="ntFocus">Focus Neurotransmitter:</label>
        <select id="ntFocus" required>
         <option>Serotonin</option>
            <option>Dopamine</option>
            <option>GABA</option>
            <option>Glutamate</option>
            <option>Acetylcholine</option>
            <option>Histamine</option>
            <option>Oxytocin</option>
            <option>Vasopressin</option>
            <option>Endorphins</option>
            <option>Melatonin</option>
            <option>Cortisol</option>
            <option>Adrenaline</option>
            <option>Noradrenaline</option>
            <option>Enkephalins</option>
            <option>Substance P</option>
            <option>Dynorphin</option>
            <option>Glycine</option>
            <option>Aspartate</option>
            <option>Endocannabinoids</option>
            <option>Neuropeptide Y</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="ntFocusOther" class="other-input hidden" placeholder="Please specify…"/>
 </div>
    </div>
        <button id="analyzeNeuro" class="btn-primary" type="submit"><i class="fas fa-brain"></i> Analyze Balance</button>
      </form>
      <div id="neurotransmitterPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="pharmacogenomics" class="module">
      <h2><i class="fas fa-dna"></i> Pharmacogenomics &amp; Dosing</h2>
      <p class="desc">
        Upload a validated Variant Call Format (VCF) file containing genotypic polymorphisms (e.g., CYP2C19, CYP2D6). Enter demographic and clinical parameters 
        (e.g., age, sex). 
      </p>
      <form id="pgx-form">
        <div class="two-column-grid">
          <div>
        <label for="pgxUpload">Upload Genotype (VCF/JSON):</label>
        <input type="file" id="pgxUpload" accept=".vcf,.txt,.json" required/>

        <label for="pgxSex">Sex:</label>
        <select id="pgxSex" required>
          <option>Male</option>
          <option>Female</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="pgxSexOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="pgxAge">Age (years):</label>
        <input type="number" id="pgxAge" min="0" required/>

        <label for="pgxWeight">Weight (kg):</label>
        <input type="number" id="pgxWeight" min="1"/>

        <label for="pgxDrug">Drug:</label>
         <select id="pgxDrug" required>
            <option>Clopidogrel</option>
            <option>Warfarin</option>
            <option>Codeine</option>
            <option>Citalopram</option>
            <option>Sertraline</option>
            <option>Fluoxetine</option>
            <option>Risperidone</option>
            <option>Lithium</option>
            <option>Valproate</option>
            <option>Lamotrigine</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="pgxDrugOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="pgxGene">Gene Variant:</label>
        <select id="pgxGene" required>
            <option>CYP2C19*1</option>
            <option>CYP2C19*2</option>
            <option>CYP2C19*3</option>
            <option>CYP2D6*1</option>
            <option>CYP2D6*4</option>
            <option>TPMT*1</option>
            <option>UGT1A1*28</option>
            <option>VKORC1</option>
            <option>MTHFR C677T</option>
            <option>HLA-B*57:01</option>
            <option>SLCO1B1*5</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="pgxGeneOther" class="other-input hidden" placeholder="Please specify…"/>
 </div>
       </div>
        <button id="runPGx" class="btn-primary" type="submit"><i class="fas fa-flask"></i> Run Analysis</button>
      </form>
      <div id="pharmacogenomicsPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="interactions" class="module">
      <h2><i class="fas fa-exchange-alt"></i> Drug Interaction Profiler</h2>
      <p class="desc">
  Enter all current psychotropic medications (including OTCs, supplements, or herbal preparations) and any comorbid medical conditions (e.g., hepatic or renal impairment, cardiovascular disease).  
  </p>
      <form id="int-form">
        <label for="intListSelect">Medications:</label>
        <select id="intListSelect" required>
            <option>Sertraline</option>
            <option>Fluoxetine</option>
            <option>Paroxetine</option>
            <option>Escitalopram</option>
            <option>Venlafaxine</option>
            <option>Duloxetine</option>
            <option>Risperidone</option>
            <option>Quetiapine</option>
            <option>Lithium</option>
            <option>Valproate</option>
            <option>Lamotrigine</option>
            <option>Carbamazepine</option>
            <option>Topiramate</option>
            <option>Gabapentin</option>
            <option>Pregabalin</option>
            <option>Clonazepam</option>
            <option>Diazepam</option>
            <option>Alprazolam</option>
            <option>Buspirone</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="intListOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="intComorbid">Comorbid Conditions:</label>
        <select id="intComorbid" required>
            <option>Schizophrenia</option>
            <option>Bipolar Disorder</option>
            <option>Depression</option>
            <option>OCD</option>
            <option>Anxiety</option>
            <option>Autism</option>
            <option>ADHD</option>
            <option>Dementia</option>
            <option>Alzheimer’s</option>
            <option>Parkinson’s</option>
            <option>PTSD</option>
            <option>Epilepsy</option>
            <option>Insomnia</option>
            <option>Substance Use</option>
            <option>Anorexia</option>
            <option>Bulimia</option>
            <option>Phobia</option>
            <option>Psychosis</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="intComorbidOther" class="other-input hidden" placeholder="Please specify…"/>

        <button id="checkInt" class="btn-primary" type="submit"><i class="fas fa-pills"></i> Check Interactions</button>
      </form>
      <div id="interactionsPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="eeg" class="module">
      <h2><i class="fas fa-wave-square"></i> EEG &amp; Brainwave Interpreter</h2>
      <p class="desc">
  Upload your raw EEG (Electroencephalography) file (EDF or CSV) and specify the recording condition or task (e.g., “Resting Eyes Closed,” “Cognitive Stress Task”).  
</p>

      <form id="eeg-form">
        <label for="eegFile">Upload EEG File:</label>
        <input type="file" id="eegFile" accept=".edf,.csv" required/>

        <label for="eegCondition">Task / Condition:</label>
        <select id="eegCondition" required>
            <option>Resting Eyes Closed</option>
            <option>Resting Eyes Open</option>
            <option>Sleep Stage 1</option>
            <option>Sleep Stage 2</option>
            <option>REM Sleep</option>
            <option>Meditation</option>
            <option>Reading</option>
            <option>Stress Task</option>
            <option>Typing</option>
            <option>Video Watching</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="eegConditionOther" class="other-input hidden" placeholder="Please specify…"/>

        <button id="analyzeEEG" class="btn-primary" type="submit"><i class="fas fa-microchip"></i> Analyze EEG</button>
      </form>
      <div id="eegPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="trialmatch" class="module">
      <h2><i class="fas fa-handshake"></i> Clinical Trial Matcher</h2>
      <p class="desc">
  Describe your primary psychiatric diagnosis (e.g., Major Depressive Disorder, Generalized Anxiety Disorder), enter your location (city, country), and select the trial phase you wish to explore.  
</p>
      <form id="trial-form">
        <label for="trialDx">Diagnosis:</label>
         <select id="trialDx" required>
            <option>Anxiety</option>
            <option>Depression</option>
            <option>Schizophrenia</option>
            <option>Bipolar Disorder</option>
            <option>ADHD</option>
            <option>PTSD</option>
            <option>OCD</option>
            <option>Insomnia</option>
            <option>Autism</option>
            <option>Parkinson’s</option>
            <option>Alzheimer’s</option>
            <option>Epilepsy</option>
            <option>Migraine</option>
            <option>Dementia</option>
            <option>Substance Use</option>
            <option>Phobia</option>
            <option>Anorexia</option>
            <option>Bulimia</option>
            <option>Borderline Personality</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="trialDxOther" class="other-input hidden" placeholder="Please specify…"/>

        <label for="trialLoc">Location:</label>
        <input id="trialLoc" type="text" placeholder="City, Country" required/>

        <label for="trialPhase">Trial Phase:</label>
       <select id="trialPhase" required>
            <option>Phase I</option>
            <option>Phase II</option>
            <option>Phase III</option>
            <option>Phase IV</option>
            <option>First-in-Human</option>
            <option>Proof-of-Concept</option>
            <option>Open-Label</option>
            <option>Randomized</option>
            <option>Double-Blind</option>
            <option>Placebo-Controlled</option>
            <option>Adaptive Design</option>
            <option>Dose-Escalation</option>
            <option>Biomarker Study</option>
            <option>Observational</option>
            <option>Longitudinal</option>
            <option>Cross-Over</option>
            <option>Basket Trial</option>
            <option>Umbrella Trial</option>
            <option>N-of-1 Trial</option>
            <option value="Other">Other</option>
          </select>
        <input type="text" id="trialPhaseOther" class="other-input hidden" placeholder="Please specify…"/>

        <button id="findTrials" class="btn-primary" type="submit"><i class="fas fa-search"></i> Find Trials</button>
      </form>
      <div id="trialmatchPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section id="analytics" class="module">
      <h2><i class="fas fa-chart-pie"></i> Data Analytics &amp; ROI</h2>
      <p class="desc">
        Real‐time charts show therapy engagement and outcome metrics. Export your data as CSV for deeper analysis.
      </p>
      <div class="charts">
        <figure class="chart-card">
          <canvas id="engagementChart"></canvas>
          <figcaption><strong>Engagement Over Time:</strong> Weekly number of therapy sessions.</figcaption>
          <p class="chart-desc">Line chart updates automatically every minute with simulated session counts.</p>
        </figure>
        <figure class="chart-card">
          <canvas id="outcomeChart"></canvas>
          <figcaption><strong>Outcome Metrics:</strong> Average improvement scores per week.</figcaption>
          <p class="chart-desc">Bar chart refreshed in real time to reflect latest patient survey data.</p>
        </figure>
      </div>
      <button id="exportCharts" class="btn-primary">Export CSV</button>
    </section>

    <section id="meet-expert" class="module meet-module">
      <div class="meet-content">
        <div class="meet-icon">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="meet-text">
          <h2>Meet a<br/>Mental Health Expert</h2>
          <p>
            Schedule one-on-one sessions with licensed therapists for personalized guidance, medication advice, and evidence-based strategies.
          </p>
          <a href="consult.html" class="btn-schedule">
            <i class="fas fa-calendar-check"></i> Schedule Consultation
          </a>
        </div>
      </div>
    </section>

    <footer>
      <p>&copy; 2025 Vitra AI – Neuropharma Command Center. <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms &amp; Conditions</a></p>
    </footer>
  </main>
</body>

  <script src="storage.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

    (function() {
    const savedTheme = localStorage.getItem("vitra-theme");
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark");
      document.documentElement.setAttribute("aria-theme", "dark");
    }
  })();

  document.addEventListener("DOMContentLoaded", () => {

    if ('speechSynthesis' in window) {
      window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
      window.speechSynthesis.getVoices();
    }
        function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function formatHTML(text) {
      if (!text) return "";
      return text
        .replace(/^######\s*(.+)$/gm, "<h6>$1</h6>")
        .replace(/^#####\s*(.+)$/gm, "<h5>$1</h5>")
        .replace(/^####\s*(.+)$/gm, "<h4>$1</h4>")
        .replace(/^###\s*(.+)$/gm, "<h3>$1</h3>")
        .replace(/^##\s*(.+)$/gm, "<h2>$1</h2>")
        .replace(/^#\s*(.+)$/gm, "<h1>$1</h1>")
        .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
        .replace(/\*(.+?)\*/g, "<em>$1</em>")
        .replace(/`([^`]+)`/g, "<code>$1</code>")
        .split(/\n{2,}/)
        .map(p => `<p>${p.trim()}</p>`)
        .join("");
    }

    function addClose(panel) {
      if (panel.querySelector(".close-btn")) return;
      const btn = document.createElement("button");
      btn.className = "close-btn";
      btn.setAttribute("aria-label", "Close result");
      btn.textContent = "×";
      btn.onclick = () => (panel.hidden = true);
      panel.prepend(btn);
    }

    function addTools(panel) {
      if (panel.querySelector(".tool-row")) return;
      const tools = document.createElement("div");
      tools.className = "tool-row";
      tools.innerHTML = `
        <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
        <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
      `;
      panel.append(tools);

      const contentDiv = panel.querySelector(".result-content");
      tools.querySelector(".copy-btn").onclick = () => {
        if (!contentDiv) return;
        navigator.clipboard.writeText(contentDiv.innerText || "");
        const toast = document.createElement("div");
        toast.className = "copy-toast";
        toast.textContent = "Copied!";
        document.body.append(toast);
        setTimeout(() => toast.remove(), 1500);
      };
      tools.querySelector(".dl-btn").onclick = () => {
        if (!contentDiv) return;
        const text = contentDiv.innerText || "";
        const blob = new Blob([text], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "response.txt";
        document.body.append(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      };
    }

    async function callOpenAI(messages) {
      try {
        const response = await fetch("/.netlify/functions/openai-proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages })
        });
  if (!response.ok) {
           const body = await response.json().catch(() => ({}));
        const msg = body.error?.message || response.statusText;
        const code = response.status;
        throw new Error(`OPENAI_ERR_${code}: ${msg}`);
        }
       const data = await response.json();
        return data.choices?.[0]?.message?.content.trim() || "";
      } catch (err) {
        console.error(err);
        throw err;
      }
    }
    function callOpenAIWithTimeout(messages, ms = 15000) {
      return Promise.race([
        callOpenAI(messages),
        new Promise((_, reject) =>
          setTimeout(() => reject(new Error("timeout")), ms)
        )
      ]);
    }


Storage.recordCategory("Psych"); 

    const sidebar = document.getElementById("sidebar");
    const shrinkBtn = document.getElementById("shrinkBtn");
    const hamburger = document.getElementById("hamburger");
    const header = document.querySelector("header");

    if (localStorage.getItem("sidebar-collapsed") === "true") {
      sidebar.classList.add("collapsed");
      shrinkBtn.querySelector("i").classList.replace("fa-angle-double-left", "fa-angle-double-right");
      header.classList.add("sidebar-collapsed");
    }
    shrinkBtn.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      const icon = shrinkBtn.querySelector("i");
      icon.classList.toggle("fa-angle-double-left");
      icon.classList.toggle("fa-angle-double-right");
      header.classList.toggle("sidebar-collapsed");
      localStorage.setItem("sidebar-collapsed", sidebar.classList.contains("collapsed"));
    });

    function updateHamburgerVisibility() {
      hamburger.style.display = window.matchMedia("(max-width: 1024px)").matches ? "block" : "none";
    }
    window.matchMedia("(max-width: 1024px)").addListener(updateHamburgerVisibility);
    updateHamburgerVisibility();

    hamburger.addEventListener("click", e => {
      e.stopPropagation();
      sidebar.classList.toggle("open");
    });
    document.addEventListener("click", e => {
      if (!sidebar.classList.contains("open")) return;
      if (sidebar.contains(e.target) || hamburger.contains(e.target)) return;
      sidebar.classList.remove("open");
    });

    document.querySelectorAll('aside#sidebar nav a').forEach(link => {
      const linkHref = link.getAttribute("href").split("/").pop();
      const pageNow = window.location.pathname.split("/").pop();
      if (linkHref === pageNow) link.classList.add("active");
      else link.classList.remove("active");
    });

    const themeToggle = document.getElementById("themeToggle");
    themeToggle.addEventListener("click", () => {
      const htmlEl = document.documentElement;
      const isDark = htmlEl.classList.toggle("dark");
      themeToggle.classList.toggle("fa-sun", isDark);
      themeToggle.classList.toggle("fa-moon", !isDark);
      htmlEl.setAttribute("aria-theme", isDark ? "dark" : "light");
      localStorage.setItem("vitra-theme", isDark ? "dark" : "light");
    });

    document.querySelectorAll("select").forEach(sel => {
      sel.addEventListener("change", () => {
        const otherField = sel.parentElement.querySelector(".other-input");
        if (!otherField) return;
        if (sel.value === "Other") {
          otherField.style.display = "block";
          otherField.required = true;
        } else {
          otherField.style.display = "none";
          otherField.required = false;
        }
      });
      sel.dispatchEvent(new Event("change"));
    });

    const panelIds = [
      "therapybotPanel",
      "moodPanel",
      "neurotransmitterPanel",
      "pharmacogenomicsPanel",
      "interactionsPanel",
      "eegPanel",
      "trialmatchPanel"
    ];
    panelIds.forEach(pid => {
      const saved = localStorage.getItem(pid);
      if (saved) {
        const panel = document.getElementById(pid);
        panel.innerHTML = saved;
        panel.hidden = false;
        panel.querySelectorAll(".close-btn").forEach(btn => (btn.onclick = () => panel.hidden = true));
        addClose(panel);
        addTools(panel);
      }
    });

    (function() {
      const chatBox = document.getElementById("chatBox");
      const chatInput = document.getElementById("chatInput");
      const sendChatBtn = document.getElementById("sendChat");

      chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();        
          sendChatBtn.click();       
        }
      });
      const viewHistoryBtn = document.getElementById("viewHistory");
      const clearChatBtn = document.getElementById("clearChat");
       const startSpeech = document.getElementById("startSpeech");
     const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
       recognition.lang            = 'en-US';
      recognition.interimResults  = true;   
      recognition.maxAlternatives = 1;
      recognition.continuous      = false;   
     
      startSpeech.addEventListener("click", () => {
        recognition.start();
        startSpeech.classList.add("listening");
        startSpeech.innerHTML = '<i class="fas fa-microphone-slash"></i>';
      });

      recognition.addEventListener("result", e => {
        const transcript = Array
          .from(e.results)
          .map(r => r[0].transcript)
          .join('');
        chatInput.value = transcript.trim();
      });

     recognition.addEventListener("end", () => {
        startSpeech.classList.remove("listening");
        startSpeech.innerHTML = '<i class="fas fa-microphone"></i>';
        if (chatInput.value.trim()) sendChatBtn.click();
      });
      recognition.addEventListener("error", () => {
        startSpeech.classList.remove("listening");
        startSpeech.innerHTML = '<i class="fas fa-microphone"></i>';
      });
     let lastDateHeader = null;

 let chatHistory = JSON.parse(localStorage.getItem("therapyChatHistory") || "[]");
 const chatCleared = localStorage.getItem("chatCleared") === "1";  
     function formatDateSeparator(date) {
        const today = new Date();
        const diffDays = Math.floor((today.setHours(0, 0, 0, 0) - date.setHours(0, 0, 0, 0)) / 86400000);
        if (diffDays === 0) return "Today";
        if (diffDays === 1) return "Yesterday";
        return date.toLocaleDateString();
      }
      function addMessage(who, text, timestamp = new Date()) {
        const msgDate = timestamp instanceof Date ? timestamp : new Date(timestamp);
        const msgDay = msgDate.toDateString();
        if (msgDay !== lastDateHeader) {
          const sep = document.createElement("div");
          sep.className = "chat-date-separator";
          sep.textContent = formatDateSeparator(msgDate);
          chatBox.append(sep);
          lastDateHeader = msgDay;
        }
        const msgDiv = document.createElement("div");
        msgDiv.className = who === "You" ? "user-msg" : "bot-msg";
        msgDiv.innerHTML = `
          ${formatHTML(text)}
          <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true })}</div>
        `;
        chatBox.append(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      if (!chatCleared) {
        chatHistory.forEach(m => {
          const ts = m.timestamp ? new Date(m.timestamp) : new Date();
          addMessage(m.who, m.text, ts);
        });
      }
      
      sendChatBtn.onclick = async (e) => {
        localStorage.removeItem("chatCleared");
        e.preventDefault();
        const userText = chatInput.value.trim();
        if (!userText) return;
       const lower = userText.toLowerCase();
       if (/suicidal|kill myself|harm myself/.test(lower)) {
          addMessage("Therapist",
            `I’m so sorry you’re in such deep pain. You don’t have to face this alone.  
             • You could reach out right now to the Suicide & Crisis Lifeline by calling or texting 988 (US).  
             • Consider telling someone you trust—even if it’s just one person.  
             • If you feel unsafe with your own thoughts, please go to your nearest emergency department.  
             You deserve help and hope—would you like some strategies for coping in the moment?`
          );
          return;
        }
        const userTime = new Date();
        addMessage("You", userText, userTime);
        chatHistory.push({ who: "You", text: userText, timestamp: userTime.toISOString() });
        localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
        chatInput.value = "";

        const spinnerDiv = document.createElement("div");
        spinnerDiv.className = "bot-msg";
        spinnerDiv.innerHTML = `<div class="spinner"></div>`;
        chatBox.append(spinnerDiv);
        chatBox.scrollTop = chatBox.scrollHeight;

         const systemPrompt = `
You are a warm, empathic, licensed clinical psychologist skilled in CBT, DBT, and mindfulness.
• Speak in a caring, conversational tone (“I’m here for you,” “That sounds tough”).
• Offer clear, evidence-based suggestions.
• If you’re unsure, ask clarifying questions.
• Keep replies under 250 words unless requested longer.
• Check in with the user: “How does that feel?” or “Would you like to explore that more?”
        `.trim();


        const allMessages = [];
          allMessages.push({ role: "system", content: systemPrompt });
        allMessages.push({ role: "assistant", content:
 `It sounds like you’re feeling: "${userText}". Let’s explore that in more detail.` });  
       chatHistory.forEach(m => {
            allMessages.push({
              role: m.who === "You" ? "user" : "assistant",
              content: m.text
            });
          });
          allMessages.push({ role: "user", content: userText });

          try {
             sendChatBtn.disabled = true;
        startSpeech.disabled = true;
        let aiReply;
        try {
          aiReply = await callOpenAIWithTimeout(allMessages, 15000);
        } catch (err) {
            let userMsg = "⚠️ Something went wrong. Please try again.";
            if (/OPENAI_ERR_429/.test(err.message)) {
              userMsg = "🤖 The therapist is a bit busy right now. Please wait a few moments and try again.";
            } else if (/timeout/.test(err.message) || /OPENAI_ERR_5\d\d/.test(err.message)) {
              userMsg = "⏱️ The response is taking longer than expected—let’s try once more.";
            }
            spinnerDiv.innerHTML = `<div class="result-content">${userMsg}</div>`;
            sendChatBtn.disabled = false;
            startSpeech.disabled = false;
          return;
        }
            const replyTime = new Date();
            spinnerDiv.innerHTML = `
              ${formatHTML(aiReply)}
              <div class="timestamp">${replyTime.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true })}</div>
            `;
            const plainReply = aiReply.replace(/<\/?[^>]+(>|$)/g, "");
            const lastBot = chatBox.querySelector('.bot-msg:last-child');
            const play = document.createElement('button');
            play.className = 'speak-btn';
            play.title = 'Play';
            play.innerHTML = '<i class="fas fa-volume-up"></i>';
            lastBot.append(play);
             let currentUtterance = null;
            play.addEventListener('click', () => {
              if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                play.innerHTML = '<i class="fas fa-volume-up"></i>';
                currentUtterance = null;
              } else {
                const u = new SpeechSynthesisUtterance(plainReply);
                const voices = window.speechSynthesis.getVoices();
                const female = voices.find(v => /female|woman|zira|samantha/i.test(v.name))
                             || voices.find(v => v.lang.startsWith('en'));
                if (female) u.voice = female;
                u.lang = 'en-US';
                u.rate = 1;
                currentUtterance = u;
                speechSynthesis.speak(u);
                play.innerHTML = '<i class="fas fa-volume-mute"></i>';
                u.onend = () => play.innerHTML = '<i class="fas fa-volume-up"></i>';
              }
            });
            chatHistory.push({ who: "Therapist", text: aiReply, timestamp: replyTime.toISOString() });
            localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
            sendChatBtn.disabled = false;
            startSpeech.disabled = false;         
          } catch (err) {
            spinnerDiv.innerHTML = `<div class="result-content">⚠️ Something went wrong. Please try again.</div>`;
          }
          chatBox.scrollTop = chatBox.scrollHeight;
        };

     clearChatBtn.onclick = () => {
        chatBox.innerHTML = "";
        lastDateHeader = null;
        localStorage.setItem("chatCleared", "1");
      };
     
      viewHistoryBtn.onclick = () => {
        const modal = document.createElement("div");
        modal.className = "history-modal";
        const grouped = {};
        chatHistory.forEach((m, i) => {
          const dt = new Date(m.timestamp);
          const label = formatDateSeparator(dt);
          if (!grouped[label]) grouped[label] = [];
          grouped[label].push({ who: m.who, text: m.text, idx: i });
        });

        let tableHTML = `<table class="history-table">`;
        Object.keys(grouped).forEach(label => {
          tableHTML += `
            <thead>
              <tr><th colspan="3">${label}</th></tr>
              <tr>
                <th>Sender</th>
                <th>Message</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              ${grouped[label]
                .map(m =>
                  `<tr data-index="${m.idx}">
                     <td>${m.who}</td>
                     <td>${formatHTML(m.text)}</td>
                     <td><button class="del-msg" data-index="${m.idx}" title="Delete"><i class="fas fa-trash-alt"></i></button></td>
                   </tr>`
                ).join("")}
            </tbody>`;
        });
        tableHTML += `</table>`;

        modal.innerHTML = `
          <div class="history-content">
            <h3>Chat History</h3>
            <div class="history-table-wrapper">
              ${tableHTML}
            </div>
            <div class="history-actions">
              <button class="clear-history"><i class="fas fa-trash"></i> Clear History</button>
              <button class="close-history"><i class="fas fa-times"></i> Close</button>
            </div>
          </div>`;
        document.body.append(modal);

        modal.querySelectorAll(".del-msg").forEach(btn => {
          btn.onclick = () => {
            const idx = +btn.dataset.index;
            chatHistory.splice(idx, 1);
            localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
            const row = modal.querySelector(`tr[data-index="${idx}"]`);
            if (row) row.remove();
            modal.querySelectorAll(".history-table tbody tr").forEach((tr, i) => {
              tr.dataset.index = i;
              tr.querySelector(".del-msg").dataset.index = i;
            });
          };
        });

        modal.querySelector(".clear-history").onclick = () => {
          chatHistory = [];
          localStorage.removeItem("therapyChatHistory");
          modal.remove();
        };

        modal.querySelector(".close-history").onclick = () => modal.remove();
      };
    })();

    (function() {
      const form = document.getElementById("mood-form");
      const panel = document.getElementById("moodPanel");
      const moodRange = document.getElementById("moodRange");
      const moodValue = document.getElementById("moodValue");
      const triggersOther = document.getElementById("moodTriggersOther");
     
      moodRange.oninput = () => (moodValue.textContent = moodRange.value);

      document.querySelectorAll('#moodTracker input[name="triggers"]').forEach(cb => {
        cb.addEventListener("change", () => {
          if ([...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')]
                .some(c => c.value === "Other")) {
            triggersOther.style.display = "block";
            triggersOther.required = true;
          } else {
            triggersOther.style.display = "none";
            triggersOther.required = false;
          }
        });
      });

     
      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Analyzing… <span class="spinner"></span></div>';

        const data = {
          mood: moodRange.value,
          emotions: [...document.querySelectorAll('#moodTracker input[name="emotions"]:checked')].map(c => c.value),
          triggers: [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')].map(c => c.value === "Other" ? triggersOther.value.trim() : c.value),
          note: document.getElementById("moodNote").value.trim(),
          selfCare: selfCare.value === "Other" ? selfCareOther.value.trim() : selfCare.value
        };

        try {
          const aiReply = await callOpenAI([
  {
    role: "system",
    content: `
You are an advanced mental health AI specializing in daily mood analytics and personalized self-care recommendations. When given a “Daily Mood Entry,” do the following:

• If any required field (mood score, at least one emotion) is missing or empty, ask a clarifying question (e.g., “Please select at least one emotion.”).  
• Analyze mood (1–10), selected emotions (e.g., “Anxious,” “Calm”), and triggers (e.g., “Work,” “Sleep”).  
• Identify patterns or correlations (for example: “High stress at work correlates with low mood.”).  
• Provide at least three tailored, evidence-based self-care strategies (e.g., “Try progressive muscle relaxation,” “Practice 5-minute mindfulness breathing,” “Consider scheduling a 15-minute walk after work”).  
• Use empathetic, non-judgmental language—acknowledge feelings, normalize common struggles.  
• If user mentions high-risk phrases (e.g., “suicidal,” “want to harm myself”), respond with a brief crisis-safe message (“I’m sorry you’re feeling this way. If you feel you might harm yourself, please reach out to 988 or a trusted professional immediately.”).  
• Keep each reply under 200 words unless explicitly asked for more detail.  
    `.trim()
  },
  { role: "user", content: `Daily Mood Entry:\n${JSON.stringify(data)}` }
]);
          panel.innerHTML = `
          <div class="result-content">${formatHTML(aiReply)}</div>
          <div class="tool-row">
            <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
            <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
          </div>`;
        addClose(panel);

        panel.querySelector(".copy-btn").onclick = () => {
          const txt = panel.querySelector(".result-content").innerText || "";
          navigator.clipboard.writeText(txt);
          const toast = document.createElement("div");
          toast.className = "copy-toast";
          toast.textContent = "Copied!";
          document.body.append(toast);
          setTimeout(() => toast.remove(), 1500);
        };
        panel.querySelector(".dl-btn").onclick = () => {
          const txt = panel.querySelector(".result-content").innerText || "";
          const blob = new Blob([txt], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "mood-analysis.txt";
          document.body.append(a);
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
        };
        localStorage.setItem("moodPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedMood = localStorage.getItem("moodPanel");
      if (savedMood) {
        panel.innerHTML = savedMood;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    (function() {
      const form = document.getElementById("nt-form");
      const panel = document.getElementById("neurotransmitterPanel");
      const ntSleep = document.getElementById("ntSleep");
      const ntSleepOther = document.getElementById("ntSleepOther");
      const ntAppetite = document.getElementById("ntAppetite");
      const ntAppetiteOther = document.getElementById("ntAppetiteOther");
      const ntAdherence = document.getElementById("ntAdherence");
      const ntAdherenceOther = document.getElementById("ntAdherenceOther");
      const ntFocus = document.getElementById("ntFocus");
      const ntFocusOther = document.getElementById("ntFocusOther");

      [ntSleep, ntAppetite, ntAdherence, ntFocus].forEach(sel => {
        sel.addEventListener("change", () => {
          const other = sel.parentElement.querySelector(".other-input");
          if (sel.value === "Other") {
            other.style.display = "block";
            other.required = true;
          } else {
            other.style.display = "none";
            other.required = false;
          }
        });
        sel.dispatchEvent(new Event("change"));
      });

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Analyzing… <span class="spinner"></span></div>';
        const data = {
          mood: document.getElementById("ntMood").value,
          sleep: ntSleep.value === "Other" ? ntSleepOther.value.trim() : ntSleep.value,
          appetite: ntAppetite.value === "Other" ? ntAppetiteOther.value.trim() : ntAppetite.value,
          adherence: ntAdherence.value === "Other" ? ntAdherenceOther.value.trim() : ntAdherence.value,
          focus: ntFocus.value === "Other" ? ntFocusOther.value.trim() : ntFocus.value
        };
        try {
         const aiReply = await callOpenAI([
          { role: "system", content: `
You are a neuroscientist specializing in psychopharmacology and human neurochemistry. 
When given mood, sleep, appetite, and adherence data:
  • Correlate metrics (e.g., low sleep quality) with likely neurotransmitter imbalances (e.g., low Serotonin).
  • Provide at least three evidence‐based recommendations (e.g., diet, exercise, supplementation).
  • Explain each recommendation’s mechanism briefly (e.g., “Vitamin B6 is co-factor for Serotonin synthesis”).
  • If invalid or missing data, request clarification (e.g., “Please specify sleep quality from Poor to Excellent.”).
          `.trim() },
          { role: "user", content: `Neuro Profile Data:\n${JSON.stringify(data)}` }
        ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("neurotransmitterPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedNeuro = localStorage.getItem("neurotransmitterPanel");
      if (savedNeuro) {
        panel.innerHTML = savedNeuro;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    (function() {
      const form = document.getElementById("pgx-form");
      const panel = document.getElementById("pharmacogenomicsPanel");
      const pgxSex = document.getElementById("pgxSex");
      const pgxSexOther = document.getElementById("pgxSexOther");
      const pgxDrug = document.getElementById("pgxDrug");
      const pgxDrugOther = document.getElementById("pgxDrugOther");
      const pgxGene = document.getElementById("pgxGene");
      const pgxGeneOther = document.getElementById("pgxGeneOther");
      const pgxUpload = document.getElementById("pgxUpload");

      [pgxSex, pgxDrug, pgxGene].forEach(sel => {
        sel.addEventListener("change", () => {
          const other = sel.parentElement.querySelector(".other-input");
          if (sel.value === "Other") {
            other.style.display = "block";
            other.required = true;
          } else {
            other.style.display = "none";
            other.required = false;
          }
        });
        sel.dispatchEvent(new Event("change"));
      });

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Processing… <span class="spinner"></span></div>';
        const file = pgxUpload.files[0];
        if (!file) {
          panel.innerHTML = '<div class="result-content">⚠️ Please upload a genotype file.</div>';
          addClose(panel);
          return;
        }
        const data = {
          sex: pgxSex.value === "Other" ? pgxSexOther.value.trim() : pgxSex.value,
          age: document.getElementById("pgxAge").value.trim(),
          weight: document.getElementById("pgxWeight").value.trim(),
          drug: pgxDrug.value === "Other" ? pgxDrugOther.value.trim() : pgxDrug.value,
          gene: pgxGene.value === "Other" ? pgxGeneOther.value.trim() : pgxGene.value
        };
        if (!data.sex || !data.age || !data.drug || !data.gene) {
          panel.innerHTML = '<div class="result-content">⚠️ Please fill all required fields.</div>';
          addClose(panel);
          return;
        }
        try {
        const aiReply = await callOpenAI([
  {
    role: "system",
    content: `
You are a board-certified pharmacogenomics specialist. When provided with a user’s clinical data (sex, age, genotype variant, and chosen medication), do the following:

• If any field is missing or invalid, ask for clarification (e.g., “Please confirm the gene variant (e.g., CYP2C19*1).”).  
• Interpret the genotype‐phenotype relationship (e.g., “CYP2C19*2 suggests intermediate metabolizer status”).  
• Explain how that phenotype affects the chosen medication (e.g., “As an intermediate metabolizer, you may require a lower dose of Clopidogrel for efficacy”).  
• Provide a specific, evidence‐based dosing recommendation (e.g., “Recommend 75 mg daily with food; monitor platelet function after 7 days”).  
• Cite any major guidelines or clinical trials supporting your recommendation (e.g., “Based on CPIC guidelines (Clinical Pharmacogenetics Implementation Consortium) for CYP2C19 and Clopidogrel”).  
• Use clear terminology but define abbreviations (e.g., “IM = Intermediate Metabolizer”).  
• If the user indicates a rare variant not in your list, state that “I do not have sufficient evidence for this variant—please consult a pharmacogeneticist.”  
• Always include a brief safety note (e.g., “Monitor for signs of bleeding or thrombosis”).  
• Keep tone professional and precise, under 250 words unless asked for more detail.
    `.trim()
  },
  { role: "user", content: `Patient Data:\n${JSON.stringify(data)}` }
]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("pharmacogenomicsPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedPGx = localStorage.getItem("pharmacogenomicsPanel");
      if (savedPGx) {
        panel.innerHTML = savedPGx;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    (function() {
      const form = document.getElementById("int-form");
      const panel = document.getElementById("interactionsPanel");
      const intListSelect = document.getElementById("intListSelect");
      const intListOther = document.getElementById("intListOther");
      const intComorbid = document.getElementById("intComorbid");
      const intComorbidOther = document.getElementById("intComorbidOther");

      [intListSelect, intComorbid].forEach(sel => {
        sel.addEventListener("change", () => {
          const other = sel.parentElement.querySelector(".other-input");
          if (sel.value === "Other") {
            other.style.display = "block";
            other.required = true;
          } else {
            other.style.display = "none";
            other.required = false;
          }
        });
        sel.dispatchEvent(new Event("change"));
      });

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Checking… <span class="spinner"></span></div>';
        const meds = intListSelect.value === "Other" ? intListOther.value.trim() : intListSelect.value;
        const cond = intComorbid.value === "Other" ? intComorbidOther.value.trim() : intComorbid.value;
        if (!meds) {
          panel.innerHTML = '<div class="result-content">⚠️ Please select at least one medication.</div>';
          addClose(panel);
          return;
        }
        try {
         const aiReply = await callOpenAI([
  {
    role: "system",
    content: `
You are a clinical pharmacologist specializing in psychotropic drug interactions. When given a list of medications and comorbid conditions:

• If no medication or condition is provided, ask for that input (e.g., “Please list at least one current medication.”).  
• Check for CYP450 metabolism overlaps, receptor antagonism/synergy, QT prolongation risk, and condition-drug contraindications (e.g., “Sertraline + Tramadol increases serotonin syndrome risk”).  
• For each interaction, provide:  
  1. Mechanism (e.g., “CYP2D6 inhibition leads to increased levels of…”)  
  2. Clinical significance (e.g., “High risk of sedation; consider dose adjustment”)  
  3. Recommendation (e.g., “Switch to an alternative SSRIs with lower CYP2D6 inhibition”).  
• If the user’s comorbid condition (e.g., “Liver impairment”) could affect pharmacokinetics, mention dose modifications or monitoring.  
• If any medication is not recognized, say “I do not have data on [medication]—please verify its generic name.”  
• Summarize at the end: “In summary, these interactions warrant X, Y, Z.”  
• Keep the response under 300 words unless asked for more detail.  
• Maintain an authoritative but empathetic tone.
    `.trim()
  },
  { role: "user", content: `Medications: ${meds}\nComorbid Conditions: ${cond}` }
]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("interactionsPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedInt = localStorage.getItem("interactionsPanel");
      if (savedInt) {
        panel.innerHTML = savedInt;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    (function() {
      const form = document.getElementById("eeg-form");
      const panel = document.getElementById("eegPanel");
      const eegCondition = document.getElementById("eegCondition");
      const eegConditionOther = document.getElementById("eegConditionOther");
      const eegFile = document.getElementById("eegFile");

      eegCondition.addEventListener("change", () => {
        if (eegCondition.value === "Other") {
          eegConditionOther.style.display = "block";
          eegConditionOther.required = true;
        } else {
          eegConditionOther.style.display = "none";
          eegConditionOther.required = false;
        }
      });
      eegCondition.dispatchEvent(new Event("change"));

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        if (!eegFile.files.length) {
          panel.innerHTML = '<div class="result-content">⚠️ Please upload an EEG file.</div>';
          addClose(panel);
          return;
        }
        panel.innerHTML = '<div class="result-content">Analyzing… <span class="spinner"></span></div>';
        const cond = eegCondition.value === "Other" ? eegConditionOther.value.trim() : eegCondition.value;
        try {
          const aiReply = await callOpenAI([
  {
    role: "system",
    content: `
You are a neurophysiologist specializing in EEG interpretation for psychiatric and cognitive insights. When provided with an EEG “Condition/Task” descriptor (e.g., “Resting Eyes Closed,” “Stress Task”):

• If no file or condition is provided, request it (“Please upload an EEG file and select a condition.”).  
• Explain typical waveform patterns expected for that condition (e.g., “Eyes closed resting: elevated alpha in occipital leads”).  
• Identify clinical concerns if abnormal (e.g., “Excessive theta in frontal leads may indicate drowsiness or attention deficit”).  
• Suggest at least two actionable interventions or follow-up steps (e.g., “Consider mindfulness meditation to enhance alpha coherence,” “Refer for sleep study if excessive delta persists”).  
• Use terms like “alpha (8–12 Hz), theta (4–7 Hz), beta (13–30 Hz), delta (<4 Hz).”  
• If condition/label is unfamiliar, ask for clarification (“I’m unfamiliar with ‘XYZ’—can you describe the task further?”).  
• Always maintain a balanced tone—neither overly technical nor too simplified.  
• Keep the response under 200 words unless asked for more detail.
    `.trim()
  },
  { role: "user", content: `EEG Analysis:\nCondition/Task: ${cond}` }
]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("eegPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedEEG = localStorage.getItem("eegPanel");
      if (savedEEG) {
        panel.innerHTML = savedEEG;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    (function() {
      const form = document.getElementById("trial-form");
      const panel = document.getElementById("trialmatchPanel");
      const trialDx = document.getElementById("trialDx");
      const trialDxOther = document.getElementById("trialDxOther");
      const trialPhase = document.getElementById("trialPhase");
      const trialPhaseOther = document.getElementById("trialPhaseOther");

      [trialDx, trialPhase].forEach(sel => {
        sel.addEventListener("change", () => {
          const other = sel.parentElement.querySelector(".other-input");
          if (sel.value === "Other") {
            other.style.display = "block";
            other.required = true;
          } else {
            other.style.display = "none";
            other.required = false;
          }
        });
        sel.dispatchEvent(new Event("change"));
      });

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Searching… <span class="spinner"></span></div>';
        const dx = trialDx.value === "Other" ? trialDxOther.value.trim() : trialDx.value;
        const loc = document.getElementById("trialLoc").value.trim();
        const ph = trialPhase.value === "Other" ? trialPhaseOther.value.trim() : trialPhase.value;
        if (!dx || !loc) {
          panel.innerHTML = '<div class="result-content">⚠️ Please specify diagnosis and location.</div>';
          addClose(panel);
          return;
        }
        try {
          const aiReply = await callOpenAI([
  {
    role: "system",
    content: `
You are a clinical research coordinator specializing in psychiatric trials. When provided with “Diagnosis,” “Location,” and “Phase”:

• If any field is missing, prompt the user (e.g., “Please specify the diagnosis if not listed.”).  
• Query major registries (e.g., ClinicalTrials.gov, EU Clinical Trials Register) in your knowledge base for matching studies.  
• For each suggested trial, include:  
  1. Official trial name (e.g., “Trial of XYZ for Major Depressive Disorder”).  
  2. Phase and design (e.g., “Phase II, randomized, double-blind”).  
  3. Brief inclusion/exclusion criteria (e.g., “Adults 18–55, refractory to two SSRIs, no substance abuse”).  
  4. Key contact info or recruitment website (e.g., “Contact: research@psychiatriccenter.org”).  
• If no exact matches are found, suggest “nearby phases” (e.g., if Phase III isn’t recruiting, list Phase II or IV).  
• Provide at least two alternate options in different geographic regions if possible.  
• If user’s location is not recognized, ask for a city/state again.  
• Keep each trial summary under 75 words.  
• Conclude with “Please verify eligibility criteria on the official registry before enrollment.”  
• Use a formal, concise tone.  
    `.trim()
  },
  { role: "user", content: `Diagnosis: ${dx}\nLocation: ${loc}\nPhase: ${ph}` }
]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("trialmatchPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedTrials = localStorage.getItem("trialmatchPanel");
      if (savedTrials) {
        panel.innerHTML = savedTrials;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

     (function() {
      const form = document.getElementById("mood-form");
      const panel = document.getElementById("moodPanel");
      const moodRange = document.getElementById("moodRange");
      const moodValue = document.getElementById("moodValue");
      const triggersOther = document.getElementById("moodTriggersOther");
      
      moodRange.oninput = () => (moodValue.textContent = moodRange.value);

      document.querySelectorAll('#moodTracker input[name="triggers"]').forEach(cb => {
        cb.addEventListener("change", () => {
          const anyOther = [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')]
            .some(c => c.value === "Other");
          if (anyOther) {
            triggersOther.style.display = "block";
            triggersOther.required = true;
          } else {
            triggersOther.style.display = "none";
            triggersOther.required = false;
          }
        });
      });

      form.onsubmit = async e => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Analyzing… <span class="spinner"></span></div>';

        const data = {
          mood: moodRange.value,
          emotions: [...document.querySelectorAll('#moodTracker input[name="emotions"]:checked')].map(c => c.value),
          triggers: [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')]
                     .map(c => c.value === "Other" ? triggersOther.value.trim() : c.value),
          note: document.getElementById("moodNote").value.trim()
        };

        try {
          const aiReply = await callOpenAI([
            {
              role: "system",
              content: `
You are an advanced mental health AI specializing in daily mood analytics and personalized self-care recommendations. When given a “Daily Mood Entry,” do the following:

• If any required field (mood score, at least one emotion) is missing, ask a clarifying question (e.g., “Please select at least one emotion.”).  
• Analyze mood (1–10), selected emotions (e.g., “Anxious,” “Calm”), and triggers (e.g., “Work,” “Sleep”).  
• Identify patterns or correlations (for example: “High stress at work correlates with low mood.”).  
• Provide at least three tailored, evidence-based self-care strategies (e.g., “Try progressive muscle relaxation,” “Practice 5-minute mindfulness breathing,” “Consider scheduling a 15-minute walk after work”).  
• Use empathetic, non-judgmental language—acknowledge feelings, normalize common struggles.  
• If user mentions high-risk phrases (e.g., “suicidal,” “want to harm myself”), respond with a brief crisis-safe message (“I’m sorry you’re feeling this way. If you feel you might harm yourself, please reach out to 988 or a trusted professional immediately.”).  
• Keep each reply under 200 words unless explicitly asked for more detail.  
        `.trim()
            },
            { role: "user", content: `Daily Mood Entry:\n${JSON.stringify(data)}` }
          ]);

          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("moodPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedMood = localStorage.getItem("moodPanel");
      if (savedMood) {
        panel.innerHTML = savedMood;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }

        panel.addEventListener("click", e => {
        if (e.target.closest(".close-btn")) {
          panel.hidden = true;
          return;
        }
        if (e.target.closest(".copy-btn")) {
          const contentDiv = panel.querySelector(".result-content");
          if (!contentDiv) return;
          navigator.clipboard.writeText(contentDiv.innerText.trim());
          const toast = document.createElement("div");
          toast.className = "copy-toast";
          toast.textContent = "Copied!";
          document.body.append(toast);
          setTimeout(() => toast.remove(), 1500);
          return;
        }
        if (e.target.closest(".dl-btn")) {
          const contentDiv = panel.querySelector(".result-content");
          if (!contentDiv) return;
          const text = contentDiv.innerText.trim();
          const blob = new Blob([text], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "mood_analysis.txt";
          document.body.append(a);
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
          return;
        }
      });
    })();

    (function() {
      function getCSSVar(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      }

      function initMoodStatsChart() {
        const ctx = document.getElementById("moodStatsChart").getContext("2d");
        let savedEntries = JSON.parse(localStorage.getItem("dailyMoodEntries") || "[]");
        if (!savedEntries.length) {
          const today = new Date();
          for (let i = 6; i >= 0; i--) {
            const day = new Date(today);
            day.setDate(today.getDate() - i);
            savedEntries.push({ date: day.toLocaleDateString(), score: Math.floor(Math.random() * 5) + 5 });
          }
          localStorage.setItem("dailyMoodEntries", JSON.stringify(savedEntries));
        }
        const labels = savedEntries.map(e => e.date);
        const dataPoints = savedEntries.map(e => e.score);
        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Avg Mood Score",
              data: dataPoints,
              borderColor: getCSSVar("--primary"),
              backgroundColor: "rgba(226,74,74,0.1)",
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { ticks: { color: getCSSVar("--text") }, grid: { display: false } },
              y: { ticks: { color: getCSSVar("--text") }, grid: { color: getCSSVar("--muted") }, beginAtZero: true, max: 10 }
            },
            plugins: { legend: { display: false } }
          }
        });

        document.getElementById("exportMoodStats").addEventListener("click", () => {
          let csv = "Date,Mood Score\n";
          savedEntries.forEach(e => {
            csv += `"${e.date}",${e.score}\n`;
          });
          const blob = new Blob([csv], { type: "text/csv" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "mood_stats.csv";
          document.body.append(a);
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
        });
      }
  
      function initRealCharts() {
        const colorText = getCSSVar("--text");
        const colorMuted = getCSSVar("--muted");
        const primary = getCSSVar("--primary");
        const secondary = getCSSVar("--secondary");

        new Chart("engagementChart", {
          type: "line",
          data: {
            labels: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
            datasets: [{
              label: "Sessions",
              data: [12, 9, 14, 11, 13, 10, 15],
              borderColor: primary,
              backgroundColor: `rgba(${parseInt(primary.slice(1,3),16)},${parseInt(primary.slice(3,5),16)},${parseInt(primary.slice(5,7),16)},0.1)`,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { ticks: { color: colorText }, grid: { display: false } },
              y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true }
            },
            plugins: { legend: { display: false } }
          }
        });

        new Chart("outcomeChart", {
          type: "bar",
          data: {
            labels: ["Week 1","Week 2","Week 3","Week 4"],
            datasets: [{
              label: "Outcome Score",
              data: [3.2, 4.1, 4.5, 4.8],
              backgroundColor: secondary
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { ticks: { color: colorText }, grid: { display: false } },
              y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true, max: 5 }
            },
            plugins: { legend: { display: false } }
          }
        });
        initMoodStatsChart();
      }

      window.addEventListener("load", () => {
        if (typeof initRealCharts === "function") {
          initRealCharts();
        }
      });

      document.getElementById("exportCharts").addEventListener("click", () => {
        const engChart = Chart.getChart("engagementChart");
        const outChart = Chart.getChart("outcomeChart");
        let csv = "Chart,Label,Value\n";
        [
          ["Sessions", engChart],
          ["Outcome", outChart]
        ].forEach(([name, ch]) => {
          ch.data.labels.forEach((lab, i) => {
            csv += `"${name}","${lab}",${ch.data.datasets[0].data[i]}\n`;
          });
        });
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "analytics.csv";
        document.body.append(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      });
    })();
  });
</script>

  
</body>

</html>
