<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra AI – Psychology & Mental Health</title>
  <!-- Pale Blue + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <style>
  /*────────────────── THEME VARIABLES ──────────────────*/
  :root {
    --primary: #a3c4f3;        /* pale blue */
    --secondary: #7fa8e7;      /* mid blue */
    --accent: #eef5fc;         /* off-white blue */
    --bg: #ffffff;
    --surface: #f0f7ff;
    --text: #1a1a1a;
    --muted: #555555;
    --radius: 0.5rem;
    --padding: 1rem;
    --transition: 0.3s ease;
    --sidebar-w: 260px;
    --sidebar-collapsed-w: 60px;
    --header-h: 60px;
  }
  html.dark {
    --bg: #1a1a2e;
    --surface: #16213e;
    --text: #e0e0e0;
    --muted: #999999;
  }
  /*────────────────── RESET & BASE ──────────────────*/
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  html{font-family:'Montserrat',sans-serif;scroll-behavior:smooth}
  body{display:flex;min-height:100vh;background:var(--bg);color:var(--text);overflow-x:hidden}
  a{color:inherit;text-decoration:none}
  button{border:none;background:none;font:inherit}
  /*────────────────── SIDEBAR ──────────────────*/
  aside{flex:0 0 var(--sidebar-w);position:sticky;top:0;height:100vh;background:var(--surface);transition: flex var(--transition);overflow:hidden;z-index:1000}
  aside.collapsed{flex:0 0 var(--sidebar-collapsed-w)}
  .brand{display:flex;align-items:center;gap:.5rem;padding:var(--padding);font-size:1.2rem;color:var(--primary)}
  .brand span{transition: opacity var(--transition)}
  aside.collapsed .brand span{opacity:0}
  nav{margin-top:1rem;display:flex;flex-direction:column}
  nav a{display:flex;align-items:center;gap:1rem;padding:.75rem var(--padding);border-radius:var(--radius);font-weight:500;transition:background var(--transition)}
  nav a:hover,nav a.active{background:var(--primary);color:#fff}
  #shrinkBtn{position:absolute;bottom:var(--padding);right:-18px;width:36px;height:36px;border-radius:50%;background:var(--primary);color:#fff;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.2)}
  /*────────────────── HEADER ──────────────────*/
  header{position:fixed;top:0;left:var(--sidebar-w);right:0;height:var(--header-h);background:var(--surface);display:flex;align-items:center;justify-content:space-between;padding:0 var(--padding);border-bottom:1px solid var(--muted);transition:left var(--transition);z-index:999}
  aside.collapsed ~ header{left:var(--sidebar-collapsed-w)}
  header h1{font-size:1.3rem;font-weight:600}
  .hamburger,.theme-toggle{font-size:1.4rem;color:var(--primary);cursor:pointer;transition:transform var(--transition)}
  .hamburger:hover,.theme-toggle:hover{transform:scale(1.1)}
  /*────────────────── HERO ──────────────────*/
  .hero{background:var(--surface);padding:4rem 1rem;text-align:center;position:relative;overflow:hidden}
  .hero h1{font-size:2.5rem;color:var(--primary);margin-bottom:.5rem;display:flex;justify-content:center;align-items:center;gap:.5rem}
  .hero p{color:var(--muted);font-size:1.1rem;margin-bottom:2rem}
  .hero .actions{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}
  .hero .actions a{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:var(--radius);cursor:pointer;transition:transform var(--transition)}
  .hero .actions a.btn-primary{background:var(--primary);color:#fff}
  .hero .actions a.btn-secondary{background:var(--secondary);color:#fff}
  .hero .actions a:hover{transform:translateY(-2px)}
  /*────────────────── MODULES ──────────────────*/
  main{flex:1;padding:calc(var(--header-h)+var(--padding)) var(--padding) var(--padding)}
  section{background:var(--surface);border-radius:var(--radius);padding:var(--padding);margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
  section h2{display:flex;align-items:center;gap:.5rem;font-size:1.4rem;color:var(--primary);margin-bottom:.5rem}
  .desc{color:var(--muted);margin-bottom:1rem}
  .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem 1rem;border-radius:var(--radius);cursor:pointer;transition:transform var(--transition)}
  .btn-primary{background:var(--primary);color:#fff}
  .btn-secondary{background:var(--secondary);color:#fff}
  .btn:hover{transform:translateY(-2px)}
  .response{background:var(--accent);border-left:4px solid var(--secondary);padding:var(--padding);border-radius:var(--radius);margin-top:1rem;position:relative}
  .response .result-content{white-space:pre-wrap}
  .spinner{display:inline-block;width:1em;height:1em;border:2px solid var(--primary);border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle;margin-left:.25em}
  @keyframes spin{to{transform:rotate(360deg)}}
  /*────────────────── CHARTS ──────────────────*/
  .charts{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-top:1rem}
  .chart-card{background:var(--surface);border-radius:var(--radius);padding:var(--padding);box-shadow:0 2px 6px rgba(0,0,0,0.05);display:flex;flex-direction:column;align-items:center}
  .chart-card canvas{width:100%!important;height:180px!important}
  /*────────────────── RESPONSIVE ──────────────────*/
  @media(max-width:1024px){aside{position:fixed;transform:translateX(-100%)}aside.open{transform:translateX(0)}header{left:0!important}}
  @media(max-width:640px){.charts{grid-template-columns:1fr}}
  @media(max-width:414px){.hero h1{font-size:2rem}.hero p{font-size:1rem}}
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-brain"></i><span>Vitra AI</span></div>
    <nav>
      <a href="index.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
      <a href="psychology.html" class="active"><i class="fas fa-brain"></i><span>Psychology &amp; Mental Health</span></a>
      <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
      <a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i><span>Consultation Booking</span></a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
  </aside>

  <!-- HEADER -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>Psychology &amp; Mental Health</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- MAIN + HERO -->
  <main>
    <section class="hero" id="hero">
      <h1><i class="fas fa-brain"></i> Transform Your Mind with AI</h1>
      <p>Explore advanced, AI-powered tools for emotional insight, therapy, and holistic mental well-being—all in one place.</p>
      <div class="actions">
        <a href="#insight" class="btn btn-primary"><i class="fas fa-wave-square"></i> Emotional Insight</a>
        <a href="#dream"   class="btn btn-secondary"><i class="fas fa-bed"></i> Dream Explorer</a>
      </div>
    </section>

    <!-- 1. Multimodal Emotional Insight -->
    <section id="insight">
      <h2><i class="fas fa-wave-square"></i> 1. Multimodal Emotional Insight</h2>
      <p class="desc">Capture voice, video, and typing signals to map your emotional state in real time.</p>
      <button class="btn btn-primary" id="startVideo"><i class="fas fa-video"></i> Start 30s Video</button>
      <button class="btn btn-secondary" id="typingAnalysis"><i class="fas fa-keyboard"></i> Typing Dynamics</button>
    </section>

    <!-- 2. Dream & Subconscious Explorer -->
    <section id="dream">
      <h2><i class="fas fa-bed"></i> 2. Dream &amp; Subconscious Explorer</h2>
      <p class="desc">Recall and interpret your dreams with AI-driven prompts.</p>
      <button class="btn btn-primary" id="dreamRecall"><i class="fas fa-question-circle"></i> Guided Recall</button>
      <button class="btn btn-secondary" id="voiceDiary"><i class="fas fa-microphone"></i> Night Voice Diary</button>
    </section>

    <!-- 3. Virtual Reality Micro-Therapies -->
    <section id="vr">
      <h2><i class="fas fa-vr-cardboard"></i> 3. Virtual Reality Micro-Therapies</h2>
      <p class="desc">Immersive, AI-driven VR experiences for healing and exposure therapy.</p>
      <button class="btn btn-primary" id="phobiaSim"><i class="fas fa-exclamation-triangle"></i> Phobia Simulator</button>
      <button class="btn btn-secondary" id="mindscapes"><i class="fas fa-globe"></i> 360° Mindscapes</button>
    </section>

    <!-- 4. AI-Curated Creative Therapies -->
    <section id="creative">
      <h2><i class="fas fa-palette"></i> 4. AI-Curated Creative Therapies</h2>
      <p class="desc">Unleash creativity and healing through art and music generated just for you.</p>
      <button class="btn btn-primary" id="artEmotion"><i class="fas fa-brush"></i> Art-By-Emotion</button>
      <button class="btn btn-secondary" id="musicMixer"><i class="fas fa-music"></i> Music Mood Mixer</button>
    </section>

    <!-- 5. Dynamic Cognitive Games -->
    <section id="games">
      <h2><i class="fas fa-gamepad"></i> 5. Dynamic Cognitive Games</h2>
      <p class="desc">Adaptive puzzles and storytelling to train your mind and foster insight.</p>
      <button class="btn btn-primary" id="puzzles"><i class="fas fa-puzzle-piece"></i> Adaptive Puzzles</button>
      <button class="btn btn-secondary" id="storyBuilder"><i class="fas fa-book"></i> Story Builder</button>
    </section>

    <!-- 6. Predictive Risk & Early Warning -->
    <section id="risk">
      <h2><i class="fas fa-chart-line"></i> 6. Predictive Risk & Early Warning</h2>
      <p class="desc">Early detection of risk patterns and crisis alerts to keep you safe.</p>
      <button class="btn btn-primary" id="phenotyping"><i class="fas fa-tachometer-alt"></i> Phenotyping Dashboard</button>
      <button class="btn btn-secondary" id="crisisAlerts"><i class="fas fa-bell"></i> Crisis Alerts</button>
    </section>

    <!-- 7. Personalized Growth Path -->
    <section id="growth">
      <h2><i class="fas fa-compass"></i> 7. Personalized Growth Path</h2>
      <p class="desc">Set goals and earn badges on your journey to well-being.</p>
      <button class="btn btn-primary" id="goalCoach"><i class="fas fa-flag"></i> Life Compass</button>
      <button class="btn btn-secondary" id="habitGame"><i class="fas fa-gift"></i> Gamified Habits</button>
    </section>

    <!-- 8. Integrated Professional Ecosystem -->
    <section id="pro">
      <h2><i class="fas fa-toolbox"></i> 8. Integrated Professional Ecosystem</h2>
      <p class="desc">Tools for clinicians and a seamless referral pipeline.</p>
      <button class="btn btn-primary" id="clinicianToolkit"><i class="fas fa-file-alt"></i> Clinician Toolkit</button>
      <button class="btn btn-secondary" id="referralPipeline"><i class="fas fa-share-square"></i> Referral Pipeline</button>
    </section>

    <!-- 9. Biofeedback & Wearable Sync -->
    <section id="biofeedback">
      <h2><i class="fas fa-heartbeat"></i> 9. Biofeedback &amp; Wearable Sync</h2>
      <p class="desc">Real-time stress monitoring and guided biofeedback sessions.</p>
      <button class="btn btn-primary" id="stressMonitor"><i class="fas fa-phone-alt"></i> Stress Monitor</button>
      <button class="btn btn-secondary" id="bioSessions"><i class="fas fa-chart-bar"></i> Guided Sessions</button>
    </section>

    <!-- 10. Community & Peer Support -->
    <section id="community">
      <h2><i class="fas fa-users"></i> 10. Community &amp; Peer Support</h2>
      <p class="desc">Join AI-moderated circles or get a check-in from your Buddy Bot.</p>
      <button class="btn btn-primary" id="supportCircles"><i class="fas fa-comments"></i> Support Circles</button>
      <button class="btn btn-secondary" id="buddyBot"><i class="fas fa-user-friends"></i> Buddy Bot</button>
    </section>

    <!-- 11. Symptom & Mood Assessment -->
    <section id="assessment">
      <h2><i class="fas fa-smile"></i> 11. Symptom &amp; Mood Assessment</h2>
      <p class="desc">Daily mood tracking and symptom questionnaires powered by AI.</p>
      <button class="btn btn-primary" id="moodTracker"><i class="fas fa-sliders-h"></i> Mood Tracker</button>
      <button class="btn btn-secondary" id="symptomQuiz"><i class="fas fa-clipboard-list"></i> Symptom Quiz</button>
    </section>

    <!-- 12. Conversational “Therapy Bot” -->
    <section id="therapybot">
      <h2><i class="fas fa-robot"></i> 12. Conversational “Therapy Bot”</h2>
      <p class="desc">CBT exercises and crisis hotline integration in chat form.</p>
      <button class="btn btn-primary" id="cbtChat"><i class="fas fa-comments"></i> CBT Chat</button>
      <button class="btn btn-secondary" id="hotline"><i class="fas fa-phone"></i> Crisis Hotline</button>
    </section>

    <!-- 13. Personalized Self-Care Plans -->
    <section id="selfcare">
      <h2><i class="fas fa-heart"></i> 13. Personalized Self-Care Plans</h2>
      <p class="desc">AI-generated activity suggestions and progress nudges.</p>
      <button class="btn btn-primary" id="activitySuggest"><i class="fas fa-lightbulb"></i> Activity Suggestions</button>
      <button class="btn btn-secondary" id="nudges"><i class="fas fa-bell"></i> Reminders & Nudges</button>
    </section>

    <!-- 14. Teletherapy & Appointment Booking -->
    <section id="teletherapy">
      <h2><i class="fas fa-video"></i> 14. Teletherapy &amp; Booking</h2>
      <p class="desc">Smart matching and in-app video sessions with professionals.</p>
      <button class="btn btn-primary" id="matchTherapist"><i class="fas fa-user-check"></i> Smart Matching</button>
      <button class="btn btn-secondary" id="videoSession"><i class="fas fa-camera"></i> Video Session</button>
    </section>

    <!-- 15. Medication Management & Safety -->
    <section id="medsafety">
      <h2><i class="fas fa-pills"></i> 15. Medication Management &amp; Safety</h2>
      <p class="desc">Check psychotropic interactions and track adherence.</p>
      <button class="btn btn-primary" id="medInteraction"><i class="fas fa-exchange-alt"></i> Interaction Checker</button>
      <button class="btn btn-secondary" id="adherence"><i class="fas fa-check-circle"></i> Adherence Tracker</button>
    </section>

    <!-- 16. Data Analytics & ROI -->
    <section id="analytics">
      <h2><i class="fas fa-chart-pie"></i> 16. Data Analytics &amp; ROI</h2>
      <p class="desc">Engagement and outcome metrics to measure impact.</p>
      <div class="charts">
        <div class="chart-card"><canvas id="engagementChart"></canvas><figcaption>Session Engagement</figcaption></div>
        <div class="chart-card"><canvas id="outcomeChart"></canvas><figcaption>Mood Improvement</figcaption></div>
      </div>
      <button id="exportCharts" class="btn btn-primary" style="margin-top:1rem;"><i class="fas fa-file-export"></i> Export CSV</button>
    </section>
  </main>

  <!-- FOOTER -->
  <footer style="text-align:center;padding:var(--padding);background:var(--surface);color:var(--muted)">
    &copy; 2025 Vitra AI – Psychology &amp; Mental Health
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  // ── OpenAI proxy call ─────────────────────────────────────────────────────────
  async function callOpenAI(messages) {
    const res = await fetch('/.netlify/functions/openai-proxy', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({messages})
    });
    if(!res.ok) throw new Error('OpenAI error');
    const j = await res.json();
    return j.choices[0].message.content;
  }
  function formatHTML(txt){
    return txt
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .replace(/\*(.+?)\*/g,'<em>$1</em>')
      .split(/\n{2,}/).map(p=>`<p>${p.trim()}</p>`).join('');
  }
  // ── Utility: get/create response panel ───────────────────────────────────────
  function getPanel(id){
    const sec = document.getElementById(id);
    let p = sec.querySelector('.response');
    if(!p){
      p = document.createElement('div');
      p.className='response';
      sec.appendChild(p);
    }
    return p;
  }
  // ── Generic text module handler ──────────────────────────────────────────────
  async function handleModule(id, sys, promptText){
    const panel = getPanel(id);
    panel.innerHTML=`<div class="result-content">Processing<span class="spinner"></span></div>`;
    try{
      const inp = prompt(promptText);
      if(!inp){ panel.innerHTML=''; return; }
      const reply = await callOpenAI([
        {role:'system',content:sys},
        {role:'user',content:inp}
      ]);
      panel.innerHTML=`<div class="result-content">${formatHTML(reply)}</div>`;
    }catch{
      panel.innerHTML=`<div class="result-content">😕 Something went wrong.</div>`;
    }
  }
  document.addEventListener('DOMContentLoaded',()=>{
    // Sidebar toggle
    document.getElementById('shrinkBtn').onclick=()=>document.getElementById('sidebar').classList.toggle('collapsed');
    // Mobile nav
    document.getElementById('hamburger').onclick=()=>document.getElementById('sidebar').classList.toggle('open');
    // Theme toggle
    document.getElementById('themeToggle').onclick=()=>{
      document.documentElement.classList.toggle('dark');
      document.getElementById('themeToggle').classList.toggle('fa-sun');
    };

    // 1. Emotional Insight
    document.getElementById('startVideo').onclick=()=>alert('Integrate video+Whisper here.');
    document.getElementById('typingAnalysis').onclick=()=>handleModule(
      'insight',
      'You are an expert in keystroke dynamics. Analyze this text for stress.',
      'Type a few sentences to analyze:'
    );
    // 2. Dream Explorer
    document.getElementById('dreamRecall').onclick=()=>handleModule(
      'dream',
      'You are an AI dream interpreter.',
      'Describe your dream:'
    );
    document.getElementById('voiceDiary').onclick=()=>alert('Integrate voice recording+Whisper.');
    // 3. VR Micro-Therapies
    document.getElementById('phobiaSim').onclick=()=>alert('Launch WebXR phobia simulator.');
    document.getElementById('mindscapes').onclick=()=>alert('Launch generative VR mindscape.');
    // 4. Creative Therapies
    document.getElementById('artEmotion').onclick=()=>handleModule(
      'creative',
      'You are an AI art director. Create a DALL·E prompt for this emotion.',
      'Enter an emotion:'
    );
    document.getElementById('musicMixer').onclick=()=>handleModule(
      'creative',
      'You are an AI composer. Describe a short adaptive soundscape.',
      'How are you feeling?'
    );
    // 5. Cognitive Games
    document.getElementById('puzzles').onclick=()=>handleModule(
      'games',
      'You generate an adaptive logic puzzle.',
      'Generate an easy logic puzzle.'
    );
    document.getElementById('storyBuilder').onclick=()=>handleModule(
      'games',
      'You are a narrative therapist. Continue this seed.`,
      'Enter a story seed:'
    );
    // 6. Predictive Risk
    document.getElementById('phenotyping').onclick=()=>alert('Integrate passive data dashboard.');
    document.getElementById('crisisAlerts').onclick=()=>handleModule(
      'risk',
      'You assess crisis risk and recommend actions.',
      'Describe any current thoughts or feelings:'
    );
    // 7. Growth Path
    document.getElementById('goalCoach').onclick=()=>handleModule(
      'growth',
      'You are an AI coach. Help set a SMART goal.',
      'Which area? (sleep, social, mindfulness)'
    );
    document.getElementById('habitGame').onclick=()=>handleModule(
      'growth',
      'You design habit gamification rewards.',
      'Habit: daily gratitude journaling'
    );
    // 8. Professional Ecosystem
    document.getElementById('clinicianToolkit').onclick=()=>handleModule(
      'pro',
      'You summarize clinical session notes.',
      'Paste session notes:'
    );
    document.getElementById('referralPipeline').onclick=()=>handleModule(
      'pro',
      'You match patients to therapists.',
      'Enter user profile preferences:'
    );
    // 9. Biofeedback
    document.getElementById('stressMonitor').onclick=()=>alert('Integrate wearable HRV data.');
    document.getElementById('bioSessions').onclick=()=>alert('Render biofeedback charts+voice.');
    // 10. Community Support
    document.getElementById('supportCircles').onclick=()=>handleModule(
      'community',
      'You moderate a peer support chat and summarize insights.',
      'Paste recent chat transcript:'
    );
    document.getElementById('buddyBot').onclick=()=>handleModule(
      'community',
      'You are a friendly buddy. Provide a check-in message.',
      'User last logged mood "sad".'
    );
    // 11. Symptom & Mood Assessment
    document.getElementById('moodTracker').onclick=()=>handleModule(
      'assessment',
      'You analyze mood logs for trends and flags.',
      'Enter mood values comma-separated (1–10):'
    );
    document.getElementById('symptomQuiz').onclick=()=>handleModule(
      'assessment',
      'You evaluate mental health symptoms and recommend next steps.',
      'Answer: sleep quality, appetite, concentration:'
    );
    // 12. Therapy Bot
    document.getElementById('cbtChat').onclick=()=>handleModule(
      'therapybot',
      'You guide a CBT thought record.',
      'Enter a negative automatic thought:'
    );
    document.getElementById('hotline').onclick=()=>alert('Show crisis resources and Call 988.');
    // 13. Self-Care Plans
    document.getElementById('activitySuggest').onclick=()=>handleModule(
      'selfcare',
      'You are an AI self-care planner. Recommend 3 activities.',
      'How have you felt this week?'
    );
    document.getElementById('nudges').onclick=()=>alert('Schedule push/email reminders here.');
    // 14. Teletherapy & Booking
    document.getElementById('matchTherapist').onclick=()=>handleModule(
      'teletherapy',
      'You match patients to therapists based on profile.',
      'Enter user preferences:'
    );
    document.getElementById('videoSession').onclick=()=>alert('Embed HIPAA-compliant video widget.');
    // 15. Medication Safety
    document.getElementById('medInteraction').onclick=()=>handleModule(
      'medsafety',
      'You warn of dangerous psychotropic interactions.',
      'Enter two medications separated by comma:'
    );
    document.getElementById('adherence').onclick=()=>alert('Set up medication reminders here.');
    // 16. Analytics & Export
    const engCtx = document.getElementById('engagementChart').getContext('2d');
    const engagementChart = new Chart(engCtx, {
      type:'line',
      data:{ labels:['Mon','Tue','Wed','Thu','Fri'], datasets:[{ label:'Sessions', data:[12,9,14,11,13], borderColor:varGet('--primary'), tension:0.3, fill:false }] }
    });
    const outCtx = document.getElementById('outcomeChart').getContext('2d');
    const outcomeChart = new Chart(outCtx, {
      type:'bar',
      data:{ labels:['Week1','Week2','Week3'], datasets:[{ label:'Mood Score', data:[3.2,4.1,4.5], backgroundColor:varGet('--secondary') }] }
    });
    document.getElementById('exportCharts').onclick = () => {
      let csv='Chart,Label,Value\n';
      [['Engagement', engagementChart], ['Outcome', outcomeChart]].forEach(([name,ch])=>{
        ch.data.labels.forEach((lab,i)=>{
          csv+=`${name},${lab},${ch.data.datasets[0].data[i]}\n`;
        });
      });
      const blob=new Blob([csv],{type:'text/csv'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url; a.download='psychology_analytics.csv'; a.click();
      URL.revokeObjectURL(url);
    };
  });
  function varGet(name){return getComputedStyle(document.documentElement).getPropertyValue(name).trim();}
  </script>
</body>
</html>
