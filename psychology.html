<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Psychology & Mental Health</title>
  <!-- Pale Blue + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
  /*────────────────── THEME VARIABLES ──────────────────*/
  :root {
    --primary: #5A8DEE;
    --primary-alt: #7DA4E8;
    --secondary: #FF758C;
    --accent: rgba(255,255,255,0.4);
    --bg: #F0F4F8;
    --surface: rgba(255,255,255,0.85);
    --text: #1F2937;
    --muted: #546E7A;
    --radius: 0.75rem;
    --padding: 1rem;
    --transition: 0.3s ease;
    --shadow-light: 0 4px 20px rgba(0,0,0,0.05);
    --shadow-heavy: 0 8px 40px rgba(0,0,0,0.1);
  }
  html.dark {
    --bg: #111827;
    --surface: rgba(30,35,54,0.85);
    --text: #E0E6F0;
    --muted: #9AA5B1;
    --accent: rgba(30,35,54,0.5);
  }

  /*────────────────── RESET & BASE ──────────────────*/
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  html { font-family:'Montserrat',sans-serif; scroll-behavior:smooth; }
  body { display:flex; min-height:100vh; background:var(--bg); color:var(--text); overflow-x:hidden; }
  a { color:inherit; text-decoration:none; }
  button, input, textarea, select { font:inherit; transition:all var(--transition); }
  :focus { outline:2px solid var(--primary); outline-offset:2px; }

  /*────────────────── SIDEBAR ──────────────────*/
  aside {
    flex:0 0 260px; background:var(--surface); backdrop-filter:blur(12px);
    box-shadow:var(--shadow-light); position:sticky; top:0; height:100vh;
    display:flex; flex-direction:column; transition:flex var(--transition);
  }
  aside.collapsed { flex:0 0 72px; }
  .brand { display:flex; align-items:center; gap:.75rem; padding:var(--padding); font-size:1.2rem; color:var(--primary); }
  aside.collapsed .brand span { opacity:0; }
  nav { flex:1; overflow-y:auto; margin-top:.5rem; }
  nav a {
    display:flex; align-items:center; gap:1rem; padding:.75rem var(--padding);
    border-radius:var(--radius); transition:background var(--transition), transform var(--transition);
  }
  nav a:hover, nav a.active { background:var(--primary); color:#fff; transform:translateX(4px); }
  #shrinkBtn {
    margin:var(--padding) auto; width:36px; height:36px; border-radius:50%;
    background:var(--primary); color:#fff; box-shadow:var(--shadow-heavy); transition:transform var(--transition);
  }
  #shrinkBtn:hover { transform:scale(1.1); }

  /*────────────────── HEADER ──────────────────*/
  header {
    position:fixed; top:0; left:260px; right:0; height:60px;
    background:var(--surface); backdrop-filter:blur(12px);
    display:flex; align-items:center; justify-content:space-between;
    padding:0 var(--padding); box-shadow:var(--shadow-light);
    transition:left var(--transition); z-index:1000;
  }
  header.sidebar-collapsed { left:72px; }
  header h1 { font-size:1.4rem; }
  .hamburger, .theme-toggle {
    font-size:1.5rem; color:var(--primary); cursor:pointer;
  }
  .hamburger:hover, .theme-toggle:hover { transform:scale(1.1); }

  /*────────────────── MAIN & HERO ──────────────────*/
  main { flex:1; margin-top:60px; padding:var(--padding); overflow-x:hidden; }
  .hero {
    position:relative; background:var(--surface); backdrop-filter:blur(12px);
    border-radius:var(--radius); padding:3rem var(--padding); text-align:center;
    box-shadow:var(--shadow-heavy); margin-bottom:2rem;
  }
  .hero h1 { font-size:2.75rem; color:var(--primary); margin-bottom:1rem; }
  .hero p  { font-size:1.2rem; color:var(--muted); margin-bottom:2rem; max-width:600px; margin-inline:auto; }
  .hero .actions {
    display:flex; flex-direction:column; gap:1rem; max-width:360px; margin-inline:auto;
  }
  .hero .actions a {
    background:var(--primary); color:#fff; padding:1rem; font-size:1rem;
    border-radius:var(--radius); box-shadow:var(--shadow-light);
    transition:transform var(--transition), background var(--transition);
  }
  .hero .actions a.btn-secondary { background:var(--secondary); }
  .hero .actions a:hover { transform:translateY(-3px); }
  .hero-icons {
    position:absolute; top:1rem; right:1rem; display:flex; flex-direction:column; gap:.5rem;
    font-size:2rem; opacity:0.15;
  }

  /*────────────────── MODULE SECTIONS ──────────────────*/
  section.module {
    background:var(--surface); backdrop-filter:blur(8px);
    border-radius:var(--radius); padding:var(--padding); margin-bottom:1.5rem;
    box-shadow:var(--shadow-light); transition:transform var(--transition);
  }
  section.module:hover { transform:translateY(-4px); }
  section.module h2 {
    display:flex; align-items:center; gap:.5rem;
    font-size:1.5rem; color:var(--primary); margin-bottom:.75rem;
  }
  section.module p.desc {
    color:var(--muted); font-size:1rem; margin-bottom:1rem;
  }

  /*────────────────── FORMS & INPUTS ──────────────────*/
  input[type="text"], input[type="number"], select, textarea {
    width:100%; padding:.75rem; border:1px solid var(--muted);
    border-radius:var(--radius); background:var(--accent); color:var(--text);
  }
  input:focus, textarea:focus, select:focus {
    border-color:var(--primary); box-shadow:0 0 8px var(--primary);
  }
  input[type="range"] {
    width:100%; accent-color:var(--primary);
  }
  .checkbox-group { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:.5rem; }
  fieldset { border:1px solid var(--muted); border-radius:var(--radius); padding:.75rem; }
  legend { padding:0 .5rem; font-weight:600; color:var(--secondary); }

  /*────────────────── BUTTONS ──────────────────*/
  button.btn {
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.75rem 1.25rem; border:none; border-radius:var(--radius);
    background:var(--primary); color:#fff; font-weight:600;
    box-shadow:var(--shadow-light); cursor:pointer;
    transition:background var(--transition), transform var(--transition), box-shadow var(--transition);
  }
  button.btn-secondary { background:var(--secondary); }
  button.btn:hover {
    transform:translateY(-2px); box-shadow:var(--shadow-heavy);
  }
  button.btn-secondary:hover {
    background:var(--primary-alt);
  }

  /*────────────────── RESPONSE PANELS ──────────────────*/
  .response {
    background:var(--surface); backdrop-filter:blur(8px);
    border-left:4px solid var(--secondary); padding:var(--padding);
    border-radius:var(--radius); margin-top:1rem; box-shadow:var(--shadow-light);
    position:relative;
  }
  .response .result-content { white-space:pre-wrap; line-height:1.5; }
  .close-btn {
    position:absolute; top:var(--padding); right:var(--padding);
    background:none; border:none; font-size:1.2rem; color:var(--secondary);
    cursor:pointer;
  }
  .tool-row {
    position:absolute; bottom:var(--padding); right:var(--padding);
    display:flex; gap:.5rem;
  }
  .tool-row button {
    background:var(--surface); border:1px solid var(--muted); border-radius:50%;
    width:1.6rem; height:1.6rem; display:flex; align-items:center; justify-content:center;
    cursor:pointer; transition:transform var(--transition);
  }
  .tool-row button:hover { transform:scale(1.1); }

  /*────────────────── CHATBOT UI ──────────────────*/
  .chat-box {
    background:var(--bg); border:1px solid var(--muted);
    border-radius:var(--radius); padding:var(--padding);
    max-height:300px; overflow-y:auto; display:flex; flex-direction:column;
  }
  .user-msg, .bot-msg {
    max-width:75%; padding:.75rem 1rem; margin:.5rem 0; border-radius:1rem; position:relative;
  }
  .user-msg { background:var(--primary); color:#fff; align-self:flex-end; }
  .bot-msg  { background:var(--accent); color:var(--text); align-self:flex-start; }
  .timestamp {
    font-size:.65rem; color:var(--muted); position:absolute; bottom:-1.2rem; right:1rem;
  }

    /*────────────────── MOOD TRACKER OVERRIDES ──────────────────*/
#moodTracker {
  background: var(--surface);
  backdrop-filter: blur(10px);
  border: 2px solid var(--primary-alt);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  position: relative;
}
#moodTracker h2 {
  font-size: 1.6rem;
  color: var(--primary);
  margin-bottom: 0.75rem;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#moodTracker .desc {
  font-style: italic;
  color: var(--muted);
  margin-bottom: 1.25rem;
}

/* Mood slider */
#moodRange {
  margin-top: 0.5rem;
  margin-bottom: 1rem;
}
#moodValue {
  display: inline-block;
  background: var(--primary);
  color: #fff;
  padding: 0.2em 0.5em;
  border-radius: 0.4rem;
  font-weight: bold;
}

/* Fieldsets */
#moodTracker fieldset {
  border: 1px solid var(--primary-alt);
  background: rgba(255,255,255,0.3);
  box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}
#moodTracker legend {
  font-size: 0.95rem;
  color: var(--primary);
  padding: 0 .5rem;
}

/* Checkboxes */
#moodTracker .checkbox-group label {
  background: var(--accent);
  border-radius: var(--radius);
  padding: 0.5rem;
  transition: background var(--transition);
}
#moodTracker .checkbox-group input:checked + i,
#moodTracker .checkbox-group input:checked + span {
  color: var(--primary);
}
#moodTracker .checkbox-group label:hover {
  background: rgba(255,255,255,0.5);
}

/* Textarea & select */
#moodTracker textarea,
#moodTracker select {
  min-height: 3.5rem;
  font-size: 0.95rem;
  border: 1px solid var(--primary-alt);
}

/* Submit button */
#moodTracker button[type="submit"] {
  background: var(--secondary);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: transform var(--transition), background var(--transition);
}
#moodTracker button[type="submit"]:hover {
  background: var(--primary-alt);
  transform: translateY(-3px);
}

/* Response panel */
#moodPanel.response {
  border-color: var(--secondary);
  padding: calc(var(--padding) * 1.5);
}
#moodPanel .result-content {
  font-size: 1rem;
  line-height: 1.6;
}
#moodPanel .close-btn {
  color: var(--primary-alt);
}
#moodPanel .tool-row button {
  background: var(--accent);
  transition: background var(--transition), transform var(--transition);
}
#moodPanel .tool-row button:hover {
  background: var(--surface);
  transform: scale(1.2);
}


/*────────────────── DREAM EXPLORER OVERRIDES ──────────────────*/
#dream {
  background: var(--surface);
  backdrop-filter: blur(10px);
  border: 2px dashed var(--secondary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
}
#dream h2 {
  font-size: 1.6rem;
  color: var(--secondary);
  margin-bottom: 0.75rem;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#dream .desc {
  font-style: italic;
  color: var(--muted);
  margin-bottom: 1.25rem;
}

/* Dream narrative textarea */
#dream textarea {
  min-height: 5rem;
  border: 1px solid var(--secondary);
}

/* File upload button */
#dream .dream-block input[type="file"] {
  display: block;
  margin-bottom: 0.5rem;
}
#dream .dream-block button {
  background: var(--secondary);
  color: #fff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
#dream .dream-block button:hover {
  background: var(--primary-alt);
}

/* Checkbox symbols */
#dream .checkbox-group label {
  background: var(--accent);
  border: 1px solid var(--secondary);
  border-radius: var(--radius);
  padding: 0.5rem;
  transition: background var(--transition), transform var(--transition);
}
#dream .checkbox-group input:checked + i,
#dream .checkbox-group input:checked + span {
  color: var(--secondary);
  transform: scale(1.1);
}
#dream .checkbox-group label:hover {
  background: rgba(255,255,255,0.5);
}

/* Pre/post mood selects */
#dream select {
  border: 1px solid var(--secondary);
  margin-bottom: 1rem;
}

/* Contextual tags input */
#dream input[type="text"]#dreamTags {
  border: 1px solid var(--secondary);
  background: var(--accent);
  padding: 0.75rem;
  border-radius: var(--radius);
}

/* Reflection textarea */
#dream textarea#dreamReflect {
  min-height: 4rem;
  border: 1px solid var(--secondary);
}

/* Dream action buttons */
.dream-actions button {
  background: var(--secondary);
  color: #fff;
  border-radius: var(--radius);
  padding: 0.75rem 1.25rem;
  box-shadow: var(--shadow-light);
  transition: transform var(--transition), background var(--transition);
}
.dream-actions button.btn-secondary {
  background: var(--primary-alt);
}
.dream-actions button:hover {
  transform: translateY(-3px);
}

/* Dream response panel */
#dreamPanel.response {
  border-color: var(--secondary);
  padding: calc(var(--padding) * 1.5);
}
#dreamPanel .result-content {
  font-size: 1rem;
  line-height: 1.6;
}
#dreamPanel .close-btn {
  color: var(--secondary);
}
#dreamPanel .tool-row button {
  background: var(--accent);
  transition: transform var(--transition);
}
#dreamPanel .tool-row button:hover {
  transform: scale(1.2);
}
    
  /*────────────────── CHARTS ──────────────────*/
  .charts {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:1.5rem; margin-top:1rem;
  }
  .chart-card {
    background:var(--surface); backdrop-filter:blur(8px);
    border-radius:var(--radius); padding:var(--padding);
    box-shadow:var(--shadow-light); display:flex; flex-direction:column;
  }
  .chart-card canvas { flex:1; }

  /*────────────────── RESPONSIVE ──────────────────*/
  @media (max-width:1024px) {
    header { padding:0 .5rem; }
    .hero { padding:2rem .75rem; }
  }
  @media (max-width:640px) {
    .hero h1 { font-size:2rem; }
    section.module { padding:.75rem; }
    .hero-icons { display:none; }
    .checkbox-group { grid-template-columns:1fr; }
  }
</style>
</head>

  <body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-brain"></i><span>Vitra AI</span></div>
    <nav>
      <a href="index.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
      <a href="psychology.html" class="active"><i class="fas fa-brain"></i><span>Psych &amp; MH</span></a>
      <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
      <a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i><span>Consult Booking</span></a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
  </aside>

  <!-- HEADER -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>Psychology &amp; Mental Health</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- MAIN CONTENT -->
  <main>

    <!-- HERO (stacked) -->
    <section class="hero" id="hero">
      <h1><i class="fas fa-brain"></i> Empower Your Mind with AI</h1>
      <p>Discover multimodal insights, therapeutic chats, creative therapies, and more—powered by advanced AI.</p>
      <div class="actions" style="flex-direction:column; gap:1rem; max-width:400px; margin:0 auto;">
        <a href="#therapybot" class="btn btn-primary"><i class="fas fa-comments"></i> Talk to Therapy Bot</a>
        <a href="#insight"      class="btn btn-secondary"><i class="fas fa-wave-square"></i> Emotional Insight</a>
        <a href="#creative"     class="btn btn-primary"><i class="fas fa-palette"></i> Creative Therapies</a>
        <a href="#games"        class="btn btn-secondary"><i class="fas fa-gamepad"></i> Cognitive Games</a>
      </div>
      <div class="hero-icons" style="position:absolute; top:1rem; right:1rem; opacity:0.2; font-size:2rem;">
        <i class="fas fa-cloud"></i>
        <i class="fas fa-moon"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-lightbulb"></i>
      </div>
    </section>

    <!-- 1. Therapy Bot with extra inputs -->
    <section class="module" id="therapybot">
      <h2><i class="fas fa-robot"></i> 1. Conversational “Therapy Bot”</h2>
      <p class="desc">Engage in guided CBT, mindfulness, or emotional support—choose your path and let the AI adapt.</p>
      <form id="therapy-form" style="display:grid; gap:1rem;">
        <label>Modality:
          <select id="therapyModality">
            <option value="CBT">CBT Exercises</option>
            <option value="mindfulness">Mindfulness</option>
            <option value="emotional">Emotional Support</option>
            <option value="guidedImagery">Guided Imagery</option>
          </select>
        </label>
        <label>Session Length:
          <select id="therapyLength">
            <option>5 minutes</option>
            <option>10 minutes</option>
            <option>20 minutes</option>
          </select>
        </label>
        <label>Language:
          <select id="therapyLang">
            <option>English</option>
            <option>Spanish</option>
            <option>French</option>
          </select>
        </label>
        <div style="display:flex; gap:0.5rem;">
          <input id="therapyInput" type="text" placeholder="Describe what you need…" />
          <button id="sendChat" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
        </div>
      </form>
      <div id="chatBox" class="chat-box"></div>
      <div id="chatHint" class="desc" style="display:none;">Bot is thinking… <span class="spinner"></span></div>
    </section>

    <!-- 2. Multimodal Emotional Insight with extra features -->
    <section class="module" id="insight">
      <h2><i class="fas fa-wave-square"></i> 2. Multimodal Emotional Insight</h2>
      <p class="desc">Record voice, upload a selfie, or type your thoughts to get sentiment, tone, and stress analysis.</p>
      <div class="insight-controls" style="display:flex; flex-wrap:wrap; gap:1rem;">
        <button id="startVideo"      class="btn btn-primary"><i class="fas fa-video"></i> Record Video</button>
        <button id="uploadAudio"     class="btn btn-secondary"><i class="fas fa-microphone"></i> Upload Audio</button>
        <button id="uploadImage"     class="btn btn-primary"><i class="fas fa-camera"></i> Upload Selfie</button>
        <button id="typingAnalysis"  class="btn btn-secondary"><i class="fas fa-keyboard"></i> Type Analysis</button>
      </div>
      <textarea id="insightNotes" rows="3" placeholder="Or write your feelings…"></textarea>
      <button id="runInsight" class="btn btn-primary"><i class="fas fa-play"></i> Analyze</button>
      <div id="insightPanel" class="response" hidden></div>
    </section>

    <!-- 3. Daily Mood Tracker -->
<section class="module" id="moodTracker">
  <h2><i class="fas fa-sliders-h"></i> 3. Daily Mood Tracker</h2>
  <p class="desc">
    Consistent mood logging helps you and our AI detect patterns, triggers, and early warning signs.  
    Empower yourself with insights and personalized self-care tips.
  </p>
  <form id="mood-form">
    <!-- Mood Rating -->
    <label for="moodRange">Mood Rating: <strong><span id="moodValue">5</span>/10</strong></label>
    <input type="range" id="moodRange" name="mood" min="1" max="10" value="5" />

    <!-- Emotions Tags -->
    <fieldset>
      <legend>Select all that apply:</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" name="emotions" value="Happy"> <i class="far fa-smile"></i> Happy</label>
        <label><input type="checkbox" name="emotions" value="Sad"> <i class="far fa-frown"></i> Sad</label>
        <label><input type="checkbox" name="emotions" value="Anxious"> <i class="fas fa-exclamation-triangle"></i> Anxious</label>
        <label><input type="checkbox" name="emotions" value="Calm"> <i class="fas fa-water"></i> Calm</label>
        <label><input type="checkbox" name="emotions" value="Angry"> <i class="fas fa-fire"></i> Angry</label>
        <label><input type="checkbox" name="emotions" value="Motivated"> <i class="fas fa-bolt"></i> Motivated</label>
      </div>
    </fieldset>

    <!-- Triggers Checklist -->
    <fieldset>
      <legend>Potential Triggers:</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" name="triggers" value="Work"> Work</label>
        <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
        <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
        <label><input type="checkbox" name="triggers" value="Health"> Health</label>
        <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
        <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
      </div>
    </fieldset>

    <!-- Quick Journal -->
    <label for="moodNote">Quick Journal Entry:</label>
    <textarea id="moodNote" name="note" rows="3" placeholder="How are you feeling? What happened today?"></textarea>

    <!-- Self-Care Suggestion -->
    <label for="selfCare">Self-Care Focus:</label>
    <select id="selfCare" name="selfCare">
      <option disabled selected>Select an area…</option>
      <option value="Breathing">Guided Breathing</option>
      <option value="Stretching">Stretch & Movement</option>
      <option value="Mindfulness">Mindfulness Pause</option>
      <option value="Music">Music Break</option>
      <option value="Walk">Short Walk</option>
    </select>

    <!-- Submit -->
    <button type="submit" class="btn btn-primary"><i class="fas fa-chart-line"></i> Analyze Mood</button>
  </form>

  <!-- AI Response Panel -->
  <div id="moodPanel" class="response" hidden>
    <button class="close-btn" aria-label="Close result"><i class="fas fa-times"></i></button>
    <div class="result-content"></div>
    <div class="tool-row">
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"   title="Download"><i class="fas fa-download"></i></button>
    </div>
  </div>
</section>


    <!-- 4. Dream & Subconscious Explorer -->
 <section class="module" id="dream">
  <h2><i class="fas fa-bed"></i> 4. Dream &amp; Subconscious Explorer</h2>
  <p class="desc">
    Dive into the depths of your nightly mind—capture narratives, symbols, emotions, and ambient sounds.
    Our AI weaves them together to surface hidden patterns, archetypes, and personalized insights.
  </p>

  <!-- 1. Dream Narrative -->
  <div class="dream-block">
    <h3><i class="fas fa-feather-alt"></i> Dream Narrative</h3>
    <p class="mini-desc">Write down every detail you remember—characters, colors, emotions, settings.</p>
    <textarea id="dreamText" rows="4" placeholder="“I found myself… ”"></textarea>
  </div>

  <!-- 2. Audio Capture -->
  <div class="dream-block">
    <h3><i class="fas fa-microphone-alt"></i> Nighttime Audio (Optional)</h3>
    <p class="mini-desc">Upload or record sounds (breathing, ambient noise) to enrich context.</p>
    <input type="file" id="dreamAudio" accept="audio/*"/>
    <button class="btn btn-secondary" onclick="startRecording()">
      <i class="fas fa-record-vinyl"></i> Record 30s
    </button>
  </div>

  <!-- 3. Symbol & Theme Selector -->
  <div class="dream-block">
    <h3><i class="fas fa-swatchbook"></i> Symbols &amp; Themes</h3>
    <p class="mini-desc">Tick any motifs you noticed; add your own too.</p>
    <fieldset>
      <legend>Common Symbols</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" value="water"/> <i class="fas fa-water"></i> Water</label>
        <label><input type="checkbox" value="flight"/> <i class="fas fa-wind"></i> Flight</label>
        <label><input type="checkbox" value="teeth"/> <i class="fas fa-tooth"></i> Teeth</label>
        <label><input type="checkbox" value="chase"/> <i class="fas fa-running"></i> Being Chased</label>
        <label><input type="checkbox" value="falling"/> <i class="fas fa-arrow-down"></i> Falling</label>
        <label>
          <input type="checkbox" id="otherSymbolChk"/> <i class="fas fa-plus"></i> Other:
          <input type="text" id="otherSymbol" placeholder="Your symbol"/>
        </label>
      </div>
    </fieldset>
  </div>

  <!-- 4. Pre-Sleep & Wake Mood -->
  <div class="dream-block">
    <h3><i class="fas fa-smile-beam"></i> Mood Before Sleep</h3>
    <p class="mini-desc">How did you feel drifting off?</p>
    <select id="preMood">
      <option disabled selected>Select mood…</option>
      <option>Calm</option><option>Anxious</option><option>Neutral</option><option>Excited</option><option>Sad</option><option>Other…</option>
    </select>

    <h3 style="margin-top:1rem;"><i class="fas fa-sun"></i> Mood On Waking</h3>
    <p class="mini-desc">How did you feel upon awakening?</p>
    <select id="postMood">
      <option disabled selected>Select mood…</option>
      <option>Refreshed</option><option>Tired</option><option>Confused</option><option>Inspired</option><option>Anxious</option><option>Other…</option>
    </select>
  </div>

  <!-- 5. Contextual Tags -->
  <div class="dream-block">
    <h3><i class="fas fa-tags"></i> Contextual Tags</h3>
    <p class="mini-desc">Add keywords: stressors, events, people, places.</p>
    <input type="text" id="dreamTags" placeholder="e.g. exam, hometown, graduation"/>
  </div>

  <!-- 6. Free-form Reflection -->
  <div class="dream-block">
    <h3><i class="fas fa-lightbulb"></i> Reflection &amp; Intentions</h3>
    <p class="mini-desc">What do you think this dream means? Set intentions for tomorrow.</p>
    <textarea id="dreamReflect" rows="3" placeholder="My reflection…"></textarea>
  </div>

  <!-- Action Buttons -->
 <div class="dream-actions">
    <button id="analyzeDream"   class="btn btn-primary"><i class="fas fa-brain"></i> Analyze Dream</button>
    <button id="interpretSymbols" class="btn btn-secondary"><i class="fas fa-search"></i> Interpret Symbols</button>
    <button id="generatePrompts"  class="btn btn-secondary"><i class="fas fa-pen-nib"></i> Generate Writing Prompts</button>
  </div>

  <!-- AI Response Panel -->
  <div id="dreamPanel" class="response" hidden>
    <button class="close-btn" aria-label="Close dream insights">&times;</button>
    <div class="tool-row">
      <button title="Copy"><i class="fas fa-copy"></i></button>
      <button title="Download"><i class="fas fa-download"></i></button>
    </div>
    <div class="result-content"></div>
  </div>
</section>
    <!-- 5. AI-Curated Creative Therapies expanded -->
    <section class="module" id="creative">
      <h2><i class="fas fa-palette"></i> 3. AI-Curated Creative Therapies</h2>
      <p class="desc">Generate art, music, poetry or guided journaling prompts—all tailored to your mood and style.</p>
      <form id="creative-form" style="display:grid; gap:1rem;">
        <label>Therapy Type:
          <select id="creativeType">
            <option value="art">Abstract Art</option>
            <option value="music">Soundscape</option>
            <option value="poetry">Poetry</option>
            <option value="journaling">Journaling Prompts</option>
          </select>
        </label>
        <label>Style:
          <select id="creativeStyle">
            <option>Calm & Soft</option>
            <option>Vibrant & Bold</option>
            <option>Mystical</option>
            <option>Minimalist</option>
          </select>
        </label>
        <label>Detail Level:
          <input type="range" id="creativeDetail" min="1" max="10" value="5" />
        </label>
        <button id="artEmotion" class="btn btn-primary"><i class="fas fa-brush"></i> Generate</button>
      </form>
      <div id="creativePanel" class="response" hidden></div>
    </section>

    <!-- 6. Dynamic Cognitive Games expanded -->
    <section class="module" id="games">
      <h2><i class="fas fa-gamepad"></i> 4. Dynamic Cognitive Games</h2>
      <p class="desc">Adaptive puzzles, memory challenges, and story co-creation to train attention, memory, and creativity.</p>
      <form id="games-form" style="display:grid; gap:1rem;">
        <label>Game Type:
          <select id="gameType">
            <option value="puzzle">Logic Puzzle</option>
            <option value="memory">Memory Match</option>
            <option value="story">Collaborative Story</option>
          </select>
        </label>
        <label>Difficulty:
          <select id="gameDifficulty">
            <option>Easy</option><option>Medium</option><option>Hard</option>
          </select>
        </label>
        <button id="puzzles" class="btn btn-primary"><i class="fas fa-puzzle-piece"></i> Start</button>
      </form>
      <div id="gamesPanel" class="response" hidden></div>
    </section>

    <!-- 7. Predictive Risk & Early Warning with extra settings -->
    <section class="module" id="risk">
      <h2><i class="fas fa-chart-line"></i> 5. Predictive Risk &amp; Early Warning</h2>
      <p class="desc">Continuously monitor patterns and get alerts when risk thresholds are crossed.</p>
      <form id="risk-form" style="display:grid; gap:1rem;">
        <label>Alert Threshold (%):
          <input type="number" id="riskThreshold" min="1" max="100" value="75" />
        </label>
        <label>Notify Via:
          <select id="riskNotify">
            <option>Email</option>
            <option>SMS</option>
            <option>In-App</option>
          </select>
        </label>
        <button id="crisisAlerts" class="btn btn-primary"><i class="fas fa-bell"></i> Enable Alerts</button>
      </form>
      <div id="riskPanel" class="response" hidden></div>
    </section>

    <!-- 8. Personalized Self-Care Plans with scheduling -->
    <section class="module" id="selfcare">
      <h2><i class="fas fa-heart"></i> 6. Personalized Self-Care Plans</h2>
      <p class="desc">AI-generated daily routines, reminders, and habit tracking to keep you on track.</p>
      <form id="selfcare-form" style="display:grid; gap:1rem;">
        <label>Focus Area:
          <select id="selfcareFocus">
            <option>Breathing Exercises</option>
            <option>Stretch & Movement</option>
            <option>Mindfulness Breaks</option>
            <option>Creative Pause</option>
          </select>
        </label>
        <label>Reminder Time:
          <input type="time" id="selfcareTime" />
        </label>
        <button id="activitySuggest" class="btn btn-primary"><i class="fas fa-lightbulb"></i> Generate Plan</button>
      </form>
      <div id="selfcarePanel" class="response" hidden></div>
    </section>

    <!-- 9. Virtual Reality Micro-Therapies choices -->
    <section class="module" id="vr">
      <h2><i class="fas fa-vr-cardboard"></i> 7. Virtual Reality Micro-Therapies</h2>
      <p class="desc">Immerse yourself in calm landscapes or graded exposure in VR to manage anxiety and fears.</p>
      <form id="vr-form" style="display:grid; gap:1rem;">
        <label>Environment:
          <select id="vrEnvironment">
            <option>Forest</option><option>Beach</option><option>Mountain</option><option>Custom</option>
          </select>
        </label>
        <label>Duration:
          <select id="vrDuration">
            <option>2 minutes</option><option>5 minutes</option><option>10 minutes</option>
          </select>
        </label>
        <button id="phobiaSim" class="btn btn-primary"><i class="fas fa-exclamation-triangle"></i> Launch</button>
      </form>
      <div id="vrPanel" class="response" hidden></div>
    </section>

    <!-- 10. Integrated Professional Ecosystem -->
    <section class="module" id="pro">
      <h2><i class="fas fa-toolbox"></i> 8. Integrated Professional Ecosystem</h2>
      <p class="desc">For clinicians: secure note-taking, referral management, and session analytics.</p>
      <form id="pro-form" style="display:grid; gap:1rem;">
        <label>Upload Session Notes (txt/json):
          <input type="file" id="proUpload" accept=".txt,.json" />
        </label>
        <label>Referral Preference:
          <select id="proReferral">
            <option>Immediate</option><option>Standard</option><option>Low Priority</option>
          </select>
        </label>
        <button id="clinicianToolkit" class="btn btn-primary"><i class="fas fa-file-alt"></i> Process</button>
      </form>
      <div id="proPanel" class="response" hidden></div>
    </section>

    <!-- 11. Medication Management & Safety -->
    <section class="module" id="medsafety">
      <h2><i class="fas fa-pills"></i> 9. Medication Management &amp; Safety</h2>
      <p class="desc">Enter your current medications, check interactions, set adherence reminders.</p>
      <form id="medsafety-form" style="display:grid; gap:1rem;">
        <label>Medications (comma-separated):
          <input type="text" id="medList" placeholder="e.g. Sertraline, Ibuprofen" />
        </label>
        <button id="medInteraction" class="btn btn-primary"><i class="fas fa-exchange-alt"></i> Check Interactions</button>
        <button id="adherence" class="btn btn-secondary"><i class="fas fa-check-circle"></i> Set Reminders</button>
      </form>
      <div id="medsafetyPanel" class="response" hidden></div>
    </section>

    <!-- 12. Symptom Questionnaire -->
    <section class="module" id="symptomQuiz">
      <h2><i class="fas fa-clipboard-list"></i> 10. Symptom Questionnaire</h2>
      <p class="desc">Answer a brief standardized survey; AI will score severity and suggest next steps.</p>
      <form id="quiz-form" style="display:grid; gap:1rem;">
        <label>Sleep Quality:
          <select name="sleep"><option>Poor</option><option>Fair</option><option>Good</option></select>
        </label>
        <label>Appetite:
          <select name="appetite"><option>Low</option><option>Normal</option><option>High</option></select>
        </label>
        <label>Concentration:
          <select name="concentration"><option>Impaired</option><option>Average</option><option>Sharp</option></select>
        </label>
        <button id="launchQuiz" class="btn btn-primary"><i class="fas fa-play"></i> Submit & Analyze</button>
      </form>
      <div id="quizPanel" class="response" hidden></div>
    </section>

    <!-- 13. Community & Peer Support -->
    <section class="module" id="community">
      <h2><i class="fas fa-users"></i> 11. Community &amp; Peer Support</h2>
      <p class="desc">Join moderated circles, host topic rooms, or get a check-in from Buddy Bot.</p>
      <form id="community-form" style="display:grid; gap:1rem;">
        <label>Topic:
          <select id="communityTopic">
            <option>Anxiety</option><option>Depression</option><option>Motivation</option><option>Mindfulness</option>
          </select>
        </label>
        <label><input type="checkbox" id="anonToggle" /> Join Anonymously</label>
        <button id="supportCircles" class="btn btn-primary"><i class="fas fa-comments"></i> Enter Circle</button>
        <button id="buddyBot" class="btn btn-secondary"><i class="fas fa-user-friends"></i> Buddy Check-in</button>
      </form>
      <div id="communityPanel" class="response" hidden></div>
    </section>

    <!-- 14. Data Analytics & ROI -->
    <section class="module" id="analytics">
      <h2><i class="fas fa-chart-pie"></i> 12. Data Analytics &amp; ROI</h2>
      <p class="desc">Visualize your engagement, symptom changes, and export detailed reports.</p>
      <div class="charts">
        <div class="chart-card">
          <canvas id="engagementChart"></canvas>
          <figcaption>Sessions Over Time</figcaption>
        </div>
        <div class="chart-card">
          <canvas id="outcomeChart"></canvas>
          <figcaption>Outcome Metrics</figcaption>
        </div>
      </div>
      <div style="display:flex; gap:1rem; margin-top:1rem;">
        <label>Date Range:
          <input type="date" id="analyticsFrom" /> –
          <input type="date" id="analyticsTo" />
        </label>
        <button id="exportCharts" class="btn btn-primary"><i class="fas fa-file-export"></i> Export CSV</button>
      </div>
    </section>

    <!-- FOOTER -->
    <footer style="text-align:center; padding:1rem; background:var(--surface); color:var(--muted)">
      &copy; 2025 Vitra AI – Psychology &amp; Mental Health
    </footer>

  </main>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function callOpenAI(messages) {
  const res = await fetch('/.netlify/functions/openai-proxy', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages })
  });
  if (!res.ok) throw new Error('OpenAI error');
  const j = await res.json();
  return j.choices[0].message.content;
}

function formatHTML(txt) {
  return txt
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .split(/\n{2,}/).map(p => `<p>${p.trim()}</p>`).join('');
}

document.addEventListener('DOMContentLoaded', () => {
  const asideEl = document.getElementById('sidebar');
  const headerEl = document.querySelector('header');

  // ── SIDEBAR TOGGLE ─────────────────────────
  document.getElementById('hamburger').onclick = () => {
    asideEl.classList.toggle('collapsed');
    headerEl.classList.toggle('sidebar-collapsed');
  };
  document.getElementById('shrinkBtn').onclick = () => {
    asideEl.classList.toggle('collapsed');
    headerEl.classList.toggle('sidebar-collapsed');
  };

  // ── THEME TOGGLE ────────────────────────────
  document.getElementById('themeToggle').onclick = () => {
    document.documentElement.classList.toggle('dark');
    document.getElementById('themeToggle').classList.toggle('fa-sun');
  };

  // Utility: ensure panel exists
  function getPanel(sectionId) {
    const sec = document.getElementById(sectionId);
    let panel = sec.querySelector('.response');
    if (!panel) {
      panel = document.createElement('div');
      panel.className = 'response';
      sec.append(panel);
    }
    panel.hidden = false;
    return panel;
  }

  // Utility: wire any button to a generic prompt->AI flow
  function wire(btnId, systemPrompt, ask, sectionId) {
    document.getElementById(btnId).onclick = async () => {
      const panel = getPanel(sectionId);
      panel.innerHTML = `<div class="result-content">Processing <span class="spinner"></span></div>`;
      const inp = prompt(ask);
      if (!inp) {
        panel.innerHTML = '';
        return;
      }
      try {
        const reply = await callOpenAI([
          { role: 'system', content: systemPrompt },
          { role: 'user', content: inp }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
      attachPanelControls(panel);
    };
  }

  // After panel renders, wire up close / copy / download
  function attachPanelControls(panel) {
    // Close
    let btn = panel.querySelector('.close-btn');
    if (!btn) {
      btn = document.createElement('button');
      btn.className = 'close-btn';
      btn.innerHTML = '&times;';
      panel.append(btn);
    }
    btn.onclick = () => panel.hidden = true;

    // Copy
    let copy = panel.querySelector('.copy-btn');
    if (!copy) {
      copy = document.createElement('button');
      copy.className = 'tool-row copy-btn';
      copy.title = 'Copy';
      copy.innerHTML = '<i class="fas fa-copy"></i>';
      panel.append(copy);
    }
    copy.onclick = () => {
      navigator.clipboard.writeText(panel.querySelector('.result-content').innerText);
      copy.innerText = '✓';
      setTimeout(() => copy.innerHTML = '<i class="fas fa-copy"></i>', 1000);
    };

    // Download
    let dl = panel.querySelector('.dl-btn');
    if (!dl) {
      dl = document.createElement('button');
      dl.className = 'tool-row dl-btn';
      dl.title = 'Download';
      dl.innerHTML = '<i class="fas fa-download"></i>';
      panel.append(dl);
    }
    dl.onclick = () => {
      const text = panel.querySelector('.result-content').innerText;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'response.txt'; a.click();
      URL.revokeObjectURL(url);
    };
  }

  // ── THERAPY BOT ───────────────────────────────────
  const chatBox   = document.getElementById('chatBox'),
        chatHint  = document.getElementById('chatHint'),
        chatInput = document.getElementById('therapyInput');

  function addChat(who, text) {
    const msg = document.createElement('div');
    msg.className = who === 'You' ? 'user-msg' : 'bot-msg';
    msg.innerHTML = `${formatHTML(text)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
    chatBox.append(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  document.getElementById('sendChat').onclick = async e => {
    e.preventDefault();
    const txt = chatInput.value.trim();
    if (!txt) return;
    addChat('You', txt);
    chatInput.value = '';
    chatHint.style.display = 'block';

    const sys = `Therapy | Modality: ${document.getElementById('therapyModality').value}; Length: ${document.getElementById('therapyLength').value}; Language: ${document.getElementById('therapyLang').value}`;
    try {
      const reply = await callOpenAI([
        { role: 'system', content: sys },
        { role: 'user', content: txt }
      ]);
      addChat('Therapist', reply);
    } catch {
      addChat('Therapist', '⚠️ Something went wrong.');
    } finally {
      chatHint.style.display = 'none';
    }
  };

  // ── MOOD TRACKER ───────────────────────────────────
  const moodRange = document.getElementById('moodRange'),
        moodValue = document.getElementById('moodValue');
  moodRange.oninput = () => moodValue.textContent = moodRange.value;

  document.getElementById('mood-form').onsubmit = async e => {
    e.preventDefault();
    const panel = getPanel('moodTracker');
    panel.innerHTML = `<div class="result-content">Analyzing <span class="spinner"></span></div>`;
    const data = {
      mood: moodRange.value,
      emotions: [...document.querySelectorAll('input[name="emotions"]:checked')].map(c=>c.value),
      triggers: [...document.querySelectorAll('input[name="triggers"]:checked')].map(c=>c.value),
      note: document.getElementById('moodNote').value.trim(),
      selfCare: document.getElementById('selfCare').value
    };
    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You are a mood analysis assistant.' },
        { role: 'user', content: `Mood Entry: ${JSON.stringify(data)}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
    attachPanelControls(panel);
  };

  // ── DREAM EXPLORER ──────────────────────────────────
  const dreamAnalyze = document.getElementById('analyzeDream'),
        dreamInterp  = document.getElementById('interpretSymbols'),
        dreamPrompts = document.getElementById('generatePrompts');

  dreamAnalyze.onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Analyzing <span class="spinner"></span></div>`;
    const narrative = document.getElementById('dreamText').value.trim();
    const symbols   = [...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(c=>c.value).join(', ');
    const pre       = document.getElementById('preMood').value;
    const post      = document.getElementById('postMood').value;
    const tags      = document.getElementById('dreamTags').value.trim();
    const reflect   = document.getElementById('dreamReflect').value.trim();

    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You are a dream interpreter.' },
        { role: 'user', content:
            `Narrative: ${narrative}\nSymbols: ${symbols}\nBefore: ${pre}\nAfter: ${post}\nTags: ${tags}\nReflection: ${reflect}`
        }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Error.</div>`;
    }
    attachPanelControls(panel);
  };

  dreamInterp.onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Interpreting <span class="spinner"></span></div>`;
    const symbols = [...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(c=>c.value).join(', ');
    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You are a dream symbol expert.' },
        { role: 'user', content: `Symbols: ${symbols}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Error.</div>`;
    }
    attachPanelControls(panel);
  };

  dreamPrompts.onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Generating <span class="spinner"></span></div>`;
    const narrative = document.getElementById('dreamText').value.trim();
    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You generate journal prompts.' },
        { role: 'user', content: `Dream: ${narrative}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Error.</div>`;
    }
    attachPanelControls(panel);
  };

  // ── WIRE REMAINING MODULES ───────────────────────────
  wire('startVideo',      'Analyze video emotion',         'Paste video URL:',            'insight');
  wire('uploadAudio',     'Analyze audio emotion',         'Paste audio URL:',            'insight');
  wire('uploadImage',     'Analyze facial emotion',        'Paste image URL:',            'insight');
  wire('typingAnalysis',  'Analyze typing stress',         'Type a few sentences:',       'insight');
  wire('runInsight',      'Summarize text emotion',         'Paste text:',                 'insight');

  wire('artEmotion',      'Generate art for emotion',      'Enter an emotion:',           'creative');
  wire('musicMixer',      'Compose music for mood',        'Describe your mood:',         'creative');
  wire('puzzles',         'Create a logic puzzle',         'Enter a theme:',              'games');
  wire('storyBuilder',    'Continue a story',              'Enter a seed idea:',          'games');

  wire('crisisAlerts',    'Assess crisis risk',            'Describe feelings:',          'risk');
  wire('activitySuggest', 'Suggest self-care activities',  'Tell me your current state:', 'selfcare');
  wire('nudges',          'Schedule self-care reminders',  'What reminder would you like:', 'selfcare');

  wire('phobiaSim',       'Launch VR phobia environment',  'N/A',                          'vr');
  wire('mindscapes',      'Launch VR relaxation scene',    'N/A',                          'vr');

  wire('clinicianToolkit','Process clinician notes',       'Paste session notes:',         'pro');
  wire('referralPipeline','Match patient to therapist',    'Paste profile:',               'pro');

  wire('medInteraction',  'Check drug interactions',       'List medications (comma sep):','medsafety');
  wire('adherence',       'Set adherence reminders',       'What reminder time?',          'medsafety');

  wire('launchQuiz',      'Evaluate symptom quiz',         'Answer: sleep, appetite, concentration:', 'symptomQuiz');

  wire('supportCircles',  'Summarize community chat',      'Paste chat transcript:',       'community');
  wire('buddyBot',        'Send buddy check-in',           'Enter last mood:',             'community');

  // ── CHARTS & CSV EXPORT ───────────────────────────────
  const eng = new Chart(document.getElementById('engagementChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri'],
      datasets: [{ label:'Sessions', data:[12,9,14,11,13], borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary').trim(), fill:false }]
    }
  });
  const out = new Chart(document.getElementById('outcomeChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: ['Week1','Week2','Week3'],
      datasets: [{ label:'Outcome', data:[3.2,4.1,4.5], backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim() }]
    }
  });

  document.getElementById('exportCharts').onclick = () => {
    let csv = 'Chart,Label,Value\n';
    [['Sessions', eng], ['Outcome', out]].forEach(([name,c])=>{
      c.data.labels.forEach((lab,i)=> csv+=`${name},${lab},${c.data.datasets[0].data[i]}\n`);
    });
    const blob = new Blob([csv], { type:'text/csv' }), url = URL.createObjectURL(blob),
          a = document.createElement('a');
    a.href = url; a.download = 'analytics.csv'; a.click();
    URL.revokeObjectURL(url);
  };
});
</script>


</body>
</html>
