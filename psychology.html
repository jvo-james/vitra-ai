<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Neuropharma Command Center</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<style>
  /* Reset & Base Variables */
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  html {
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    scroll-behavior: smooth;

    /* Color Palette (Red primary, Blue secondary) */
    --primary: #E24A4A;          /* Vivid Red */
    --secondary: #4A90E2;        /* Bright Blue */
    --accent: #F3F6FB;           /* Soft Neutral */
    --bg: #F8F6F0;               /* Very Light Beige */
    --surface: #FFFFFF;          /* White */
    --text: #333333;             /* Dark Gray */
    --muted: #6B6B6B;            /* Medium Gray */

    /* Dark Mode Overrides */
    --bg-dark: #1F1F1F;
    --surface-dark: #2A2A2A;
    --text-dark: #ECECEC;
    --muted-dark: #888888;

    /* Spacing & Typography */
    --radius: 0.75rem;
    --padding: 1rem;
    --transition: 0.3s ease;

    /* Layout */
    --sidebar-w: 280px;
    --sidebar-collapsed-w: 80px;
    --header-h: 64px;
  }
  html.dark {
    --bg: var(--bg-dark);
    --surface: var(--surface-dark);
    --text: var(--text-dark);
    --muted: var(--muted-dark);
  }
  body {
    display: flex;
    min-height: 100vh;
    background: var(--bg);
    color: var(--text);
    overflow-x: hidden;
    transition: background var(--transition), color var(--transition);
  }
  a {
    color: var(--primary);
    text-decoration: none;
    transition: color var(--transition);
  }
  a:hover {
    color: var(--secondary);
  }
  img {
    max-width: 100%;
    display: block;
  }
  button {
    font-family: inherit;
  }
  ul, ol {
    list-style: none;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    SIDEBAR
  ──────────────────────────────────────────────────────────────────────────────*/
  aside#sidebar {
    flex: 0 0 var(--sidebar-w);
    position: sticky;
    top: 0;
    height: 100vh;
    background: var(--surface);
    box-shadow: 2px 0 12px rgba(0, 0, 0, 0.05);
    transition: flex var(--transition), background var(--transition);
    overflow: hidden;
    z-index: 1000;
    display: flex;
    flex-direction: column;
  }
  aside#sidebar .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: var(--padding);
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--primary);
  }
  aside#sidebar .logo svg {
    width: 1.8rem;
    height: 1.8rem;
    fill: var(--primary);
    transition: transform var(--transition);
  }
  aside#sidebar .logo:hover svg {
    transform: scale(1.1);
  }
  aside#sidebar .logo .logo-text {
    font-size: 1.4rem;
  }
  aside#sidebar nav {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  aside#sidebar nav a {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem var(--padding);
    border-radius: var(--radius);
    color: var(--text);
    font-weight: 500;
    transition: background var(--transition), padding-left var(--transition), color var(--transition);
  }
  aside#sidebar nav a i {
    font-size: 1.2rem;
    width: 1.2rem;
    text-align: center;
  }
  aside#sidebar nav a:hover,
  aside#sidebar nav a.active {
    background: var(--primary);
    color: #fff;
    padding-left: calc(var(--padding) + 0.5rem);
  }
  aside#sidebar nav a.active {
    font-weight: 700;
  }
  aside#sidebar.collapsed {
    flex: 0 0 var(--sidebar-collapsed-w);
  }
  aside#sidebar.collapsed .logo .logo-text,
  aside#sidebar.collapsed nav a span {
    display: none;
  }
  aside#sidebar.collapsed nav a {
    justify-content: center;
  }
  #shrinkBtn {
    position: absolute;
    bottom: var(--padding);
    left: 50%;
    transform: translateX(-50%);
    width: 36px;
    height: 36px;
    background: none;
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color var(--transition), border-color var(--transition), transform var(--transition);
  }
  #shrinkBtn:hover {
    color: var(--secondary);
    border-color: var(--secondary);
    transform: translateX(-50%) scale(1.1);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    HEADER
  ──────────────────────────────────────────────────────────────────────────────*/
  header {
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    height: var(--header-h);
    background: var(--surface);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--padding);
    z-index: 999;
    transition: left var(--transition), background var(--transition);
  }
  aside#sidebar.collapsed ~ header {
    left: var(--sidebar-collapsed-w);
  }
  header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text);
  }
  header .hamburger,
  header .theme-toggle {
    font-size: 1.4rem;
    color: var(--primary);
    cursor: pointer;
    transition: transform var(--transition), color var(--transition);
  }
  header .hamburger:hover,
  header .theme-toggle:hover {
    transform: scale(1.1);
    color: var(--secondary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    MAIN
  ──────────────────────────────────────────────────────────────────────────────*/
  main {
    flex: 1;
    padding: calc(var(--header-h) + var(--padding)) var(--padding) var(--padding);
    background: var(--bg);
    transition: background var(--transition);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    MODULE BASE STYLES
  ──────────────────────────────────────────────────────────────────────────────*/
  .module {
    background: var(--surface);
    border-radius: var(--radius);
    padding: var(--padding);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    margin-bottom: 1.5rem;
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .module:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  }
  .module h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    font-size: 1.25rem;
    color: var(--primary);
  }
  .module p.desc {
    font-size: 0.95rem;
    color: var(--muted);
    margin-bottom: 1rem;
  }
  .module form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-end;
  }
  .module form label {
    font-size: 0.95rem;
    color: var(--text);
    margin-bottom: 0.25rem;
    display: block;
    font-weight: 500;
  }
  .module form input,
  .module form select,
  .module form textarea {
    flex: 1 1 200px;
    padding: 0.75rem;
    border: 1.5px solid rgba(0, 0, 0, 0.1);
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    border-radius: var(--radius);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .module form input:focus,
  .module form select:focus,
  .module form textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  .module form button {
    background: var(--primary);
    color: #fff;
    padding: 0.7rem 1.4rem;
    border: none;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    border-radius: var(--radius);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .module form button:hover:not([disabled]) {
    transform: scale(1.03);
    box-shadow: 0 5px 14px rgba(0, 0, 0, 0.12);
    background: var(--secondary);
  }
  .module form button[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .hint {
    width: 100%;
    font-size: 0.85rem;
    color: var(--muted);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    RESPONSE PANEL
  ──────────────────────────────────────────────────────────────────────────────*/
  .response {
    background: rgba(226, 74, 74, 0.1);
    border-left: 4px solid var(--secondary);
    padding: var(--padding);
    border-radius: var(--radius);
    margin-top: 1rem;
    position: relative;
    transition: background var(--transition);
  }
  .response .close-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: none;
    color: var(--secondary);
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
    transition: color var(--transition), transform var(--transition);
  }
  .response .close-btn:hover {
    color: var(--primary);
    transform: scale(1.1);
  }
  .response .result-content {
    margin-top: 1.5rem; /* leave space for close button above */
    color: var(--text);
    line-height: 1.5;
  }
  .tool-row {
    position: static;
    margin-top: 1rem;
    display: flex;
    gap: 0.5rem;
  }
  .tool-row button {
    font-size: 0.85rem;
    width: 1.6rem;
    height: 1.6rem;
    padding: 0.2rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  .tool-row button:hover {
    background: var(--primary);
    color: #fff;
    transform: scale(1.1);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    HERO SECTION
  ──────────────────────────────────────────────────────────────────────────────*/
  .hero-module {
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: left;
    border-radius: var(--radius);
    padding: 4rem 2rem;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    transition: background var(--transition), box-shadow var(--transition);
  }
  .hero-module:hover {
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  }
  .hero-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    gap: 2rem;
  }
  .hero-content {
    flex: 1;
    padding-right: 2rem;
  }
  .hero-content h1 {
    font-size: 2.8rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary);
  }
  .hero-subtitle {
    font-size: 1.1rem;
    margin-bottom: 2rem;
    color: var(--muted);
  }
  .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }
  .hero-actions .btn-primary,
  .hero-actions .btn-secondary,
  .hero-actions .btn-tertiary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-radius: var(--radius);
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border: none;
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  .hero-actions .btn-primary {
    background: var(--primary);
    color: #fff;
  }
  .hero-actions .btn-secondary {
    background: var(--secondary);
    color: #fff;
  }
  .hero-actions .btn-tertiary {
    background: var(--accent);
    color: var(--primary);
    border: 2px solid var(--primary);
  }
  .hero-actions a:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  .hero-image {
    flex: 1;
    text-align: right;
  }
  .hero-image img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    transition: transform var(--transition), box-shadow var(--transition);
  }
  .hero-image img:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  }
  .hero-bg-icon {
    position: absolute;
    font-size: 9rem;
    color: rgba(226, 74, 74, 0.05);
    pointer-events: none;
    user-select: none;
    transition: color var(--transition);
  }
  html.dark .hero-bg-icon {
    color: rgba(243, 246, 251, 0.05);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    CHATBOT SECTION
  ──────────────────────────────────────────────────────────────────────────────*/
  #therapybot .chat-controls {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  #therapybot .chat-controls button {
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }
  #therapybot .chat-controls button:hover {
    background: var(--primary);
    color: #fff;
    transform: scale(1.1);
  }
  .chat-box {
    background: var(--bg);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: var(--radius);
    padding: var(--padding);
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
    transition: background var(--transition), border-color var(--transition);
  }
  .user-msg,
  .bot-msg {
    max-width: 80%;
    margin: 0.5rem 0;
    padding: 0.8rem 1rem;
    border-radius: 1.2rem;
    position: relative;
    transition: background var(--transition), color var(--transition);
  }
  .user-msg {
    background: var(--primary);
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 0.2rem;
  }
  .bot-msg {
    background: rgba(74, 144, 226, 0.1);
    color: var(--text);
    align-self: flex-start;
    border-bottom-left-radius: 0.2rem;
  }
  html.dark .bot-msg {
    background: var(--surface-dark);
    color: var(--text-dark);
  }
  .timestamp {
    font-size: 0.7rem;
    position: absolute;
    bottom: -1.2rem;
    right: 0.8rem;
    color: var(--muted);
  }
  .chat-date-separator {
    text-align: center;
    margin: 0.75rem 0;
    font-weight: bold;
    color: var(--muted);
    user-select: none;
  }
  .chat-input-row {
    display: flex;
    gap: 0.5rem;
  }
  .chat-input-row input {
    flex: 1 1 100%;
    padding: 0.8rem 1rem;
    border: 1px solid var(--muted);
    border-radius: var(--radius);
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .chat-input-row input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }
  .chat-input-row button {
    background: var(--primary);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: background var(--transition), transform var(--transition);
  }
  .chat-input-row button:hover {
    transform: scale(1.1);
    background: var(--secondary);
  }
  #chatHint {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /*──────────────────────────────────────────────────────────────────────────────
    “Other” INPUTS
  ──────────────────────────────────────────────────────────────────────────────*/
  .other-input {
    display: none;
    margin-top: 0.5rem;
    padding: 0.75rem;
    border: 1.5px solid #d1dce5;
    background: var(--bg);
    color: var(--text);
    font-size: 0.95rem;
    border-radius: var(--radius);
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .other-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    CHARTS & ANALYTICS
  ──────────────────────────────────────────────────────────────────────────────*/
  .charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.25rem;
    margin-top: 1rem;
  }
  .chart-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: box-shadow var(--transition);
  }
  .chart-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  }
  .chart-card canvas {
    flex: 1 1 auto;
    width: 100% !important;
    height: 200px !important;
  }
  .chart-card figcaption {
    padding: 0.5rem 0.75rem;
    background: var(--bg);
    font-size: 0.9rem;
    color: var(--text);
  }
  .chart-desc {
    padding: 0 0.75rem 0.75rem;
    font-size: 0.85rem;
    color: var(--muted);
  }
  #exportCharts {
    margin-top: 1rem;
    background: var(--primary);
    color: #fff;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: background var(--transition), transform var(--transition);
    cursor: pointer;
  }
  #exportCharts:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    “Meet an Expert” SECTION
  ──────────────────────────────────────────────────────────────────────────────*/
  .meet-module {
    background: linear-gradient(135deg, rgba(226, 74, 74, 0.1), rgba(74, 144, 226, 0.1));
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    border-radius: var(--radius);
    margin-bottom: 2rem;
  }
  .meet-content {
    display: flex;
    align-items: center;
    max-width: 900px;
    width: 100%;
    gap: 2rem;
  }
  .meet-icon {
    flex: 0 0 80px;
    height: 80px;
    background: var(--primary);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  .meet-text h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: var(--secondary);
    line-height: 1.2;
  }
  .meet-text p {
    font-size: 1rem;
    margin-bottom: 1rem;
    color: var(--text);
    line-height: 1.4;
  }
  .btn-schedule {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    color: #fff;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 1rem;
    transition: transform var(--transition), box-shadow var(--transition);
  }
  .btn-schedule:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    FOOTER
  ──────────────────────────────────────────────────────────────────────────────*/
  footer {
    background: var(--surface);
    padding: var(--padding);
    text-align: center;
    font-size: 0.85rem;
    color: var(--muted);
    margin-top: 2rem;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
  }
  footer a {
    color: var(--primary);
    text-decoration: none;
    margin: 0 0.5rem;
    transition: color var(--transition);
  }
  footer a:hover {
    color: var(--secondary);
  }

  /*──────────────────────────────────────────────────────────────────────────────
    SPINNER ICON
  ──────────────────────────────────────────────────────────────────────────────*/
  .spinner {
    display: inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid var(--primary);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    vertical-align: middle;
    margin-left: 0.25em;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /*──────────────────────────────────────────────────────────────────────────────
    RESPONSIVE (TABLETS & PHONES)
  ──────────────────────────────────────────────────────────────────────────────*/
  @media (max-width: 1024px) {
    aside#sidebar {
      position: fixed !important;
      transform: translateX(-100%);
      z-index: 900;
      flex: 0 0 var(--sidebar-w);
    }
    aside#sidebar.open {
      transform: translateX(0);
    }
    header {
      left: 0 !important;
    }
  }
  @media (max-width: 768px) {
    .hero-inner {
      flex-direction: column;
      gap: 2rem;
    }
    .hero-content {
      padding-right: 0;
    }
    .hero-content h1 {
      font-size: 2.2rem;
    }
    .charts {
      grid-template-columns: 1fr !important;
    }
    .chart-card {
      height: auto;
    }
    .hero-subtitle,
    .module p.desc {
      font-size: 0.95rem;
    }
  }
  @media (max-width: 640px) {
    form,
    .chat-input-row {
      flex-direction: column;
      gap: 0.75rem;
    }
    input, select, textarea, button {
      width: 100% !important;
    }
    .chart-card canvas {
      height: 180px !important;
    }
    .hero-content h1 {
      font-size: 2rem;
    }
    #shrinkBtn {
      bottom: 0.5rem;
    }
    aside#sidebar:not(.open) {
      display: none;
    }
  }
  @media (max-width: 480px) {
    input, select, textarea, button {
      font-size: 0.9rem;
    }
    .hero-content h1 {
      font-size: 1.8rem;
      flex-direction: column;
    }
    .hero-actions {
      flex-direction: column;
    }
    .hero-actions a {
      width: 100%;
      justify-content: center;
    }
    .chat-box {
      max-height: 220px;
    }
  }

   /*──────────────────────── History Modal ─────────────────────────────────*/
  .history-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }

  .history-content {
    background: var(--surface-light);
    border-radius: var(--radius);
    padding: 1.5rem;
    width: 90%;
    max-width: 700px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 12px 60px rgba(0, 0, 0, 0.2);
    position: relative;
  }

  .history-content h3 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: var(--primary);
  }

  .history-table-wrapper {
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }

  .history-table th,
  .history-table td {
    border-bottom: 1px solid var(--muted-light);
    padding: 0.5rem;
    text-align: left;
  }

  .history-table th {
    background: var(--primary-light);
    color: #fff;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  .history-table thead tr:first-child th {
    background: var(--primary);
  }

  .history-table tbody tr:hover {
    background: var(--accent-light);
  }

  .del-msg {
    background: none;
    border: none;
    color: var(--muted-light);
    cursor: pointer;
    font-size: 1.1rem;
    transition: color var(--transition);
  }

  .del-msg:hover {
    color: var(--primary);
  }

  .history-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    position: sticky;
    bottom: 0;
    background: var(--surface-light);
    padding-top: 0.5rem;
  }

  .history-actions button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: var(--radius);
    background: var(--primary);
    color: #fff;
    font-weight: 500;
    cursor: pointer;
    transition: background var(--transition), transform var(--transition);
  }

  .history-actions .clear-history {
    background: var(--secondary);
  }

  .history-actions button:hover {
    transform: translateY(-2px);
    filter: brightness(1.1);
  }
 /*──────────────────────── Copy Toast ─────────────────────────────────*/
  .copy-toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    font-size: 0.95rem;
    animation: fade-in-out 2s ease forwards;
    z-index: 2000;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
    10% { opacity: 1; transform: translateX(-50%) translateY(0); }
    90% { opacity: 1; }
    100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
  }

   .checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
  }
  /* When “Other” checkbox is checked, show the text field */
.checkbox-group input[type="checkbox"][value="Other"]:checked ~ 
input.other-input {
  display: block;
  width: 100%;
}
  /* Container around the two buttons (already .chat-controls or .tool-row) */
#therapybot .chat-controls {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

/* Base styling for those icon-buttons */
#therapybot .chat-controls button {
  width: 36px;
  height: 36px;
  background: var(--surface);
  border: 2px solid var(--secondary);  /* blue outline */
  color: var(--secondary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  transition: background var(--transition), color var(--transition), transform var(--transition);
}

/* On hover, invert colors */
#therapybot .chat-controls button:hover {
  background: var(--secondary);
  color: #fff;
  transform: scale(1.1);
}

/* If you want one to be “history” (blue) and one “clear” (red), override: */
#viewHistory {
  border-color: var(--secondary);
  color: var(--secondary);
}
#viewHistory:hover {
  background: var(--secondary);
  color: #fff;
}

#clearChat {
  border-color: var(--primary);
  color: var(--primary);
}
#clearChat:hover {
  background: var(--primary);
  color: #fff;
}

</style>


  
<body>
  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="logo">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="var(--primary)">
        <polygon points="10,10 25,90 50,40 75,90 90,10 65,10 50,70 35,10"/>
      </svg>
      <span class="logo-text">Vitra AI</span>
    </div>
    <nav role="navigation">
      <a href="herbal.html">
        <i class="fas fa-seedling"></i>
        <span>Herbal Medicine</span>
      </a>
      <a href="psychology.html" class="active">
        <i class="fas fa-brain"></i>
        <span>Psych & Mental Health</span>
      </a>
      <a href="dietetics.html">
        <i class="fas fa-utensils"></i>
        <span>Dietetics</span>
      </a>
      <a href="pharmacy.html">
        <i class="fas fa-prescription-bottle-alt"></i>
        <span>E-Pharmacy</span>
      </a>
      <a href="consult.html">
        <i class="fas fa-calendar-check"></i>
        <span>Consultation Booking</span>
      </a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar">
      <i class="fas fa-angle-double-left"></i>
    </button>
  </aside>
<!-- MAIN CONTENT -->
  <main role="main">
  <!-- HEADER -->
  <header>
    <div class="header-left">
      <i id="hamburger" class="fas fa-bars hamburger" aria-label="Toggle navigation"></i>
      <h1>Neuropharma Command Center</h1>
    </div>
    <div class="header-right">
      <i id="themeToggle" class="fas fa-moon theme-toggle" aria-label="Toggle theme"></i>
    </div>
  </header>

  
    <!-- HERO SECTION -->
    <section id="hero" class="module hero-module">
      <div class="hero-inner">
        <div class="hero-content">
          <h1><i class="fas fa-brain"></i> Empower Your Mental Wellness</h1>
          <p class="hero-subtitle">
            Combine AI-driven therapy, mood tracking, neurochemical insights, and pharmacogenomics—all in one place.
          </p>
          <div class="hero-actions">
            <a href="#therapybot" class="btn-primary">
              <i class="fas fa-comments"></i> Therapy Bot
            </a>
            
           
            <a href="#pharmacogenomics" class="btn-primary">
              <i class="fas fa-dna"></i> Pharmaco-Genomics
            </a>
            
            <a href="#eeg" class="btn-primary">
              <i class="fas fa-wave-square"></i> EEG Analysis
            </a>
          
          </div>
        </div>
        <div class="hero-image">
          <img src="mental.jpg" alt="Neuro and mental wellness illustration">
        </div>
      </div>
      <i class="fas fa-microscope hero-bg-icon" style="top: 8%; left: 7%;"></i>
      <i class="fas fa-pills hero-bg-icon" style="top: 5%; right: 9%;"></i>
      <i class="fas fa-wave-square hero-bg-icon" style="bottom: 10%; left: 12%;"></i>
      <i class="fas fa-chart-line hero-bg-icon" style="bottom: 8%; right: 15%;"></i>
    </section>

    <!-- 1. Conversational Therapy Bot -->
    <section id="therapybot" class="module">
      <h2><i class="fas fa-robot"></i> Conversational Therapy Bot</h2>
      <p class="desc">
        Choose a modality, duration, and language—then chat with our AI-powered therapist.  
        Spinners show when the AI is thinking.
      </p>
      <form id="therapy-form" class="chat-form">
        <div class="form-row">
          <label for="therapyModality">Modality</label>
          <select id="therapyModality" required>
            <option value="CBT">CBT Exercises</option>
            <option value="Mindfulness">Mindfulness</option>
            <option value="Emotional">Emotional Support</option>
            <option value="GuidedImagery">Guided Imagery</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="therapyModalityOther" class="other-input" placeholder="Please specify modality…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="therapyLength">Length</label>
          <select id="therapyLength" required>
            <option>5 minutes</option>
            <option>10 minutes</option>
            <option>20 minutes</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="therapyLengthOther" class="other-input" placeholder="Please specify length…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="therapyLang">Language</label>
          <select id="therapyLang" required>
            <option>English</option>
            <option>Spanish</option>
            <option>French</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="therapyLangOther" class="other-input" placeholder="Please specify language…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="therapyInput">Your Topic</label>
          <input id="therapyInput" type="text" placeholder="Describe what you need…" required>
        </div>
        <button id="sendChat" class="btn-primary" type="submit">
          <i class="fas fa-paper-plane"></i> Send
        </button>
      </form>

      <div class="tool-row chat-tools">
        <button id="viewHistory" class="copy-btn" title="View History"><i class="fas fa-history"></i></button>
        <button id="clearChat" class="dl-btn" title="Clear Chat"><i class="fas fa-trash"></i></button>
      </div>

      <div id="chatBox" class="chat-box" role="log" aria-live="polite"></div>
      <div id="chatHint" class="chat-spinner" style="display:none;">
        <i class="fas fa-spinner fa-spin"></i> AI is thinking…
      </div>
    </section>

    <!-- 2. Daily Mood Tracker -->
    <section id="moodTracker" class="module">
      <h2><i class="fas fa-sliders-h"></i> Daily Mood Tracker</h2>
      <p class="desc">
        Log your mood, emotions, triggers, and journal entry—AI spots patterns and suggests self-care tips.
      </p>
      <form id="mood-form">
        <div class="form-row">
          <label for="moodRange">Mood Score: <strong><span id="moodValue">5</span>/10</strong></label>
          <input type="range" id="moodRange" min="1" max="10" value="5">
        </div>
        <fieldset>
          <legend>Emotions (select up to 20)</legend>
          <div class="checkbox-group emotions-group">
            <label><input type="checkbox" name="emotions" value="Happy"> Happy</label>
            <label><input type="checkbox" name="emotions" value="Sad"> Sad</label>
            <label><input type="checkbox" name="emotions" value="Anxious"> Anxious</label>
            <label><input type="checkbox" name="emotions" value="Calm"> Calm</label>
            <label><input type="checkbox" name="emotions" value="Angry"> Angry</label>
            <label><input type="checkbox" name="emotions" value="Motivated"> Motivated</label>
            <label><input type="checkbox" name="emotions" value="Stressed"> Stressed</label>
            <label><input type="checkbox" name="emotions" value="Relaxed"> Relaxed</label>
            <label><input type="checkbox" name="emotions" value="Focused"> Focused</label>
            <label><input type="checkbox" name="emotions" value="Overwhelmed"> Overwhelmed</label>
            <label><input type="checkbox" name="emotions" value="Bored"> Bored</label>
            <label><input type="checkbox" name="emotions" value="Confident"> Confident</label>
            <label><input type="checkbox" name="emotions" value="Nervous"> Nervous</label>
            <label><input type="checkbox" name="emotions" value="Lonely"> Lonely</label>
            <label><input type="checkbox" name="emotions" value="Hopeful"> Hopeful</label>
            <label><input type="checkbox" name="emotions" value="Frustrated"> Frustrated</label>
            <label><input type="checkbox" name="emotions" value="Joyful"> Joyful</label>
            <label><input type="checkbox" name="emotions" value="Dull"> Dull</label>
            <label><input type="checkbox" name="emotions" value="Energetic"> Energetic</label>
            <label><input type="checkbox" name="emotions" value="Tired"> Tired</label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Triggers (select up to 20)</legend>
          <div class="checkbox-group triggers-group">
            <label><input type="checkbox" name="triggers" value="Work"> Work</label>
            <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
            <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
            <label><input type="checkbox" name="triggers" value="Health"> Health</label>
            <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
            <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
            <label><input type="checkbox" name="triggers" value="Exercise"> Exercise</label>
            <label><input type="checkbox" name="triggers" value="Family"> Family</label>
            <label><input type="checkbox" name="triggers" value="Social"> Social</label>
            <label><input type="checkbox" name="triggers" value="Weather"> Weather</label>
            <label><input type="checkbox" name="triggers" value="Noise"> Noise</label>
            <label><input type="checkbox" name="triggers" value="Light"> Light</label>
            <label><input type="checkbox" name="triggers" value="Crowds"> Crowds</label>
            <label><input type="checkbox" name="triggers" value="Traffic"> Traffic</label>
            <label><input type="checkbox" name="triggers" value="Media"> Media</label>
            <label><input type="checkbox" name="triggers" value="Pets"> Pets</label>
            <label><input type="checkbox" name="triggers" value="Home"> Home</label>
            <label><input type="checkbox" name="triggers" value="Commute"> Commute</label>
            <label><input type="checkbox" name="triggers" value="Finances"> Finances</label>
            <label><input type="checkbox" name="triggers" value="Other"> Other</label>
          </div>
          <input type="text" id="moodTriggersOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </fieldset>
        <div class="form-row">
          <label for="moodNote">Journal Entry</label>
          <textarea id="moodNote" rows="3" placeholder="What happened today?" style="margin-bottom:1rem;"></textarea>
        </div>
        <div class="form-row">
          <label for="selfCare">Self-Care Focus</label>
          <select id="selfCare" required>
            <optgroup label="Breathing & Relaxation">
              <option>Guided Breathing</option>
              <option>Progressive Muscle Relaxation</option>
            </optgroup>
            <optgroup label="Movement">
              <option>Stretch & Walk</option>
              <option>Yoga Flow</option>
            </optgroup>
            <optgroup label="Mindfulness">
              <option>Body Scan</option>
              <option>Sound Meditation</option>
            </optgroup>
            <optgroup label="Creative">
              <option>Music Break</option>
              <option>Art Prompt</option>
            </optgroup>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="selfCareOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <button type="submit" class="btn-primary">
          <i class="fas fa-chart-line"></i> Analyze Mood
        </button>
      </form>
      <div id="moodPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <!-- 3. Neurotransmitter Balance -->
    <section id="neurotransmitter" class="module">
      <h2><i class="fas fa-vial"></i> Neurotransmitter Balance</h2>
      <p class="desc">
        Integrate mood, sleep, appetite, and medication adherence—AI reveals neurochemical insights.
      </p>
      <form id="nt-form">
        <div class="form-row">
          <label for="ntMood">Mood (1–10)</label>
          <input type="range" id="ntMood" min="1" max="10" value="5">
        </div>
        <div class="form-row">
          <label for="ntSleep">Sleep Quality</label>
          <select id="ntSleep" required>
            <option>Poor</option>
            <option>Fair</option>
            <option>Good</option>
            <option>Excellent</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="ntSleepOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="ntAppetite">Appetite</label>
          <select id="ntAppetite" required>
            <option>Low</option>
            <option>Normal</option>
            <option>High</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="ntAppetiteOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="ntAdherence">Medication Adherence</label>
          <select id="ntAdherence" required>
            <option>Poor</option>
            <option>Fair</option>
            <option>Good</option>
            <option>Excellent</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="ntAdherenceOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="ntFocus">Focus Neurotransmitter</label>
          <select id="ntFocus" required>
            <option>Serotonin</option>
            <option>Dopamine</option>
            <option>GABA</option>
            <option>Glutamate</option>
            <option>Acetylcholine</option>
            <option>Histamine</option>
            <option>Oxytocin</option>
            <option>Vasopressin</option>
            <option>Endorphins</option>
            <option>Melatonin</option>
            <option>Cortisol</option>
            <option>Adrenaline</option>
            <option>Noradrenaline</option>
            <option>Enkephalins</option>
            <option>Substance P</option>
            <option>Dynorphin</option>
            <option>Glycine</option>
            <option>Aspartate</option>
            <option>Endocannabinoids</option>
            <option>Neuropeptide Y</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="ntFocusOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <button id="analyzeNeuro" class="btn-primary" type="submit">
          <i class="fas fa-brain"></i> Analyze Balance
        </button>
      </form>
      <div id="neurotransmitterPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 4. Pharmacogenomics & Dosing -->
    <section id="pharmacogenomics" class="module">
      <h2><i class="fas fa-dna"></i> Pharmacogenomics &amp; Dosing</h2>
      <p class="desc">
        Upload your genotype file and enter clinical details—AI provides personalized dosing recommendations.
      </p>
      <form id="pgx-form">
        <div class="form-row">
          <label for="pgxUpload">Upload Genotype (VCF)</label>
          <input type="file" id="pgxUpload" accept=".vcf,.txt" required>
        </div>
        <div class="form-row">
          <label for="pgxSex">Sex</label>
          <select id="pgxSex" required>
            <option>Male</option>
            <option>Female</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="pgxSexOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="pgxAge">Age</label>
          <input type="number" id="pgxAge" min="0" required placeholder="Years">
        </div>
        <div class="form-row">
          <label for="pgxWeight">Weight (kg)</label>
          <input type="number" id="pgxWeight" min="1" placeholder="kg">
        </div>
        <div class="form-row">
          <label for="pgxDrug">Drug</label>
          <select id="pgxDrug" required>
            <option>Clopidogrel</option>
            <option>Warfarin</option>
            <option>Codeine</option>
            <option>Citalopram</option>
            <option>Sertraline</option>
            <option>Fluoxetine</option>
            <option>Risperidone</option>
            <option>Lithium</option>
            <option>Valproate</option>
            <option>Lamotrigine</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="pgxDrugOther" class="other-input" placeholder="Enter drug…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="pgxGene">Gene Variant</label>
          <select id="pgxGene" required>
            <option>CYP2C19*1</option>
            <option>CYP2C19*2</option>
            <option>CYP2C19*3</option>
            <option>CYP2D6*1</option>
            <option>CYP2D6*4</option>
            <option>TPMT*1</option>
            <option>UGT1A1*28</option>
            <option>VKORC1</option>
            <option>MTHFR C677T</option>
            <option>HLA-B*57:01</option>
            <option>SLCO1B1*5</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="pgxGeneOther" class="other-input" placeholder="Enter variant…" style="display:none;">
        </div>
        <button id="runPGx" class="btn-primary" type="submit">
          <i class="fas fa-flask"></i> Run Analysis
        </button>
      </form>
      <div id="pharmacogenomicsPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 5. Drug Interaction Profiler -->
    <section id="interactions" class="module">
      <h2><i class="fas fa-exchange-alt"></i> Drug Interaction Profiler</h2>
      <p class="desc">
        Enter current medications and comorbid conditions—AI checks for interaction risks.
      </p>
      <form id="int-form">
        <div class="form-row">
          <label for="intListSelect">Medications</label>
          <select id="intListSelect" required>
            <option>Sertraline</option>
            <option>Fluoxetine</option>
            <option>Paroxetine</option>
            <option>Escitalopram</option>
            <option>Venlafaxine</option>
            <option>Duloxetine</option>
            <option>Risperidone</option>
            <option>Quetiapine</option>
            <option>Lithium</option>
            <option>Valproate</option>
            <option>Lamotrigine</option>
            <option>Carbamazepine</option>
            <option>Topiramate</option>
            <option>Gabapentin</option>
            <option>Pregabalin</option>
            <option>Clonazepam</option>
            <option>Diazepam</option>
            <option>Alprazolam</option>
            <option>Buspirone</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="intListOther" class="other-input" placeholder="Enter medication…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="intComorbid">Comorbid Conditions</label>
          <select id="intComorbid" required>
            <option>Schizophrenia</option>
            <option>Bipolar Disorder</option>
            <option>Depression</option>
            <option>OCD</option>
            <option>Anxiety</option>
            <option>Autism</option>
            <option>ADHD</option>
            <option>Dementia</option>
            <option>Alzheimer’s</option>
            <option>Parkinson’s</option>
            <option>PTSD</option>
            <option>Epilepsy</option>
            <option>Insomnia</option>
            <option>Substance Use</option>
            <option>Anorexia</option>
            <option>Bulimia</option>
            <option>Phobia</option>
            <option>Psychosis</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="intComorbidOther" class="other-input" placeholder="Enter condition…" style="display:none;">
        </div>
        <button id="checkInt" class="btn-primary" type="submit">
          <i class="fas fa-pills"></i> Check Interactions
        </button>
      </form>
      <div id="interactionsPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 6. EEG & Brainwave Interpreter -->
    <section id="eeg" class="module">
      <h2><i class="fas fa-wave-square"></i> EEG &amp; Brainwave Interpreter</h2>
      <p class="desc">
        Upload EEG data—AI decodes patterns and suggests cognitive insights.
      </p>
      <form id="eeg-form">
        <div class="form-row">
          <label for="eegFile">Upload EEG File (EDF/CSV)</label>
          <input type="file" id="eegFile" accept=".edf,.csv" required>
        </div>
        <div class="form-row">
          <label for="eegCondition">Condition/Task</label>
          <select id="eegCondition" required>
            <option>Resting Eyes Closed</option>
            <option>Resting Eyes Open</option>
            <option>Sleep Stage 1</option>
            <option>Sleep Stage 2</option>
            <option>REM Sleep</option>
            <option>Meditation</option>
            <option>Reading</option>
            <option>Stress Task</option>
            <option>Typing</option>
            <option>Video Watching</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="eegConditionOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <button id="analyzeEEG" class="btn-primary" type="submit">
          <i class="fas fa-microchip"></i> Analyze EEG
        </button>
      </form>
      <div id="eegPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 7. Clinical Trial Matcher -->
    <section id="trialmatch" class="module">
      <h2><i class="fas fa-handshake"></i> Clinical Trial Matcher</h2>
      <p class="desc">
        Describe your diagnosis and location—AI suggests relevant clinical trials.
      </p>
      <form id="trial-form">
        <div class="form-row">
          <label for="trialDx">Diagnosis</label>
          <select id="trialDx" required>
            <option>Anxiety</option>
            <option>Depression</option>
            <option>Schizophrenia</option>
            <option>Bipolar Disorder</option>
            <option>ADHD</option>
            <option>PTSD</option>
            <option>OCD</option>
            <option>Insomnia</option>
            <option>Autism</option>
            <option>Parkinson’s</option>
            <option>Alzheimer’s</option>
            <option>Epilepsy</option>
            <option>Migraine</option>
            <option>Dementia</option>
            <option>Substance Use</option>
            <option>Phobia</option>
            <option>Anorexia</option>
            <option>Bulimia</option>
            <option>Borderline Personality</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="trialDxOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <div class="form-row">
          <label for="trialLoc">Location</label>
          <input id="trialLoc" type="text" placeholder="City, Country" required>
        </div>
        <div class="form-row">
          <label for="trialPhase">Trial Phase</label>
          <select id="trialPhase" required>
            <option>Phase I</option>
            <option>Phase II</option>
            <option>Phase III</option>
            <option>Phase IV</option>
            <option>First-in-Human</option>
            <option>Proof-of-Concept</option>
            <option>Open-Label</option>
            <option>Randomized</option>
            <option>Double-Blind</option>
            <option>Placebo-Controlled</option>
            <option>Adaptive Design</option>
            <option>Dose-Escalation</option>
            <option>Biomarker Study</option>
            <option>Observational</option>
            <option>Longitudinal</option>
            <option>Cross-Over</option>
            <option>Basket Trial</option>
            <option>Umbrella Trial</option>
            <option>N-of-1 Trial</option>
            <option value="Other">Other</option>
          </select>
          <input type="text" id="trialPhaseOther" class="other-input" placeholder="Please specify…" style="display:none;">
        </div>
        <button id="findTrials" class="btn-primary" type="submit">
          <i class="fas fa-search"></i> Find Trials
        </button>
      </form>
      <div id="trialmatchPanel" class="response" hidden>
        <button class="close-btn" aria-label="Close result">×</button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 8. Data Analytics & ROI -->
    <section id="analytics" class="module">
      <h2><i class="fas fa-chart-pie"></i> Data Analytics &amp; ROI</h2>
      <p class="desc">
        Visualize engagement, outcomes, and export CSV reports for your practice metrics.
      </p>
      <div class="charts">
        <figure class="chart-card">
          <canvas id="engagementChart"></canvas>
          <figcaption><strong>Engagement Over Time:</strong> Number of therapy sessions per week.</figcaption>
        </figure>
        <figure class="chart-card">
          <canvas id="outcomeChart"></canvas>
          <figcaption><strong>Outcome Metrics:</strong> Average improvement scores month over month.</figcaption>
        </figure>
      </div>
      <button id="exportCharts" class="btn-primary">Export CSV</button>
    </section>

    <!-- MEET A THERAPY EXPERT -->
    <section id="meet-expert" class="module meet-module">
      <div class="meet-content">
        <div class="meet-icon">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="meet-text">
          <h2>Meet a<br>Mental Health Expert</h2>
          <p>
            Get one-on-one guidance from our licensed therapists. Discover personalized treatment plans, expert medication advice, and evidence-based strategies.
          </p>
          <a href="consult.html" class="btn-schedule">
            <i class="fas fa-calendar-check"></i> Schedule Consultation
          </a>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <p>&copy; 2025 Vitra AI – Neuropharma Command Center. <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms & Conditions</a></p>
    </footer>
  </main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  //──────────────────────── Utility Functions ────────────────────────────────
  // Sanitize user-provided strings
  function escapeHtml(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // Convert simple markdown to HTML
  function formatHTML(text) {
    if (!text) return "";
    return text
      .replace(/^######\s*(.+)$/gm, "<h6>$1</h6>")
      .replace(/^#####\s*(.+)$/gm, "<h5>$1</h5>")
      .replace(/^####\s*(.+)$/gm, "<h4>$1</h4>")
      .replace(/^###\s*(.+)$/gm, "<h3>$1</h3>")
      .replace(/^##\s*(.+)$/gm, "<h2>$1</h2>")
      .replace(/^#\s*(.+)$/gm, "<h1>$1</h1>")
      .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
      .replace(/\*(.+?)\*/g, "<em>$1</em>")
      .replace(/`([^`]+)`/g, "<code>$1</code>")
      .split(/\n{2,}/)
      .map(p => `<p>${p.trim()}</p>`)
      .join("");
  }

  // Append a close button to a response panel
  function addClose(panel) {
    if (panel.querySelector(".close-btn")) return;
    const btn = document.createElement("button");
    btn.className = "close-btn";
    btn.setAttribute("aria-label", "Close result");
    btn.textContent = "×";
    btn.onclick = () => (panel.hidden = true);
    panel.prepend(btn);
  }

  // Add copy and download tools to a panel
  function addTools(panel) {
    if (panel.querySelector(".tool-row")) return;
    const tools = document.createElement("div");
    tools.className = "tool-row";
    tools.innerHTML = `
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>`;
    panel.append(tools);

    const copyBtn = tools.querySelector(".copy-btn");
    const dlBtn = tools.querySelector(".dl-btn");
    const contentDiv = panel.querySelector(".result-content");

    copyBtn.onclick = () => {
      if (!contentDiv) return;
      navigator.clipboard.writeText(contentDiv.innerText || "");
      const toast = document.createElement("div");
      toast.className = "copy-toast";
      toast.textContent = "Copied!";
      document.body.append(toast);
      setTimeout(() => toast.remove(), 1500);
    };

    dlBtn.onclick = () => {
      if (!contentDiv) return;
      const text = contentDiv.innerText || "";
      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "response.txt";
      document.body.append(a);
      a.click();
      URL.revokeObjectURL(url);
      a.remove();
    };
  }

  // Call OpenAI via proxy
  async function callOpenAI(messages) {
    try {
      const response = await fetch("/.netlify/functions/openai-proxy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages })
      });
      if (!response.ok) throw new Error("OpenAI request failed");
      const data = await response.json();
      return data.choices?.[0]?.message?.content.trim() || "";
    } catch (err) {
      console.error(err);
      throw err;
    }
  }

  // Helper: get select value or the corresponding other-input if "Other"
  function getSelectValue(select) {
    const other = select.parentElement.querySelector(".other-input");
    if (other && select.value === "Other") {
      return other.value.trim();
    }
    return select.value;
  }

  document.addEventListener("DOMContentLoaded", () => {
    //──────────────────────── Persisted Theme ────────────────────────────────
    const savedTheme = localStorage.getItem("vitra-theme");
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark");
      document.documentElement.setAttribute("aria-theme", "dark");
      document.getElementById("themeToggle").classList.replace("fa-moon", "fa-sun");
    }

    //──────────────────────── Sidebar & Hamburger ─────────────────────────────
    const sidebar = document.getElementById("sidebar");
    const shrinkBtn = document.getElementById("shrinkBtn");
    const hamburger = document.getElementById("hamburger");

    shrinkBtn.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      const icon = shrinkBtn.querySelector("i");
      icon.classList.toggle("fa-angle-double-left");
      icon.classList.toggle("fa-angle-double-right");
      localStorage.setItem("sidebar-collapsed", sidebar.classList.contains("collapsed"));
      document.querySelector("header").classList.toggle("sidebar-collapsed");
    });

    if (localStorage.getItem("sidebar-collapsed") === "true") {
      sidebar.classList.add("collapsed");
      shrinkBtn.querySelector("i").classList.replace("fa-angle-double-left", "fa-angle-double-right");
      document.querySelector("header").classList.add("sidebar-collapsed");
    }

    hamburger.addEventListener("click", () => {
      sidebar.classList.toggle("open");
    });

    document.addEventListener("click", (e) => {
      if (!sidebar.classList.contains("open")) return;
      if (sidebar.contains(e.target) || hamburger.contains(e.target)) return;
      sidebar.classList.remove("open");
    });

    const mq = window.matchMedia("(max-width: 1024px)");
    function updateHamburgerVisibility() {
      hamburger.style.display = mq.matches ? "block" : "none";
    }
    mq.addListener(updateHamburgerVisibility);
    updateHamburgerVisibility();

    //──────────────────────── Theme Toggle ───────────────────────────────────
    const themeToggle = document.getElementById("themeToggle");
    themeToggle.addEventListener("click", () => {
      const htmlEl = document.documentElement;
      const isDark = htmlEl.classList.toggle("dark");
      themeToggle.classList.toggle("fa-sun", isDark);
      themeToggle.classList.toggle("fa-moon", !isDark);
      htmlEl.setAttribute("aria-theme", isDark ? "dark" : "light");
      localStorage.setItem("vitra-theme", isDark ? "dark" : "light");
    });

    //──────────────────────── "Other" Select Handler ─────────────────────────
    function setupOtherField(selectId, otherInputId) {
      const sel = document.getElementById(selectId);
      const other = document.getElementById(otherInputId);
      sel.addEventListener("change", () => {
        if (sel.value === "Other") {
          other.style.display = "block";
          other.required = true;
        } else {
          other.style.display = "none";
          other.required = false;
        }
      });
      sel.dispatchEvent(new Event("change"));
    }
    // Therapy Bot selects
    setupOtherField("therapyModality", "therapyModalityOther");
    setupOtherField("therapyLength", "therapyLengthOther");
    setupOtherField("therapyLang", "therapyLangOther");
    // Mood Tracker self-care
    setupOtherField("selfCare", "selfCareOther");
    // Mood Tracker triggers single "Other" input
    const triggersGroup = document.querySelectorAll('#moodTracker input[name="triggers"]');
    const moodTriggersOther = document.getElementById("moodTriggersOther");
    triggersGroup.forEach(cb => {
      cb.addEventListener("change", () => {
        if ([...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')]
              .some(c => c.value === "Other")) {
          moodTriggersOther.style.display = "block";
          moodTriggersOther.required = true;
        } else {
          moodTriggersOther.style.display = "none";
          moodTriggersOther.required = false;
        }
      });
    });

    // Neurotransmitter selects
    ["ntSleep", "ntAppetite", "ntAdherence", "ntFocus"].forEach(id => {
      setupOtherField(id, id + "Other");
    });

    // PGx selects
    ["pgxSex", "pgxDrug", "pgxGene"].forEach(id => {
      setupOtherField(id, id + "Other");
    });

    // Interaction selects
    setupOtherField("intListSelect", "intListOther");
    setupOtherField("intComorbid", "intComorbidOther");

    // EEG select
    setupOtherField("eegCondition", "eegConditionOther");

    // Trial Matcher selects
    setupOtherField("trialDx", "trialDxOther");
    setupOtherField("trialPhase", "trialPhaseOther");

    //──────────────────────── Restore Persisted Panels ────────────────────────
    const panelMap = {
      therapybot: "therapybotPanel", // not used as ID; therapy bot panel is chat, no panel to restore
      moodTracker: "moodPanel",
      neurotransmitter: "neurotransmitterPanel",
      pharmacogenomics: "pharmacogenomicsPanel",
      interactions: "interactionsPanel",
      eeg: "eegPanel",
      trialmatch: "trialmatchPanel"
    };
    Object.values(panelMap).forEach((pid) => {
      const saved = localStorage.getItem(pid);
      if (saved) {
        const panel = document.getElementById(pid);
        panel.innerHTML = saved;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
        panel.querySelectorAll(".close-btn").forEach(btn => {
          btn.onclick = () => panel.hidden = true;
        });
      }
    });

    //──────────────────────── Therapy Bot ─────────────────────────────────────
    (function() {
      const chatBox = document.getElementById("chatBox");
      const chatInput = document.getElementById("therapyInput");
      const therapyModality = document.getElementById("therapyModality");
      const therapyLength = document.getElementById("therapyLength");
      const therapyLang = document.getElementById("therapyLang");
      const chatHint = document.getElementById("chatHint");
      let lastDateHeader = null;

      let chatHistory = JSON.parse(localStorage.getItem("therapyChatHistory") || "[]");

      function formatDateSeparator(date) {
        const today = new Date();
        const diff = Math.floor((today.setHours(0,0,0,0) - date.setHours(0,0,0,0)) / 86400000);
        if (diff === 0) return "Today";
        if (diff === 1) return "Yesterday";
        return date.toLocaleDateString();
      }

      function addMessage(who, text, timestamp = new Date()) {
        const msgDate = timestamp instanceof Date ? timestamp : new Date(timestamp);
        const msgDay = msgDate.toDateString();
        if (msgDay !== lastDateHeader) {
          const sep = document.createElement("div");
          sep.className = "chat-date-separator";
          sep.textContent = formatDateSeparator(msgDate);
          chatBox.append(sep);
          lastDateHeader = msgDay;
        }
        const msgDiv = document.createElement("div");
        msgDiv.className = who === "You" ? "user-msg" : "bot-msg";
        msgDiv.innerHTML = `
          ${formatHTML(text)}
          <div class="timestamp">${msgDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true })}</div>
        `;
        chatBox.append(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Render saved history
      chatHistory.forEach(m => addMessage(m.who, m.text, new Date(m.timestamp)));

      document.getElementById("sendChat").addEventListener("click", async (e) => {
        e.preventDefault();
        const userText = chatInput.value.trim();
        if (!userText) return;
        const userTime = new Date();
        addMessage("You", userText, userTime);
        chatHistory.push({ who: "You", text: userText, timestamp: userTime.toISOString() });
        localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
        chatInput.value = "";

        // Show spinner
        chatHint.style.display = "flex";

        const modality = getSelectValue(therapyModality);
        const length = getSelectValue(therapyLength);
        const language = getSelectValue(therapyLang);
        const systemPrompt = `
You are a licensed therapist. Modality: ${escapeHtml(modality)}; Length: ${escapeHtml(length)}; Language: ${escapeHtml(language)}.
Respond empathetically, providing CBT techniques, mindfulness exercises, or emotional support steps tailored to the user's request.
        `.trim();

        try {
          const aiReply = await callOpenAI([
            { role: "system", content: systemPrompt },
            { role: "user", content: userText }
          ]);
          const replyTime = new Date();
          chatHint.style.display = "none";
          addMessage("Therapist", aiReply, replyTime);
          chatHistory.push({ who: "Therapist", text: aiReply, timestamp: replyTime.toISOString() });
          localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
        } catch (err) {
          chatHint.style.display = "none";
          addMessage("Therapist", "⚠️ Something went wrong. Please try again.", new Date());
        }
      });

      document.getElementById("clearChat").addEventListener("click", () => {
        chatBox.innerHTML = "";
        chatHistory = [];
        localStorage.removeItem("therapyChatHistory");
        lastDateHeader = null;
      });

      document.getElementById("viewHistory").addEventListener("click", () => {
        const modal = document.createElement("div");
        modal.className = "history-modal";
        const grouped = {};
        chatHistory.forEach((m, i) => {
          const dt = new Date(m.timestamp);
          const label = formatDateSeparator(dt);
          if (!grouped[label]) grouped[label] = [];
          grouped[label].push({ who: m.who, text: m.text, idx: i });
        });
        let tableHTML = `<table class="history-table">`;
        Object.keys(grouped).forEach((label) => {
          tableHTML += `
            <thead>
              <tr><th colspan="3">${label}</th></tr>
              <tr>
                <th>Sender</th>
                <th>Message</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              ${grouped[label]
                .map(m =>
                  `<tr data-index="${m.idx}">
                     <td>${m.who}</td>
                     <td>${formatHTML(m.text)}</td>
                     <td><button class="del-msg" data-index="${m.idx}" title="Delete"><i class="fas fa-trash-alt"></i></button></td>
                   </tr>`
                ).join("")}
            </tbody>`;
        });
        tableHTML += `</table>`;
        modal.innerHTML = `
          <div class="history-content">
            <h3>Chat History</h3>
            <div class="history-table-wrapper">
              ${tableHTML}
            </div>
            <div class="history-actions">
              <button class="clear-history"><i class="fas fa-trash"></i> Clear History</button>
              <button class="close-history"><i class="fas fa-times"></i> Close</button>
            </div>
          </div>`;
        document.body.append(modal);

        modal.querySelectorAll(".del-msg").forEach(btn => {
          btn.onclick = () => {
            const idx = +btn.dataset.index;
            chatHistory.splice(idx, 1);
            localStorage.setItem("therapyChatHistory", JSON.stringify(chatHistory));
            const row = modal.querySelector(`tr[data-index="${idx}"]`);
            if (row) row.remove();
            modal.querySelectorAll(".history-table tbody tr").forEach((tr, i) => {
              tr.dataset.index = i;
              tr.querySelector(".del-msg").dataset.index = i;
            });
          };
        });
        modal.querySelector(".clear-history").onclick = () => {
          chatHistory = [];
          localStorage.removeItem("therapyChatHistory");
          modal.remove();
        };
        modal.querySelector(".close-history").onclick = () => modal.remove();
      });
    })();

    //──────────────────────── Mood Tracker ────────────────────────────────────
    (function() {
      const form = document.getElementById("mood-form");
      const panel = document.getElementById("moodPanel");
      const moodRange = document.getElementById("moodRange");
      const moodValue = document.getElementById("moodValue");
      const triggersOther = document.getElementById("moodTriggersOther");
      const selfCare = document.getElementById("selfCare");
      const selfCareOther = document.getElementById("selfCareOther");

      moodRange.oninput = () => {
        moodValue.textContent = moodRange.value;
      };

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Analyzing… <i class="fas fa-spinner fa-spin"></i></div>';

        const data = {
          mood: moodRange.value,
          emotions: [...document.querySelectorAll('#moodTracker input[name="emotions"]:checked')].map(c => c.value),
          triggers: [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')].map(c =>
            c.value === "Other" ? triggersOther.value.trim() : c.value
          ),
          note: document.getElementById("moodNote").value.trim(),
          selfCare: getSelectValue(selfCare)
        };

        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are an AI mental health assistant analyzing daily mood logs. Provide personalized feedback, identify patterns, and suggest self-care strategies." },
            { role: "user", content: `Daily Mood Entry:\n${JSON.stringify(data)}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("moodPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedMood = localStorage.getItem("moodPanel");
      if (savedMood) {
        panel.innerHTML = savedMood;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── Neurotransmitter Balance ────────────────────────
    (function() {
      const form = document.getElementById("nt-form");
      const panel = document.getElementById("neurotransmitterPanel");
      const ntSleep = document.getElementById("ntSleep");
      const ntSleepOther = document.getElementById("ntSleepOther");
      const ntAppetite = document.getElementById("ntAppetite");
      const ntAppetiteOther = document.getElementById("ntAppetiteOther");
      const ntAdherence = document.getElementById("ntAdherence");
      const ntAdherenceOther = document.getElementById("ntAdherenceOther");
      const ntFocus = document.getElementById("ntFocus");
      const ntFocusOther = document.getElementById("ntFocusOther");

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Analyzing… <i class="fas fa-spinner fa-spin"></i></div>';
        const data = {
          mood: document.getElementById("ntMood").value,
          sleep: getSelectValue(ntSleep),
          appetite: getSelectValue(ntAppetite),
          adherence: getSelectValue(ntAdherence),
          focus: getSelectValue(ntFocus)
        };
        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are a neuroscientist analyzing neurotransmitter balance based on user inputs. Provide neurochemical insights, suggest lifestyle or dietary adjustments to optimize balance, and explain impacts." },
            { role: "user", content: `Neuro Profile Data:\n${JSON.stringify(data)}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("neurotransmitterPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedNeuro = localStorage.getItem("neurotransmitterPanel");
      if (savedNeuro) {
        panel.innerHTML = savedNeuro;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── Pharmacogenomics & Dosing ─────────────────────
    (function() {
      const form = document.getElementById("pgx-form");
      const panel = document.getElementById("pharmacogenomicsPanel");
      const pgxSex = document.getElementById("pgxSex");
      const pgxSexOther = document.getElementById("pgxSexOther");
      const pgxDrug = document.getElementById("pgxDrug");
      const pgxDrugOther = document.getElementById("pgxDrugOther");
      const pgxGene = document.getElementById("pgxGene");
      const pgxGeneOther = document.getElementById("pgxGeneOther");
      const pgxUpload = document.getElementById("pgxUpload");

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Processing… <i class="fas fa-spinner fa-spin"></i></div>';
        const file = pgxUpload.files[0];
        if (!file) {
          panel.innerHTML = '<div class="result-content">⚠️ Please upload a genotype file.</div>';
          addClose(panel);
          return;
        }
        const data = {
          sex: getSelectValue(pgxSex),
          age: document.getElementById("pgxAge").value.trim(),
          weight: document.getElementById("pgxWeight").value.trim(),
          drug: getSelectValue(pgxDrug),
          gene: getSelectValue(pgxGene)
        };
        if (!data.sex || !data.age || !data.drug || !data.gene) {
          panel.innerHTML = '<div class="result-content">⚠️ Please fill all required fields.</div>';
          addClose(panel);
          return;
        }
        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are a pharmacogenomics expert providing personalized dosing recommendations based on genotype and clinical data. Consider drug-gene interactions, phenotype, and safety guidelines." },
            { role: "user", content: `Patient Data:\n${JSON.stringify(data)}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("pharmacogenomicsPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedPGx = localStorage.getItem("pharmacogenomicsPanel");
      if (savedPGx) {
        panel.innerHTML = savedPGx;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── Drug Interaction Profiler ──────────────────────
    (function() {
      const form = document.getElementById("int-form");
      const panel = document.getElementById("interactionsPanel");
      const intListSelect = document.getElementById("intListSelect");
      const intListOther = document.getElementById("intListOther");
      const intComorbid = document.getElementById("intComorbid");
      const intComorbidOther = document.getElementById("intComorbidOther");

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Checking… <i class="fas fa-spinner fa-spin"></i></div>';
        const meds = getSelectValue(intListSelect);
        const cond = getSelectValue(intComorbid);
        if (!meds) {
          panel.innerHTML = '<div class="result-content">⚠️ Please select at least one medication.</div>';
          addClose(panel);
          return;
        }
        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are a drug interaction profiler specialized in psychotropic medications. Evaluate medication–condition and medication–medication interactions, cite mechanisms and safety advice." },
            { role: "user", content: `Medications: ${meds}\nComorbid Conditions: ${cond}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("interactionsPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedInt = localStorage.getItem("interactionsPanel");
      if (savedInt) {
        panel.innerHTML = savedInt;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── EEG & Brainwave Interpreter ───────────────────
    (function() {
      const form = document.getElementById("eeg-form");
      const panel = document.getElementById("eegPanel");
      const eegCondition = document.getElementById("eegCondition");
      const eegConditionOther = document.getElementById("eegConditionOther");
      const eegFile = document.getElementById("eegFile");

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        if (!eegFile.files.length) {
          panel.innerHTML = '<div class="result-content">⚠️ Please upload an EEG file.</div>';
          addClose(panel);
          return;
        }
        panel.innerHTML = '<div class="result-content">Analyzing… <i class="fas fa-spinner fa-spin"></i></div>';
        const cond = getSelectValue(eegCondition);
        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are an EEG & brainwave interpreter specializing in mental health. Analyze common patterns (alpha, beta, theta, delta) and suggest cognitive insights or interventions." },
            { role: "user", content: `EEG Analysis:\nCondition/Task: ${cond}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("eegPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedEEG = localStorage.getItem("eegPanel");
      if (savedEEG) {
        panel.innerHTML = savedEEG;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── Clinical Trial Matcher ─────────────────────────
    (function() {
      const form = document.getElementById("trial-form");
      const panel = document.getElementById("trialmatchPanel");
      const trialDx = document.getElementById("trialDx");
      const trialDxOther = document.getElementById("trialDxOther");
      const trialPhase = document.getElementById("trialPhase");
      const trialPhaseOther = document.getElementById("trialPhaseOther");
      const trialLoc = document.getElementById("trialLoc");

      form.onsubmit = async (e) => {
        e.preventDefault();
        panel.hidden = false;
        panel.innerHTML = '<div class="result-content">Searching… <i class="fas fa-spinner fa-spin"></i></div>';
        const dx = getSelectValue(trialDx);
        const loc = trialLoc.value.trim();
        const ph = getSelectValue(trialPhase);
        if (!dx || !loc) {
          panel.innerHTML = '<div class="result-content">⚠️ Please specify diagnosis and location.</div>';
          addClose(panel);
          return;
        }
        try {
          const aiReply = await callOpenAI([
            { role: "system", content: "You are a clinical trial matching engine specialized in psychiatry. Suggest relevant trials by phase, location, and eligibility. Provide trial names, phases, brief inclusion criteria, and contact information if available." },
            { role: "user", content: `Diagnosis: ${dx}\nLocation: ${loc}\nPhase: ${ph}` }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(aiReply)}</div>`;
          addClose(panel);
          addTools(panel);
          localStorage.setItem("trialmatchPanel", panel.innerHTML);
        } catch (err) {
          panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
          addClose(panel);
        }
      };

      const savedTrials = localStorage.getItem("trialmatchPanel");
      if (savedTrials) {
        panel.innerHTML = savedTrials;
        panel.hidden = false;
        addClose(panel);
        addTools(panel);
      }
    })();

    //──────────────────────── Data Analytics & Charts ───────────────────────
    (function() {
      const engCtx = document.getElementById("engagementChart").getContext("2d");
      const outCtx = document.getElementById("outcomeChart").getContext("2d");

      function getCSSVar(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      }
      const colorText = getCSSVar("--text");
      const colorMuted = getCSSVar("--muted");
      const primary = getCSSVar("--primary");
      const secondary = getCSSVar("--secondary");

      // Ensure canvas containers have fixed height so charts don't grow infinitely
      engCtx.canvas.parentElement.style.height = "200px";
      outCtx.canvas.parentElement.style.height = "200px";

      // Engagement Over Time (line)
      const engChart = new Chart(engCtx, {
        type: "line",
        data: {
          labels: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
          datasets: [{
            label: "Sessions",
            data: [12, 9, 14, 11, 13, 10, 15],
            borderColor: primary,
            backgroundColor: "rgba(74,144,226,0.1)",
            fill: "start"
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks: { color: colorText }, grid: { display: false } },
            y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true }
          },
          plugins: { legend: { display: false } }
        }
      });

      // Outcome Metrics (bar)
      const outChart = new Chart(outCtx, {
        type: "bar",
        data: {
          labels: ["Week 1","Week 2","Week 3","Week 4"],
          datasets: [{
            label: "Outcome Score",
            data: [3.2, 4.1, 4.5, 4.8],
            backgroundColor: secondary
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks: { color: colorText }, grid: { display: false } },
            y: { ticks: { color: colorText }, grid: { color: colorMuted }, beginAtZero: true, max: 5 }
          },
          plugins: { legend: { display: false } }
        }
      });

      document.getElementById("exportCharts").addEventListener("click", () => {
        let csv = "Chart,Label,Value\n";
        [
          ["Sessions", engChart],
          ["Outcome", outChart]
        ].forEach(([name, ch]) => {
          ch.data.labels.forEach((lab, i) => {
            csv += `"${name}","${lab}",${ch.data.datasets[0].data[i]}\n`;
          });
        });
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "analytics.csv";
        document.body.append(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      });
    })();
  });
</script>
  
</body>

</html>
