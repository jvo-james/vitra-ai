<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Neuropharma Command Center</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /*──────────────────────── Theme & Reset ─────────────────────────────────*/
    :root {
      --primary: #5A8DEE; --primary-alt: #7DA4E8; --secondary: #FF758C;
      --accent: rgba(255,255,255,0.4); --bg: #F0F4F8; --surface: rgba(255,255,255,0.85);
      --text: #1F2937; --muted: #546E7A; --radius: .75rem; --padding: 1rem;
      --transition: .3s ease; --shadow-light: 0 4px 20px rgba(0,0,0,.05);
    }
    html.dark {
      --bg:#111827; --surface:rgba(30,35,54,.85); --text:#E0E6F0; --muted:#9AA5B1; --accent:rgba(30,35,54,.5);
    }
    *,*::before,*::after {margin:0;padding:0;box-sizing:border-box;}
    html {font-family:'Montserrat',sans-serif;scroll-behavior:smooth;}
    body {display:flex;min-height:100vh;background:var(--bg);color:var(--text);overflow-x:hidden;}
    a{color:inherit;text-decoration:none;}button,input,textarea,select{font:inherit;transition:all var(--transition);}
    :focus{outline:2px solid var(--primary);outline-offset:2px;}

    :root {
  --sidebar-width: 260px;
  --sidebar-hidden-width: 0;
}

body.sidebar-hidden aside {
  transform: translateX(-100%);
}

body.sidebar-hidden header {
  left: 0 !important;
}

header {
  left: var(--sidebar-width);
}

aside {
  transition: transform var(--transition);
}

@media (max-width: 768px) {
  header {
    left: 0 !important;
  }
  body:not(.sidebar-hidden) aside {
    position: fixed;
    z-index: 2000;
  }
}
    /*──────────────────────── Sidebar ─────────────────────────────────*/
    aside{flex:0 0 260px;background:var(--surface);backdrop-filter:blur(12px);box-shadow:var(--shadow-light);
      position:sticky;top:0;height:100vh;display:flex;flex-direction:column;transition:flex var(--transition);}
    aside.collapsed{flex:0 0 72px;}
    .brand{display:flex;align-items:center;gap:.75rem;padding:var(--padding);font-size:1.2rem;color:var(--primary);}
    aside.collapsed .brand span{opacity:0;}
    nav{flex:1;overflow-y:auto;margin-top:.5rem;}
    nav a{display:flex;align-items:center;gap:1rem;padding:.75rem var(--padding);border-radius:var(--radius);
         transition:background var(--transition),transform var(--transition);}
    nav a:hover,nav a.active{background:var(--primary);color:#fff;transform:translateX(4px);}
    #shrinkBtn{margin:var(--padding) auto;width:36px;height:36px;border-radius:50%;
               background:var(--primary);color:#fff;box-shadow:0 8px 40px rgba(0,0,0,.1);}
    #shrinkBtn:hover{transform:scale(1.1);}

    /*──────────────────────── Header ─────────────────────────────────*/
    header{position:fixed;top:0;left:260px;right:0;height:60px;
      background:var(--surface);backdrop-filter:blur(12px);display:flex;align-items:center;
      justify-content:space-between;padding:0 var(--padding);box-shadow:var(--shadow-light);transition:left var(--transition);z-index:1000;}
    header.sidebar-collapsed{left:72px;}
    header h1{font-size:1.4rem;}
    .hamburger,.theme-toggle{font-size:1.5rem;color:var(--primary);cursor:pointer;}
    .hamburger:hover,.theme-toggle:hover{transform:scale(1.1);}

    /*──────────────────────── Main & Hero ─────────────────────────────────*/
    main{flex:1;margin-top:60px;padding:var(--padding);overflow-x:hidden;}
    .hero{position:relative;background:var(--surface);backdrop-filter:blur(12px);border-radius:var(--radius);
          padding:3rem var(--padding);text-align:center;box-shadow:0 8px 40px rgba(0,0,0,.1);margin-bottom:2rem;}
    .hero h1{font-size:2.75rem;color:var(--primary);margin-bottom:1rem;}
    .hero p{font-size:1.2rem;color:var(--muted);margin-bottom:2rem;max-width:600px;margin-inline:auto;}
    .hero .actions{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;}
    .hero .actions a{background:var(--primary);color:#fff;padding:1rem 1.5rem;border-radius:var(--radius);
                     box-shadow:var(--shadow-light);transition:transform var(--transition),background var(--transition);}
    .hero .actions a.btn-secondary{background:var(--secondary);}
    .hero .actions a:hover{transform:translateY(-3px);}
    .hero-icons{position:absolute;top:1rem;right:1rem;display:flex;flex-direction:column;gap:.5rem;font-size:2rem;opacity:.15;}

    /*──────────────────────── Modules ─────────────────────────────────*/
    section.module{background:var(--surface);backdrop-filter:blur(8px);border-radius:var(--radius);
                   padding:var(--padding);margin-bottom:1.5rem;box-shadow:var(--shadow-light);
                   transition:transform var(--transition);}
    section.module:hover{transform:translateY(-4px);}
    section.module h2{display:flex;align-items:center;gap:.5rem;font-size:1.5rem;color:var(--primary);margin-bottom:.75rem;}
    section.module p.desc{color:var(--muted);font-size:1rem;margin-bottom:1rem;}

    /*──────────────────────── Inputs & Buttons ─────────────────────────────────*/
    input[type="text"],input[type="number"],textarea,select{width:100%;padding:.75rem;border:1px solid var(--muted);
      border-radius:var(--radius);background:var(--accent);color:var(--text);}
    input:focus,textarea:focus,select:focus{border-color:var(--primary);box-shadow:0 0 8px var(--primary);}
    input[type="range"]{width:100%;accent-color:var(--primary);}
    .checkbox-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.5rem;}
    fieldset{border:1px solid var(--muted);border-radius:var(--radius);padding:.75rem;}
    legend{padding:0 .5rem;font-weight:600;color:var(--secondary);}
    button.btn{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;border:none;
               border-radius:var(--radius);background:var(--primary);color:#fff;font-weight:600;
               box-shadow:var(--shadow-light);cursor:pointer;transition:background var(--transition),transform var(--transition);}
    button.btn-secondary{background:var(--secondary);}
    button.btn:hover{transform:translateY(-2px);box-shadow:0 8px 40px rgba(0,0,0,.1);}
    button.btn-secondary:hover{background:var(--primary-alt);}

    /*──────────────────────── Response Panels ─────────────────────────────────*/
    .response{background:var(--surface);backdrop-filter:blur(8px);border-left:4px solid var(--secondary);
              padding:var(--padding);border-radius:var(--radius);margin-top:1rem;position:relative;box-shadow:var(--shadow-light);}
    .response .result-content{white-space:pre-wrap;line-height:1.5;}
    .close-btn{position:absolute;top:var(--padding);right:var(--padding);background:none;border:none;
               font-size:1.2rem;color:var(--secondary);cursor:pointer;}
    .tool-row{position:absolute;bottom:var(--padding);right:var(--padding);display:flex;gap:.5rem;}
    .tool-row button{background:var(--accent);border:none;border-radius:50%;width:1.6rem;height:1.6rem;
                     display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform var(--transition);}
    .tool-row button:hover{transform:scale(1.2);}

    /*──────────────────────── Chat UI ─────────────────────────────────*/
    .chat-box{background:var(--bg);border:1px solid var(--muted);border-radius:var(--radius);
              padding:var(--padding);max-height:300px;overflow-y:auto;display:flex;flex-direction:column;}
    .user-msg,.bot-msg{max-width:75%;padding:.75rem 1rem;margin:.5rem 0;border-radius:1rem;position:relative;}
    .user-msg{background:var(--primary);color:#fff;align-self:flex-end;}
    .bot-msg{background:var(--accent);color:var(--text);align-self:flex-start;}
    .timestamp{font-size:.65rem;color:var(--muted);position:absolute;bottom:-1.2rem;right:1rem;}

    /*────────────────── NEUROTRANSMITTER BALANCE ──────────────────*/
#neurotransmitter {
  background: linear-gradient(135deg, rgba(90,142,238,0.15), rgba(255,117,140,0.1));
  border: 2px solid var(--primary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(90,142,238,0.2);
}
#neurotransmitter h2 {
  color: var(--primary-alt);
  background: var(--primary);
  -webkit-background-clip: text;
  color: transparent;
  font-size: 1.7rem;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
}
#neurotransmitter .desc {
  font-style: italic;
  margin-bottom: 1rem;
}
#neurotransmitter form label {
  display: block;
  margin-bottom: 1rem;
}
#neurotransmitter input[type="range"]::-webkit-slider-thumb,
#neurotransmitter select,
#neurotransmitter input[type="range"] {
  accent-color: var(--primary-alt);
}
#neurotransmitter #ntFocus {
  background: var(--accent);
  border: 1px solid var(--primary-alt);
}
#neurotransmitter button {
  background: var(--primary-alt);
  box-shadow: 0 4px 14px rgba(125,164,232,0.4);
}
#neurotransmitter button:hover {
  background: var(--primary);
}

/*────────────────── PHARMACOGENOMICS & DOSING ──────────────────*/
#pharmacogenomics {
  background: linear-gradient(145deg, rgba(255,117,140,0.1), rgba(90,142,238,0.1));
  border: 2px dashed var(--secondary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(255,117,140,0.2);
}
#pharmacogenomics h2 {
  color: var(--secondary);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#pharmacogenomics .desc {
  margin-bottom: 1rem;
}
#pharmacogenomics form label {
  display: block;
  margin-bottom: 1rem;
}
#pharmacogenomics select#pgxGene {
  background: var(--accent);
  border: 1px solid var(--secondary);
}
#pharmacogenomics button {
  background: var(--secondary);
  box-shadow: 0 4px 14px rgba(255,117,140,0.4);
}
#pharmacogenomics button:hover {
  background: var(--secondary-alt, var(--secondary));
}

/*────────────────── DRUG INTERACTION PROFILER ──────────────────*/
#interactions {
  background: rgba(90,142,238,0.05);
  border-left: 6px solid var(--primary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(0,0,0,0.05);
}
#interactions h2 {
  color: var(--primary);
  position: relative;
}
#interactions h2::after {
  content: '';
  display: block;
  width: 40px;
  height: 4px;
  background: var(--primary-alt);
  margin-top: 4px;
}
#interactions .desc {
  margin-bottom: 1rem;
}
#interactions form label {
  display: block;
  margin-bottom: 1rem;
}
#interactions select#intComorbid {
  background: var(--accent);
  border: 1px solid var(--primary);
}
#interactions button {
  background: var(--primary);
  box-shadow: 0 4px 14px rgba(90,142,238,0.4);
}
#interactions button:hover {
  background: var(--primary-alt);
}

/*────────────────── EEG & BRAINWAVE INTERPRETER ──────────────────*/
#eeg {
  background: linear-gradient(135deg, rgba(125,164,232,0.1), rgba(255,117,140,0.1));
  border: 2px solid var(--primary-alt);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(125,164,232,0.2);
}
#eeg h2 {
  color: var(--primary-alt);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#eeg .desc {
  margin-bottom: 1rem;
}
#eeg form label {
  display: block;
  margin-bottom: 1rem;
}
#eeg select#eegCondition {
  background: var(--accent);
  border: 1px solid var(--primary-alt);
}
#eeg button {
  background: var(--primary-alt);
  box-shadow: 0 4px 14px rgba(125,164,232,0.4);
}
#eeg button:hover {
  background: var(--primary);
}

/*────────────────── CLINICAL TRIAL MATCHING ENGINE ──────────────────*/
#trialmatch {
  background: rgba(255,117,140,0.05);
  border: 2px dashed var(--secondary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(255,117,140,0.2);
}
#trialmatch h2 {
  color: var(--secondary);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#trialmatch .desc {
  margin-bottom: 1rem;
}
#trialmatch form label {
  display: block;
  margin-bottom: 1rem;
}
#trialmatch select#trialPhase {
  background: var(--accent);
  border: 1px solid var(--secondary);
}
#trialmatch button {
  background: var(--secondary);
  box-shadow: 0 4px 14px rgba(255,117,140,0.4);
}
#trialmatch button:hover {
  background: var(--secondary-alt, var(--secondary));
}

/*────────────────── RESPONSE PANEL ENHANCEMENTS ──────────────────*/
.response {
  transition: all 0.3s ease;
}
.response .close-btn { color: var(--muted); }
.response .copy-btn, .response .dl-btn {
  background: var(--surface);
  border: 1px solid var(--muted);
}
.response .copy-btn:hover, .response .dl-btn:hover {
  background: var(--accent);
  transform: scale(1.2);
}
    
    /*──────────────────────── Charts ─────────────────────────────────*/
    .charts{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;}
    .chart-card{background:var(--surface);backdrop-filter:blur(8px);border-radius:var(--radius);
                padding:var(--padding);box-shadow:var(--shadow-light);display:flex;flex-direction:column;}
    .chart-card canvas{flex:1;}

    /*──────────────────────── Responsive ─────────────────────────────────*/
    @media(max-width:1024px){header{padding:0 .5rem;} .hero{padding:2rem .75rem;}}
    @media(max-width:640px){.hero h1{font-size:2rem;}section.module{padding:.75rem;}
      .hero-icons{display:none;} .checkbox-group{grid-template-columns:1fr;}}
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-brain"></i><span>Vitra AI</span></div>
    <nav>
      <a href="index.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
      <a href="psychology.html" class="active"><i class="fas fa-brain"></i><span>Psych & MH</span></a>
      <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
      <a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i><span>Consult Booking</span></a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
  </aside>

  <!-- HEADER -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>Neuropharma Command Center</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- MAIN -->
  <main>

    <!-- HERO -->
    <section class="hero" id="hero">
      <h1><i class="fas fa-brain"></i> Empower Your Neuro-Health</h1>
      <p>Integrate genetics, neurotransmitters, EEG, and drug data—AI-driven insights for precision psychiatry.</p>
      <div class="actions">
        <a href="#therapybot" class="btn"><i class="fas fa-comments"></i> Therapy Bot</a>
        <a href="#moodTracker" class="btn btn-secondary"><i class="fas fa-sliders-h"></i> Mood Tracker</a>
        <a href="#neurotransmitter" class="btn"><i class="fas fa-flask"></i> Neuro Balance</a>
        <a href="#pharmacogenomics" class="btn btn-secondary"><i class="fas fa-dna"></i> Pharmaco-Genomics</a>
        <a href="#interactions" class="btn"><i class="fas fa-exchange-alt"></i> Drug Interactions</a>
        <a href="#eeg" class="btn btn-secondary"><i class="fas fa-wave-square"></i> EEG Analysis</a>
        <a href="#trialmatch" class="btn"><i class="fas fa-search"></i> Trial Matching</a>
      </div>
      <div class="hero-icons">
        <i class="fas fa-microscope"></i>
        <i class="fas fa-pills"></i>
        <i class="fas fa-wave-square"></i>
        <i class="fas fa-chart-line"></i>
      </div>
    </section>

    <!-- 1. Conversational Therapy Bot -->
    <section class="module" id="therapybot">
      <h2><i class="fas fa-robot"></i> Conversational Therapy Bot</h2>
      <p class="desc">Guided CBT, mindfulness, or emotional support—AI adapts to your modality, length, and language.</p>
      <form id="therapy-form">
        <label>Modality:
          <select id="therapyModality">
            <option value="CBT">CBT Exercises</option>
            <option value="mindfulness">Mindfulness</option>
            <option value="emotional">Emotional Support</option>
            <option value="guidedImagery">Guided Imagery</option>
          </select>
        </label>
        <label>Length:
          <select id="therapyLength">
            <option>5 minutes</option>
            <option>10 minutes</option>
            <option>20 minutes</option>
          </select>
        </label>
        <label>Language:
          <select id="therapyLang">
            <option>English</option>
            <option>Spanish</option>
            <option>French</option>
          </select>
        </label>
        <div style="display:flex;gap:.5rem;">
          <input id="therapyInput" type="text" placeholder="Describe what you need…" />
          <button id="sendChat" class="btn"><i class="fas fa-paper-plane"></i></button>
        </div>
      </form>
      <div class="tool-row" style="top:var(--padding);left:var(--padding);">
        <button id="clearChat" title="Clear Chat"><i class="fas fa-trash"></i></button>
        <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
      </div>
      <div id="chatBox" class="chat-box"></div>
      <div id="chatHint" class="desc" style="display:none;">Bot is thinking… <span class="spinner"></span></div>
    </section>

    <section class="module" id="neurotransmitter">
  <h2><i class="fas fa-vial"></i> Neurotransmitter Balance</h2>
  <p class="desc">Integrate your mood, sleep, appetite, and med-adherence to get AI-driven neurochemical insights.</p>
  <form id="nt-form">
    <label>Mood (1–10):
      <input type="range" id="ntMood" min="1" max="10" value="5">
    </label>
    <label>Sleep Quality:
      <select id="ntSleep">
        <option>Poor</option><option>Fair</option><option>Good</option><option>Excellent</option>
      </select>
    </label>
    <label>Appetite:
      <select id="ntAppetite">
        <option>Low</option><option>Normal</option><option>High</option>
      </select>
    </label>
    <label>Medication Adherence:
      <select id="ntAdherence">
        <option>Poor</option><option>Fair</option><option>Good</option><option>Excellent</option>
      </select>
    </label>

    <!-- NEW: Key Neurotransmitter to Analyze -->
    <label>Focus Neurotransmitter:
      <select id="ntFocus">
        <option>Serotonin</option>
        <option>Dopamine</option>
        <option>GABA</option>
        <option>Glutamate</option>
        <option>Acetylcholine</option>
        <option>Histamine</option>
        <option>Oxytocin</option>
        <option>Vasopressin</option>
        <option>Endorphins</option>
        <option>Melatonin</option>
        <option>Cortisol</option>
        <option>Adrenaline</option>
        <option>Noradrenaline</option>
        <option>Enkephalins</option>
        <option>Substance P</option>
        <option>Dynorphin</option>
        <option>Glycine</option>
        <option>Aspartate</option>
        <option>Endocannabinoids</option>
        <option>Neuropeptide Y</option>
      </select>
    </label>

    <button id="analyzeNeuro" class="btn"><i class="fas fa-brain"></i> Analyze Balance</button>
  </form>
  <div id="neurotransmitterPanel" class="response" hidden>
    <button class="close-btn"><i class="fas fa-times"></i></button>
    <div class="tool-row">
      <button class="copy-btn"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"><i class="fas fa-download"></i></button>
    </div>
    <div class="result-content"></div>
  </div>
</section>
    
    <!-- 2. Daily Mood Tracker -->
    <section class="module" id="moodTracker">
      <h2><i class="fas fa-sliders-h"></i> Daily Mood Tracker</h2>
      <p class="desc">Log mood, triggers, and journal entries—AI spots patterns and suggests self-care tips.</p>
      <form id="mood-form">
        <label for="moodRange">Mood Score: <strong><span id="moodValue">5</span>/10</strong></label>
        <input type="range" id="moodRange" min="1" max="10" value="5">
        <fieldset>
          <legend>Feelings (select up to 20):</legend>
          <div class="checkbox-group">
            <!-- 20 common emotions -->
            <label><input type="checkbox" name="emotions" value="Happy"> Happy</label>
            <label><input type="checkbox" name="emotions" value="Sad"> Sad</label>
            <label><input type="checkbox" name="emotions" value="Anxious"> Anxious</label>
            <label><input type="checkbox" name="emotions" value="Calm"> Calm</label>
            <label><input type="checkbox" name="emotions" value="Angry"> Angry</label>
            <label><input type="checkbox" name="emotions" value="Motivated"> Motivated</label>
            <label><input type="checkbox" name="emotions" value="Stressed"> Stressed</label>
            <label><input type="checkbox" name="emotions" value="Relaxed"> Relaxed</label>
            <label><input type="checkbox" name="emotions" value="Focused"> Focused</label>
            <label><input type="checkbox" name="emotions" value="Overwhelmed"> Overwhelmed</label>
            <label><input type="checkbox" name="emotions" value="Bored"> Bored</label>
            <label><input type="checkbox" name="emotions" value="Confident"> Confident</label>
            <label><input type="checkbox" name="emotions" value="Nervous"> Nervous</label>
            <label><input type="checkbox" name="emotions" value="Lonely"> Lonely</label>
            <label><input type="checkbox" name="emotions" value="Hopeful"> Hopeful</label>
            <label><input type="checkbox" name="emotions" value="Frustrated"> Frustrated</label>
            <label><input type="checkbox" name="emotions" value="Joyful"> Joyful</label>
            <label><input type="checkbox" name="emotions" value="Dull"> Dull</label>
            <label><input type="checkbox" name="emotions" value="Energetic"> Energetic</label>
            <label><input type="checkbox" name="emotions" value="Tired"> Tired</label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Triggers (select up to 20):</legend>
          <div class="checkbox-group">
            <!-- 20 triggers -->
            <label><input type="checkbox" name="triggers" value="Work"> Work</label>
            <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
            <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
            <label><input type="checkbox" name="triggers" value="Health"> Health</label>
            <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
            <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
            <label><input type="checkbox" name="triggers" value="Exercise"> Exercise</label>
            <label><input type="checkbox" name="triggers" value="Family"> Family</label>
            <label><input type="checkbox" name="triggers" value="Social"> Social</label>
            <label><input type="checkbox" name="triggers" value="Weather"> Weather</label>
            <label><input type="checkbox" name="triggers" value="Noise"> Noise</label>
            <label><input type="checkbox" name="triggers" value="Light"> Light</label>
            <label><input type="checkbox" name="triggers" value="Crowds"> Crowds</label>
            <label><input type="checkbox" name="triggers" value="Traffic"> Traffic</label>
            <label><input type="checkbox" name="triggers" value="Media"> Media</label>
            <label><input type="checkbox" name="triggers" value="Pets"> Pets</label>
            <label><input type="checkbox" name="triggers" value="Home"> Home</label>
            <label><input type="checkbox" name="triggers" value="Commute"> Commute</label>
            <label><input type="checkbox" name="triggers" value="Finances"> Finances</label>
            <label><input type="checkbox" name="triggers" value="Other"> Other</label>
          </div>
        </fieldset>
        <label for="moodNote">Journal Entry:</label>
        <textarea id="moodNote" rows="3" placeholder="What happened today?"></textarea>
        <label for="selfCare">Self-Care Focus:</label>
        <select id="selfCare">
          <optgroup label="Breathing & Relaxation">
            <option>Guided Breathing</option>
            <option>Progressive Muscle Relaxation</option>
          </optgroup>
          <optgroup label="Movement">
            <option>Stretch & Walk</option>
            <option>Yoga Flow</option>
          </optgroup>
          <optgroup label="Mindfulness">
            <option>Body Scan</option>
            <option>Sound Meditation</option>
          </optgroup>
          <optgroup label="Creative">
            <option>Music Break</option>
            <option>Art Prompt</option>
          </optgroup>
        </select>
        <button type="submit" class="btn"><i class="fas fa-chart-line"></i> Analyze Mood</button>
      </form>
      <div id="moodPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

    <section class="module" id="pharmacogenomics">
  <h2><i class="fas fa-dna"></i> Pharmacogenomics & Dosing</h2>
  <p class="desc">Upload your genotype to get AI-optimized drug recommendations and dosing guidelines.</p>
  <form id="pgx-form">
    <label>Upload Genotype (VCF):
      <input type="file" id="pgxUpload" accept=".vcf,.txt">
    </label>
    <label>Drug:
      <select id="pgxDrug">
        <option>Clopidogrel</option>
        <option>Warfarin</option>
        <option>Codeine</option>
        <option>Citalopram</option>
      </select>
    </label>

    <!-- NEW: Select Relevant Gene Variant -->
    <label>Gene Variant:
      <select id="pgxGene">
        <option>CYP2C19*1</option><option>CYP2C19*2</option><option>CYP2C19*3</option>
        <option>CYP2D6*1</option><option>CYP2D6*4</option><option>CYP2D6*5</option>
        <option>TPMT*1</option><option>TPMT*2</option><option>TPMT*3</option>
        <option>UGT1A1*28</option><option>VKORC1</option><option>MTHFR C677T</option>
        <option>HLA-B*57:01</option><option>SLCO1B1*5</option><option>CFTR ΔF508</option>
        <option>G6PD A−</option><option>HFE C282Y</option><option>NAT2 Slow</option>
        <option>COMT Val158Met</option><option>Other…</option>
      </select>
    </label>

    <button id="runPGx" class="btn"><i class="fas fa-flask"></i> Run PGx Analysis</button>
  </form>
  <div id="pharmacogenomicsPanel" class="response" hidden> … </div>
</section>
    
    <!-- 3. Dream & Subconscious Explorer -->
    <section class="module" id="dream">
      <h2><i class="fas fa-bed"></i> Dream & Subconscious Explorer</h2>
      <p class="desc">Capture narratives, symbols, ambient sounds—AI surfaces hidden archetypes and patterns.</p>

      <!-- Narrative -->
      <label for="dreamText">Dream Narrative:</label>
      <textarea id="dreamText" rows="4" placeholder="I found myself…"></textarea>

      <!-- Symbols -->
      <fieldset>
        <legend>Symbols & Themes (20+):</legend>
        <div class="checkbox-group">
          <label><input type="checkbox" value="Water"> Water</label>
          <label><input type="checkbox" value="Flight"> Flight</label>
          <label><input type="checkbox" value="Teeth"> Teeth</label>
          <label><input type="checkbox" value="Chase"> Being Chased</label>
          <label><input type="checkbox" value="Falling"> Falling</label>
          <label><input type="checkbox" value="Fire"> Fire</label>
          <label><input type="checkbox" value="Forest"> Forest</label>
          <label><input type="checkbox" value="Animals"> Animals</label>
          <label><input type="checkbox" value="Darkness"> Darkness</label>
          <label><input type="checkbox" value="Light"> Light</label>
          <label><input type="checkbox" value="Doors"> Doors</label>
          <label><input type="checkbox" value="Mirrors"> Mirrors</label>
          <label><input type="checkbox" value="Vehicles"> Vehicles</label>
          <label><input type="checkbox" value="People"> People</label>
          <label><input type="checkbox" value="Waterfall"> Waterfall</label>
          <label><input type="checkbox" value="Labyrinth"> Labyrinth</label>
          <label><input type="checkbox" value="Other"/> Other: <input type="text" id="otherSymbol" placeholder="Your symbol"></label>
        </div>
      </fieldset>

      <!-- Mood Before/After -->
      <div style="display:flex;gap:1rem;">
        <div style="flex:1;">
          <label>Mood Before Sleep:
            <select id="preMood">
              <option disabled selected>Select…</option>
              <option>Calm</option><option>Anxious</option><option>Neutral</option>
              <option>Excited</option><option>Sad</option><option>Other</option>
            </select>
          </label>
        </div>
        <div style="flex:1;">
          <label>Mood On Waking:
            <select id="postMood">
              <option disabled selected>Select…</option>
              <option>Refreshed</option><option>Tired</option><option>Confused</option>
              <option>Inspired</option><option>Anxious</option><option>Other</option>
            </select>
          </label>
        </div>
      </div>

      <!-- Tags -->
      <label for="dreamTags">Contextual Tags (comma-separated):</label>
      <input type="text" id="dreamTags" placeholder="exam, hometown, graduation">

      <!-- Reflection -->
      <label for="dreamReflect">Reflection & Intentions:</label>
      <textarea id="dreamReflect" rows="3" placeholder="My reflection…"></textarea>

      <!-- Actions -->
      <div style="display:flex;gap:.75rem;margin-top:1rem;">
        <button id="analyzeDream" class="btn"><i class="fas fa-brain"></i> Analyze Dream</button>
        <button id="interpretSymbols" class="btn btn-secondary"><i class="fas fa-search"></i> Interpret Symbols</button>
        <button id="generatePrompts" class="btn btn-secondary"><i class="fas fa-pen-nib"></i> Generate Prompts</button>
      </div>

      <!-- Response -->
      <div id="dreamPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"   title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

     <section class="module" id="interactions">
  <h2><i class="fas fa-exchange-alt"></i> Drug Interaction Profiler</h2>
  <p class="desc">Enter all your medications to get an AI-powered interaction risk report.</p>
  <form id="int-form">
    <label>Med List (comma-sep):
      <input type="text" id="intList" placeholder="e.g. Metformin, Ibuprofen, ...">
    </label>

    <!-- NEW: Select Comorbid Conditions -->
    <label>Comorbid Conditions:
      <select id="intComorbid">
        <option>Hypertension</option><option>Diabetes</option><option>Asthma</option><option>Depression</option>
        <option>Anxiety</option><option>Insomnia</option><option>Obesity</option><option>Hyperlipidemia</option>
        <option>Arthritis</option><option>GERD</option><option>Migraine</option><option>ADHD</option>
        <option>Parkinson’s</option><option>Alzheimer’s</option><option>Epilepsy</option><option>COPD</option>
        <option>CKD</option><option>CHF</option><option>HIV</option><option>Cancer</option>
      </select>
    </label>

    <button id="checkInt" class="btn"><i class="fas fa-pills"></i> Check Interactions</button>
  </form>
  <div id="interactionsPanel" class="response" hidden> … </div>
</section>
    
    <!-- 4. AI-Curated Creative Therapies -->
    <section class="module" id="creative">
      <h2><i class="fas fa-palette"></i> AI-Curated Creative Therapies</h2>
      <p class="desc">Generate art, music, poetry or journaling prompts—all tailored to your mood and style.</p>
      <form id="creative-form">
        <label>Type:
          <select id="creativeType">
            <option value="art">Abstract Art</option>
            <option value="music">Soundscape</option>
            <option value="poetry">Poetry</option>
            <option value="journaling">Journaling Prompts</option>
          </select>
        </label>
        <label>Style:
          <select id="creativeStyle">
            <option>Calm & Soft</option><option>Vibrant & Bold</option><option>Mystical</option><option>Minimalist</option>
          </select>
        </label>
        <label>Detail Level:
          <input type="range" id="creativeDetail" min="1" max="10" value="5">
        </label>
        <button id="artEmotion" class="btn"><i class="fas fa-brush"></i> Generate</button>
      </form>
      <div id="creativePanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <section class="module" id="eeg">
  <h2><i class="fas fa-wave-square"></i> EEG & Brainwave Interpreter</h2>
  <p class="desc">Upload your EEG data—AI decodes patterns in alpha, beta, theta, and delta bands.</p>
  <form id="eeg-form">
    <label>Upload EEG File (EDF/CSV):
      <input type="file" id="eegFile" accept=".edf,.csv">
    </label>

    <!-- NEW: Recording Condition -->
    <label>Recording Condition:
      <select id="eegCondition">
        <option>Resting Eyes Closed</option><option>Resting Eyes Open</option><option>Sleep Stage 1</option>
        <option>Sleep Stage 2</option><option>Sleep Stage 3</option><option>REM Sleep</option>
        <option>Meditation</option><option>Reading</option><option>Math Task</option>
        <option>Visual Stimuli</option><option>Auditory Stimuli</option><option>Hyperventilation</option>
        <option>Photostimulation</option><option>Stress Task</option><option>Relaxation</option>
        <option>Walking in Place</option><option>Typing</option><option>Conversation</option>
        <option>Video Watching</option><option>Other…</option>
      </select>
    </label>

    <button id="analyzeEEG" class="btn"><i class="fas fa-microchip"></i> Analyze EEG</button>
  </form>
  <div id="eegPanel" class="response" hidden> … </div>
</section>
    
    <!-- 5. Dynamic Cognitive Games -->
    <section class="module" id="games">
      <h2><i class="fas fa-gamepad"></i> Dynamic Cognitive Games</h2>
      <p class="desc">Logic puzzles, memory matches, and story co-creation for brain training.</p>
      <form id="games-form">
        <label>Game Type:
          <select id="gameType">
            <option value="puzzle">Logic Puzzle</option>
            <option value="memory">Memory Match</option>
            <option value="story">Story Co-Write</option>
          </select>
        </label>
        <label>Difficulty:
          <select id="gameDifficulty">
            <option>Easy</option><option>Medium</option><option>Hard</option>
          </select>
        </label>
        <button id="puzzles" class="btn"><i class="fas fa-puzzle-piece"></i> Start</button>
      </form>
      <div id="gamesPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 6. Medication Management & Safety -->
    <section class="module" id="medsafety">
      <h2><i class="fas fa-pills"></i> Medication Management & Safety</h2>
      <p class="desc">Enter your current meds, check interactions, and set adherence reminders.</p>
      <form id="medsafety-form">
        <label>Medications (comma-separated):
          <input type="text" id="medList" placeholder="e.g. Sertraline, Ibuprofen">
        </label>
        <button id="medInteraction" class="btn"><i class="fas fa-exchange-alt"></i> Check Interactions</button>
        <button id="adherence" class="btn btn-secondary"><i class="fas fa-check-circle"></i> Set Reminders</button>
      </form>
      <div id="medsafetyPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 7. Symptom Questionnaire -->
    <section class="module" id="symptomQuiz">
      <h2><i class="fas fa-clipboard-list"></i> Symptom Questionnaire</h2>
      <p class="desc">Standardized survey—AI scores severity and suggests next steps.</p>
      <form id="quiz-form">
        <label>Sleep Quality:
          <select name="sleep">
            <option>Poor</option><option>Fair</option><option>Good</option>
          </select>
        </label>
        <label>Appetite:
          <select name="appetite">
            <option>Low</option><option>Normal</option><option>High</option>
          </select>
        </label>
        <label>Concentration:
          <select name="concentration">
            <option>Impaired</option><option>Average</option><option>Sharp</option>
          </select>
        </label>
        <button id="launchQuiz" class="btn"><i class="fas fa-play"></i> Submit & Analyze</button>
      </form>
      <div id="quizPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <section class="module" id="trialmatch">
  <h2><i class="fas fa-handshake"></i> Clinical Trial Matcher</h2>
  <p class="desc">Describe your condition and location—AI will suggest matching neuro-psych trials.</p>
  <form id="trial-form">
    <label>Diagnosis:
      <input type="text" id="trialDx" placeholder="e.g. Major Depressive Disorder">
    </label>
    <label>Location:
      <input type="text" id="trialLoc" placeholder="City, Country">
    </label>

    <!-- NEW: Desired Trial Phase -->
    <label>Trial Phase:
      <select id="trialPhase">
        <option>Phase I</option><option>Phase II</option><option>Phase III</option><option>Phase IV</option>
        <option>First-in-Human</option><option>Proof-of-Concept</option><option>Open-Label</option>
        <option>Randomized</option><option>Double-Blind</option><option>Placebo-Controlled</option>
        <option>Adaptive Design</option><option>Dose-Escalation</option><option>Biomarker Study</option>
        <option>Observational</option><option>Longitudinal</option><option>Cross-Over</option>
        <option>Basket Trial</option><option>Umbrella Trial</option><option>N-of-1 Trial</option>
        <option>Other…</option>
      </select>
    </label>

    <button id="findTrials" class="btn"><i class="fas fa-search"></i> Find Trials</button>
  </form>
  <div id="trialmatchPanel" class="response" hidden> … </div>
</section>
    
    <!-- 8. Data Analytics & ROI -->
    <section class="module" id="analytics">
      <h2><i class="fas fa-chart-pie"></i> Data Analytics & ROI</h2>
      <p class="desc">Visualize sessions, outcome metrics, and export CSV reports.</p>
      <div class="charts">
        <div class="chart-card">
          <canvas id="engagementChart" height="200"></canvas>
          <figcaption>Sessions Over Time</figcaption>
        </div>
        <div class="chart-card">
          <canvas id="outcomeChart" height="200"></canvas>
          <figcaption>Outcome Metrics</figcaption>
        </div>
      </div>
      <div style="display:flex;gap:1rem;margin-top:1rem;">
        <label>Date Range:
          <input type="date" id="analyticsFrom"> –
          <input type="date" id="analyticsTo">
        </label>
        <button id="exportCharts" class="btn"><i class="fas fa-file-export"></i> Export CSV</button>
      </div>
    </section>

    <!-- FOOTER -->
    <footer style="text-align:center;padding:1rem;background:var(--surface);color:var(--muted)">
      &copy; 2025 Vitra AI – Neuropharma Command Center
    </footer>

  </main>

  <!-- Chart.js + AI Proxy Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ── OpenAI Proxy + Markdown→HTML Helper ─────────────────────────────────
async function callOpenAI(messages) {
  const res = await fetch('/.netlify/functions/openai-proxy', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ messages })
  });
  if (!res.ok) throw new Error('OpenAI error');
  const j = await res.json();
  return j.choices[0].message.content;
}

function formatHTML(txt) {
  return txt
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    .split(/\n{2,}/).map(p=>`<p>${p.trim()}</p>`).join('');
}

document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;

  // ── PANEL UTILITY ──────────────────────────────────────────────
  function getPanel(sectionId) {
    const sec = document.getElementById(sectionId);
    let panel = sec.querySelector('.response');
    if (!panel) {
      panel = document.createElement('div');
      panel.className = 'response';
      // insert after the form/buttons area
      sec.append(panel);
    }
    panel.hidden = false;
    return panel;
  }

  // ── SIDEBAR & HEADER FIXES ─────────────────────────────────────
  document.getElementById('shrinkBtn').onclick = () =>
    document.getElementById('sidebar').classList.toggle('collapsed');

  document.getElementById('hamburger').onclick = () =>
    body.classList.toggle('sidebar-hidden');

  // ensure header moves left when sidebar-hidden
  const observer = new MutationObserver(() => {
    document.querySelector('header').classList.toggle(
      'sidebar-collapsed',
      body.classList.contains('sidebar-hidden')
    );
  });
  observer.observe(body, { attributes: true, attributeFilter: ['class'] });

  document.getElementById('themeToggle').onclick = () => {
    document.documentElement.classList.toggle('dark');
    document.getElementById('themeToggle').classList.toggle('fa-sun');
  };

  // ── THERAPY BOT ────────────────────────────────────────────────
  const chatBox   = document.getElementById('chatBox'),
        chatHint  = document.getElementById('chatHint'),
        chatInput = document.getElementById('therapyInput'),
        history   = [];

  function addMessage(who, txt) {
    const msg = document.createElement('div');
    msg.className = who === 'You' ? 'user-msg' : 'bot-msg';
    msg.innerHTML = `${formatHTML(txt)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
    chatBox.append(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  document.getElementById('sendChat').onclick = async e => {
    e.preventDefault();
    const txt = chatInput.value.trim();
    if (!txt) return;
    addMessage('You', txt);
    history.push({ who:'You', text: txt });
    chatInput.value = '';
    chatHint.style.display = 'block';

    const sys = `You are a therapist. Modality=${document.getElementById('therapyModality').value};` +
                `Length=${document.getElementById('therapyLength').value};` +
                `Language=${document.getElementById('therapyLang').value}.`;
    try {
      const reply = await callOpenAI([
        { role:'system', content: sys },
        { role:'user',   content: txt }
      ]);
      addMessage('Therapist', reply);
      history.push({ who:'Therapist', text: reply });
    } catch {
      addMessage('Therapist', '⚠️ Something went wrong.');
    } finally {
      chatHint.style.display = 'none';
    }
  };

  document.getElementById('clearChat').onclick = () => {
    chatBox.innerHTML = '';
    history.length = 0;
  };
  document.getElementById('viewHistory').onclick = () => {
    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:2000';
    modal.innerHTML = `
      <div style="background:var(--surface);padding:1rem;border-radius:var(--radius);max-width:400px;width:90%;">
        <h3>Chat History</h3>
        <ul style="list-style:none;padding:0;max-height:300px;overflow:auto;">
          ${history.map((m,i)=>`
            <li style="margin:.5rem 0;">
              <strong>${m.who}:</strong> ${m.text}
              <button data-i="${i}" style="float:right;border:none;background:none;color:var(--secondary);cursor:pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </li>`).join('')}
        </ul>
        <button onclick="this.closest('div').remove()">Close</button>
      </div>`;
    document.body.append(modal);
    modal.querySelectorAll('button[data-i]').forEach(btn=>{
      btn.onclick = () => { history.splice(+btn.dataset.i,1); modal.remove(); };
    });
  };

  // ── MOOD TRACKER ───────────────────────────────────────────────
  const moodR = document.getElementById('moodRange'),
        moodV = document.getElementById('moodValue');
  moodR.oninput = () => moodV.textContent = moodR.value;

  document.getElementById('mood-form').onsubmit = async e => {
    e.preventDefault();
    const panel = getPanel('moodTracker');
    panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;
    const data = {
      mood: moodR.value,
      emotions: [...document.querySelectorAll('#moodTracker input[name="emotions"]:checked')].map(c=>c.value),
      triggers: [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')].map(c=>c.value),
      note: document.getElementById('moodNote').value.trim(),
      selfCare: document.getElementById('selfCare').value
    };
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a mental health assistant.' },
        { role:'user',   content:`Daily Mood Entry:\n${JSON.stringify(data)}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── DREAM EXPLORER ─────────────────────────────────────────────
  function wireDream(btnId, sysPrompt, buildContent) {
    document.getElementById(btnId).onclick = async () => {
      const panel = getPanel('dream');
      panel.innerHTML = `<div class="result-content">Processing…<span class="spinner"></span></div>`;
      try {
        const reply = await callOpenAI([
          { role:'system', content: sysPrompt },
          { role:'user',   content: buildContent() }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
      }
    };
  }

  wireDream('analyzeDream',
            'You are a dream interpreter. Use all details.',
            () => {
              const narrative = document.getElementById('dreamText').value.trim();
              const symbols   = [...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(cb=>cb.value).join(', ');
              const pre       = document.getElementById('preMood').value;
              const post      = document.getElementById('postMood').value;
              const tags      = document.getElementById('dreamTags').value.trim();
              const refl      = document.getElementById('dreamReflect').value.trim();
              return `Narrative: ${narrative}\nSymbols: ${symbols}\nBefore sleep: ${pre}\nOn waking: ${post}\nTags: ${tags}\nReflection: ${refl}`;
            });

  wireDream('interpretSymbols',
            'You are a dream symbol interpreter.',
            () => `Symbols: ${[...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(cb=>cb.value).join(', ')}`);

  wireDream('generatePrompts',
            'You are a creative writing assistant.',
            () => `Generate 3 journaling prompts based on: ${document.getElementById('dreamText').value.trim()}`);

  // ── CREATIVE THERAPIES ─────────────────────────────────────────
  document.getElementById('artEmotion').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('creative');
    panel.innerHTML = `<div class="result-content">Generating…<span class="spinner"></span></div>`;
    const type   = document.getElementById('creativeType').value;
    const style  = document.getElementById('creativeStyle').value;
    const detail = document.getElementById('creativeDetail').value;
    try {
      const reply = await callOpenAI([
        { role:'system', content:`You are a creative AI generating ${type} in a ${style} style with detail level ${detail}.` },
        { role:'user',   content:'Please produce one creative piece.' }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">⚠️ Something went wrong.</div>`;
    }
  };

  // ── COGNITIVE GAMES ───────────────────────────────────────────
  document.getElementById('puzzles').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('games');
    panel.innerHTML = `<div class="result-content">Starting…<span class="spinner"></span></div>`;
    const game = document.getElementById('gameType').value;
    const diff = document.getElementById('gameDifficulty').value;
    try {
      const reply = await callOpenAI([
        { role:'system', content:`You are a games master creating a ${diff} ${game}.` },
        { role:'user',   content:'Please generate one challenge.' }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">⚠️ Something went wrong.</div>`;
    }
  };

  // ── MEDICATION SAFETY ─────────────────────────────────────────
  document.getElementById('medInteraction').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('medsafety');
    panel.innerHTML = `<div class="result-content">Checking…<span class="spinner"></span></div>`;
    const meds = document.getElementById('medList').value.trim();
    if (!meds) { panel.innerHTML = ''; return; }
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a drug interaction checker.' },
        { role:'user',   content:`Medications: ${meds}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };
  document.getElementById('adherence').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('medsafety');
    panel.innerHTML = `<div class="result-content">Generating reminders…<span class="spinner"></span></div>`;
    const meds = document.getElementById('medList').value.trim();
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a medication adherence coach.' },
        { role:'user',   content:`Create a daily schedule for: ${meds}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── SYMPTOM QUIZ ─────────────────────────────────────────────
  document.getElementById('launchQuiz').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('symptomQuiz');
    panel.innerHTML = `<div class="result-content">Scoring…<span class="spinner"></span></div>`;
    const s = document.querySelector('select[name="sleep"]').value;
    const a = document.querySelector('select[name="appetite"]').value;
    const c = document.querySelector('select[name="concentration"]').value;
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a clinical symptom scoring assistant.' },
        { role:'user',   content:`Sleep:${s},Appetite:${a},Concentration:${c}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── DATA ANALYTICS & EXPORT ─────────────────────────────────
  const engCtx = document.getElementById('engagementChart').getContext('2d'),
        outCtx = document.getElementById('outcomeChart').getContext('2d');

  const engChart = new Chart(engCtx, {
    type: 'line',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri'],
      datasets: [{ label:'Sessions', data:[12,9,14,11,13],
                   borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary').trim(),
                   fill:false }]
    }
  });
  const outChart = new Chart(outCtx, {
    type: 'bar',
    data: {
      labels: ['Week 1','Week 2','Week 3'],
      datasets: [{ label:'Outcome', data:[3.2,4.1,4.5],
                   backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim() }]
    }
  });

  document.getElementById('exportCharts').onclick = () => {
    let csv = 'Chart,Label,Value\n';
    [['Sessions',engChart],['Outcome',outChart]].forEach(([name,ch]) => {
      ch.data.labels.forEach((lab,i) => {
        csv += `${name},${lab},${ch.data.datasets[0].data[i]}\n`;
      });
    });
    const blob = new Blob([csv], { type:'text/csv' }),
          url  = URL.createObjectURL(blob),
          a    = document.createElement('a');
    a.href = url; a.download = 'analytics.csv'; a.click();
    URL.revokeObjectURL(url);
  };

  // ── NEUROTRANSMITTER BALANCE ──────────────────────────────
  document.getElementById('analyzeNeuro').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('neurotransmitter');
    panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;
    const data = {
      mood:       document.getElementById('ntMood').value,
      sleep:      document.getElementById('ntSleep').value,
      appetite:   document.getElementById('ntAppetite').value,
      adherence:  document.getElementById('ntAdherence').value,
      focus20:    document.getElementById('ntFocus').value
    };
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a neurotransmitter balance specialist.' },
        { role:'user',   content:`Profile Data:\n${JSON.stringify(data)}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── PHARMACOGENOMICS & DOSING ─────────────────────────────
  document.getElementById('runPGx').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('pharmacogenomics');
    panel.innerHTML = `<div class="result-content">Processing…<span class="spinner"></span></div>`;
    const drug   = document.getElementById('pgxDrug').value;
    const gene   = document.getElementById('pgxGene').value;
    const fileOK = document.getElementById('pgxUpload').files.length;
    if (!drug || !gene || !fileOK) { panel.innerHTML=''; return; }
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a pharmacogenomics expert.' },
        { role:'user',   content:`Drug:${drug}, Gene:${gene}, GenotypeFile:uploaded` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── DRUG INTERACTION PROFILER ────────────────────────────
  document.getElementById('checkInt').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('interactions');
    panel.innerHTML = `<div class="result-content">Checking…<span class="spinner"></span></div>`;
    const meds = document.getElementById('intList').value.trim();
    if (!meds) { panel.innerHTML = ''; return; }
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a drug interaction profiler.' },
        { role:'user',   content:`Medications: ${meds}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── EEG & BRAINWAVE INTERPRETER ──────────────────────────
  document.getElementById('analyzeEEG').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('eeg');
    panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;
    if (!document.getElementById('eegFile').files.length) { panel.innerHTML=''; return; }
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are an EEG & brainwave interpreter.' },
        { role:'user',   content:'EEG file uploaded.' }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

  // ── CLINICAL TRIAL MATCHING ENGINE ───────────────────────
  document.getElementById('findTrials').onclick = async e => {
    e.preventDefault();
    const panel = getPanel('trialmatch');
    panel.innerHTML = `<div class="result-content">Searching…<span class="spinner"></span></div>`;
    const dx  = document.getElementById('trialDx').value.trim();
    const loc = document.getElementById('trialLoc').value.trim();
    if (!dx || !loc) { panel.innerHTML=''; return; }
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a clinical trial matching engine.' },
        { role:'user',   content:`Diagnosis: ${dx}\nLocation: ${loc}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
    }
  };

});
</script>
</body>
</html>
