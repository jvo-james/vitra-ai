<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Psychology & Mental Health</title>
  <!-- Pale Blue + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
  /*────────────────── THEME VARIABLES ──────────────────*/
  :root {
    --primary: #7DA4E8;       /* darker pale blue */
    --secondary: #5C85D6;
    --accent: #E6EFFB;
    --bg: #F7FAFE;
    --surface: #FFFFFF;
    --text: #1A1A1A;
    --muted: #555555;
    --radius: 0.6rem;
    --padding: 1rem;
    --transition: 0.3s ease;
    --sidebar-w: 260px;
    --sidebar-collapsed-w: 60px;
    --header-h: 60px;
  }
  html.dark {
    --bg: #1F2233;
    --surface: #2B2E44;
    --text: #E0E0E0;
    --muted: #888888;
  }
  /*────────────────── RESET & BASE ──────────────────*/
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box }
  html { font-family:'Montserrat',sans-serif; scroll-behavior:smooth }
  body { display:flex; min-height:100vh; background:var(--bg); color:var(--text); overflow-x:hidden }
  a { color:inherit; text-decoration:none }
  button { font:inherit; cursor:pointer; }
  /*────────────────── SIDEBAR ──────────────────*/
  aside {
    flex:0 0 var(--sidebar-w);
    background:var(--surface);
    position:sticky; top:0;
    height:100vh;
    box-shadow:2px 0 12px rgba(0,0,0,0.05);
    transition:flex var(--transition);
    overflow:hidden; z-index:1000;
  }
  aside.collapsed { flex:0 0 var(--sidebar-collapsed-w); }
  .brand { display:flex;align-items:center;gap:.5rem;padding:var(--padding);font-size:1.2rem;color:var(--primary); }
  .brand span { transition:opacity var(--transition); }
  aside.collapsed .brand span { opacity:0; }
  nav { margin-top:1rem; display:flex; flex-direction:column; }
  nav a {
    display:flex; align-items:center; gap:1rem;
    padding:.75rem var(--padding); border-radius:var(--radius);
    font-weight:500; transition:background var(--transition);
  }
  nav a.active, nav a:hover { background:var(--primary); color:#fff; }
  #shrinkBtn {
    position:absolute; bottom:var(--padding); right:-18px;
    width:36px;height:36px;border-radius:50%;
    background:var(--primary); color:#fff;
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 3px 8px rgba(0,0,0,0.15);
  }
  /*────────────────── HEADER ──────────────────*/
  header {
    position:fixed; top:0; left:var(--sidebar-w); right:0;
    height:var(--header-h); background:var(--surface);
    display:flex; align-items:center; justify-content:space-between;
    padding:0 var(--padding); box-shadow:0 1px 4px rgba(0,0,0,0.1);
    transition:left var(--transition); z-index:999;
  }
  aside.collapsed ~ header { left:var(--sidebar-collapsed-w); }
  header h1 { font-size:1.3rem; font-weight:600; }
  .hamburger, .theme-toggle { font-size:1.4rem; color:var(--primary); transition:transform var(--transition); }
  .hamburger:hover, .theme-toggle:hover { transform:scale(1.1); }
  /*────────────────── MAIN & HERO ──────────────────*/
  main { flex:1; padding:calc(var(--header-h)+var(--padding)) var(--padding) var(--padding); overflow-x:hidden; }
  .hero {
    background:var(--surface); border-radius:var(--radius);
    padding:3rem var(--padding); text-align:center; position:relative; overflow:hidden;
    box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-bottom:2rem;
  }
  .hero h1 { font-size:2.5rem; color:var(--primary); margin-bottom:.5rem; display:flex; justify-content:center; align-items:center; gap:.5rem; }
  .hero p { font-size:1.1rem; color:var(--muted); margin-bottom:2rem; }
  .hero .actions { display:flex; gap:1rem; flex-wrap:wrap; justify-content:center; }
  .hero .actions a {
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.75rem 1.5rem; border-radius:var(--radius);
    transition:transform var(--transition);
  }
  .hero .actions a.btn-primary { background:var(--primary); color:#fff; }
  .hero .actions a.btn-secondary { background:var(--secondary); color:#fff; }
  .hero .actions a:hover { transform:translateY(-2px); }
  /*────────────────── MODULE SECTIONS ──────────────────*/
  section.module {
    background:var(--surface); border-radius:var(--radius);
    padding:var(--padding); margin-bottom:1.5rem;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
  }
  section.module h2 { display:flex;align-items:center;gap:.5rem;font-size:1.4rem;color:var(--primary);margin-bottom:.5rem }
  section.module p.desc { color:var(--muted); margin-bottom:1rem; }
  .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.6rem 1rem; border-radius:var(--radius); transition:transform var(--transition); }
  .btn:hover { transform:translateY(-2px); }
  .btn-primary { background:var(--primary); color:#fff; }
  .btn-secondary { background:var(--secondary); color:#fff; }
  /* Response Panel (chat & modules) */
  .response {
    background:var(--accent); border-left:4px solid var(--secondary);
    padding:var(--padding); border-radius:var(--radius);
    margin-top:1rem; position:relative;
  }
  .response .result-content { margin-top:.5rem; white-space:pre-wrap; }
  .spinner {
    display:inline-block; width:1em; height:1em;
    border:2px solid var(--primary); border-top-color:transparent;
    border-radius:50%; animation:spin .8s linear infinite;
    vertical-align:middle; margin-left:.25em;
  }
  @keyframes spin { to { transform:rotate(360deg); } }
  /*────────────────── CHATBOT UI ──────────────────*/
  .chat-box {
    background:var(--bg); border:1px solid var(--accent);
    border-radius:var(--radius); padding:var(--padding);
    max-height:300px; overflow-y:auto; display:flex; flex-direction:column;
  }
  .user-msg, .bot-msg {
    max-width:80%; margin:0.5rem 0; padding:.8rem 1rem;
    border-radius:1.2rem; position:relative;
  }
  .user-msg { background:var(--primary); color:#fff; align-self:flex-end; border-bottom-right-radius:.2rem; }
  .bot-msg  { background:var(--accent); color:var(--text); align-self:flex-start; border-bottom-left-radius:.2rem; }
  .timestamp {
    font-size:.7rem; position:absolute; bottom:-1.2rem; right:.8rem; color:var(--muted);
  }
  .close-btn {
    position:absolute; top:.5rem; right:.5rem; background:none; border:none;
    color:var(--secondary); font-size:1.2rem; cursor:pointer;
  }
  .tool-row { position:absolute; bottom:.5rem; right:.5rem; display:flex; gap:.5rem; }
  .tool-row button { background:var(--surface); border:1px solid var(--muted); border-radius:50%; width:1.6rem; height:1.6rem; font-size:.85rem; display:flex; align-items:center; justify-content:center; cursor:pointer; }
  /*────────────────── CHARTS ──────────────────*/
  .charts { display:grid; grid-template-columns:repeat(2,1fr); gap:1rem; margin-top:1rem; }
  .chart-card { background:var(--surface); border-radius:var(--radius); padding:var(--padding); box-shadow:0 2px 6px rgba(0,0,0,0.05); display:flex; flex-direction:column; }
  .chart-card canvas { flex:1; width:100%!important; height:180px!important; }
  /*────────────────── RESPONSIVE ──────────────────*/
  @media(max-width:1024px){
    aside { position:fixed; transform:translateX(-100%); z-index:900; }
    aside.open { transform:translateX(0); }
    header { left:0!important; }
  }
  @media(max-width:640px){
    section.module { padding:.75rem; }
    .charts { grid-template-columns:1fr; }
  }
    /* Daily Mood Tracker Styles */
#moodTracker {
  /* ensure consistency with other modules */
  background: var(--surface);
  border-radius: var(--radius);
  padding: var(--padding);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  margin-bottom: 1.5rem;
}

#moodTracker h2 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.4rem;
  color: var(--primary);
  margin-bottom: 0.5rem;
}

#moodTracker .desc {
  color: var(--muted);
  margin-bottom: 1rem;
}

#moodTracker form#mood-form {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

#moodTracker label {
  font-weight: 500;
}

#moodTracker input[type="range"] {
  width: 100%;
  margin-top: 0.25rem;
}

#moodTracker fieldset {
  border: 1px solid #ddd;
  border-radius: var(--radius);
  padding: 0.75rem;
}

#moodTracker fieldset legend {
  padding: 0 0.5rem;
  font-weight: 600;
  color: var(--secondary);
}

#moodTracker .checkbox-group {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 0.5rem;
  margin-top: 0.5rem;
}

#moodTracker .checkbox-group label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.95rem;
  cursor: pointer;
}

#moodTracker textarea,
#moodTracker select {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #d1dce5;
  border-radius: var(--radius);
  font-size: 0.95rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}

#moodTracker textarea:focus,
#moodTracker select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 8px var(--primary);
}

#moodTracker button[type="submit"] {
  justify-self: start;
  background: var(--primary);
  color: #fff;
  padding: 0.7rem 1.4rem;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  transition: transform var(--transition), box-shadow var(--transition);
}

#moodTracker button[type="submit"]:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 14px rgba(0,0,0,0.12);
}

/* Response Panel Overrides */
#moodPanel.response {
  padding-top: 2rem;
}

#moodPanel .close-btn {
  position: absolute;
  top: var(--padding);
  right: var(--padding);
  background: none;
  border: none;
  color: var(--secondary);
  font-size: 1.2rem;
  cursor: pointer;
}

#moodPanel .tool-row {
  position: absolute;
  bottom: var(--padding);
  right: var(--padding);
  display: flex;
  gap: 0.5rem;
}

#moodPanel .tool-row button {
  background: var(--surface);
  border: 1px solid var(--muted);
  border-radius: 50%;
  width: 1.6rem;
  height: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.85rem;
  cursor: pointer;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  #moodTracker .checkbox-group {
    grid-template-columns: 1fr;
  }
}
    /* ─── Dream & Subconscious Explorer ───────────────────────────────────── */
.dream-block {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: var(--accent);
  border-radius: var(--radius);
}
.dream-block h3 {
  display: flex;
  align-items: center;
  gap: .5rem;
  font-size: 1.1rem;
  color: var(--secondary);
  margin-bottom: .25rem;
}
.dream-block .mini-desc {
  font-size: .9rem;
  color: var(--muted);
  margin-bottom: .5rem;
}
.dream-block textarea,
.dream-block input[type="text"],
.dream-block select {
  width: 100%;
  padding: .75rem;
  border: 1px solid #d1dce5;
  border-radius: var(--radius);
  font-size: .95rem;
  margin-bottom: .5rem;
  background: var(--surface);
  color: var(--text);
}
.dream-block input[type="file"] {
  display: block;
  margin-bottom: .5rem;
}
.checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: .75rem;
}
.checkbox-group label {
  display: inline-flex;
  align-items: center;
  gap: .25rem;
  font-size: .9rem;
  color: var(--text);
}
.checkbox-group input[type="checkbox"] {
  transform: scale(1.1);
}
#otherSymbol {
  flex: 1;
  padding: .5rem;
}
.dream-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
  margin-top: 1rem;
}
.dream-actions .btn {
  font-size: .95rem;
}
#dreamPanel {
  margin-top: 1.5rem;
}
#dreamPanel .close-btn {
  position: absolute;
  top: .5rem;
  right: .5rem;
}
#dreamPanel .tool-row {
  position: absolute;
  bottom: .5rem;
  right: .5rem;
}
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-brain"></i><span>Vitra AI</span></div>
    <nav>
      <a href="index.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
      <a href="psychology.html" class="active"><i class="fas fa-brain"></i><span>Psych &amp; MH</span></a>
      <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
      <a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i><span>Consult Booking</span></a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
  </aside>

  <!-- HEADER -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>Psychology &amp; Mental Health</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- MAIN CONTENT -->
  <main>

    <!-- HERO -->
    <section class="hero" id="hero">
      <h1><i class="fas fa-brain"></i> Empower Your Mind with AI</h1>
      <p>Discover multimodal insights, therapeutic chats, creative therapies, and more—powered by advanced AI.</p>
      <div class="actions">
        <a href="#therapybot" class="btn btn-primary"><i class="fas fa-comments"></i> Talk to Therapy Bot</a>
        <a href="#insight" class="btn btn-secondary"><i class="fas fa-wave-square"></i> Emotional Insight</a>
      </div>
    </section>

    <!-- 1. Conversational “Therapy Bot” -->
    <section class="module" id="therapybot">
      <h2><i class="fas fa-robot"></i> 1. Conversational “Therapy Bot”</h2>
      <p class="desc">Engage in guided CBT exercises or get crisis support instantly.</p>
      <div id="chatControls" class="chat-controls" style="display:flex;justify-content:flex-end;gap:.5rem;margin-bottom:.5rem;">
        <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
        <button id="clearChat" title="Clear Chat"><i class="fas fa-trash"></i></button>
      </div>
      <div id="chatBox" class="chat-box" role="log" aria-live="polite"></div>
      <div class="chat-input-row" style="display:flex;gap:.5rem;margin-top:.5rem;">
        <input id="chatInput" type="text" placeholder="Ask about your thoughts or feelings…" style="flex:1;padding:.8rem;border:1px solid var(--muted);border-radius:var(--radius);"/>
        <button id="sendChat" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div id="chatHint" class="desc" style="margin-top:.5rem;display:none;">Bot is thinking… <span class="spinner"></span></div>
    </section>

    <!-- 2. Multimodal Emotional Insight -->
    <section class="module" id="insight">
      <h2><i class="fas fa-wave-square"></i> 2. Multimodal Emotional Insight</h2>
      <p class="desc">Record voice/video or type your thoughts to get real-time emotional analysis.</p>
      <button class="btn btn-primary" id="startVideo"><i class="fas fa-video"></i> Record 30s Video</button>
      <button class="btn btn-secondary" id="typingAnalysis"><i class="fas fa-keyboard"></i> Typing Dynamics</button>
      <div id="insightPanel"></div>
    </section>

 <!-- 3. Daily Mood Tracker -->
<section class="module" id="moodTracker">
  <h2><i class="fas fa-sliders-h"></i> 3. Daily Mood Tracker</h2>
  <p class="desc">
    Consistent mood logging helps you and our AI detect patterns, triggers, and early warning signs.  
    Empower yourself with insights and personalized self-care tips.
  </p>
  <form id="mood-form">
    <!-- Mood Rating -->
    <label for="moodRange">Mood Rating: <strong><span id="moodValue">5</span>/10</strong></label>
    <input type="range" id="moodRange" name="mood" min="1" max="10" value="5" />

    <!-- Emotions Tags -->
    <fieldset>
      <legend>Select all that apply:</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" name="emotions" value="Happy"> <i class="far fa-smile"></i> Happy</label>
        <label><input type="checkbox" name="emotions" value="Sad"> <i class="far fa-frown"></i> Sad</label>
        <label><input type="checkbox" name="emotions" value="Anxious"> <i class="fas fa-exclamation-triangle"></i> Anxious</label>
        <label><input type="checkbox" name="emotions" value="Calm"> <i class="fas fa-water"></i> Calm</label>
        <label><input type="checkbox" name="emotions" value="Angry"> <i class="fas fa-fire"></i> Angry</label>
        <label><input type="checkbox" name="emotions" value="Motivated"> <i class="fas fa-bolt"></i> Motivated</label>
      </div>
    </fieldset>

    <!-- Triggers Checklist -->
    <fieldset>
      <legend>Potential Triggers:</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" name="triggers" value="Work"> Work</label>
        <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
        <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
        <label><input type="checkbox" name="triggers" value="Health"> Health</label>
        <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
        <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
      </div>
    </fieldset>

    <!-- Quick Journal -->
    <label for="moodNote">Quick Journal Entry:</label>
    <textarea id="moodNote" name="note" rows="3" placeholder="How are you feeling? What happened today?"></textarea>

    <!-- Self-Care Suggestion -->
    <label for="selfCare">Self-Care Focus:</label>
    <select id="selfCare" name="selfCare">
      <option disabled selected>Select an area…</option>
      <option value="Breathing">Guided Breathing</option>
      <option value="Stretching">Stretch & Movement</option>
      <option value="Mindfulness">Mindfulness Pause</option>
      <option value="Music">Music Break</option>
      <option value="Walk">Short Walk</option>
    </select>

    <!-- Submit -->
    <button type="submit" class="btn btn-primary"><i class="fas fa-chart-line"></i> Analyze Mood</button>
  </form>

  <!-- AI Response Panel -->
  <div id="moodPanel" class="response" hidden>
    <button class="close-btn" aria-label="Close result"><i class="fas fa-times"></i></button>
    <div class="result-content"></div>
    <div class="tool-row">
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"   title="Download"><i class="fas fa-download"></i></button>
    </div>
  </div>
</section>


    <!-- 4. Dream & Subconscious Explorer -->
 <section class="module" id="dream">
  <h2><i class="fas fa-bed"></i> 4. Dream &amp; Subconscious Explorer</h2>
  <p class="desc">
    Dive into the depths of your nightly mind—capture narratives, symbols, emotions, and ambient sounds.
    Our AI weaves them together to surface hidden patterns, archetypes, and personalized insights.
  </p>

  <!-- 1. Dream Narrative -->
  <div class="dream-block">
    <h3><i class="fas fa-feather-alt"></i> Dream Narrative</h3>
    <p class="mini-desc">Write down every detail you remember—characters, colors, emotions, settings.</p>
    <textarea id="dreamText" rows="4" placeholder="“I found myself… ”"></textarea>
  </div>

  <!-- 2. Audio Capture -->
  <div class="dream-block">
    <h3><i class="fas fa-microphone-alt"></i> Nighttime Audio (Optional)</h3>
    <p class="mini-desc">Upload or record sounds (breathing, ambient noise) to enrich context.</p>
    <input type="file" id="dreamAudio" accept="audio/*"/>
    <button class="btn btn-secondary" onclick="startRecording()">
      <i class="fas fa-record-vinyl"></i> Record 30s
    </button>
  </div>

  <!-- 3. Symbol & Theme Selector -->
  <div class="dream-block">
    <h3><i class="fas fa-swatchbook"></i> Symbols &amp; Themes</h3>
    <p class="mini-desc">Tick any motifs you noticed; add your own too.</p>
    <fieldset>
      <legend>Common Symbols</legend>
      <div class="checkbox-group">
        <label><input type="checkbox" value="water"/> <i class="fas fa-water"></i> Water</label>
        <label><input type="checkbox" value="flight"/> <i class="fas fa-wind"></i> Flight</label>
        <label><input type="checkbox" value="teeth"/> <i class="fas fa-tooth"></i> Teeth</label>
        <label><input type="checkbox" value="chase"/> <i class="fas fa-running"></i> Being Chased</label>
        <label><input type="checkbox" value="falling"/> <i class="fas fa-arrow-down"></i> Falling</label>
        <label>
          <input type="checkbox" id="otherSymbolChk"/> <i class="fas fa-plus"></i> Other:
          <input type="text" id="otherSymbol" placeholder="Your symbol"/>
        </label>
      </div>
    </fieldset>
  </div>

  <!-- 4. Pre-Sleep & Wake Mood -->
  <div class="dream-block">
    <h3><i class="fas fa-smile-beam"></i> Mood Before Sleep</h3>
    <p class="mini-desc">How did you feel drifting off?</p>
    <select id="preMood">
      <option disabled selected>Select mood…</option>
      <option>Calm</option><option>Anxious</option><option>Neutral</option><option>Excited</option><option>Sad</option><option>Other…</option>
    </select>

    <h3 style="margin-top:1rem;"><i class="fas fa-sun"></i> Mood On Waking</h3>
    <p class="mini-desc">How did you feel upon awakening?</p>
    <select id="postMood">
      <option disabled selected>Select mood…</option>
      <option>Refreshed</option><option>Tired</option><option>Confused</option><option>Inspired</option><option>Anxious</option><option>Other…</option>
    </select>
  </div>

  <!-- 5. Contextual Tags -->
  <div class="dream-block">
    <h3><i class="fas fa-tags"></i> Contextual Tags</h3>
    <p class="mini-desc">Add keywords: stressors, events, people, places.</p>
    <input type="text" id="dreamTags" placeholder="e.g. exam, hometown, graduation"/>
  </div>

  <!-- 6. Free-form Reflection -->
  <div class="dream-block">
    <h3><i class="fas fa-lightbulb"></i> Reflection &amp; Intentions</h3>
    <p class="mini-desc">What do you think this dream means? Set intentions for tomorrow.</p>
    <textarea id="dreamReflect" rows="3" placeholder="My reflection…"></textarea>
  </div>

  <!-- Action Buttons -->
 <div class="dream-actions">
    <button id="analyzeDream"   class="btn btn-primary"><i class="fas fa-brain"></i> Analyze Dream</button>
    <button id="interpretSymbols" class="btn btn-secondary"><i class="fas fa-search"></i> Interpret Symbols</button>
    <button id="generatePrompts"  class="btn btn-secondary"><i class="fas fa-pen-nib"></i> Generate Writing Prompts</button>
  </div>

  <!-- AI Response Panel -->
  <div id="dreamPanel" class="response" hidden>
    <button class="close-btn" aria-label="Close dream insights">&times;</button>
    <div class="tool-row">
      <button title="Copy"><i class="fas fa-copy"></i></button>
      <button title="Download"><i class="fas fa-download"></i></button>
    </div>
    <div class="result-content"></div>
  </div>
</section>

    <!-- 5. AI-Curated Creative Therapies -->
    <section class="module" id="creative">
      <h2><i class="fas fa-palette"></i> 5. AI-Curated Creative Therapies</h2>
      <p class="desc">Generate abstract art or soundscapes tailored to your emotions.</p>
      <button class="btn btn-primary" id="artEmotion"><i class="fas fa-brush"></i> Generate Art</button>
      <button class="btn btn-secondary" id="musicMixer"><i class="fas fa-music"></i> Mix Music</button>
      <div id="creativePanel"></div>
    </section>

    <!-- 6. Dynamic Cognitive Games -->
    <section class="module" id="games">
      <h2><i class="fas fa-gamepad"></i> 6. Dynamic Cognitive Games</h2>
      <p class="desc">Play adaptive puzzles or co-author stories to train your mind.</p>
      <button class="btn btn-primary" id="puzzles"><i class="fas fa-puzzle-piece"></i> Adaptive Puzzles</button>
      <button class="btn btn-secondary" id="storyBuilder"><i class="fas fa-book"></i> Story Builder</button>
      <div id="gamesPanel"></div>
    </section>

    <!-- 7. Predictive Risk & Early Warning -->
    <section class="module" id="risk">
      <h2><i class="fas fa-chart-line"></i> 7. Predictive Risk &amp; Early Warning</h2>
      <p class="desc">AI monitors digital signals to alert you before crisis points.</p>
      <button class="btn btn-primary" id="phenotyping"><i class="fas fa-tachometer-alt"></i> View Dashboard</button>
      <button class="btn btn-secondary" id="crisisAlerts"><i class="fas fa-bell"></i> Crisis Alerts</button>
      <div id="riskPanel"></div>
    </section>

    <!-- 8. Personalized Self-Care Plans -->
    <section class="module" id="selfcare">
      <h2><i class="fas fa-heart"></i> 8. Personalized Self-Care Plans</h2>
      <p class="desc">Get AI-generated activities and reminders to stay on track.</p>
      <button class="btn btn-primary" id="activitySuggest"><i class="fas fa-lightbulb"></i> Suggest Activities</button>
      <button class="btn btn-secondary" id="nudges"><i class="fas fa-bell"></i> Schedule Reminders</button>
      <div id="selfcarePanel"></div>
    </section>

    <!-- 9. Virtual Reality Micro-Therapies -->
    <section class="module" id="vr">
      <h2><i class="fas fa-vr-cardboard"></i> 9. Virtual Reality Micro-Therapies</h2>
      <p class="desc">Immersive VR experiences for phobia exposure and calm mindscapes.</p>
      <button class="btn btn-primary" id="phobiaSim"><i class="fas fa-exclamation-triangle"></i> Phobia Simulator</button>
      <button class="btn btn-secondary" id="mindscapes"><i class="fas fa-globe"></i> 360° Mindscapes</button>
      <div id="vrPanel"></div>
    </section>

    <!-- 10. Integrated Professional Ecosystem -->
    <section class="module" id="pro">
      <h2><i class="fas fa-toolbox"></i> 10. Integrated Professional Ecosystem</h2>
      <p class="desc">Tools for clinicians and seamless referrals when you need expert help.</p>
      <button class="btn btn-primary" id="clinicianToolkit"><i class="fas fa-file-alt"></i> Clinician Toolkit</button>
      <button class="btn btn-secondary" id="referralPipeline"><i class="fas fa-share-square"></i> Referral Pipeline</button>
      <div id="proPanel"></div>
    </section>

    <!-- 11. Medication Management & Safety -->
    <section class="module" id="medsafety">
      <h2><i class="fas fa-pills"></i> 11. Medication Management &amp; Safety</h2>
      <p class="desc">Check for dangerous interactions and track your adherence.</p>
      <button class="btn btn-primary" id="medInteraction"><i class="fas fa-exchange-alt"></i> Interaction Checker</button>
      <button class="btn btn-secondary" id="adherence"><i class="fas fa-check-circle"></i> Adherence Tracker</button>
      <div id="medsafetyPanel"></div>
    </section>

    <!-- 12. Symptom Questionnaire -->
    <section class="module" id="symptomQuiz">
      <h2><i class="fas fa-clipboard-list"></i> 12. Symptom Questionnaire</h2>
      <p class="desc">Answer a quick questionnaire; get AI-powered severity and next-step advice.</p>
      <button class="btn btn-primary" id="launchQuiz"><i class="fas fa-play"></i> Start Questionnaire</button>
      <div id="quizPanel"></div>
    </section>

    <!-- 13. Community & Peer Support -->
    <section class="module" id="community">
      <h2><i class="fas fa-users"></i> 13. Community &amp; Peer Support</h2>
      <p class="desc">Join AI-moderated support circles or get a check-in from your Buddy Bot.</p>
      <button class="btn btn-primary" id="supportCircles"><i class="fas fa-comments"></i> Support Circles</button>
      <button class="btn btn-secondary" id="buddyBot"><i class="fas fa-user-friends"></i> Buddy Bot</button>
      <div id="communityPanel"></div>
    </section>

    <!-- 14. Data Analytics & ROI -->
    <section class="module" id="analytics">
      <h2><i class="fas fa-chart-pie"></i> 14. Data Analytics &amp; ROI</h2>
      <p class="desc">Visualize your engagement and outcomes; export data for review.</p>
      <div class="charts">
        <div class="chart-card"><canvas id="engagementChart"></canvas><figcaption>Sessions Over Time</figcaption></div>
        <div class="chart-card"><canvas id="outcomeChart"></canvas><figcaption>Mood Improvement</figcaption></div>
      </div>
      <button id="exportCharts" class="btn btn-primary" style="margin-top:1rem;"><i class="fas fa-file-export"></i> Export CSV</button>
    </section>

    <!-- FOOTER -->
  <footer style="text-align:center;padding:var(--padding);background:var(--surface);color:var(--muted)">
    &copy; 2025 Vitra AI – Psychology &amp; Mental Health
  </footer>

  </main>

  
  <!-- SCRIPTS -->
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ── OpenAI proxy + Markdown helper ───────────────────────────────────────────
async function callOpenAI(messages) {
  const res = await fetch('/.netlify/functions/openai-proxy', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ messages })
  });
  if (!res.ok) throw new Error('OpenAI error');
  const j = await res.json();
  return j.choices[0].message.content;
}
function formatHTML(txt) {
  return txt
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .split(/\n{2,}/).map(p=>`<p>${p.trim()}</p>`).join('');
}

document.addEventListener('DOMContentLoaded', () => {
  // ── Utility: get-or-create response panel under any section ───────────────
  function getPanel(sectionId) {
    const sec = document.getElementById(sectionId);
    let panel = sec.querySelector('.response');
    if (!panel) {
      panel = document.createElement('div');
      panel.className = 'response';
      sec.append(panel);
    }
    panel.hidden = false;
    return panel;
  }

  // ── Sidebar & Theme Toggles ────────────────────────────────────────────────
  document.getElementById('shrinkBtn').onclick   = () => document.getElementById('sidebar').classList.toggle('collapsed');
  document.getElementById('hamburger').onclick   = () => document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('themeToggle').onclick = () => {
    document.documentElement.classList.toggle('dark');
    document.getElementById('themeToggle').classList.toggle('fa-sun');
  };

  // ── CHATBOT ───────────────────────────────────────────────────────────────
  const chatBox   = document.getElementById('chatBox'),
        history   = [],
        sendChat  = document.getElementById('sendChat'),
        chatInput = document.getElementById('chatInput'),
        chatHint  = document.getElementById('chatHint');

  function addMessage(who, text) {
    const msg = document.createElement('div');
    msg.className = who === 'You' ? 'user-msg' : 'bot-msg';
    msg.innerHTML = `${formatHTML(text)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
    chatBox.append(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  document.getElementById('viewHistory').onclick = () => {
    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:2000';
    modal.innerHTML = `
      <div style="background:var(--surface);padding:1rem;border-radius:var(--radius);max-width:360px;width:80%;">
        <h3 style="margin-bottom:.5rem;">Chat History</h3>
        <ul style="list-style:none;padding:0;max-height:300px;overflow:auto;">
          ${history.map((m,i)=>`
            <li style="margin-bottom:.5rem;">
              <strong>${m.who}:</strong> ${m.text}
              <button data-i="${i}" style="float:right;border:none;background:none;color:var(--secondary);cursor:pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </li>`).join('')}
        </ul>
        <button style="margin-top:.5rem;" onclick="this.closest('div[style]').remove()">Close</button>
      </div>`;
    document.body.append(modal);
    modal.querySelectorAll('button[data-i]').forEach(btn=>{
      btn.onclick = () => {
        history.splice(+btn.dataset.i,1);
        modal.remove();
      };
    });
  };

  document.getElementById('clearChat').onclick = () => {
    chatBox.innerHTML = '';
    history.length = 0;
  };

  sendChat.onclick = async () => {
    const txt = chatInput.value.trim();
    if (!txt) return;
    addMessage('You', txt);
    history.push({ who: 'You', text: txt });
    chatInput.value = '';
    chatHint.style.display = 'block';
    try {
      const reply = await callOpenAI([
        { role: 'system', content: 'You are a friendly therapist.' },
        { role: 'user',   content: txt }
      ]);
      addMessage('Therapist', reply);
      history.push({ who: 'Therapist', text: reply });
    } catch {
      addMessage('Therapist', '⚠️ Something went wrong.');
    } finally {
      chatHint.style.display = 'none';
    }
  };

  // ── MOOD TRACKER ──────────────────────────────────────────────────────────
  const moodRange = document.getElementById('moodRange'),
        moodValue = document.getElementById('moodValue');
  moodRange.addEventListener('input', () => moodValue.textContent = moodRange.value);

  document.getElementById('mood-form').addEventListener('submit', async e => {
    e.preventDefault();
    const panel = document.getElementById('moodPanel');
    panel.hidden = false;
    panel.querySelector('.result-content').innerHTML = 'Analyzing… <span class="spinner"></span>';

    const data = {
      mood: moodRange.value,
      emotions: [...document.querySelectorAll('input[name="emotions"]:checked')].map(c=>c.value),
      triggers: [...document.querySelectorAll('input[name="triggers"]:checked')].map(c=>c.value),
      note: document.getElementById('moodNote').value.trim(),
      selfCare: document.getElementById('selfCare').value
    };

    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a mental health assistant.' },
        { role:'user',   content:`Daily Mood Entry:\n${JSON.stringify(data)}` }
      ]);
      panel.querySelector('.result-content').innerHTML = formatHTML(reply);
    } catch {
      panel.querySelector('.result-content').innerHTML = '😕 Something went wrong.';
    }
  });

  // ── DREAM & SUBCONSCIOUS EXPLORER ────────────────────────────────────────
  document.getElementById('analyzeDream').onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Analyzing… <span class="spinner"></span></div>`;

    const narrative = document.getElementById('dreamText').value.trim();
    const symbols   = Array.from(
      document.querySelectorAll('#dream input[type="checkbox"]:checked')
    ).map(cb=>cb.value).join(', ');
    const preMood   = document.getElementById('preMood').value;
    const postMood  = document.getElementById('postMood').value;
    const tags      = document.getElementById('dreamTags').value.trim();
    const reflect   = document.getElementById('dreamReflect').value.trim();

    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a dream interpreter. Use all provided data.' },
        { role:'user',   content:
            `Narrative: ${narrative}\n` +
            `Symbols: ${symbols}\n` +
            `Before sleep: ${preMood}\n` +
            `On waking: ${postMood}\n` +
            `Tags: ${tags}\n` +
            `Reflection: ${reflect}`
        }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
    }
  };

  document.getElementById('interpretSymbols').onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Interpreting symbols… <span class="spinner"></span></div>`;
    const symbols = Array.from(
      document.querySelectorAll('#dream input[type="checkbox"]:checked')
    ).map(cb=>cb.value).join(', ');
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a dream symbol interpreter.' },
        { role:'user',   content:`Symbols: ${symbols}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
    }
  };

  document.getElementById('generatePrompts').onclick = async () => {
    const panel = getPanel('dream');
    panel.innerHTML = `<div class="result-content">Generating prompts… <span class="spinner"></span></div>`;
    const narrative = document.getElementById('dreamText').value.trim();
    try {
      const reply = await callOpenAI([
        { role:'system', content:'You are a creative writing assistant.' },
        { role:'user',   content:`Generate 3 journal prompts inspired by this dream: ${narrative}` }
      ]);
      panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
    } catch {
      panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
    }
  };

  // ── GENERIC MODULE HANDLER ───────────────────────────────────────────────
  function wire(id, systemPrompt, askText, sectionId) {
    document.getElementById(id).onclick = async () => {
      const panel = getPanel(sectionId);
      panel.innerHTML = `<div class="result-content">Processing… <span class="spinner"></span></div>`;
      const inp = prompt(askText);
      if (!inp) return panel.innerHTML = '';
      try {
        const reply = await callOpenAI([
          { role:'system', content: systemPrompt },
          { role:'user',   content: inp }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
      }
    };
  }

  // ── WIRE OTHER BUTTONS ──────────────────────────────────────────────────
  wire('startVideo',      'Analyze video emotion',         'Paste video URL:',       'insight');
  wire('typingAnalysis',  'Analyze typing for stress',     'Type a few sentences:',  'insight');
  wire('artEmotion',      'Generate art prompt',           'Enter an emotion:',      'creative');
  wire('musicMixer',      'Compose a soundscape',          'Describe your mood:',    'creative');
  wire('puzzles',         'Create an adaptive puzzle',     'Enter puzzle theme:',    'games');
  wire('storyBuilder',    'Continue a story',              'Enter story seed:',      'games');
  wire('phenotyping',     'Provide phenotyping dashboard', 'N/A',                    'risk');
  wire('crisisAlerts',    'Assess crisis risk',            'Describe feelings:',     'risk');
  wire('activitySuggest', 'Suggest self-care activities',  'How have you felt?',     'selfcare');
  wire('nudges',          'Schedule reminders',            'What reminder?',         'selfcare');
  wire('phobiaSim',       'Launch VR phobia simulator',    'N/A',                    'vr');
  wire('mindscapes',      'Launch VR mindscapes',          'N/A',                    'vr');
  wire('clinicianToolkit','Summarize session notes',       'Paste notes:',           'pro');
  wire('referralPipeline','Match to therapist',            'Enter user profile:',    'pro');
  wire('medInteraction',  'Warn of med interactions',      'Enter two meds:',        'medsafety');
  wire('adherence',       'Track adherence',               'N/A',                    'medsafety');
  wire('launchQuiz',      'Evaluate symptoms & advise',    'Answer quiz questions:', 'symptomQuiz');
  wire('supportCircles',  'Summarize support circle chat', 'Paste chat transcript:', 'community');
  wire('buddyBot',        'Buddy check-in',                'Enter last mood:',       'community');

  // ── ANALYTICS CSV EXPORT ────────────────────────────────────────────────
  document.getElementById('exportCharts').onclick = () => {
    const eng = Chart.getChart('engagementChart'),
          out = Chart.getChart('outcomeChart');
    let csv = 'Chart,Label,Value\n';
    [['Sessions', eng], ['Mood', out]].forEach(([name,ch]) => {
      ch.data.labels.forEach((lab,i) => csv += `${name},${lab},${ch.data.datasets[0].data[i]}\n`);
    });
    const blob = new Blob([csv], {type:'text/csv'}),
          url  = URL.createObjectURL(blob),
          a    = document.createElement('a');
    a.href = url; a.download = 'analytics.csv'; a.click();
    URL.revokeObjectURL(url);
  };
});
</script>
</body>
</html>
