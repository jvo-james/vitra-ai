<!DOCTYPE html>
<html lang="en" aria-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vitra AI – Neuropharma Command Center</title>
  <!-- Montserrat + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /*──────────────────────── Theme & Reset ─────────────────────────────────*/
    :root {
      --primary: #5A8DEE; --primary-alt: #7DA4E8; --secondary: #FF758C;
      --accent: rgba(255,255,255,0.4); --bg: #F0F4F8; --surface: rgba(255,255,255,0.85);
      --text: #1F2937; --muted: #546E7A; --radius: .75rem; --padding: 1rem;
      --transition: .3s ease; --shadow-light: 0 4px 20px rgba(0,0,0,.05);
    }
    html.dark {
      --bg:#111827; --surface:rgba(30,35,54,.85); --text:#E0E6F0; --muted:#9AA5B1; --accent:rgba(30,35,54,.5);
    }
    *,*::before,*::after {margin:0;padding:0;box-sizing:border-box;}
    html {font-family:'Montserrat',sans-serif;scroll-behavior:smooth;}
    body {display:flex;min-height:100vh;background:var(--bg);color:var(--text);overflow-x:hidden;}
    a{color:inherit;text-decoration:none;}button,input,textarea,select{font:inherit;transition:all var(--transition);}
    :focus{outline:2px solid var(--primary);outline-offset:2px;}

    :root {
  --sidebar-width: 260px;
  --sidebar-hidden-width: 0;
}

body.sidebar-hidden aside {
  transform: translateX(-100%);
}

body.sidebar-hidden header {
  left: 0 !important;
}

header {
  left: var(--sidebar-width);
}

aside {
  transition: transform var(--transition);
}

@media (max-width: 768px) {
  header {
    left: 0 !important;
  }
  body:not(.sidebar-hidden) aside {
    position: fixed;
    z-index: 2000;
  }
}
    /*──────────────────────── Sidebar ─────────────────────────────────*/
    aside{flex:0 0 260px;background:var(--surface);backdrop-filter:blur(12px);box-shadow:var(--shadow-light);
      position:sticky;top:0;height:100vh;display:flex;flex-direction:column;transition:flex var(--transition);}
    aside.collapsed{flex:0 0 72px;}
    .brand{display:flex;align-items:center;gap:.75rem;padding:var(--padding);font-size:1.2rem;color:var(--primary);}
    aside.collapsed .brand span{opacity:0;}
    nav{flex:1;overflow-y:auto;margin-top:.5rem;}
    nav a{display:flex;align-items:center;gap:1rem;padding:.75rem var(--padding);border-radius:var(--radius);
         transition:background var(--transition),transform var(--transition);}
    nav a:hover,nav a.active{background:var(--primary);color:#fff;transform:translateX(4px);}
    #shrinkBtn{margin:var(--padding) auto;width:36px;height:36px;border-radius:50%;
               background:var(--primary);color:#fff;box-shadow:0 8px 40px rgba(0,0,0,.1);}
    #shrinkBtn:hover{transform:scale(1.1);}

    /*──────────────────────── Header ─────────────────────────────────*/
    header{position:fixed;top:0;left:260px;right:0;height:60px;
      background:var(--surface);backdrop-filter:blur(12px);display:flex;align-items:center;
      justify-content:space-between;padding:0 var(--padding);box-shadow:var(--shadow-light);transition:left var(--transition);z-index:1000;}
    header.sidebar-collapsed{left:72px;}
    header h1{font-size:1.4rem;}
    .hamburger,.theme-toggle{font-size:1.5rem;color:var(--primary);cursor:pointer;}
    .hamburger:hover,.theme-toggle:hover{transform:scale(1.1);}

    /*──────────────────────── Main & Hero ─────────────────────────────────*/
    /* ── Main & Hero ─────────────────────────────────────────────────── */
main {
  flex: 1;
  margin-top: 60px;
  margin-left: var(--sidebar-width);     /* use the same variable as the sidebar */
  padding: var(--padding);
  transition: margin-left var(--transition);
}
@media (max-width: 1024px) {
  /* on smaller screens, collapse margin */
  main {
    margin-left: 0;
  }
}
  /* when sidebar is hidden, remove that left margin */
 body.sidebar-hidden main {
   margin-left: 0;
  }
    .hero{position:relative;background:var(--surface);backdrop-filter:blur(12px);border-radius:var(--radius);
          padding:3rem var(--padding);text-align:center;box-shadow:0 8px 40px rgba(0,0,0,.1);margin-bottom:2rem;}
    .hero h1{font-size:2.75rem;color:var(--primary);margin-bottom:1rem;}
    .hero p{font-size:1.2rem;color:var(--muted);margin-bottom:2rem;max-width:600px;margin-inline:auto;}
    .hero .actions{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;}
    .hero .actions a{background:var(--primary);color:#fff;padding:1rem 1.5rem;border-radius:var(--radius);
                     box-shadow:var(--shadow-light);transition:transform var(--transition),background var(--transition);}
    .hero .actions a.btn-secondary{background:var(--secondary);}
    .hero .actions a:hover{transform:translateY(-3px);}
    .hero-icons{position:absolute;top:1rem;right:1rem;display:flex;flex-direction:column;gap:.5rem;font-size:2rem;opacity:.15;}

    /*──────────────────────── Modules ─────────────────────────────────*/
    section.module{background:var(--surface);backdrop-filter:blur(8px);border-radius:var(--radius);
                   padding:var(--padding);margin-bottom:1.5rem;box-shadow:var(--shadow-light);
                   transition:transform var(--transition);}
    section.module:hover{transform:translateY(-4px);}
    section.module h2{display:flex;align-items:center;gap:.5rem;font-size:1.5rem;color:var(--primary);margin-bottom:.75rem;}
    section.module p.desc{color:var(--muted);font-size:1rem;margin-bottom:1rem;}

    /*──────────────────────── Inputs & Buttons ─────────────────────────────────*/
    input[type="text"],input[type="number"],textarea,select{width:100%;padding:.75rem;border:1px solid var(--muted);
      border-radius:var(--radius);background:var(--accent);color:var(--text);}
    input:focus,textarea:focus,select:focus{box-shadow:0 0 8px var(--primary);}
    input[type="range"]{width:100%;accent-color:var(--primary);}
    .checkbox-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.5rem;}
    fieldset{border:1px solid var(--muted);border-radius:var(--radius);padding:.75rem;}
    legend{padding:0 .5rem;font-weight:600;color:var(--secondary);}
    button.btn{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;border:none;
               border-radius:var(--radius);background:var(--primary);color:#fff;font-weight:600;
               box-shadow:var(--shadow-light);cursor:pointer;transition:background var(--transition),transform var(--transition);}
    button.btn-secondary{background:var(--secondary);}
    button.btn:hover{transform:translateY(-2px);box-shadow:0 8px 40px rgba(0,0,0,.1);}
    button.btn-secondary:hover{background:var(--primary-alt);}

    /*──────────────────────── Response Panels ─────────────────────────────────*/
      .response{background:var(--surface);backdrop-filter:blur(8px);border-left:4px solid var(--secondary);
              padding:var(--padding);border-radius:var(--radius);margin-top:1rem;position:relative;box-shadow:var(--shadow-light);
              transition:all var(--transition);}
    .response .result-content{white-space:pre-wrap;line-height:1.5;}
    .tool-row{position:absolute;bottom:var(--padding);left:auto;right:var(--padding);display:flex;gap:.5rem;}
    .close-btn,.copy-btn,.dl-btn{background:none;border:none;cursor:pointer;}
    .copy-btn,.dl-btn{border:1px solid var(--muted);border-radius:50%;width:1.6rem;height:1.6rem;
                      display:flex;align-items:center;justify-content:center;}
    .copy-btn:focus,.dl-btn:focus{outline:none;}
    
    /*──────────────────────── Chat UI ─────────────────────────────────*/
    .chat-box{background:var(--bg);border:1px solid var(--muted);border-radius:var(--radius);
              padding:var(--padding);max-height:300px;overflow-y:auto;display:flex;flex-direction:column;}
    .user-msg,.bot-msg{max-width:75%;padding:.75rem 1rem;margin:.5rem 0;border-radius:1rem;position:relative;}
    .user-msg{background:var(--primary);color:#fff;align-self:flex-end;}
    .bot-msg{background:var(--accent);color:var(--text);align-self:flex-start;}
    .timestamp{font-size:.65rem;color:var(--muted);position:absolute;bottom:-1.2rem;right:1rem;}
    /* push chat tools to top-right, out of the way */
#therapybot .tool-row {
  position: absolute;
  top: var(--padding);
  right: var(--padding);
  left: auto !important;
}
    #therapybot form {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: .75rem;
  align-items: end;
}
#therapybot input, #therapybot select, #therapybot button {
  border-radius: var(--radius);
  padding: .75rem;
}
#therapybot button#sendChat {
  background: var(--secondary);
  color: #fff;
  border: none;
  box-shadow: var(--shadow-light);
}
#therapybot button#sendChat:hover {
  background: var(--secondary-alt, var(--secondary));
}
    /* ── Fix Chatbot Tool-Row Height ─────────────────────────────────────── */
#therapybot .tool-row {
  position: absolute;
  top: var(--padding);
  right: var(--padding);
  bottom: auto;      /* reset the bottom so it doesn’t stretch */
  height: auto;      /* ensure it sizes to its contents */
  display: flex;
  gap: .5rem;
  z-index: 5;        /* sit above the chat box */
}
    .chat-box{background:var(--bg);border:1px solid var(--muted);border-radius:var(--radius);
              padding:var(--padding);max-height:300px;overflow-y:auto;display:flex;flex-direction:column;}
    .bot-msg{background:var(--accent);color:var(--text);align-self:flex-start;padding:.75rem 1rem;border-radius:1rem;}
    .user-msg{background:var(--primary);color:#fff;align-self:flex-end;padding:.75rem 1rem;border-radius:1rem;}
    .timestamp{font-size:.65rem;color:var(--muted);position:absolute;bottom:-1.2rem;right:1rem;}
    /*────────────────── NEUROTRANSMITTER BALANCE ──────────────────*/
#neurotransmitter {
  background: linear-gradient(135deg, rgba(90,142,238,0.15), rgba(255,117,140,0.1));
  border: 2px solid var(--primary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(90,142,238,0.2);
}
#neurotransmitter h2 {
  color: var(--primary-alt);
  background: var(--primary);
  -webkit-background-clip: text;
  color: transparent;
  font-size: 1.7rem;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
}
#neurotransmitter .desc {
  font-style: italic;
  margin-bottom: 1rem;
}
#neurotransmitter form label {
  display: block;
  margin-bottom: 1rem;
}
#neurotransmitter input[type="range"]::-webkit-slider-thumb,
#neurotransmitter select,
#neurotransmitter input[type="range"] {
  accent-color: var(--primary-alt);
}
#neurotransmitter #ntFocus {
  background: var(--accent);
  border: 1px solid var(--primary-alt);
}
#neurotransmitter button {
  background: var(--primary-alt);
  box-shadow: 0 4px 14px rgba(125,164,232,0.4);
}
#neurotransmitter button:hover {
  background: var(--primary);
}

/*────────────────── PHARMACOGENOMICS & DOSING ──────────────────*/
#pharmacogenomics {
  background: linear-gradient(145deg, rgba(255,117,140,0.1), rgba(90,142,238,0.1));
  border: 2px dashed var(--secondary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(255,117,140,0.2);
}
#pharmacogenomics h2 {
  color: var(--secondary);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#pharmacogenomics .desc {
  margin-bottom: 1rem;
}
#pharmacogenomics form label {
  display: block;
  margin-bottom: 1rem;
}
#pharmacogenomics select#pgxGene {
  background: var(--accent);
  border: 1px solid var(--secondary);
}
#pharmacogenomics button {
  background: var(--secondary);
  box-shadow: 0 4px 14px rgba(255,117,140,0.4);
}
#pharmacogenomics button:hover {
  background: var(--secondary-alt, var(--secondary));
}

/*────────────────── DRUG INTERACTION PROFILER ──────────────────*/
#interactions {
  background: rgba(90,142,238,0.05);
  border-left: 6px solid var(--primary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(0,0,0,0.05);
}
#interactions h2 {
  color: var(--primary);
  position: relative;
}
#interactions h2::after {
  content: '';
  display: block;
  width: 40px;
  height: 4px;
  background: var(--primary-alt);
  margin-top: 4px;
}
#interactions .desc {
  margin-bottom: 1rem;
}
#interactions form label {
  display: block;
  margin-bottom: 1rem;
}
#interactions select#intComorbid {
  background: var(--accent);
  border: 1px solid var(--primary);
}
#interactions button {
  background: var(--primary);
  box-shadow: 0 4px 14px rgba(90,142,238,0.4);
}
#interactions button:hover {
  background: var(--primary-alt);
}

/*────────────────── EEG & BRAINWAVE INTERPRETER ──────────────────*/
#eeg {
  background: linear-gradient(135deg, rgba(125,164,232,0.1), rgba(255,117,140,0.1));
  border: 2px solid var(--primary-alt);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(125,164,232,0.2);
}
#eeg h2 {
  color: var(--primary-alt);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#eeg .desc {
  margin-bottom: 1rem;
}
#eeg form label {
  display: block;
  margin-bottom: 1rem;
}
#eeg select#eegCondition {
  background: var(--accent);
  border: 1px solid var(--primary-alt);
}
#eeg button {
  background: var(--primary-alt);
  box-shadow: 0 4px 14px rgba(125,164,232,0.4);
}
#eeg button:hover {
  background: var(--primary);
}

/*────────────────── CLINICAL TRIAL MATCHING ENGINE ──────────────────*/
#trialmatch {
  background: rgba(255,117,140,0.05);
  border: 2px dashed var(--secondary);
  padding: calc(var(--padding) * 1.5);
  border-radius: var(--radius);
  box-shadow: 0 8px 30px rgba(255,117,140,0.2);
}
#trialmatch h2 {
  color: var(--secondary);
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
#trialmatch .desc {
  margin-bottom: 1rem;
}
#trialmatch form label {
  display: block;
  margin-bottom: 1rem;
}
#trialmatch select#trialPhase {
  background: var(--accent);
  border: 1px solid var(--secondary);
}
#trialmatch button {
  background: var(--secondary);
  box-shadow: 0 4px 14px rgba(255,117,140,0.4);
}
#trialmatch button:hover {
  background: var(--secondary-alt, var(--secondary));
}

/*────────────────── RESPONSE PANEL ENHANCEMENTS ──────────────────*/
.response {
  transition: all 0.3s ease;
}
.response .close-btn { color: var(--muted); }
.response .copy-btn, .response .dl-btn {
  background: var(--surface);
  border: 1px solid var(--muted);
}
.response .copy-btn:hover, .response .dl-btn:hover {
  background: var(--accent);
  transform: scale(1.2);
}
       #creativeDetail + #rangeVal {margin-left:.5rem;font-weight:600;}

    /*──────────────────────── Clinical Trial, Drug Profiler & PGx ─────────────────────────────────*/
    select, input[type="text"], input[type="number"], textarea{width:100%;padding:.75rem;border:1px solid var(--muted);
      border-radius:var(--radius);background:var(--accent);color:var(--text);}
    fieldset{border:1px solid var(--muted);padding:.75rem;border-radius:var(--radius);}
    legend{padding:0 .5rem;font-weight:600;color:var(--secondary);}
    
    /*──────────────────────── Charts ─────────────────────────────────*/
    .charts{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;}
    .chart-card{background:var(--surface);backdrop-filter:blur(8px);border-radius:var(--radius);
                padding:var(--padding);box-shadow:var(--shadow-light);display:flex;flex-direction:column;}
    .chart-card canvas{flex:1;}

    /*──────────────────────── Responsive ─────────────────────────────────*/
    @media(max-width:1024px){header{padding:0 .5rem;} .hero{padding:2rem .75rem;}}
    @media(max-width:640px){.hero h1{font-size:2rem;}section.module{padding:.75rem;}
      .hero-icons{display:none;} .checkbox-group{grid-template-columns:1fr;}}
  /* hide hamburger on wider screens */
@media (min-width: 769px) {
  #hamburger { display: none; }
}
    @media (min-width: 769px) {
  aside { position: fixed; left: 0; z-index: 1000; }
  main { margin-left: var(--sidebar-width); } /* main always offset */
  header { left: var(--sidebar-width); }
}
@media (max-width: 768px) {
  /* mobile: toggled via sidebar-hidden */
  #hamburger { display: block; }
}
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="brand"><i class="fas fa-brain"></i><span>Vitra AI</span></div>
    <nav>
      <a href="index.html"><i class="fas fa-seedling"></i><span>Herbal Medicine</span></a>
      <a href="psychology.html" class="active"><i class="fas fa-brain"></i><span>Psych & MH</span></a>
      <a href="dietetics.html"><i class="fas fa-utensils"></i><span>Dietetics</span></a>
      <a href="pharmacy.html"><i class="fas fa-prescription-bottle-alt"></i><span>E-Pharmacy</span></a>
      <a href="consult.html"><i class="fas fa-calendar-check"></i><span>Consult Booking</span></a>
    </nav>
    <button id="shrinkBtn" aria-label="Toggle sidebar"><i class="fas fa-angle-double-left"></i></button>
  </aside>

  <!-- HEADER -->
  <header>
    <i id="hamburger" class="fas fa-bars"></i>
    <h1>Neuropharma Command Center</h1>
    <i id="themeToggle" class="fas fa-moon"></i>
  </header>

  <!-- MAIN -->
  <main>

    <!-- HERO -->
    <section class="hero" id="hero">
      <h1><i class="fas fa-brain"></i> Empower Your Neuro-Health</h1>
      <p>Integrate genetics, neurotransmitters, EEG, and drug data—AI-driven insights for precision psychiatry.</p>
      <div class="actions">
        <a href="#therapybot" class="btn"><i class="fas fa-comments"></i> Therapy Bot</a>
        <a href="#moodTracker" class="btn btn-secondary"><i class="fas fa-sliders-h"></i> Mood Tracker</a>
        <a href="#neurotransmitter" class="btn"><i class="fas fa-flask"></i> Neuro Balance</a>
        <a href="#pharmacogenomics" class="btn btn-secondary"><i class="fas fa-dna"></i> Pharmaco-Genomics</a>
        <a href="#interactions" class="btn"><i class="fas fa-exchange-alt"></i> Drug Interactions</a>
        <a href="#eeg" class="btn btn-secondary"><i class="fas fa-wave-square"></i> EEG Analysis</a>
        <a href="#trialmatch" class="btn"><i class="fas fa-search"></i> Trial Matching</a>
      </div>
      <div class="hero-icons">
        <i class="fas fa-microscope"></i>
        <i class="fas fa-pills"></i>
        <i class="fas fa-wave-square"></i>
        <i class="fas fa-chart-line"></i>
      </div>
    </section>

    <!-- 1. Conversational Therapy Bot -->
    <section class="module" id="therapybot">
      <h2><i class="fas fa-robot"></i> Conversational Therapy Bot</h2>
      <p class="desc">Guided CBT, mindfulness, or emotional support—AI adapts to your modality, length, and language.</p>
      <form id="therapy-form">
        <label>Modality:
          <select id="therapyModality">
            <option value="CBT">CBT Exercises</option>
            <option value="mindfulness">Mindfulness</option>
            <option value="emotional">Emotional Support</option>
            <option value="guidedImagery">Guided Imagery</option>
          </select>
        </label>
        <label>Length:
          <select id="therapyLength">
            <option>5 minutes</option>
            <option>10 minutes</option>
            <option>20 minutes</option>
          </select>
        </label>
        <label>Language:
          <select id="therapyLang">
            <option>English</option>
            <option>Spanish</option>
            <option>French</option>
          </select>
        </label>
        <div style="display:flex;gap:.5rem;">
          <input id="therapyInput" type="text" placeholder="Describe what you need…" />
          <button id="sendChat" class="btn"><i class="fas fa-paper-plane"></i></button>
        </div>
      </form>
      <div class="tool-row" style="top:var(--padding);left:var(--padding);">
        <button id="clearChat" title="Clear Chat"><i class="fas fa-trash"></i></button>
        <button id="viewHistory" title="View History"><i class="fas fa-history"></i></button>
      </div>
      <div id="chatBox" class="chat-box"></div>
      <div id="chatHint" class="desc" style="display:none;">Bot is thinking… <span class="spinner"></span></div>
    </section>

    <section class="module" id="liveTherapist">
  <h2><i class="fas fa-user-md"></i> Talk to a Real Therapist</h2>
  <p class="desc">
    Not satisfied with AI? Chat live or book a session with a licensed professional.
  </p>
  <form id="liveTherapyForm">
    <label>Name:
      <input type="text" id="ltName" required placeholder="Your full name">
    </label>
    <label>Email:
      <input type="email" id="ltEmail" required placeholder="you@example.com">
    </label>
    <label>Phone:
      <input type="tel" id="ltPhone" required placeholder="0594121246">
    </label>
    <label>Preferred Contact Method:
      <select id="ltContactMethod" class="other-input-group">
        <option>Email</option>
        <option>Phone</option>
        <option value="Other">Other</option>
      </select>
      <input type="text" class="other-input" placeholder="Specify…" style="display:none;">
    </label>
    <label>Brief Description:
      <textarea id="ltMessage" rows="3" placeholder="How can we help you today?"></textarea>
    </label>
    <div style="display:flex;gap:.5rem;margin-top:.75rem;">
      <button type="submit" class="btn"><i class="fas fa-paper-plane"></i> Send Request</button>
      <button type="button" id="ltClear" class="btn btn-secondary"><i class="fas fa-trash"></i> Clear</button>
    </div>
  </form>
  <div id="liveTherapistPanel" class="response" hidden>
    <button class="close-btn"><i class="fas fa-times"></i></button>
    <div class="tool-row">
      <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
      <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
    </div>
    <div class="result-content">
      <!-- Filled in by JS after submission -->
    </div>
  </div>
</section>
    
    <section class="module" id="neurotransmitter">
  <h2><i class="fas fa-vial"></i> Neurotransmitter Balance</h2>
  <p class="desc">Integrate your mood, sleep, appetite, and med-adherence to get AI-driven neurochemical insights.</p>
  <form id="nt-form">
    <label>Mood (1–10):
      <input type="range" id="ntMood" min="1" max="10" value="5">
    </label>
    <label>Sleep Quality:
      <select id="ntSleep">
        <option>Poor</option><option>Fair</option><option>Good</option><option>Excellent</option>
      </select>
    </label>
    <label>Appetite:
      <select id="ntAppetite">
        <option>Low</option><option>Normal</option><option>High</option>
      </select>
    </label>
    <label>Medication Adherence:
      <select id="ntAdherence">
        <option>Poor</option><option>Fair</option><option>Good</option><option>Excellent</option>
      </select>
    </label>

    <!-- NEW: Key Neurotransmitter to Analyze -->
    <label>Focus Neurotransmitter:
      <select id="ntFocus">
        <option>Serotonin</option>
        <option>Dopamine</option>
        <option>GABA</option>
        <option>Glutamate</option>
        <option>Acetylcholine</option>
        <option>Histamine</option>
        <option>Oxytocin</option>
        <option>Vasopressin</option>
        <option>Endorphins</option>
        <option>Melatonin</option>
        <option>Cortisol</option>
        <option>Adrenaline</option>
        <option>Noradrenaline</option>
        <option>Enkephalins</option>
        <option>Substance P</option>
        <option>Dynorphin</option>
        <option>Glycine</option>
        <option>Aspartate</option>
        <option>Endocannabinoids</option>
        <option>Neuropeptide Y</option>
      </select>
    </label>

    <button id="analyzeNeuro" class="btn"><i class="fas fa-brain"></i> Analyze Balance</button>
  </form>
  <div id="neurotransmitterPanel" class="response" hidden>
    <button class="close-btn"><i class="fas fa-times"></i></button>
    <div class="tool-row">
      <button class="copy-btn"><i class="fas fa-copy"></i></button>
      <button class="dl-btn"><i class="fas fa-download"></i></button>
    </div>
    <div class="result-content"></div>
  </div>
</section>
    
    <!-- 2. Daily Mood Tracker -->
    <section class="module" id="moodTracker">
      <h2><i class="fas fa-sliders-h"></i> Daily Mood Tracker</h2>
      <p class="desc">Log mood, triggers, and journal entries—AI spots patterns and suggests self-care tips.</p>
      <form id="mood-form">
        <label for="moodRange">Mood Score: <strong><span id="moodValue">5</span>/10</strong></label>
        <input type="range" id="moodRange" min="1" max="10" value="5">
        <fieldset>
          <legend>Feelings (select up to 20):</legend>
          <div class="checkbox-group">
            <!-- 20 common emotions -->
            <label><input type="checkbox" name="emotions" value="Happy"> Happy</label>
            <label><input type="checkbox" name="emotions" value="Sad"> Sad</label>
            <label><input type="checkbox" name="emotions" value="Anxious"> Anxious</label>
            <label><input type="checkbox" name="emotions" value="Calm"> Calm</label>
            <label><input type="checkbox" name="emotions" value="Angry"> Angry</label>
            <label><input type="checkbox" name="emotions" value="Motivated"> Motivated</label>
            <label><input type="checkbox" name="emotions" value="Stressed"> Stressed</label>
            <label><input type="checkbox" name="emotions" value="Relaxed"> Relaxed</label>
            <label><input type="checkbox" name="emotions" value="Focused"> Focused</label>
            <label><input type="checkbox" name="emotions" value="Overwhelmed"> Overwhelmed</label>
            <label><input type="checkbox" name="emotions" value="Bored"> Bored</label>
            <label><input type="checkbox" name="emotions" value="Confident"> Confident</label>
            <label><input type="checkbox" name="emotions" value="Nervous"> Nervous</label>
            <label><input type="checkbox" name="emotions" value="Lonely"> Lonely</label>
            <label><input type="checkbox" name="emotions" value="Hopeful"> Hopeful</label>
            <label><input type="checkbox" name="emotions" value="Frustrated"> Frustrated</label>
            <label><input type="checkbox" name="emotions" value="Joyful"> Joyful</label>
            <label><input type="checkbox" name="emotions" value="Dull"> Dull</label>
            <label><input type="checkbox" name="emotions" value="Energetic"> Energetic</label>
            <label><input type="checkbox" name="emotions" value="Tired"> Tired</label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Triggers (select up to 20):</legend>
          <div class="checkbox-group">
            <!-- 20 triggers -->
            <label><input type="checkbox" name="triggers" value="Work"> Work</label>
            <label><input type="checkbox" name="triggers" value="Relationships"> Relationships</label>
            <label><input type="checkbox" name="triggers" value="Finance"> Finance</label>
            <label><input type="checkbox" name="triggers" value="Health"> Health</label>
            <label><input type="checkbox" name="triggers" value="Sleep"> Sleep</label>
            <label><input type="checkbox" name="triggers" value="Diet"> Diet</label>
            <label><input type="checkbox" name="triggers" value="Exercise"> Exercise</label>
            <label><input type="checkbox" name="triggers" value="Family"> Family</label>
            <label><input type="checkbox" name="triggers" value="Social"> Social</label>
            <label><input type="checkbox" name="triggers" value="Weather"> Weather</label>
            <label><input type="checkbox" name="triggers" value="Noise"> Noise</label>
            <label><input type="checkbox" name="triggers" value="Light"> Light</label>
            <label><input type="checkbox" name="triggers" value="Crowds"> Crowds</label>
            <label><input type="checkbox" name="triggers" value="Traffic"> Traffic</label>
            <label><input type="checkbox" name="triggers" value="Media"> Media</label>
            <label><input type="checkbox" name="triggers" value="Pets"> Pets</label>
            <label><input type="checkbox" name="triggers" value="Home"> Home</label>
            <label><input type="checkbox" name="triggers" value="Commute"> Commute</label>
            <label><input type="checkbox" name="triggers" value="Finances"> Finances</label>
            <label><input type="checkbox" name="triggers" value="Other"> Other</label>
          </div>
        </fieldset>
        <label for="moodNote">Journal Entry:</label>
        <textarea id="moodNote" rows="3" placeholder="What happened today?"></textarea>
        <label for="selfCare">Self-Care Focus:</label>
        <select id="selfCare">
          <optgroup label="Breathing & Relaxation">
            <option>Guided Breathing</option>
            <option>Progressive Muscle Relaxation</option>
          </optgroup>
          <optgroup label="Movement">
            <option>Stretch & Walk</option>
            <option>Yoga Flow</option>
          </optgroup>
          <optgroup label="Mindfulness">
            <option>Body Scan</option>
            <option>Sound Meditation</option>
          </optgroup>
          <optgroup label="Creative">
            <option>Music Break</option>
            <option>Art Prompt</option>
          </optgroup>
        </select>
        <button type="submit" class="btn"><i class="fas fa-chart-line"></i> Analyze Mood</button>
      </form>
      <div id="moodPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="result-content"></div>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn" title="Download"><i class="fas fa-download"></i></button>
        </div>
      </div>
    </section>

   
    <!-- Pharmacogenomics & Dosing – extra fields & options -->
    <section class="module" id="pharmacogenomics">
      <h2><i class="fas fa-dna"></i> Pharmacogenomics & Dosing</h2>
      <p class="desc">Upload genotype & clinical info for AI-optimized dosing.</p>
      <form id="pgx-form">
        <label>Upload Genotype (VCF):
          <input type="file" id="pgxUpload" accept=".vcf,.txt">
        </label>
        <label style="margin-top:1rem;">Sex:
          <select id="pgxSex" required><option>Male</option><option>Female</option><option>Other</option></select>
        </label>
        <label>Age:
          <input type="number" id="pgxAge" min="0" required>
        </label>
        <label>Weight (kg):
          <input type="number" id="pgxWeight" min="1">
        </label>
        <label>Drug:
          <select id="pgxDrug">
            <option>Clopidogrel</option><option>Warfarin</option><option>Codeine</option>
            <option>Citalopram</option><option>Sertraline</option><option>Fluoxetine</option>
            <option>Risperidone</option><option>Lithium</option><option>Valproate</option>
            <option>Lamotrigine</option><option>Other</option>
          </select>
        </label>
        <input id="pgxDrugOther" type="text" placeholder="Enter drug…" style="display:none;margin-top:.5rem;"/>
        <label>Gene Variant:
          <select id="pgxGene">
            <option>CYP2C19*1</option><option>CYP2C19*2</option><option>CYP2C19*3</option>
            <option>CYP2D6*1</option><option>CYP2D6*4</option><option>TPMT*1</option>
            <option>UGT1A1*28</option><option>VKORC1</option><option>MTHFR C677T</option>
            <option>HLA-B*57:01</option><option>SLCO1B1*5</option><option>Other</option>
          </select>
        </label>
        <button id="runPGx" class="btn" style="margin-top:1rem;"><i class="fas fa-flask"></i> Run PGx Analysis</button>
      </form>
      <div id="pharmacogenomicsPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
<div class="tool-row">
  <button class="copy-btn"><i class="fas fa-copy"></i></button>
  <button class="dl-btn"><i class="fas fa-download"></i></button>
</div>
<div class="result-content"></div>
      </div>
    </section>
    
    <!-- 3. Dream & Subconscious Explorer -->
    <section class="module" id="dream">
      <h2><i class="fas fa-bed"></i> Dream & Subconscious Explorer</h2>
      <p class="desc">Capture narratives, symbols, ambient sounds—AI surfaces hidden archetypes and patterns.</p>

      <!-- Narrative -->
      <label for="dreamText">Dream Narrative:</label>
      <textarea id="dreamText" rows="4" placeholder="I found myself…"></textarea>

      <!-- Symbols -->
      <fieldset>
        <legend>Symbols & Themes (20+):</legend>
        <div class="checkbox-group">
          <label><input type="checkbox" value="Water"> Water</label>
          <label><input type="checkbox" value="Flight"> Flight</label>
          <label><input type="checkbox" value="Teeth"> Teeth</label>
          <label><input type="checkbox" value="Chase"> Being Chased</label>
          <label><input type="checkbox" value="Falling"> Falling</label>
          <label><input type="checkbox" value="Fire"> Fire</label>
          <label><input type="checkbox" value="Forest"> Forest</label>
          <label><input type="checkbox" value="Animals"> Animals</label>
          <label><input type="checkbox" value="Darkness"> Darkness</label>
          <label><input type="checkbox" value="Light"> Light</label>
          <label><input type="checkbox" value="Doors"> Doors</label>
          <label><input type="checkbox" value="Mirrors"> Mirrors</label>
          <label><input type="checkbox" value="Vehicles"> Vehicles</label>
          <label><input type="checkbox" value="People"> People</label>
          <label><input type="checkbox" value="Waterfall"> Waterfall</label>
          <label><input type="checkbox" value="Labyrinth"> Labyrinth</label>
          <label><input type="checkbox" value="Other"/> Other: <input type="text" id="otherSymbol" placeholder="Your symbol"></label>
        </div>
      </fieldset>

      <!-- Mood Before/After -->
      <div style="display:flex;gap:1rem;">
        <div style="flex:1;">
          <label>Mood Before Sleep:
            <select id="preMood">
              <option disabled selected>Select…</option>
              <option>Calm</option><option>Anxious</option><option>Neutral</option>
              <option>Excited</option><option>Sad</option><option>Other</option>
            </select>
          </label>
        </div>
        <div style="flex:1;">
          <label>Mood On Waking:
            <select id="postMood">
              <option disabled selected>Select…</option>
              <option>Refreshed</option><option>Tired</option><option>Confused</option>
              <option>Inspired</option><option>Anxious</option><option>Other</option>
            </select>
          </label>
        </div>
      </div>

      <!-- Tags -->
      <label for="dreamTags">Contextual Tags (comma-separated):</label>
      <input type="text" id="dreamTags" placeholder="exam, hometown, graduation">

      <!-- Reflection -->
      <label for="dreamReflect">Reflection & Intentions:</label>
      <textarea id="dreamReflect" rows="3" placeholder="My reflection…"></textarea>

      <!-- Actions -->
      <div style="display:flex;gap:.75rem;margin-top:1rem;">
        <button id="analyzeDream" class="btn"><i class="fas fa-brain"></i> Analyze Dream</button>
        <button id="interpretSymbols" class="btn btn-secondary"><i class="fas fa-search"></i> Interpret Symbols</button>
        <button id="generatePrompts" class="btn btn-secondary"><i class="fas fa-pen-nib"></i> Generate Prompts</button>
      </div>

      <!-- Response -->
      <div id="dreamPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"   title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>


    <!--  Drug Interaction Profiler & Comorbid Conditions -->
    <section class="module" id="interactions">
      <h2><i class="fas fa-exchange-alt"></i> Drug Interaction Profiler</h2>
      <p class="desc">Enter meds & conditions to get interaction risk report.</p>
      <form id="int-form">
        <label>Med List:
          <select id="intListSelect">
            <option>Sertraline</option><option>Fluoxetine</option><option>Paroxetine</option>
            <option>Escitalopram</option><option>Venlafaxine</option><option>Duloxetine</option>
            <option>Risperidone</option><option>Quetiapine</option><option>Lithium</option>
            <option>Valproate</option><option>Lamotrigine</option><option>Carbamazepine</option>
            <option>Topiramate</option><option>Gabapentin</option><option>Pregabalin</option>
            <option>Clonazepam</option><option>Diazepam</option><option>Alprazolam</option>
            <option>Buspirone</option><option>Other</option>
          </select>
        </label>
        <input id="intListOther" type="text" placeholder="Enter drug…" style="display:none;margin-top:.5rem;"/>

        <label style="margin-top:1rem;">Comorbid Conditions:
          <select id="intComorbid">
            <option>Schizophrenia</option><option>Bipolar Disorder</option><option>Depression</option>
            <option>OCD</option><option>Anxiety</option><option>Autism</option>
            <option>ADHD</option><option>Dementia</option><option>Alzheimer’s</option>
            <option>Parkinson’s</option><option>PTSD</option><option>Epilepsy</option>
            <option>Insomnia</option><option>Substance Use</option><option>Anorexia</option>
            <option>Bulimia</option><option>Phobia</option><option>Psychosis</option>
            <option>Other</option>
          </select>
        </label>
        <button id="checkInt" class="btn" style="margin-top:1rem;"><i class="fas fa-pills"></i> Check Interactions</button>
      </form>
      <div id="interactionsPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
<div class="tool-row">
  <button class="copy-btn"><i class="fas fa-copy"></i></button>
  <button class="dl-btn"><i class="fas fa-download"></i></button>
</div>
<div class="result-content"></div>
      </div>
    </section>
    
    <!-- 4. AI-Curated Creative Therapies -->
    <section class="module" id="creative">
      <h2><i class="fas fa-palette"></i> AI-Curated Creative Therapies</h2>
      <p class="desc">Generate art, music, poetry or journaling prompts—all tailored to your mood and style.</p>
      <form id="creative-form">
        <label>Type:
          <select id="creativeType">
            <option value="art">Abstract Art</option>
            <option value="music">Soundscape</option>
            <option value="poetry">Poetry</option>
            <option value="journaling">Journaling Prompts</option>
          </select>
        </label>
        <label>Style:
          <select id="creativeStyle">
            <option>Calm & Soft</option><option>Vibrant & Bold</option><option>Mystical</option><option>Minimalist</option>
          </select>
        </label>
        <label>Detail Level:
          <input type="range" id="creativeDetail" min="1" max="10" value="5">
        </label>
        <button id="artEmotion" class="btn"><i class="fas fa-brush"></i> Generate</button>
      </form>
      <div id="creativePanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

     <!-- 7. EEG & Brainwave Interpreter: require file before submit -->
    <section class="module" id="eeg">
      <h2><i class="fas fa-wave-square"></i> EEG & Brainwave Interpreter</h2>
      <p class="desc">Upload EEG data—AI decodes patterns.</p>
      <form id="eeg-form">
        <label>Upload EEG File (EDF/CSV):
          <input type="file" id="eegFile" accept=".edf,.csv">
        </label>
        <label style="margin-top:1rem;">Condition:
          <select id="eegCondition">
            <!-- 20 conditions + Other… -->
            <option>Resting Eyes Closed</option><option>Resting Eyes Open</option>
            <option>Sleep Stage 1</option><option>Sleep Stage 2</option><option>REM Sleep</option>
            <option>Meditation</option><option>Reading</option><option>Stress Task</option>
            <option>Typing</option><option>Video Watching</option><option>Other</option>
          </select>
        </label>
        <button id="analyzeEEG" class="btn" style="margin-top:1rem;"><i class="fas fa-microchip"></i> Analyze EEG</button>
      </form>
      <div id="eegPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
<div class="tool-row">
  <button class="copy-btn"><i class="fas fa-copy"></i></button>
  <button class="dl-btn"><i class="fas fa-download"></i></button>
</div>
<div class="result-content"></div>
      </div>
    </section>

    
    <!-- 5. Dynamic Cognitive Games -->
    <section class="module" id="games">
      <h2><i class="fas fa-gamepad"></i> Dynamic Cognitive Games</h2>
      <p class="desc">Logic puzzles, memory matches, and story co-creation for brain training.</p>
      <form id="games-form">
        <label>Game Type:
          <select id="gameType">
            <option value="puzzle">Logic Puzzle</option>
            <option value="memory">Memory Match</option>
            <option value="story">Story Co-Write</option>
          </select>
        </label>
        <label>Difficulty:
          <select id="gameDifficulty">
            <option>Easy</option><option>Medium</option><option>Hard</option>
          </select>
        </label>
        <button id="puzzles" class="btn"><i class="fas fa-puzzle-piece"></i> Start</button>
      </form>
      <div id="gamesPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 6. Medication Management & Safety -->
    <section class="module" id="medsafety">
      <h2><i class="fas fa-pills"></i> Medication Management & Safety</h2>
      <p class="desc">Enter your current meds, check interactions, and set adherence reminders.</p>
      <form id="medsafety-form">
        <label>Medications (comma-separated):
          <input type="text" id="medList" placeholder="e.g. Sertraline, Ibuprofen">
        </label>
        <button id="medInteraction" class="btn"><i class="fas fa-exchange-alt"></i> Check Interactions</button>
        <button id="adherence" class="btn btn-secondary"><i class="fas fa-check-circle"></i> Set Reminders</button>
      </form>
      <div id="medsafetyPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>

    <!-- 7. Symptom Questionnaire -->
    <section class="module" id="symptomQuiz">
      <h2><i class="fas fa-clipboard-list"></i> Symptom Questionnaire</h2>
      <p class="desc">Standardized survey—AI scores severity and suggests next steps.</p>
      <form id="quiz-form">
        <label>Sleep Quality:
          <select name="sleep">
            <option>Poor</option><option>Fair</option><option>Good</option>
          </select>
        </label>
        <label>Appetite:
          <select name="appetite">
            <option>Low</option><option>Normal</option><option>High</option>
          </select>
        </label>
        <label>Concentration:
          <select name="concentration">
            <option>Impaired</option><option>Average</option><option>Sharp</option>
          </select>
        </label>
        <button id="launchQuiz" class="btn"><i class="fas fa-play"></i> Submit & Analyze</button>
      </form>
      <div id="quizPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
        <div class="tool-row">
          <button class="copy-btn"><i class="fas fa-copy"></i></button>
          <button class="dl-btn"><i class="fas fa-download"></i></button>
        </div>
        <div class="result-content"></div>
      </div>
    </section>


     <!-- 6. Clinical Trial Matcher (with 20 options + Other) -->
    <section class="module" id="trialmatch">
      <h2><i class="fas fa-handshake"></i> Clinical Trial Matcher</h2>
      <p class="desc">Describe your diagnosis & location—AI suggests trials.</p>
      <form id="trial-form">
        <label>Diagnosis:
          <select id="trialDx">
            <option>Anxiety</option><option>Depression</option><option>Schizophrenia</option>
            <option>Bipolar Disorder</option><option>ADHD</option><option>PTSD</option>
            <option>OCD</option><option>Insomnia</option><option>Autism</option>
            <option>Parkinson’s</option><option>Alzheimer’s</option><option>Epilepsy</option>
            <option>Migraine</option><option>Dementia</option><option>Substance Use</option>
            <option>Phobia</option><option>Anorexia</option><option>Bulimia</option>
            <option>Borderline Personality</option><option value="other">Other</option>
          </select>
        </label>
        <input id="trialDxOther" type="text" placeholder="Enter diagnosis…" style="display:none;margin-top:.5rem;"/>

        <label style="margin-top:1rem;">Location:
          <input id="trialLoc" type="text" placeholder="City, Country">
        </label>

        <label style="margin-top:1rem;">Trial Phase:
          <select id="trialPhase">
            <option>Phase I</option><option>Phase II</option><option>Phase III</option><option>Phase IV</option>
            <option>First-in-Human</option><option>Proof-of-Concept</option><option>Open-Label</option>
            <option>Randomized</option><option>Double-Blind</option><option>Placebo-Controlled</option>
            <option>Adaptive Design</option><option>Dose-Escalation</option><option>Biomarker Study</option>
            <option>Observational</option><option>Longitudinal</option><option>Cross-Over</option>
            <option>Basket Trial</option><option>Umbrella Trial</option><option>N-of-1 Trial</option>
            <option value="other">Other</option>
          </select>
        </label>
        <button id="findTrials" class="btn" style="margin-top:1rem;"><i class="fas fa-search"></i> Find Trials</button>
      </form>
      <div id="trialmatchPanel" class="response" hidden>
        <button class="close-btn"><i class="fas fa-times"></i></button>
<div class="tool-row">
  <button class="copy-btn"><i class="fas fa-copy"></i></button>
  <button class="dl-btn"><i class="fas fa-download"></i></button>
</div>
<div class="result-content"></div>
      </div>
    </section>
    
    <!-- 8. Data Analytics & ROI with Date-Range filtering -->
    <section class="module" id="analytics">
      <h2><i class="fas fa-chart-pie"></i> Data Analytics & ROI</h2>
      <p class="desc">Visualize metrics & export CSV reports.</p>
      <div style="display:flex;gap:1rem;flex-wrap:wrap;">
        <label>Date Range:
          <input type="date" id="analyticsFrom"> –
          <input type="date" id="analyticsTo">
        </label>
        <button id="exportCharts" class="btn"><i class="fas fa-file-export"></i> Export CSV</button>
      </div>
      <div class="charts" style="margin-top:1rem;">
        <div class="chart-card"><canvas id="engagementChart" height="200"></canvas><figcaption>Sessions Over Time</figcaption></div>
        <div class="chart-card"><canvas id="outcomeChart" height="200"></canvas><figcaption>Outcome Metrics</figcaption></div>
      </div>
    </section>
    
    <!-- FOOTER -->
    <footer style="text-align:center;padding:1rem;background:var(--surface);color:var(--muted)">
      &copy; 2025 Vitra AI – Neuropharma Command Center
    </footer>

  </main>

 <!-- Chart.js + OpenAI Proxy + App Logic -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // ── OpenAI Proxy + Markdown→HTML Helper ─────────────────────────────────
  async function callOpenAI(messages) {
    const res = await fetch('/.netlify/functions/openai-proxy', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ messages })
    });
    if (!res.ok) throw new Error('OpenAI error');
    const j = await res.json();
    return j.choices[0].message.content;
  }

  function formatHTML(txt) {
    return txt
      .replace(/^### (.*$)/gim, '<h3>$1</h3>')                   // convert ### headings
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')          // bold
      .replace(/\*(.+?)\*/g, '<em>$1</em>')                      // italics
      .split(/\n{2,}/).map(p => `<p>${p.trim()}</p>`).join(''); // paragraphs
  }

  // ── Global “Other”-input handler ─────────────────────────────────────
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', () => {
        const otherInput = select.parentElement.querySelector('.other-input');
        if (!otherInput) return;
        otherInput.style.display =
          select.value.toLowerCase() === 'other' ? 'block' : 'none';
      });
    });
  });

  // Returns the select’s choice or, if “Other”, the custom input’s value
  function getSelectValue(select) {
    const otherInput = select.parentElement.querySelector('.other-input');
    if (otherInput && select.value.toLowerCase() === 'other') {
      return otherInput.value.trim();
    }
    return select.value;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const body = document.body;

    // ── PANEL UTILITY ─────────────────────────────────────────────────────
    function getPanel(sectionId) {
      const sec = document.getElementById(sectionId);
      let panel = sec.querySelector('.response');
      panel.hidden = false;
      return panel;
    }

    // ── Sidebar & Theme Toggles ───────────────────────────────────────────
    document.getElementById('shrinkBtn').onclick = () =>
      body.classList.toggle('sidebar-hidden');
    document.getElementById('hamburger').onclick = () =>
      body.classList.toggle('sidebar-hidden');
    document.getElementById('themeToggle').onclick = () => {
      document.documentElement.classList.toggle('dark');
      document.getElementById('themeToggle').classList.toggle('fa-sun');
    };

    // ── Delegated Response Buttons (copy, download, close) ────────────────
    body.addEventListener('click', e => {
      // Copy
      if (e.target.closest('.copy-btn')) {
        const btn = e.target.closest('.copy-btn');
        const text = btn.closest('.response').querySelector('.result-content').innerText;
        navigator.clipboard.writeText(text).then(() => {
          btn.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(() => btn.innerHTML = '<i class="fas fa-copy"></i>', 1000);
        });
      }
      // Download
      if (e.target.closest('.dl-btn')) {
        const text = e.target.closest('.response').querySelector('.result-content').innerText;
        const blob = new Blob([text], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'response.txt';
        a.click();
      }
      // Close panel
      if (e.target.closest('.close-btn')) {
        e.target.closest('.response').hidden = true;
      }
    });

    // ── Therapy Bot ────────────────────────────────────────────────────────
    const chatBox   = document.getElementById('chatBox'),
          chatHint  = document.getElementById('chatHint'),
          chatInput = document.getElementById('therapyInput'),
          history   = [];

    function addMessage(who, txt) {
      const msg = document.createElement('div');
      msg.className = who === 'You' ? 'user-msg' : 'bot-msg';
      msg.innerHTML = `${formatHTML(txt)}<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
      chatBox.append(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    document.getElementById('sendChat').onclick = async e => {
      e.preventDefault();
      const txt = chatInput.value.trim();
      if (!txt) return;
      addMessage('You', txt);
      history.push({ who: 'You', text: txt });
      chatInput.value = '';
      chatHint.style.display = 'block';

      const sys = `You are a therapist. Modality=${getSelectValue(therapyModality)};` +
                  `Length=${getSelectValue(therapyLength)};Language=${getSelectValue(therapyLang)}.`;
      try {
        const reply = await callOpenAI([
          { role: 'system', content: sys },
          { role: 'user', content: txt }
        ]);
        addMessage('Therapist', reply);
        history.push({ who: 'Therapist', text: reply });
      } catch {
        addMessage('Therapist', '⚠️ Something went wrong.');
      } finally {
        chatHint.style.display = 'none';
      }
    };

    document.getElementById('clearChat').onclick = () => {
      chatBox.innerHTML = '';
      history.length = 0;
    };

    document.getElementById('viewHistory').onclick = () => {
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:2000';
      modal.innerHTML = `
        <div style="background:var(--surface);padding:1rem;border-radius:var(--radius);max-width:400px;width:90%;position:relative;">
          <h3>Chat History</h3>
          <button style="position:absolute;top:.5rem;right:.5rem;border:none;background:none;font-size:1.2rem;cursor:pointer;"
                  onclick="this.closest('div').parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
          <ul style="list-style:none;padding:0;max-height:300px;overflow:auto;">
            ${history.map((m, i) => `
            <li style="margin:.5rem 0;">
              <strong>${m.who}:</strong> ${m.text}
              <button data-i="${i}" style="float:right;border:none;background:none;color:var(--secondary);cursor:pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </li>`).join('')}
          </ul>
        </div>`;
      document.body.append(modal);
      modal.querySelectorAll('button[data-i]').forEach(btn => {
        btn.onclick = () => {
          history.splice(+btn.dataset.i, 1);
          modal.remove();
        };
      });
    };

    // Show/hide “Other” for live therapist
document.getElementById('ltContactMethod').addEventListener('change', e => {
  const inp = e.target.parentElement.querySelector('.other-input');
  inp.style.display = e.target.value === 'Other' ? 'block' : 'none';
});

// Handle submission
document.getElementById('liveTherapyForm').onsubmit = async e => {
  e.preventDefault();
  const panel = getPanel('liveTherapist');
  panel.innerHTML = `<div class="result-content">Submitting…<span class="spinner"></span></div>`;
  const data = {
    name: document.getElementById('ltName').value.trim(),
    email: document.getElementById('ltEmail').value.trim(),
    phone: document.getElementById('ltPhone').value.trim(),
    contact: getSelectValue(document.getElementById('ltContactMethod')),
    message: document.getElementById('ltMessage').value.trim()
  };
  // You could either POST this to your backend or simply echo it:
  panel.innerHTML = `
    <div class="result-content">
      Thank you, <strong>${data.name}</strong>!<br>
      We will reach you at <strong>${data.contact === 'Email' ? data.email : data.phone}</strong> shortly.<br>
      — Your Therapist Team
    </div>`;
};
document.getElementById('ltClear').onclick = () => {
  document.getElementById('liveTherapyForm').reset();
  document.querySelector('#liveTherapyForm .other-input').style.display = 'none';
};
    
    // ── Mood Tracker ──────────────────────────────────────────────────────
    moodRange.oninput = () => moodValue.textContent = moodRange.value;
    document.getElementById('mood-form').onsubmit = async e => {
      e.preventDefault();
      const panel = getPanel('moodTracker');
      panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;
      const data = {
        mood: moodRange.value,
        emotions: [...document.querySelectorAll('#moodTracker input[name="emotions"]:checked')].map(c=>c.value),
        triggers: [...document.querySelectorAll('#moodTracker input[name="triggers"]:checked')].map(c=>c.value),
        note: document.getElementById('moodNote').value.trim(),
        selfCare: getSelectValue(selfCare)
      };
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a mental health assistant.' },
          { role: 'user', content: `Daily Mood Entry:\n${JSON.stringify(data)}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Dream Explorer ────────────────────────────────────────────────────
    function wireDream(btnId, sysPrompt, buildContent) {
      document.getElementById(btnId).onclick = async () => {
        const panel = getPanel('dream');
        panel.innerHTML = `<div class="result-content">Processing…<span class="spinner"></span></div>`;
        try {
          const reply = await callOpenAI([
            { role: 'system', content: sysPrompt },
            { role: 'user', content: buildContent() }
          ]);
          panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
        } catch {
          panel.innerHTML = `<div class="result-content">😕 Oops! Something went wrong.</div>`;
        }
      };
    }
    wireDream('analyzeDream',
      'You are a dream interpreter. Use all details.',
      () => {
        const narrative = document.getElementById('dreamText').value.trim();
        const symbols   = [...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(cb=>cb.value).join(', ');
        const pre       = getSelectValue(preMood);
        const post      = getSelectValue(postMood);
        const tags      = document.getElementById('dreamTags').value.trim();
        const refl      = document.getElementById('dreamReflect').value.trim();
        return `Narrative: ${narrative}\nSymbols: ${symbols}\nBefore sleep: ${pre}\nOn waking: ${post}\nTags: ${tags}\nReflection: ${refl}`;
      });
    wireDream('interpretSymbols',
      'You are a dream symbol interpreter.',
      () => [...document.querySelectorAll('#dream input[type="checkbox"]:checked')].map(cb=>cb.value).join(', '));
    wireDream('generatePrompts',
      'You are a creative writing assistant.',
      () => `Generate 3 journaling prompts based on: ${document.getElementById('dreamText').value.trim()}`);

    // ── Creative Therapies ────────────────────────────────────────────────
    const rd = creativeDetail, rv = document.createElement('span');
    rv.className = 'range-display'; rd.after(rv);
    rd.oninput = () => rv.textContent = ` (${rd.value})`;
    rd.oninput();
    document.getElementById('artEmotion').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('creative');
      panel.innerHTML = `<div class="result-content">Generating…<span class="spinner"></span></div>`;
      const type   = getSelectValue(creativeType);
      const style  = getSelectValue(creativeStyle);
      const detail = rd.value;
      try {
        const reply = await callOpenAI([
          { role: 'system', content: `You are a creative AI generating ${type} in a ${style} style with detail level ${detail}.` },
          { role: 'user', content: 'Please produce one creative piece.' }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">⚠️ Something went wrong.</div>`;
      }
    };

    // ── Cognitive Games ──────────────────────────────────────────────────
    document.getElementById('puzzles').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('games');
      panel.innerHTML = `<div class="result-content">Starting…<span class="spinner"></span></div>`;
      const game = getSelectValue(gameType);
      const diff = getSelectValue(gameDifficulty);
      try {
        const reply = await callOpenAI([
          { role: 'system', content: `You are a games master creating a ${diff} ${game}.` },
          { role: 'user', content: 'Please generate one challenge.' }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">⚠️ Something went wrong.</div>`;
      }
    };

    // ── Medication Safety ────────────────────────────────────────────────
    document.getElementById('medInteraction').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('medsafety');
      panel.innerHTML = `<div class="result-content">Checking…<span class="spinner"></span></div>`;
      const meds = document.getElementById('medList').value.trim();
      if (!meds) { panel.innerHTML = ''; return; }
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a drug interaction checker.' },
          { role: 'user', content: `Medications: ${meds}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };
    document.getElementById('adherence').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('medsafety');
      panel.innerHTML = `<div class="result-content">Generating reminders…<span class="spinner"></span></div>`;
      const meds = document.getElementById('medList').value.trim();
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a medication adherence coach.' },
          { role: 'user', content: `Create a daily schedule for: ${meds}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Symptom Quiz ──────────────────────────────────────────────────────
    document.getElementById('launchQuiz').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('symptomQuiz');
      panel.innerHTML = `<div class="result-content">Scoring…<span class="spinner"></span></div>`;
      const s = getSelectValue(document.querySelector('select[name="sleep"]'));
      const a = getSelectValue(document.querySelector('select[name="appetite"]'));
      const c = getSelectValue(document.querySelector('select[name="concentration"]'));
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a clinical symptom scoring assistant.' },
          { role: 'user', content: `Sleep:${s},Appetite:${a},Concentration:${c}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Data Analytics & CSV Export ───────────────────────────────────────
    const engCtx = document.getElementById('engagementChart').getContext('2d'),
          outCtx = document.getElementById('outcomeChart').getContext('2d');
    const engChart = new Chart(engCtx, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri'],
        datasets: [{
          label: 'Sessions',
          data: [12,9,14,11,13],
          borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary').trim(),
          fill: false
        }]
      }
    });
    const outChart = new Chart(outCtx, {
      type: 'bar',
      data: {
        labels: ['Week 1','Week 2','Week 3'],
        datasets: [{
          label: 'Outcome',
          data: [3.2,4.1,4.5],
          backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim()
        }]
      }
    });

    analyticsFrom.onchange = analyticsTo.onchange = () => {
      // TODO: apply real date-range filter logic here, then:
      engChart.update();
      outChart.update();
    };
    document.getElementById('exportCharts').onclick = () => {
      let csv = 'Chart,Label,Value\n';
      [['Sessions', engChart], ['Outcome', outChart]].forEach(([name, ch]) => {
        ch.data.labels.forEach((lab, i) => {
          csv += `${name},${lab},${ch.data.datasets[0].data[i]}\n`;
        });
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href = url; a.download = 'analytics.csv'; a.click();
      URL.revokeObjectURL(url);
    };

    // ── Neurotransmitter Balance ─────────────────────────────────────────
    document.getElementById('analyzeNeuro').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('neurotransmitter');
      panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;
      const data = {
        mood:      document.getElementById('ntMood').value,
        sleep:     getSelectValue(ntSleep),
        appetite:  getSelectValue(ntAppetite),
        adherence: getSelectValue(ntAdherence),
        focus:     getSelectValue(ntFocus)
      };
      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a neurotransmitter balance specialist.' },
          { role: 'user', content: `Profile Data:\n${JSON.stringify(data)}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Pharmacogenomics & Dosing ────────────────────────────────────────
    pgxDrug.onchange = () => pgxDrug.parentElement.querySelector('.other-input').style.display =
      pgxDrug.value.toLowerCase() === 'other' ? 'block' : 'none';

    document.getElementById('runPGx').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('pharmacogenomics');
      panel.innerHTML = `<div class="result-content">Processing…<span class="spinner"></span></div>`;

      const drug   = getSelectValue(pgxDrug);
      const gene   = getSelectValue(pgxGene);
      const sex    = getSelectValue(pgxSex);
      const age    = document.getElementById('pgxAge').value.trim();

      if (!pgxUpload.files.length || !drug || !gene || !sex || !age) {
        panel.innerHTML = `<div class="result-content">❗ Please fill in all required fields.</div>`;
        return;
      }

      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a pharmacogenomics expert.' },
          { role: 'user', content: `Sex:${sex},Age:${age},Weight:${document.getElementById('pgxWeight').value},Drug:${drug},Gene:${gene}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Drug Interaction Profiler ───────────────────────────────────────
    intListSelect.onchange = () => intListSelect.parentElement.querySelector('.other-input').style.display =
      intListSelect.value.toLowerCase() === 'other' ? 'block' : 'none';

    document.getElementById('checkInt').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('interactions');
      panel.innerHTML = `<div class="result-content">Checking…<span class="spinner"></span></div>`;

      const meds = getSelectValue(intListSelect);
      const cond = getSelectValue(intComorbid);

      if (!meds) { panel.innerHTML = ''; return; }

      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a drug interaction profiler.' },
          { role: 'user', content: `Medications: ${meds}\nComorbid: ${cond}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── EEG & Brainwave Interpreter ─────────────────────────────────────
    eegCondition.onchange = () => eegCondition.parentElement.querySelector('.other-input').style.display =
      eegCondition.value.toLowerCase() === 'other' ? 'block' : 'none';

    document.getElementById('analyzeEEG').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('eeg');
      if (!eegFile.files.length) {
        panel.innerHTML = `<div class="result-content">❗ Please upload a file.</div>`;
        return;
      }
      panel.innerHTML = `<div class="result-content">Analyzing…<span class="spinner"></span></div>`;

      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are an EEG & brainwave interpreter.' },
          { role: 'user', content: `EEG Uploaded. Condition: ${getSelectValue(eegCondition)}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };

    // ── Clinical Trial Finder ────────────────────────────────────────────
    trialDx.onchange = () => trialDx.parentElement.querySelector('.other-input').style.display =
      trialDx.value.toLowerCase() === 'other' ? 'block' : 'none';
    trialPhase.onchange = () => trialPhase.parentElement.querySelector('.other-input').style.display =
      trialPhase.value.toLowerCase() === 'other' ? 'block' : 'none';

    document.getElementById('findTrials').onclick = async e => {
      e.preventDefault();
      const panel = getPanel('trialmatch');
      panel.innerHTML = `<div class="result-content">Searching…<span class="spinner"></span></div>`;

      const dx  = getSelectValue(trialDx);
      const loc = document.getElementById('trialLoc').value.trim();
      const ph  = getSelectValue(trialPhase);

      if (!dx || !loc) { panel.innerHTML = ''; return; }

      try {
        const reply = await callOpenAI([
          { role: 'system', content: 'You are a clinical trial matching engine.' },
          { role: 'user', content: `Diagnosis: ${dx}\nLocation: ${loc}\nPhase: ${ph}` }
        ]);
        panel.innerHTML = `<div class="result-content">${formatHTML(reply)}</div>`;
      } catch {
        panel.innerHTML = `<div class="result-content">😕 Something went wrong.</div>`;
      }
    };
  });
</script>
  
</body>
</html>
